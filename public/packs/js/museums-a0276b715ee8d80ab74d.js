/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "/packs/";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./app/javascript/packs/museums.js");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./app/javascript/packs/museums.js":
/*!*****************************************!*\
  !*** ./app/javascript/packs/museums.js ***!
  \*****************************************/
/*! exports provided: findMuseum */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* WEBPACK VAR INJECTION */(function(process) {/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "findMuseum", function() { return findMuseum; });
/* harmony import */ var mapbox_gl__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mapbox-gl */ "./node_modules/mapbox-gl/dist/mapbox-gl.js");
/* harmony import */ var mapbox_gl__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mapbox_gl__WEBPACK_IMPORTED_MODULE_0__);


__webpack_require__(/*! dotenv */ "./node_modules/dotenv/lib/main.js").config(); // display map
// const showMap = (coordinates) => {
//   mapboxgl.accessToken = token;
//   const map = new mapboxgl.Map({
//     container: 'map',
//     style: 'mapbox://styles/mapbox/streets-v9',
//     center: coordinates,
//     zoom: 12
//   });
//   new mapboxgl.Marker()
//     .setLngLat(coordinates)
//     .addTo(map);
// };
// const submitButton = document.querySelector('#submit');
// submitButton.addEventListener('click', (event) => {
//   event.preventDefault();
//   const coordinates = document.querySelector('#text').value;
//   const url = `https://api.mapbox.com/geocoding/v5/mapbox.places/museum.json?types=poi&proximity=${coordinates}&limit=5&access_token=${process.env.MAPBOX_API_KEY}`;
//   fetch(url)
//     .then(response => response.json())
//     .then((data) => {
//       console.log(data);
//       data.features.forEach((feature) => {
//         const autoComp = `
//         <span>${feature.place_name}</span>`;
//         paragraph.insertAdjacentHTML("beforeend", autoComp);
//       });
//       // showMap(coordinates);
//     });
// });


var findMuseum = function findMuseum() {
  var submitButton = document.querySelector('#submit');
  submitButton.addEventListener('click', function (event) {
    event.preventDefault();
    var coordinates = document.querySelector('#text').value;
    var url = "https://api.mapbox.com/geocoding/v5/mapbox.places/museum.json?types=poi&proximity=".concat(coordinates, "&limit=5&access_token=").concat(process.env.MAPBOX_API_KEY);
    fetch(url).then(function (response) {
      return response.json();
    }).then(function (data) {
      console.log(data);
      data.features.forEach(function (feature) {
        var postalCode = feature.context[0].id;
        var museum = feature.place_name;
        console.log(museum);
        console.log(postalCode.substr(9, postalCode.length));
      });
    });
  });
};


/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../../../node_modules/process/browser.js */ "./node_modules/process/browser.js")))

/***/ }),

/***/ "./node_modules/dotenv/lib/main.js":
/*!*****************************************!*\
  !*** ./node_modules/dotenv/lib/main.js ***!
  \*****************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(process) {var fs = __webpack_require__(/*! fs */ "./node_modules/node-libs-browser/mock/empty.js");

var path = __webpack_require__(/*! path */ "./node_modules/path-browserify/index.js");

var os = __webpack_require__(/*! os */ "./node_modules/os-browserify/browser.js");

var LINE = /(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/mg; // Parser src into an Object

function parse(src) {
  var obj = {}; // Convert buffer to string

  var lines = src.toString(); // Convert line breaks to same format

  lines = lines.replace(/\r\n?/mg, '\n');
  var match;

  while ((match = LINE.exec(lines)) != null) {
    var key = match[1]; // Default undefined or null to empty string

    var value = match[2] || ''; // Remove whitespace

    value = value.trim(); // Check if double quoted

    var maybeQuote = value[0]; // Remove surrounding quotes

    value = value.replace(/^(['"`])([\s\S]*)\1$/mg, '$2'); // Expand newlines if double quoted

    if (maybeQuote === '"') {
      value = value.replace(/\\n/g, '\n');
      value = value.replace(/\\r/g, '\r');
    } // Add to object


    obj[key] = value;
  }

  return obj;
}

function _log(message) {
  console.log("[dotenv][DEBUG] ".concat(message));
}

function _resolveHome(envPath) {
  return envPath[0] === '~' ? path.join(os.homedir(), envPath.slice(1)) : envPath;
} // Populates process.env from .env file


function config(options) {
  var dotenvPath = path.resolve(process.cwd(), '.env');
  var encoding = 'utf8';
  var debug = Boolean(options && options.debug);
  var override = Boolean(options && options.override);

  if (options) {
    if (options.path != null) {
      dotenvPath = _resolveHome(options.path);
    }

    if (options.encoding != null) {
      encoding = options.encoding;
    }
  }

  try {
    // Specifying an encoding returns a string instead of a buffer
    var parsed = DotenvModule.parse(fs.readFileSync(dotenvPath, {
      encoding: encoding
    }));
    Object.keys(parsed).forEach(function (key) {
      if (!Object.prototype.hasOwnProperty.call(process.env, key)) {
        process.env[key] = parsed[key];
      } else {
        if (override === true) {
          process.env[key] = parsed[key];
        }

        if (debug) {
          if (override === true) {
            _log("\"".concat(key, "\" is already defined in `process.env` and WAS overwritten"));
          } else {
            _log("\"".concat(key, "\" is already defined in `process.env` and was NOT overwritten"));
          }
        }
      }
    });
    return {
      parsed: parsed
    };
  } catch (e) {
    if (debug) {
      _log("Failed to load ".concat(dotenvPath, " ").concat(e.message));
    }

    return {
      error: e
    };
  }
}

var DotenvModule = {
  config: config,
  parse: parse
};
module.exports.config = DotenvModule.config;
module.exports.parse = DotenvModule.parse;
module.exports = DotenvModule;
/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../../process/browser.js */ "./node_modules/process/browser.js")))

/***/ }),

/***/ "./node_modules/mapbox-gl/dist/mapbox-gl.js":
/*!**************************************************!*\
  !*** ./node_modules/mapbox-gl/dist/mapbox-gl.js ***!
  \**************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(process) {var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_RESULT__;function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function _get() { if (typeof Reflect !== "undefined" && Reflect.get) { _get = Reflect.get; } else { _get = function _get(target, property, receiver) { var base = _superPropBase(target, property); if (!base) return; var desc = Object.getOwnPropertyDescriptor(base, property); if (desc.get) { return desc.get.call(arguments.length < 3 ? target : receiver); } return desc.value; }; } return _get.apply(this, arguments); }

function _superPropBase(object, property) { while (!Object.prototype.hasOwnProperty.call(object, property)) { object = _getPrototypeOf(object); if (object === null) break; } return object; }

function _toArray(arr) { return _arrayWithHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableRest(); }

function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }

function _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }

function _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }

function _iterableToArrayLimit(arr, i) { var _i = arr == null ? null : typeof Symbol !== "undefined" && arr[Symbol.iterator] || arr["@@iterator"]; if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

function _createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (!it) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e458) { throw _e458; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e459) { didErr = true; err = _e459; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function _wrapNativeSuper(Class) { var _cache = typeof Map === "function" ? new Map() : undefined; _wrapNativeSuper = function _wrapNativeSuper(Class) { if (Class === null || !_isNativeFunction(Class)) return Class; if (typeof Class !== "function") { throw new TypeError("Super expression must either be null or a function"); } if (typeof _cache !== "undefined") { if (_cache.has(Class)) return _cache.get(Class); _cache.set(Class, Wrapper); } function Wrapper() { return _construct(Class, arguments, _getPrototypeOf(this).constructor); } Wrapper.prototype = Object.create(Class.prototype, { constructor: { value: Wrapper, enumerable: false, writable: true, configurable: true } }); return _setPrototypeOf(Wrapper, Class); }; return _wrapNativeSuper(Class); }

function _construct(Parent, args, Class) { if (_isNativeReflectConstruct()) { _construct = Reflect.construct; } else { _construct = function _construct(Parent, args, Class) { var a = [null]; a.push.apply(a, args); var Constructor = Function.bind.apply(Parent, a); var instance = new Constructor(); if (Class) _setPrototypeOf(instance, Class.prototype); return instance; }; } return _construct.apply(null, arguments); }

function _isNativeFunction(fn) { return Function.toString.call(fn).indexOf("[native code]") !== -1; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, "prototype", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }

function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }

function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } else if (call !== void 0) { throw new TypeError("Derived constructors may only return object or undefined"); } return _assertThisInitialized(self); }

function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }

function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }

function _typeof(obj) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, _typeof(obj); }

/* Mapbox GL JS is Copyright © 2020 Mapbox and subject to the Mapbox Terms of Service ((https://www.mapbox.com/legal/tos/). */
(function (global, factory) {
  ( false ? undefined : _typeof(exports)) === 'object' && typeof module !== 'undefined' ? module.exports = factory() :  true ? !(__WEBPACK_AMD_DEFINE_FACTORY__ = (factory),
				__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?
				(__WEBPACK_AMD_DEFINE_FACTORY__.call(exports, __webpack_require__, exports, module)) :
				__WEBPACK_AMD_DEFINE_FACTORY__),
				__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__)) : (undefined);
})(this, function () {
  'use strict';
  /* eslint-disable */

  var shared, worker, mapboxgl; // define gets called three times: one for each chunk. we rely on the order
  // they're imported to know which is which

  function define(_, chunk) {
    if (!shared) {
      shared = chunk;
    } else if (!worker) {
      worker = chunk;
    } else {
      var workerBundleString = "self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; (" + shared + ")(sharedChunk); (" + worker + ")(sharedChunk); self.onerror = null;";
      var sharedChunk = {};
      shared(sharedChunk);
      mapboxgl = chunk(sharedChunk);

      if (typeof window !== 'undefined' && window && window.URL && window.URL.createObjectURL) {
        mapboxgl.workerUrl = window.URL.createObjectURL(new Blob([workerBundleString], {
          type: 'text/javascript'
        }));
      }
    }
  }

  define(["exports"], function (t) {
    "use strict";

    var e = "2.7.1",
        r = n;

    function n(t, e, r, n) {
      this.cx = 3 * t, this.bx = 3 * (r - t) - this.cx, this.ax = 1 - this.cx - this.bx, this.cy = 3 * e, this.by = 3 * (n - e) - this.cy, this.ay = 1 - this.cy - this.by, this.p1x = t, this.p1y = n, this.p2x = r, this.p2y = n;
    }

    n.prototype.sampleCurveX = function (t) {
      return ((this.ax * t + this.bx) * t + this.cx) * t;
    }, n.prototype.sampleCurveY = function (t) {
      return ((this.ay * t + this.by) * t + this.cy) * t;
    }, n.prototype.sampleCurveDerivativeX = function (t) {
      return (3 * this.ax * t + 2 * this.bx) * t + this.cx;
    }, n.prototype.solveCurveX = function (t, e) {
      var r, n, i, s, a;

      for (void 0 === e && (e = 1e-6), i = t, a = 0; a < 8; a++) {
        if (s = this.sampleCurveX(i) - t, Math.abs(s) < e) return i;
        var o = this.sampleCurveDerivativeX(i);
        if (Math.abs(o) < 1e-6) break;
        i -= s / o;
      }

      if ((i = t) < (r = 0)) return r;
      if (i > (n = 1)) return n;

      for (; r < n;) {
        if (s = this.sampleCurveX(i), Math.abs(s - t) < e) return i;
        t > s ? r = i : n = i, i = .5 * (n - r) + r;
      }

      return i;
    }, n.prototype.solve = function (t, e) {
      return this.sampleCurveY(this.solveCurveX(t, e));
    };
    var i = s;

    function s(t, e) {
      this.x = t, this.y = e;
    }

    s.prototype = {
      clone: function clone() {
        return new s(this.x, this.y);
      },
      add: function add(t) {
        return this.clone()._add(t);
      },
      sub: function sub(t) {
        return this.clone()._sub(t);
      },
      multByPoint: function multByPoint(t) {
        return this.clone()._multByPoint(t);
      },
      divByPoint: function divByPoint(t) {
        return this.clone()._divByPoint(t);
      },
      mult: function mult(t) {
        return this.clone()._mult(t);
      },
      div: function div(t) {
        return this.clone()._div(t);
      },
      rotate: function rotate(t) {
        return this.clone()._rotate(t);
      },
      rotateAround: function rotateAround(t, e) {
        return this.clone()._rotateAround(t, e);
      },
      matMult: function matMult(t) {
        return this.clone()._matMult(t);
      },
      unit: function unit() {
        return this.clone()._unit();
      },
      perp: function perp() {
        return this.clone()._perp();
      },
      round: function round() {
        return this.clone()._round();
      },
      mag: function mag() {
        return Math.sqrt(this.x * this.x + this.y * this.y);
      },
      equals: function equals(t) {
        return this.x === t.x && this.y === t.y;
      },
      dist: function dist(t) {
        return Math.sqrt(this.distSqr(t));
      },
      distSqr: function distSqr(t) {
        var e = t.x - this.x,
            r = t.y - this.y;
        return e * e + r * r;
      },
      angle: function angle() {
        return Math.atan2(this.y, this.x);
      },
      angleTo: function angleTo(t) {
        return Math.atan2(this.y - t.y, this.x - t.x);
      },
      angleWith: function angleWith(t) {
        return this.angleWithSep(t.x, t.y);
      },
      angleWithSep: function angleWithSep(t, e) {
        return Math.atan2(this.x * e - this.y * t, this.x * t + this.y * e);
      },
      _matMult: function _matMult(t) {
        var e = t[2] * this.x + t[3] * this.y;
        return this.x = t[0] * this.x + t[1] * this.y, this.y = e, this;
      },
      _add: function _add(t) {
        return this.x += t.x, this.y += t.y, this;
      },
      _sub: function _sub(t) {
        return this.x -= t.x, this.y -= t.y, this;
      },
      _mult: function _mult(t) {
        return this.x *= t, this.y *= t, this;
      },
      _div: function _div(t) {
        return this.x /= t, this.y /= t, this;
      },
      _multByPoint: function _multByPoint(t) {
        return this.x *= t.x, this.y *= t.y, this;
      },
      _divByPoint: function _divByPoint(t) {
        return this.x /= t.x, this.y /= t.y, this;
      },
      _unit: function _unit() {
        return this._div(this.mag()), this;
      },
      _perp: function _perp() {
        var t = this.y;
        return this.y = this.x, this.x = -t, this;
      },
      _rotate: function _rotate(t) {
        var e = Math.cos(t),
            r = Math.sin(t),
            n = r * this.x + e * this.y;
        return this.x = e * this.x - r * this.y, this.y = n, this;
      },
      _rotateAround: function _rotateAround(t, e) {
        var r = Math.cos(t),
            n = Math.sin(t),
            i = e.y + n * (this.x - e.x) + r * (this.y - e.y);
        return this.x = e.x + r * (this.x - e.x) - n * (this.y - e.y), this.y = i, this;
      },
      _round: function _round() {
        return this.x = Math.round(this.x), this.y = Math.round(this.y), this;
      }
    }, s.convert = function (t) {
      return t instanceof s ? t : Array.isArray(t) ? new s(t[0], t[1]) : t;
    };
    var a = "undefined" != typeof self ? self : {},
        o = 1e-6,
        l = "undefined" != typeof Float32Array ? Float32Array : Array;

    function u() {
      var t = new l(9);
      return l != Float32Array && (t[1] = 0, t[2] = 0, t[3] = 0, t[5] = 0, t[6] = 0, t[7] = 0), t[0] = 1, t[4] = 1, t[8] = 1, t;
    }

    function c(t) {
      return t[0] = 1, t[1] = 0, t[2] = 0, t[3] = 0, t[4] = 0, t[5] = 1, t[6] = 0, t[7] = 0, t[8] = 0, t[9] = 0, t[10] = 1, t[11] = 0, t[12] = 0, t[13] = 0, t[14] = 0, t[15] = 1, t;
    }

    function h(t, e, r) {
      var n = e[0],
          i = e[1],
          s = e[2],
          a = e[3],
          o = e[4],
          l = e[5],
          u = e[6],
          c = e[7],
          h = e[8],
          p = e[9],
          d = e[10],
          f = e[11],
          y = e[12],
          m = e[13],
          g = e[14],
          x = e[15],
          v = r[0],
          b = r[1],
          w = r[2],
          _ = r[3];
      return t[0] = v * n + b * o + w * h + _ * y, t[1] = v * i + b * l + w * p + _ * m, t[2] = v * s + b * u + w * d + _ * g, t[3] = v * a + b * c + w * f + _ * x, t[4] = (v = r[4]) * n + (b = r[5]) * o + (w = r[6]) * h + (_ = r[7]) * y, t[5] = v * i + b * l + w * p + _ * m, t[6] = v * s + b * u + w * d + _ * g, t[7] = v * a + b * c + w * f + _ * x, t[8] = (v = r[8]) * n + (b = r[9]) * o + (w = r[10]) * h + (_ = r[11]) * y, t[9] = v * i + b * l + w * p + _ * m, t[10] = v * s + b * u + w * d + _ * g, t[11] = v * a + b * c + w * f + _ * x, t[12] = (v = r[12]) * n + (b = r[13]) * o + (w = r[14]) * h + (_ = r[15]) * y, t[13] = v * i + b * l + w * p + _ * m, t[14] = v * s + b * u + w * d + _ * g, t[15] = v * a + b * c + w * f + _ * x, t;
    }

    function p(t, e, r) {
      var n,
          i,
          s,
          a,
          o,
          l,
          u,
          c,
          h,
          p,
          d,
          f,
          y = r[0],
          m = r[1],
          g = r[2];
      return e === t ? (t[12] = e[0] * y + e[4] * m + e[8] * g + e[12], t[13] = e[1] * y + e[5] * m + e[9] * g + e[13], t[14] = e[2] * y + e[6] * m + e[10] * g + e[14], t[15] = e[3] * y + e[7] * m + e[11] * g + e[15]) : (i = e[1], s = e[2], a = e[3], o = e[4], l = e[5], u = e[6], c = e[7], h = e[8], p = e[9], d = e[10], f = e[11], t[0] = n = e[0], t[1] = i, t[2] = s, t[3] = a, t[4] = o, t[5] = l, t[6] = u, t[7] = c, t[8] = h, t[9] = p, t[10] = d, t[11] = f, t[12] = n * y + o * m + h * g + e[12], t[13] = i * y + l * m + p * g + e[13], t[14] = s * y + u * m + d * g + e[14], t[15] = a * y + c * m + f * g + e[15]), t;
    }

    function d(t, e, r) {
      var n = r[0],
          i = r[1],
          s = r[2];
      return t[0] = e[0] * n, t[1] = e[1] * n, t[2] = e[2] * n, t[3] = e[3] * n, t[4] = e[4] * i, t[5] = e[5] * i, t[6] = e[6] * i, t[7] = e[7] * i, t[8] = e[8] * s, t[9] = e[9] * s, t[10] = e[10] * s, t[11] = e[11] * s, t[12] = e[12], t[13] = e[13], t[14] = e[14], t[15] = e[15], t;
    }

    function f(t, e, r) {
      var n = Math.sin(r),
          i = Math.cos(r),
          s = e[4],
          a = e[5],
          o = e[6],
          l = e[7],
          u = e[8],
          c = e[9],
          h = e[10],
          p = e[11];
      return e !== t && (t[0] = e[0], t[1] = e[1], t[2] = e[2], t[3] = e[3], t[12] = e[12], t[13] = e[13], t[14] = e[14], t[15] = e[15]), t[4] = s * i + u * n, t[5] = a * i + c * n, t[6] = o * i + h * n, t[7] = l * i + p * n, t[8] = u * i - s * n, t[9] = c * i - a * n, t[10] = h * i - o * n, t[11] = p * i - l * n, t;
    }

    function y(t, e, r) {
      var n = Math.sin(r),
          i = Math.cos(r),
          s = e[0],
          a = e[1],
          o = e[2],
          l = e[3],
          u = e[8],
          c = e[9],
          h = e[10],
          p = e[11];
      return e !== t && (t[4] = e[4], t[5] = e[5], t[6] = e[6], t[7] = e[7], t[12] = e[12], t[13] = e[13], t[14] = e[14], t[15] = e[15]), t[0] = s * i - u * n, t[1] = a * i - c * n, t[2] = o * i - h * n, t[3] = l * i - p * n, t[8] = s * n + u * i, t[9] = a * n + c * i, t[10] = o * n + h * i, t[11] = l * n + p * i, t;
    }

    Math.hypot || (Math.hypot = function () {
      for (var t = 0, e = arguments.length; e--;) {
        t += arguments[e] * arguments[e];
      }

      return Math.sqrt(t);
    });
    var m = h;

    function g() {
      var t = new l(3);
      return l != Float32Array && (t[0] = 0, t[1] = 0, t[2] = 0), t;
    }

    function x(t) {
      var e = new l(3);
      return e[0] = t[0], e[1] = t[1], e[2] = t[2], e;
    }

    function v(t) {
      return Math.hypot(t[0], t[1], t[2]);
    }

    function b(t, e, r) {
      var n = new l(3);
      return n[0] = t, n[1] = e, n[2] = r, n;
    }

    function w(t, e, r) {
      return t[0] = e[0] + r[0], t[1] = e[1] + r[1], t[2] = e[2] + r[2], t;
    }

    function _(t, e, r) {
      return t[0] = e[0] - r[0], t[1] = e[1] - r[1], t[2] = e[2] - r[2], t;
    }

    function A(t, e, r) {
      return t[0] = e[0] * r[0], t[1] = e[1] * r[1], t[2] = e[2] * r[2], t;
    }

    function k(t, e, r) {
      return t[0] = Math.max(e[0], r[0]), t[1] = Math.max(e[1], r[1]), t[2] = Math.max(e[2], r[2]), t;
    }

    function S(t, e, r) {
      return t[0] = e[0] * r, t[1] = e[1] * r, t[2] = e[2] * r, t;
    }

    function I(t, e, r, n) {
      return t[0] = e[0] + r[0] * n, t[1] = e[1] + r[1] * n, t[2] = e[2] + r[2] * n, t;
    }

    function z(t, e) {
      var r = e[0],
          n = e[1],
          i = e[2],
          s = r * r + n * n + i * i;
      return s > 0 && (s = 1 / Math.sqrt(s)), t[0] = e[0] * s, t[1] = e[1] * s, t[2] = e[2] * s, t;
    }

    function M(t, e) {
      return t[0] * e[0] + t[1] * e[1] + t[2] * e[2];
    }

    function T(t, e, r) {
      var n = e[0],
          i = e[1],
          s = e[2],
          a = r[0],
          o = r[1],
          l = r[2];
      return t[0] = i * l - s * o, t[1] = s * a - n * l, t[2] = n * o - i * a, t;
    }

    function B(t, e, r) {
      var n = e[0],
          i = e[1],
          s = e[2],
          a = r[3] * n + r[7] * i + r[11] * s + r[15];
      return t[0] = (r[0] * n + r[4] * i + r[8] * s + r[12]) / (a = a || 1), t[1] = (r[1] * n + r[5] * i + r[9] * s + r[13]) / a, t[2] = (r[2] * n + r[6] * i + r[10] * s + r[14]) / a, t;
    }

    function C(t, e, r) {
      var n = r[0],
          i = r[1],
          s = r[2],
          a = e[0],
          o = e[1],
          l = e[2],
          u = i * l - s * o,
          c = s * a - n * l,
          h = n * o - i * a,
          p = i * h - s * c,
          d = s * u - n * h,
          f = n * c - i * u,
          y = 2 * r[3];
      return c *= y, h *= y, d *= 2, f *= 2, t[0] = a + (u *= y) + (p *= 2), t[1] = o + c + d, t[2] = l + h + f, t;
    }

    var P,
        E = _,
        D = A,
        V = v;

    function F(t, e, r) {
      var n = e[0],
          i = e[1],
          s = e[2],
          a = e[3];
      return t[0] = r[0] * n + r[4] * i + r[8] * s + r[12] * a, t[1] = r[1] * n + r[5] * i + r[9] * s + r[13] * a, t[2] = r[2] * n + r[6] * i + r[10] * s + r[14] * a, t[3] = r[3] * n + r[7] * i + r[11] * s + r[15] * a, t;
    }

    function L() {
      var t = new l(4);
      return l != Float32Array && (t[0] = 0, t[1] = 0, t[2] = 0), t[3] = 1, t;
    }

    function R(t) {
      return t[0] = 0, t[1] = 0, t[2] = 0, t[3] = 1, t;
    }

    function U(t, e, r) {
      r *= .5;
      var n = e[0],
          i = e[1],
          s = e[2],
          a = e[3],
          o = Math.sin(r),
          l = Math.cos(r);
      return t[0] = n * l + a * o, t[1] = i * l + s * o, t[2] = s * l - i * o, t[3] = a * l - n * o, t;
    }

    function $(t, e) {
      return t[0] === e[0] && t[1] === e[1];
    }

    g(), P = new l(4), l != Float32Array && (P[0] = 0, P[1] = 0, P[2] = 0, P[3] = 0), g(), b(1, 0, 0), b(0, 1, 0), L(), L(), u(), function () {
      var t;
      t = new l(2), l != Float32Array && (t[0] = 0, t[1] = 0);
    }();
    var O = Math.PI / 180,
        j = 180 / Math.PI;

    function q(t) {
      return t * O;
    }

    function N(t) {
      return t * j;
    }

    var G = [[0, 0], [1, 0], [1, 1], [0, 1]];

    function Z(t) {
      if (t <= 0) return 0;
      if (t >= 1) return 1;
      var e = t * t,
          r = e * t;
      return 4 * (t < .5 ? r : 3 * (t - e) + r - .75);
    }

    function X(t, e, n, i) {
      var s = new r(t, e, n, i);
      return function (t) {
        return s.solve(t);
      };
    }

    var K = X(.25, .1, .25, 1);

    function Y(t, e, r) {
      return Math.min(r, Math.max(e, t));
    }

    function H(t, e, r) {
      return (r = Y((r - t) / (e - t), 0, 1)) * r * (3 - 2 * r);
    }

    function J(t, e, r) {
      var n = r - e,
          i = ((t - e) % n + n) % n + e;
      return i === e ? r : i;
    }

    function W(t, e, r) {
      if (!t.length) return r(null, []);
      var n = t.length;
      var i = new Array(t.length);
      var s = null;
      t.forEach(function (t, a) {
        e(t, function (t, e) {
          t && (s = t), i[a] = e, 0 == --n && r(s, i);
        });
      });
    }

    function Q(t) {
      var e = [];

      for (var _r2 in t) {
        e.push(t[_r2]);
      }

      return e;
    }

    function tt(t) {
      for (var _len = arguments.length, e = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
        e[_key - 1] = arguments[_key];
      }

      for (var _i2 = 0, _e2 = e; _i2 < _e2.length; _i2++) {
        var _r3 = _e2[_i2];

        for (var _e3 in _r3) {
          t[_e3] = _r3[_e3];
        }
      }

      return t;
    }

    var et = 1;

    function rt() {
      return et++;
    }

    function nt() {
      return function t(e) {
        return e ? (e ^ 16 * Math.random() >> e / 4).toString(16) : ([1e7] + -[1e3] + -4e3 + -8e3 + -1e11).replace(/[018]/g, t);
      }();
    }

    function it(t) {
      return t <= 1 ? 1 : Math.pow(2, Math.ceil(Math.log(t) / Math.LN2));
    }

    function st(t) {
      return !!t && /^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t);
    }

    function at(t, e) {
      t.forEach(function (t) {
        e[t] && (e[t] = e[t].bind(e));
      });
    }

    function ot(t, e) {
      return -1 !== t.indexOf(e, t.length - e.length);
    }

    function lt(t, e, r) {
      var n = {};

      for (var _i3 in t) {
        n[_i3] = e.call(r || this, t[_i3], _i3, t);
      }

      return n;
    }

    function ut(t, e, r) {
      var n = {};

      for (var _i4 in t) {
        e.call(r || this, t[_i4], _i4, t) && (n[_i4] = t[_i4]);
      }

      return n;
    }

    function ct(t) {
      return Array.isArray(t) ? t.map(ct) : "object" == _typeof(t) && t ? lt(t, ct) : t;
    }

    var ht = {};

    function pt(t) {
      ht[t] || ("undefined" != typeof console && console.warn(t), ht[t] = !0);
    }

    function dt(t, e, r) {
      return (r.y - t.y) * (e.x - t.x) > (e.y - t.y) * (r.x - t.x);
    }

    function ft(t) {
      var e = 0;

      for (var _r4, _n2, _i5 = 0, _s2 = t.length, _a2 = _s2 - 1; _i5 < _s2; _a2 = _i5++) {
        _r4 = t[_i5], _n2 = t[_a2], e += (_n2.x - _r4.x) * (_r4.y + _n2.y);
      }

      return e;
    }

    function yt() {
      return "undefined" != typeof WorkerGlobalScope && "undefined" != typeof self && self instanceof WorkerGlobalScope;
    }

    function mt(t) {
      var e = {};

      if (t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g, function (t, r, n, i) {
        var s = n || i;
        return e[r] = !s || s.toLowerCase(), "";
      }), e["max-age"]) {
        var _t2 = parseInt(e["max-age"], 10);

        isNaN(_t2) ? delete e["max-age"] : e["max-age"] = _t2;
      }

      return e;
    }

    var gt,
        xt,
        vt,
        bt = null;

    function wt(t) {
      if (null == bt) {
        var _e4 = t.navigator ? t.navigator.userAgent : null;

        bt = !!t.safari || !(!_e4 || !(/\b(iPad|iPhone|iPod)\b/.test(_e4) || _e4.match("Safari") && !_e4.match("Chrome")));
      }

      return bt;
    }

    function _t(t) {
      try {
        var _e5 = a[t];
        return _e5.setItem("_mapbox_test_", 1), _e5.removeItem("_mapbox_test_"), !0;
      } catch (t) {
        return !1;
      }
    }

    var At = {
      now: function now() {
        return void 0 !== vt ? vt : a.performance.now();
      },
      setNow: function setNow(t) {
        vt = t;
      },
      restoreNow: function restoreNow() {
        vt = void 0;
      },
      frame: function frame(t) {
        var e = a.requestAnimationFrame(t);
        return {
          cancel: function cancel() {
            return a.cancelAnimationFrame(e);
          }
        };
      },
      getImageData: function getImageData(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
        var r = a.document.createElement("canvas"),
            n = r.getContext("2d");
        if (!n) throw new Error("failed to create canvas 2d context");
        return r.width = t.width, r.height = t.height, n.drawImage(t, 0, 0, t.width, t.height), n.getImageData(-e, -e, t.width + 2 * e, t.height + 2 * e);
      },
      resolveURL: function resolveURL(t) {
        return gt || (gt = a.document.createElement("a")), gt.href = t, gt.href;
      },

      get devicePixelRatio() {
        return a.devicePixelRatio;
      },

      get prefersReducedMotion() {
        return !!a.matchMedia && (null == xt && (xt = a.matchMedia("(prefers-reduced-motion: reduce)")), xt.matches);
      }

    };
    var kt;
    var St = {
      API_URL: "https://api.mapbox.com",

      get API_URL_REGEX() {
        if (null == kt) {
          var _t3 = /^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;

          try {
            kt = null != process.env.API_URL_REGEX ? new RegExp(process.env.API_URL_REGEX) : _t3;
          } catch (e) {
            kt = _t3;
          }
        }

        return kt;
      },

      get EVENTS_URL() {
        return this.API_URL ? 0 === this.API_URL.indexOf("https://api.mapbox.cn") ? "https://events.mapbox.cn/events/v2" : 0 === this.API_URL.indexOf("https://api.mapbox.com") ? "https://events.mapbox.com/events/v2" : null : null;
      },

      SESSION_PATH: "/map-sessions/v1",
      FEEDBACK_URL: "https://apps.mapbox.com/feedback",
      TILE_URL_VERSION: "v4",
      RASTER_URL_PREFIX: "raster/v1",
      REQUIRE_ACCESS_TOKEN: !0,
      ACCESS_TOKEN: null,
      MAX_PARALLEL_IMAGE_REQUESTS: 16
    },
        It = {
      supported: !1,
      testSupport: function testSupport(t) {
        !Tt && Mt && (Bt ? Ct(t) : zt = t);
      }
    };
    var zt,
        Mt,
        Tt = !1,
        Bt = !1;

    function Ct(t) {
      var e = t.createTexture();
      t.bindTexture(t.TEXTURE_2D, e);

      try {
        if (t.texImage2D(t.TEXTURE_2D, 0, t.RGBA, t.RGBA, t.UNSIGNED_BYTE, Mt), t.isContextLost()) return;
        It.supported = !0;
      } catch (t) {}

      t.deleteTexture(e), Tt = !0;
    }

    a.document && (Mt = a.document.createElement("img"), Mt.onload = function () {
      zt && Ct(zt), zt = null, Bt = !0;
    }, Mt.onerror = function () {
      Tt = !0, zt = null;
    }, Mt.src = "data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");
    var Pt = "01",
        Et = "NO_ACCESS_TOKEN";

    function Dt(t) {
      return 0 === t.indexOf("mapbox:");
    }

    function Vt(t) {
      return St.API_URL_REGEX.test(t);
    }

    var Ft = /^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;

    function Lt(t) {
      var e = t.match(Ft);
      if (!e) throw new Error("Unable to parse URL object");
      return {
        protocol: e[1],
        authority: e[2],
        path: e[3] || "/",
        params: e[4] ? e[4].split("&") : []
      };
    }

    function Rt(t) {
      var e = t.params.length ? "?".concat(t.params.join("&")) : "";
      return "".concat(t.protocol, "://").concat(t.authority).concat(t.path).concat(e);
    }

    function Ut(t) {
      if (!t) return null;
      var e = t.split(".");
      if (!e || 3 !== e.length) return null;

      try {
        return JSON.parse(decodeURIComponent(a.atob(e[1]).split("").map(function (t) {
          return "%" + ("00" + t.charCodeAt(0).toString(16)).slice(-2);
        }).join("")));
      } catch (t) {
        return null;
      }
    }

    var $t = /*#__PURE__*/function () {
      function $t(t) {
        _classCallCheck(this, $t);

        this.type = t, this.anonId = null, this.eventData = {}, this.queue = [], this.pendingRequest = null;
      }

      _createClass($t, [{
        key: "getStorageKey",
        value: function getStorageKey(t) {
          var e = Ut(St.ACCESS_TOKEN);
          var r = "";
          return r = e && e.u ? a.btoa(encodeURIComponent(e.u).replace(/%([0-9A-F]{2})/g, function (t, e) {
            return String.fromCharCode(Number("0x" + e));
          })) : St.ACCESS_TOKEN || "", t ? "mapbox.eventData.".concat(t, ":").concat(r) : "mapbox.eventData:".concat(r);
        }
      }, {
        key: "fetchEventData",
        value: function fetchEventData() {
          var t = _t("localStorage"),
              e = this.getStorageKey(),
              r = this.getStorageKey("uuid");

          if (t) try {
            var _t4 = a.localStorage.getItem(e);

            _t4 && (this.eventData = JSON.parse(_t4));

            var _n3 = a.localStorage.getItem(r);

            _n3 && (this.anonId = _n3);
          } catch (t) {
            pt("Unable to read from LocalStorage");
          }
        }
      }, {
        key: "saveEventData",
        value: function saveEventData() {
          var t = _t("localStorage"),
              e = this.getStorageKey(),
              r = this.getStorageKey("uuid");

          if (t) try {
            a.localStorage.setItem(r, this.anonId), Object.keys(this.eventData).length >= 1 && a.localStorage.setItem(e, JSON.stringify(this.eventData));
          } catch (t) {
            pt("Unable to write to LocalStorage");
          }
        }
      }, {
        key: "processRequests",
        value: function processRequests(t) {}
      }, {
        key: "postEvent",
        value: function postEvent(t, r, n, i) {
          var _this = this;

          if (!St.EVENTS_URL) return;
          var s = Lt(St.EVENTS_URL);
          s.params.push("access_token=".concat(i || St.ACCESS_TOKEN || ""));
          var a = {
            event: this.type,
            created: new Date(t).toISOString(),
            sdkIdentifier: "mapbox-gl-js",
            sdkVersion: e,
            skuId: Pt,
            userId: this.anonId
          },
              o = r ? tt(a, r) : a,
              l = {
            url: Rt(s),
            headers: {
              "Content-Type": "text/plain"
            },
            body: JSON.stringify([o])
          };
          this.pendingRequest = oe(l, function (t) {
            _this.pendingRequest = null, n(t), _this.saveEventData(), _this.processRequests(i);
          });
        }
      }, {
        key: "queueRequest",
        value: function queueRequest(t, e) {
          this.queue.push(t), this.processRequests(e);
        }
      }]);

      return $t;
    }();

    var Ot = new ( /*#__PURE__*/function (_$t) {
      _inherits(_class, _$t);

      var _super = _createSuper(_class);

      function _class(t) {
        var _this2;

        _classCallCheck(this, _class);

        _this2 = _super.call(this, "appUserTurnstile"), _this2._customAccessToken = t;
        return _this2;
      }

      _createClass(_class, [{
        key: "postTurnstileEvent",
        value: function postTurnstileEvent(t, e) {
          St.EVENTS_URL && St.ACCESS_TOKEN && Array.isArray(t) && t.some(function (t) {
            return Dt(t) || Vt(t);
          }) && this.queueRequest(Date.now(), e);
        }
      }, {
        key: "processRequests",
        value: function processRequests(t) {
          var _this3 = this;

          if (this.pendingRequest || 0 === this.queue.length) return;
          this.anonId && this.eventData.lastSuccess && this.eventData.tokenU || this.fetchEventData();
          var e = Ut(St.ACCESS_TOKEN),
              r = e ? e.u : St.ACCESS_TOKEN;
          var n = r !== this.eventData.tokenU;
          st(this.anonId) || (this.anonId = nt(), n = !0);
          var i = this.queue.shift();

          if (this.eventData.lastSuccess) {
            var _t5 = new Date(this.eventData.lastSuccess),
                _e6 = new Date(i),
                _r5 = (i - this.eventData.lastSuccess) / 864e5;

            n = n || _r5 >= 1 || _r5 < -1 || _t5.getDate() !== _e6.getDate();
          } else n = !0;

          if (!n) return this.processRequests();
          this.postEvent(i, {
            "enabled.telemetry": !1
          }, function (t) {
            t || (_this3.eventData.lastSuccess = i, _this3.eventData.tokenU = r);
          }, t);
        }
      }]);

      return _class;
    }($t))(),
        jt = Ot.postTurnstileEvent.bind(Ot),
        qt = new ( /*#__PURE__*/function (_$t2) {
      _inherits(_class2, _$t2);

      var _super2 = _createSuper(_class2);

      function _class2() {
        var _this4;

        _classCallCheck(this, _class2);

        _this4 = _super2.call(this, "map.load"), _this4.success = {}, _this4.skuToken = "";
        return _this4;
      }

      _createClass(_class2, [{
        key: "postMapLoadEvent",
        value: function postMapLoadEvent(t, e, r, n) {
          this.skuToken = e, this.errorCb = n, St.EVENTS_URL && (r || St.ACCESS_TOKEN ? this.queueRequest({
            id: t,
            timestamp: Date.now()
          }, r) : this.errorCb(new Error(Et)));
        }
      }, {
        key: "processRequests",
        value: function processRequests(t) {
          var _this5 = this;

          if (this.pendingRequest || 0 === this.queue.length) return;

          var _this$queue$shift = this.queue.shift(),
              e = _this$queue$shift.id,
              r = _this$queue$shift.timestamp;

          e && this.success[e] || (this.anonId || this.fetchEventData(), st(this.anonId) || (this.anonId = nt()), this.postEvent(r, {
            skuToken: this.skuToken
          }, function (t) {
            t ? _this5.errorCb(t) : e && (_this5.success[e] = !0);
          }, t));
        }
      }]);

      return _class2;
    }($t))(),
        Nt = qt.postMapLoadEvent.bind(qt),
        Gt = new ( /*#__PURE__*/function (_$t3) {
      _inherits(_class3, _$t3);

      var _super3 = _createSuper(_class3);

      function _class3() {
        var _this6;

        _classCallCheck(this, _class3);

        _this6 = _super3.call(this, "map.auth"), _this6.success = {}, _this6.skuToken = "";
        return _this6;
      }

      _createClass(_class3, [{
        key: "getSession",
        value: function getSession(t, e, r, n) {
          var _this7 = this;

          if (!St.API_URL || !St.SESSION_PATH) return;
          var i = Lt(St.API_URL + St.SESSION_PATH);
          i.params.push("sku=".concat(e || "")), i.params.push("access_token=".concat(n || St.ACCESS_TOKEN || ""));
          var s = {
            url: Rt(i),
            headers: {
              "Content-Type": "text/plain"
            }
          };
          this.pendingRequest = le(s, function (t) {
            _this7.pendingRequest = null, r(t), _this7.saveEventData(), _this7.processRequests(n);
          });
        }
      }, {
        key: "getSessionAPI",
        value: function getSessionAPI(t, e, r, n) {
          this.skuToken = e, this.errorCb = n, St.SESSION_PATH && St.API_URL && (r || St.ACCESS_TOKEN ? this.queueRequest({
            id: t,
            timestamp: Date.now()
          }, r) : this.errorCb(new Error(Et)));
        }
      }, {
        key: "processRequests",
        value: function processRequests(t) {
          var _this8 = this;

          if (this.pendingRequest || 0 === this.queue.length) return;

          var _this$queue$shift2 = this.queue.shift(),
              e = _this$queue$shift2.id,
              r = _this$queue$shift2.timestamp;

          e && this.success[e] || this.getSession(r, this.skuToken, function (t) {
            t ? _this8.errorCb(t) : e && (_this8.success[e] = !0);
          }, t);
        }
      }]);

      return _class3;
    }($t))(),
        Zt = Gt.getSessionAPI.bind(Gt),
        Xt = new Set(),
        Kt = "mapbox-tiles";
    var Yt,
        Ht,
        Jt = 500,
        Wt = 50;

    function Qt() {
      a.caches && !Yt && (Yt = a.caches.open(Kt));
    }

    function te(t) {
      var e = t.indexOf("?");
      return e < 0 ? t : t.slice(0, e);
    }

    var ee = 1 / 0;
    var re = {
      Unknown: "Unknown",
      Style: "Style",
      Source: "Source",
      Tile: "Tile",
      Glyphs: "Glyphs",
      SpriteImage: "SpriteImage",
      SpriteJSON: "SpriteJSON",
      Image: "Image"
    };
    "function" == typeof Object.freeze && Object.freeze(re);

    var ne = /*#__PURE__*/function (_Error) {
      _inherits(ne, _Error);

      var _super4 = _createSuper(ne);

      function ne(t, e, r) {
        var _this9;

        _classCallCheck(this, ne);

        401 === e && Vt(r) && (t += ": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"), _this9 = _super4.call(this, t), _this9.status = e, _this9.url = r;
        return _this9;
      }

      _createClass(ne, [{
        key: "toString",
        value: function toString() {
          return "".concat(this.name, ": ").concat(this.message, " (").concat(this.status, "): ").concat(this.url);
        }
      }]);

      return ne;
    }( /*#__PURE__*/_wrapNativeSuper(Error));

    var ie = yt() ? function () {
      return self.worker && self.worker.referrer;
    } : function () {
      return ("blob:" === a.location.protocol ? a.parent : a).location.href;
    };

    var se = function se(t, e) {
      if (!(/^file:/.test(r = t.url) || /^file:/.test(ie()) && !/^\w+:/.test(r))) {
        if (a.fetch && a.Request && a.AbortController && a.Request.prototype.hasOwnProperty("signal")) return function (t, e) {
          var r = new a.AbortController(),
              n = new a.Request(t.url, {
            method: t.method || "GET",
            body: t.body,
            credentials: t.credentials,
            headers: t.headers,
            referrer: ie(),
            signal: r.signal
          });
          var i = !1,
              s = !1;
          var o = (l = n.url).indexOf("sku=") > 0 && Vt(l);
          var l;
          "json" === t.type && n.headers.set("Accept", "application/json");

          var u = function u(r, i, l) {
            if (s) return;
            if (r && "SecurityError" !== r.message && pt(r), i && l) return c(i);
            var u = Date.now();
            a.fetch(n).then(function (r) {
              if (r.ok) {
                var _t6 = o ? r.clone() : null;

                return c(r, _t6, u);
              }

              return e(new ne(r.statusText, r.status, t.url));
            })["catch"](function (t) {
              20 !== t.code && e(new Error(t.message));
            });
          },
              c = function c(r, o, l) {
            ("arrayBuffer" === t.type ? r.arrayBuffer() : "json" === t.type ? r.json() : r.text()).then(function (t) {
              s || (o && l && function (t, e, r) {
                if (Qt(), !Yt) return;
                var n = {
                  status: e.status,
                  statusText: e.statusText,
                  headers: new a.Headers()
                };
                e.headers.forEach(function (t, e) {
                  return n.headers.set(e, t);
                });
                var i = mt(e.headers.get("Cache-Control") || "");
                i["no-store"] || (i["max-age"] && n.headers.set("Expires", new Date(r + 1e3 * i["max-age"]).toUTCString()), new Date(n.headers.get("Expires")).getTime() - r < 42e4 || function (t, e) {
                  if (void 0 === Ht) try {
                    new Response(new ReadableStream()), Ht = !0;
                  } catch (t) {
                    Ht = !1;
                  }
                  Ht ? e(t.body) : t.blob().then(e);
                }(e, function (e) {
                  var r = new a.Response(e, n);
                  Qt(), Yt && Yt.then(function (e) {
                    return e.put(te(t.url), r);
                  })["catch"](function (t) {
                    return pt(t.message);
                  });
                }));
              }(n, o, l), i = !0, e(null, t, r.headers.get("Cache-Control"), r.headers.get("Expires")));
            })["catch"](function (t) {
              s || e(new Error(t.message));
            });
          };

          return o ? function (t, e) {
            if (Qt(), !Yt) return e(null);
            var r = te(t.url);
            Yt.then(function (t) {
              t.match(r).then(function (n) {
                var i = function (t) {
                  if (!t) return !1;
                  var e = new Date(t.headers.get("Expires") || 0),
                      r = mt(t.headers.get("Cache-Control") || "");
                  return e > Date.now() && !r["no-cache"];
                }(n);

                t["delete"](r), i && t.put(r, n.clone()), e(null, n, i);
              })["catch"](e);
            })["catch"](e);
          }(n, u) : u(null, null), {
            cancel: function cancel() {
              s = !0, i || r.abort();
            }
          };
        }(t, e);
        if (yt() && self.worker && self.worker.actor) return self.worker.actor.send("getResource", t, e, void 0, !0);
      }

      var r;
      return function (t, e) {
        var r = new a.XMLHttpRequest();
        r.open(t.method || "GET", t.url, !0), "arrayBuffer" === t.type && (r.responseType = "arraybuffer");

        for (var _e7 in t.headers) {
          r.setRequestHeader(_e7, t.headers[_e7]);
        }

        return "json" === t.type && (r.responseType = "text", r.setRequestHeader("Accept", "application/json")), r.withCredentials = "include" === t.credentials, r.onerror = function () {
          e(new Error(r.statusText));
        }, r.onload = function () {
          if ((r.status >= 200 && r.status < 300 || 0 === r.status) && null !== r.response) {
            var _n4 = r.response;
            if ("json" === t.type) try {
              _n4 = JSON.parse(r.response);
            } catch (t) {
              return e(t);
            }
            e(null, _n4, r.getResponseHeader("Cache-Control"), r.getResponseHeader("Expires"));
          } else e(new ne(r.statusText, r.status, t.url));
        }, r.send(t.body), {
          cancel: function cancel() {
            return r.abort();
          }
        };
      }(t, e);
    },
        ae = function ae(t, e) {
      return se(tt(t, {
        type: "arrayBuffer"
      }), e);
    },
        oe = function oe(t, e) {
      return se(tt(t, {
        method: "POST"
      }), e);
    },
        le = function le(t, e) {
      return se(tt(t, {
        method: "GET"
      }), e);
    };

    function ue(t) {
      var e = a.document.createElement("a");
      return e.href = t, e.protocol === a.document.location.protocol && e.host === a.document.location.host;
    }

    var ce = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";
    var he, pe;
    he = [], pe = 0;

    var de = function de(t, e) {
      if (It.supported && (t.headers || (t.headers = {}), t.headers.accept = "image/webp,*/*"), pe >= St.MAX_PARALLEL_IMAGE_REQUESTS) {
        var _r6 = {
          requestParameters: t,
          callback: e,
          cancelled: !1,
          cancel: function cancel() {
            this.cancelled = !0;
          }
        };
        return he.push(_r6), _r6;
      }

      pe++;
      var r = !1;

      var n = function n() {
        if (!r) for (r = !0, pe--; he.length && pe < St.MAX_PARALLEL_IMAGE_REQUESTS;) {
          var _t7 = he.shift(),
              _e8 = _t7.requestParameters,
              _r7 = _t7.callback,
              _n5 = _t7.cancelled;

          _n5 || (_t7.cancel = de(_e8, _r7).cancel);
        }
      },
          i = ae(t, function (t, r, i, s) {
        n(), t ? e(t) : r && (a.createImageBitmap ? function (t, e) {
          var r = new a.Blob([new Uint8Array(t)], {
            type: "image/png"
          });
          a.createImageBitmap(r).then(function (t) {
            e(null, t);
          })["catch"](function (t) {
            e(new Error("Could not load image because of ".concat(t.message, ". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")));
          });
        }(r, function (t, r) {
          return e(t, r, i, s);
        }) : function (t, e) {
          var r = new a.Image(),
              n = a.URL;
          r.onload = function () {
            e(null, r), n.revokeObjectURL(r.src), r.onload = null, a.requestAnimationFrame(function () {
              r.src = ce;
            });
          }, r.onerror = function () {
            return e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));
          };
          var i = new a.Blob([new Uint8Array(t)], {
            type: "image/png"
          });
          r.src = t.byteLength ? n.createObjectURL(i) : ce;
        }(r, function (t, r) {
          return e(t, r, i, s);
        }));
      });

      return {
        cancel: function cancel() {
          i.cancel(), n();
        }
      };
    };

    function fe(t, e, r) {
      r[t] && -1 !== r[t].indexOf(e) || (r[t] = r[t] || [], r[t].push(e));
    }

    function ye(t, e, r) {
      if (r && r[t]) {
        var _n6 = r[t].indexOf(e);

        -1 !== _n6 && r[t].splice(_n6, 1);
      }
    }

    var me = /*#__PURE__*/_createClass(function me(t) {
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

      _classCallCheck(this, me);

      tt(this, e), this.type = t;
    });

    var ge = /*#__PURE__*/function (_me) {
      _inherits(ge, _me);

      var _super5 = _createSuper(ge);

      function ge(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

        _classCallCheck(this, ge);

        return _super5.call(this, "error", tt({
          error: t
        }, e));
      }

      return _createClass(ge);
    }(me);

    var xe = /*#__PURE__*/function () {
      function xe() {
        _classCallCheck(this, xe);
      }

      _createClass(xe, [{
        key: "on",
        value: function on(t, e) {
          return this._listeners = this._listeners || {}, fe(t, e, this._listeners), this;
        }
      }, {
        key: "off",
        value: function off(t, e) {
          return ye(t, e, this._listeners), ye(t, e, this._oneTimeListeners), this;
        }
      }, {
        key: "once",
        value: function once(t, e) {
          var _this10 = this;

          return e ? (this._oneTimeListeners = this._oneTimeListeners || {}, fe(t, e, this._oneTimeListeners), this) : new Promise(function (e) {
            return _this10.once(t, e);
          });
        }
      }, {
        key: "fire",
        value: function fire(t, e) {
          "string" == typeof t && (t = new me(t, e || {}));
          var r = t.type;

          if (this.listens(r)) {
            t.target = this;

            var _e9 = this._listeners && this._listeners[r] ? this._listeners[r].slice() : [];

            var _iterator = _createForOfIteratorHelper(_e9),
                _step;

            try {
              for (_iterator.s(); !(_step = _iterator.n()).done;) {
                var _r8 = _step.value;

                _r8.call(this, t);
              }
            } catch (err) {
              _iterator.e(err);
            } finally {
              _iterator.f();
            }

            var _n7 = this._oneTimeListeners && this._oneTimeListeners[r] ? this._oneTimeListeners[r].slice() : [];

            var _iterator2 = _createForOfIteratorHelper(_n7),
                _step2;

            try {
              for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {
                var _e10 = _step2.value;
                ye(r, _e10, this._oneTimeListeners), _e10.call(this, t);
              }
            } catch (err) {
              _iterator2.e(err);
            } finally {
              _iterator2.f();
            }

            var _i6 = this._eventedParent;
            _i6 && (tt(t, "function" == typeof this._eventedParentData ? this._eventedParentData() : this._eventedParentData), _i6.fire(t));
          } else t instanceof ge && console.error(t.error);

          return this;
        }
      }, {
        key: "listens",
        value: function listens(t) {
          return !!(this._listeners && this._listeners[t] && this._listeners[t].length > 0 || this._oneTimeListeners && this._oneTimeListeners[t] && this._oneTimeListeners[t].length > 0 || this._eventedParent && this._eventedParent.listens(t));
        }
      }, {
        key: "setEventedParent",
        value: function setEventedParent(t, e) {
          return this._eventedParent = t, this._eventedParentData = e, this;
        }
      }]);

      return xe;
    }();

    var ve = JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');

    var be = /*#__PURE__*/_createClass(function be(t, e, r, n) {
      _classCallCheck(this, be);

      this.message = (t ? "".concat(t, ": ") : "") + r, n && (this.identifier = n), null != e && e.__line__ && (this.line = e.__line__);
    });

    function we(t) {
      var e = t.value;
      return e ? [new be(t.key, e, "constants have been deprecated as of v8")] : [];
    }

    function _e(t) {
      for (var _len2 = arguments.length, e = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {
        e[_key2 - 1] = arguments[_key2];
      }

      for (var _i7 = 0, _e11 = e; _i7 < _e11.length; _i7++) {
        var _r9 = _e11[_i7];

        for (var _e12 in _r9) {
          t[_e12] = _r9[_e12];
        }
      }

      return t;
    }

    function Ae(t) {
      return t instanceof Number || t instanceof String || t instanceof Boolean ? t.valueOf() : t;
    }

    function ke(t) {
      if (Array.isArray(t)) return t.map(ke);

      if (t instanceof Object && !(t instanceof Number || t instanceof String || t instanceof Boolean)) {
        var _e13 = {};

        for (var _r10 in t) {
          _e13[_r10] = ke(t[_r10]);
        }

        return _e13;
      }

      return Ae(t);
    }

    var Se = /*#__PURE__*/function (_Error2) {
      _inherits(Se, _Error2);

      var _super6 = _createSuper(Se);

      function Se(t, e) {
        var _this11;

        _classCallCheck(this, Se);

        _this11 = _super6.call(this, e), _this11.message = e, _this11.key = t;
        return _this11;
      }

      return _createClass(Se);
    }( /*#__PURE__*/_wrapNativeSuper(Error));

    var Ie = /*#__PURE__*/function () {
      function Ie(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];

        _classCallCheck(this, Ie);

        this.parent = t, this.bindings = {};

        var _iterator3 = _createForOfIteratorHelper(e),
            _step3;

        try {
          for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {
            var _ref3 = _step3.value;

            var _ref2 = _slicedToArray(_ref3, 2);

            var _t8 = _ref2[0];
            var _r11 = _ref2[1];
            this.bindings[_t8] = _r11;
          }
        } catch (err) {
          _iterator3.e(err);
        } finally {
          _iterator3.f();
        }
      }

      _createClass(Ie, [{
        key: "concat",
        value: function concat(t) {
          return new Ie(this, t);
        }
      }, {
        key: "get",
        value: function get(t) {
          if (this.bindings[t]) return this.bindings[t];
          if (this.parent) return this.parent.get(t);
          throw new Error("".concat(t, " not found in scope."));
        }
      }, {
        key: "has",
        value: function has(t) {
          return !!this.bindings[t] || !!this.parent && this.parent.has(t);
        }
      }]);

      return Ie;
    }();

    var ze = {
      kind: "null"
    },
        Me = {
      kind: "number"
    },
        Te = {
      kind: "string"
    },
        Be = {
      kind: "boolean"
    },
        Ce = {
      kind: "color"
    },
        Pe = {
      kind: "object"
    },
        Ee = {
      kind: "value"
    },
        De = {
      kind: "collator"
    },
        Ve = {
      kind: "formatted"
    },
        Fe = {
      kind: "resolvedImage"
    };

    function Le(t, e) {
      return {
        kind: "array",
        itemType: t,
        N: e
      };
    }

    function Re(t) {
      if ("array" === t.kind) {
        var _e14 = Re(t.itemType);

        return "number" == typeof t.N ? "array<".concat(_e14, ", ").concat(t.N, ">") : "value" === t.itemType.kind ? "array" : "array<".concat(_e14, ">");
      }

      return t.kind;
    }

    var Ue = [ze, Me, Te, Be, Ce, Ve, Pe, Le(Ee), Fe];

    function $e(t, e) {
      if ("error" === e.kind) return null;

      if ("array" === t.kind) {
        if ("array" === e.kind && (0 === e.N && "value" === e.itemType.kind || !$e(t.itemType, e.itemType)) && ("number" != typeof t.N || t.N === e.N)) return null;
      } else {
        if (t.kind === e.kind) return null;

        if ("value" === t.kind) {
          var _iterator4 = _createForOfIteratorHelper(Ue),
              _step4;

          try {
            for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {
              var _t9 = _step4.value;
              if (!$e(_t9, e)) return null;
            }
          } catch (err) {
            _iterator4.e(err);
          } finally {
            _iterator4.f();
          }
        }
      }

      return "Expected ".concat(Re(t), " but found ").concat(Re(e), " instead.");
    }

    function Oe(t, e) {
      return e.some(function (e) {
        return e.kind === t.kind;
      });
    }

    function je(t, e) {
      return e.some(function (e) {
        return "null" === e ? null === t : "array" === e ? Array.isArray(t) : "object" === e ? t && !Array.isArray(t) && "object" == _typeof(t) : e === _typeof(t);
      });
    }

    function qe(t) {
      var e = {
        exports: {}
      };
      return t(e, e.exports), e.exports;
    }

    var Ne = qe(function (t, e) {
      var r = {
        transparent: [0, 0, 0, 0],
        aliceblue: [240, 248, 255, 1],
        antiquewhite: [250, 235, 215, 1],
        aqua: [0, 255, 255, 1],
        aquamarine: [127, 255, 212, 1],
        azure: [240, 255, 255, 1],
        beige: [245, 245, 220, 1],
        bisque: [255, 228, 196, 1],
        black: [0, 0, 0, 1],
        blanchedalmond: [255, 235, 205, 1],
        blue: [0, 0, 255, 1],
        blueviolet: [138, 43, 226, 1],
        brown: [165, 42, 42, 1],
        burlywood: [222, 184, 135, 1],
        cadetblue: [95, 158, 160, 1],
        chartreuse: [127, 255, 0, 1],
        chocolate: [210, 105, 30, 1],
        coral: [255, 127, 80, 1],
        cornflowerblue: [100, 149, 237, 1],
        cornsilk: [255, 248, 220, 1],
        crimson: [220, 20, 60, 1],
        cyan: [0, 255, 255, 1],
        darkblue: [0, 0, 139, 1],
        darkcyan: [0, 139, 139, 1],
        darkgoldenrod: [184, 134, 11, 1],
        darkgray: [169, 169, 169, 1],
        darkgreen: [0, 100, 0, 1],
        darkgrey: [169, 169, 169, 1],
        darkkhaki: [189, 183, 107, 1],
        darkmagenta: [139, 0, 139, 1],
        darkolivegreen: [85, 107, 47, 1],
        darkorange: [255, 140, 0, 1],
        darkorchid: [153, 50, 204, 1],
        darkred: [139, 0, 0, 1],
        darksalmon: [233, 150, 122, 1],
        darkseagreen: [143, 188, 143, 1],
        darkslateblue: [72, 61, 139, 1],
        darkslategray: [47, 79, 79, 1],
        darkslategrey: [47, 79, 79, 1],
        darkturquoise: [0, 206, 209, 1],
        darkviolet: [148, 0, 211, 1],
        deeppink: [255, 20, 147, 1],
        deepskyblue: [0, 191, 255, 1],
        dimgray: [105, 105, 105, 1],
        dimgrey: [105, 105, 105, 1],
        dodgerblue: [30, 144, 255, 1],
        firebrick: [178, 34, 34, 1],
        floralwhite: [255, 250, 240, 1],
        forestgreen: [34, 139, 34, 1],
        fuchsia: [255, 0, 255, 1],
        gainsboro: [220, 220, 220, 1],
        ghostwhite: [248, 248, 255, 1],
        gold: [255, 215, 0, 1],
        goldenrod: [218, 165, 32, 1],
        gray: [128, 128, 128, 1],
        green: [0, 128, 0, 1],
        greenyellow: [173, 255, 47, 1],
        grey: [128, 128, 128, 1],
        honeydew: [240, 255, 240, 1],
        hotpink: [255, 105, 180, 1],
        indianred: [205, 92, 92, 1],
        indigo: [75, 0, 130, 1],
        ivory: [255, 255, 240, 1],
        khaki: [240, 230, 140, 1],
        lavender: [230, 230, 250, 1],
        lavenderblush: [255, 240, 245, 1],
        lawngreen: [124, 252, 0, 1],
        lemonchiffon: [255, 250, 205, 1],
        lightblue: [173, 216, 230, 1],
        lightcoral: [240, 128, 128, 1],
        lightcyan: [224, 255, 255, 1],
        lightgoldenrodyellow: [250, 250, 210, 1],
        lightgray: [211, 211, 211, 1],
        lightgreen: [144, 238, 144, 1],
        lightgrey: [211, 211, 211, 1],
        lightpink: [255, 182, 193, 1],
        lightsalmon: [255, 160, 122, 1],
        lightseagreen: [32, 178, 170, 1],
        lightskyblue: [135, 206, 250, 1],
        lightslategray: [119, 136, 153, 1],
        lightslategrey: [119, 136, 153, 1],
        lightsteelblue: [176, 196, 222, 1],
        lightyellow: [255, 255, 224, 1],
        lime: [0, 255, 0, 1],
        limegreen: [50, 205, 50, 1],
        linen: [250, 240, 230, 1],
        magenta: [255, 0, 255, 1],
        maroon: [128, 0, 0, 1],
        mediumaquamarine: [102, 205, 170, 1],
        mediumblue: [0, 0, 205, 1],
        mediumorchid: [186, 85, 211, 1],
        mediumpurple: [147, 112, 219, 1],
        mediumseagreen: [60, 179, 113, 1],
        mediumslateblue: [123, 104, 238, 1],
        mediumspringgreen: [0, 250, 154, 1],
        mediumturquoise: [72, 209, 204, 1],
        mediumvioletred: [199, 21, 133, 1],
        midnightblue: [25, 25, 112, 1],
        mintcream: [245, 255, 250, 1],
        mistyrose: [255, 228, 225, 1],
        moccasin: [255, 228, 181, 1],
        navajowhite: [255, 222, 173, 1],
        navy: [0, 0, 128, 1],
        oldlace: [253, 245, 230, 1],
        olive: [128, 128, 0, 1],
        olivedrab: [107, 142, 35, 1],
        orange: [255, 165, 0, 1],
        orangered: [255, 69, 0, 1],
        orchid: [218, 112, 214, 1],
        palegoldenrod: [238, 232, 170, 1],
        palegreen: [152, 251, 152, 1],
        paleturquoise: [175, 238, 238, 1],
        palevioletred: [219, 112, 147, 1],
        papayawhip: [255, 239, 213, 1],
        peachpuff: [255, 218, 185, 1],
        peru: [205, 133, 63, 1],
        pink: [255, 192, 203, 1],
        plum: [221, 160, 221, 1],
        powderblue: [176, 224, 230, 1],
        purple: [128, 0, 128, 1],
        rebeccapurple: [102, 51, 153, 1],
        red: [255, 0, 0, 1],
        rosybrown: [188, 143, 143, 1],
        royalblue: [65, 105, 225, 1],
        saddlebrown: [139, 69, 19, 1],
        salmon: [250, 128, 114, 1],
        sandybrown: [244, 164, 96, 1],
        seagreen: [46, 139, 87, 1],
        seashell: [255, 245, 238, 1],
        sienna: [160, 82, 45, 1],
        silver: [192, 192, 192, 1],
        skyblue: [135, 206, 235, 1],
        slateblue: [106, 90, 205, 1],
        slategray: [112, 128, 144, 1],
        slategrey: [112, 128, 144, 1],
        snow: [255, 250, 250, 1],
        springgreen: [0, 255, 127, 1],
        steelblue: [70, 130, 180, 1],
        tan: [210, 180, 140, 1],
        teal: [0, 128, 128, 1],
        thistle: [216, 191, 216, 1],
        tomato: [255, 99, 71, 1],
        turquoise: [64, 224, 208, 1],
        violet: [238, 130, 238, 1],
        wheat: [245, 222, 179, 1],
        white: [255, 255, 255, 1],
        whitesmoke: [245, 245, 245, 1],
        yellow: [255, 255, 0, 1],
        yellowgreen: [154, 205, 50, 1]
      };

      function n(t) {
        return (t = Math.round(t)) < 0 ? 0 : t > 255 ? 255 : t;
      }

      function i(t) {
        return n("%" === t[t.length - 1] ? parseFloat(t) / 100 * 255 : parseInt(t));
      }

      function s(t) {
        return (e = "%" === t[t.length - 1] ? parseFloat(t) / 100 : parseFloat(t)) < 0 ? 0 : e > 1 ? 1 : e;
        var e;
      }

      function a(t, e, r) {
        return r < 0 ? r += 1 : r > 1 && (r -= 1), 6 * r < 1 ? t + (e - t) * r * 6 : 2 * r < 1 ? e : 3 * r < 2 ? t + (e - t) * (2 / 3 - r) * 6 : t;
      }

      try {
        e.parseCSSColor = function (t) {
          var e,
              o = t.replace(/ /g, "").toLowerCase();
          if (o in r) return r[o].slice();
          if ("#" === o[0]) return 4 === o.length ? (e = parseInt(o.substr(1), 16)) >= 0 && e <= 4095 ? [(3840 & e) >> 4 | (3840 & e) >> 8, 240 & e | (240 & e) >> 4, 15 & e | (15 & e) << 4, 1] : null : 7 === o.length && (e = parseInt(o.substr(1), 16)) >= 0 && e <= 16777215 ? [(16711680 & e) >> 16, (65280 & e) >> 8, 255 & e, 1] : null;
          var l = o.indexOf("("),
              u = o.indexOf(")");

          if (-1 !== l && u + 1 === o.length) {
            var c = o.substr(0, l),
                h = o.substr(l + 1, u - (l + 1)).split(","),
                p = 1;

            switch (c) {
              case "rgba":
                if (4 !== h.length) return null;
                p = s(h.pop());

              case "rgb":
                return 3 !== h.length ? null : [i(h[0]), i(h[1]), i(h[2]), p];

              case "hsla":
                if (4 !== h.length) return null;
                p = s(h.pop());

              case "hsl":
                if (3 !== h.length) return null;
                var d = (parseFloat(h[0]) % 360 + 360) % 360 / 360,
                    f = s(h[1]),
                    y = s(h[2]),
                    m = y <= .5 ? y * (f + 1) : y + f - y * f,
                    g = 2 * y - m;
                return [n(255 * a(g, m, d + 1 / 3)), n(255 * a(g, m, d)), n(255 * a(g, m, d - 1 / 3)), p];

              default:
                return null;
            }
          }

          return null;
        };
      } catch (t) {}
    });

    var Ge = /*#__PURE__*/function () {
      function Ge(t, e, r) {
        var n = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1;

        _classCallCheck(this, Ge);

        this.r = t, this.g = e, this.b = r, this.a = n;
      }

      _createClass(Ge, [{
        key: "toString",
        value: function toString() {
          var _this$toArray = this.toArray(),
              _this$toArray2 = _slicedToArray(_this$toArray, 4),
              t = _this$toArray2[0],
              e = _this$toArray2[1],
              r = _this$toArray2[2],
              n = _this$toArray2[3];

          return "rgba(".concat(Math.round(t), ",").concat(Math.round(e), ",").concat(Math.round(r), ",").concat(n, ")");
        }
      }, {
        key: "toArray",
        value: function toArray() {
          var t = this.r,
              e = this.g,
              r = this.b,
              n = this.a;
          return 0 === n ? [0, 0, 0, 0] : [255 * t / n, 255 * e / n, 255 * r / n, n];
        }
      }], [{
        key: "parse",
        value: function parse(t) {
          if (!t) return;
          if (t instanceof Ge) return t;
          if ("string" != typeof t) return;
          var e = Ne.parseCSSColor(t);
          return e ? new Ge(e[0] / 255 * e[3], e[1] / 255 * e[3], e[2] / 255 * e[3], e[3]) : void 0;
        }
      }]);

      return Ge;
    }();

    Ge.black = new Ge(0, 0, 0, 1), Ge.white = new Ge(1, 1, 1, 1), Ge.transparent = new Ge(0, 0, 0, 0), Ge.red = new Ge(1, 0, 0, 1), Ge.blue = new Ge(0, 0, 1, 1);

    var Ze = /*#__PURE__*/function () {
      function Ze(t, e, r) {
        _classCallCheck(this, Ze);

        this.sensitivity = t ? e ? "variant" : "case" : e ? "accent" : "base", this.locale = r, this.collator = new Intl.Collator(this.locale ? this.locale : [], {
          sensitivity: this.sensitivity,
          usage: "search"
        });
      }

      _createClass(Ze, [{
        key: "compare",
        value: function compare(t, e) {
          return this.collator.compare(t, e);
        }
      }, {
        key: "resolvedLocale",
        value: function resolvedLocale() {
          return new Intl.Collator(this.locale ? this.locale : []).resolvedOptions().locale;
        }
      }]);

      return Ze;
    }();

    var Xe = /*#__PURE__*/_createClass(function Xe(t, e, r, n, i) {
      _classCallCheck(this, Xe);

      this.text = t.normalize ? t.normalize() : t, this.image = e, this.scale = r, this.fontStack = n, this.textColor = i;
    });

    var Ke = /*#__PURE__*/function () {
      function Ke(t) {
        _classCallCheck(this, Ke);

        this.sections = t;
      }

      _createClass(Ke, [{
        key: "isEmpty",
        value: function isEmpty() {
          return 0 === this.sections.length || !this.sections.some(function (t) {
            return 0 !== t.text.length || t.image && 0 !== t.image.name.length;
          });
        }
      }, {
        key: "toString",
        value: function toString() {
          return 0 === this.sections.length ? "" : this.sections.map(function (t) {
            return t.text;
          }).join("");
        }
      }, {
        key: "serialize",
        value: function serialize() {
          var t = ["format"];

          var _iterator5 = _createForOfIteratorHelper(this.sections),
              _step5;

          try {
            for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {
              var _e15 = _step5.value;

              if (_e15.image) {
                t.push(["image", _e15.image.name]);
                continue;
              }

              t.push(_e15.text);
              var _r12 = {};
              _e15.fontStack && (_r12["text-font"] = ["literal", _e15.fontStack.split(",")]), _e15.scale && (_r12["font-scale"] = _e15.scale), _e15.textColor && (_r12["text-color"] = ["rgba"].concat(_e15.textColor.toArray())), t.push(_r12);
            }
          } catch (err) {
            _iterator5.e(err);
          } finally {
            _iterator5.f();
          }

          return t;
        }
      }], [{
        key: "fromString",
        value: function fromString(t) {
          return new Ke([new Xe(t, null, null, null, null)]);
        }
      }, {
        key: "factory",
        value: function factory(t) {
          return t instanceof Ke ? t : Ke.fromString(t);
        }
      }]);

      return Ke;
    }();

    var Ye = /*#__PURE__*/function () {
      function Ye(t) {
        _classCallCheck(this, Ye);

        this.name = t.name, this.available = t.available;
      }

      _createClass(Ye, [{
        key: "toString",
        value: function toString() {
          return this.name;
        }
      }, {
        key: "serialize",
        value: function serialize() {
          return ["image", this.name];
        }
      }], [{
        key: "fromString",
        value: function fromString(t) {
          return t ? new Ye({
            name: t,
            available: !1
          }) : null;
        }
      }]);

      return Ye;
    }();

    function He(t, e, r, n) {
      return "number" == typeof t && t >= 0 && t <= 255 && "number" == typeof e && e >= 0 && e <= 255 && "number" == typeof r && r >= 0 && r <= 255 ? void 0 === n || "number" == typeof n && n >= 0 && n <= 1 ? null : "Invalid rgba value [".concat([t, e, r, n].join(", "), "]: 'a' must be between 0 and 1.") : "Invalid rgba value [".concat(("number" == typeof n ? [t, e, r, n] : [t, e, r]).join(", "), "]: 'r', 'g', and 'b' must be between 0 and 255.");
    }

    function Je(t) {
      if (null === t) return !0;
      if ("string" == typeof t) return !0;
      if ("boolean" == typeof t) return !0;
      if ("number" == typeof t) return !0;
      if (t instanceof Ge) return !0;
      if (t instanceof Ze) return !0;
      if (t instanceof Ke) return !0;
      if (t instanceof Ye) return !0;

      if (Array.isArray(t)) {
        var _iterator6 = _createForOfIteratorHelper(t),
            _step6;

        try {
          for (_iterator6.s(); !(_step6 = _iterator6.n()).done;) {
            var _e16 = _step6.value;
            if (!Je(_e16)) return !1;
          }
        } catch (err) {
          _iterator6.e(err);
        } finally {
          _iterator6.f();
        }

        return !0;
      }

      if ("object" == _typeof(t)) {
        for (var _e17 in t) {
          if (!Je(t[_e17])) return !1;
        }

        return !0;
      }

      return !1;
    }

    function We(t) {
      if (null === t) return ze;
      if ("string" == typeof t) return Te;
      if ("boolean" == typeof t) return Be;
      if ("number" == typeof t) return Me;
      if (t instanceof Ge) return Ce;
      if (t instanceof Ze) return De;
      if (t instanceof Ke) return Ve;
      if (t instanceof Ye) return Fe;

      if (Array.isArray(t)) {
        var _e18 = t.length;

        var _r13;

        var _iterator7 = _createForOfIteratorHelper(t),
            _step7;

        try {
          for (_iterator7.s(); !(_step7 = _iterator7.n()).done;) {
            var _e19 = _step7.value;

            var _t10 = We(_e19);

            if (_r13) {
              if (_r13 === _t10) continue;
              _r13 = Ee;
              break;
            }

            _r13 = _t10;
          }
        } catch (err) {
          _iterator7.e(err);
        } finally {
          _iterator7.f();
        }

        return Le(_r13 || Ee, _e18);
      }

      return Pe;
    }

    function Qe(t) {
      var e = _typeof(t);

      return null === t ? "" : "string" === e || "number" === e || "boolean" === e ? String(t) : t instanceof Ge || t instanceof Ke || t instanceof Ye ? t.toString() : JSON.stringify(t);
    }

    var tr = /*#__PURE__*/function () {
      function tr(t, e) {
        _classCallCheck(this, tr);

        this.type = t, this.value = e;
      }

      _createClass(tr, [{
        key: "evaluate",
        value: function evaluate() {
          return this.value;
        }
      }, {
        key: "eachChild",
        value: function eachChild() {}
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return !0;
        }
      }, {
        key: "serialize",
        value: function serialize() {
          return "array" === this.type.kind || "object" === this.type.kind ? ["literal", this.value] : this.value instanceof Ge ? ["rgba"].concat(this.value.toArray()) : this.value instanceof Ke ? this.value.serialize() : this.value;
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (2 !== t.length) return e.error("'literal' expression requires exactly one argument, but found ".concat(t.length - 1, " instead."));
          if (!Je(t[1])) return e.error("invalid value");
          var r = t[1];
          var n = We(r);
          var i = e.expectedType;
          return "array" !== n.kind || 0 !== n.N || !i || "array" !== i.kind || "number" == typeof i.N && 0 !== i.N || (n = i), new tr(n, r);
        }
      }]);

      return tr;
    }();

    var er = /*#__PURE__*/function () {
      function er(t) {
        _classCallCheck(this, er);

        this.name = "ExpressionEvaluationError", this.message = t;
      }

      _createClass(er, [{
        key: "toJSON",
        value: function toJSON() {
          return this.message;
        }
      }]);

      return er;
    }();

    var rr = {
      string: Te,
      number: Me,
      "boolean": Be,
      object: Pe
    };

    var nr = /*#__PURE__*/function () {
      function nr(t, e) {
        _classCallCheck(this, nr);

        this.type = t, this.args = e;
      }

      _createClass(nr, [{
        key: "evaluate",
        value: function evaluate(t) {
          for (var _e20 = 0; _e20 < this.args.length; _e20++) {
            var _r14 = this.args[_e20].evaluate(t);

            if (!$e(this.type, We(_r14))) return _r14;
            if (_e20 === this.args.length - 1) throw new er("Expected value to be of type ".concat(Re(this.type), ", but found ").concat(Re(We(_r14)), " instead."));
          }

          return null;
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          this.args.forEach(t);
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return this.args.every(function (t) {
            return t.outputDefined();
          });
        }
      }, {
        key: "serialize",
        value: function serialize() {
          var t = this.type,
              e = [t.kind];

          if ("array" === t.kind) {
            var _r15 = t.itemType;

            if ("string" === _r15.kind || "number" === _r15.kind || "boolean" === _r15.kind) {
              e.push(_r15.kind);
              var _n8 = t.N;
              ("number" == typeof _n8 || this.args.length > 1) && e.push(_n8);
            }
          }

          return e.concat(this.args.map(function (t) {
            return t.serialize();
          }));
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (t.length < 2) return e.error("Expected at least one argument.");
          var r,
              n = 1;
          var i = t[0];

          if ("array" === i) {
            var _i8, _s3;

            if (t.length > 2) {
              var _r16 = t[1];
              if ("string" != typeof _r16 || !(_r16 in rr) || "object" === _r16) return e.error('The item type argument of "array" must be one of string, number, boolean', 1);
              _i8 = rr[_r16], n++;
            } else _i8 = Ee;

            if (t.length > 3) {
              if (null !== t[2] && ("number" != typeof t[2] || t[2] < 0 || t[2] !== Math.floor(t[2]))) return e.error('The length argument to "array" must be a positive integer literal', 2);
              _s3 = t[2], n++;
            }

            r = Le(_i8, _s3);
          } else r = rr[i];

          var s = [];

          for (; n < t.length; n++) {
            var _r17 = e.parse(t[n], n, Ee);

            if (!_r17) return null;
            s.push(_r17);
          }

          return new nr(r, s);
        }
      }]);

      return nr;
    }();

    var ir = /*#__PURE__*/function () {
      function ir(t) {
        _classCallCheck(this, ir);

        this.type = Ve, this.sections = t;
      }

      _createClass(ir, [{
        key: "evaluate",
        value: function evaluate(t) {
          return new Ke(this.sections.map(function (e) {
            var r = e.content.evaluate(t);
            return We(r) === Fe ? new Xe("", r, null, null, null) : new Xe(Qe(r), null, e.scale ? e.scale.evaluate(t) : null, e.font ? e.font.evaluate(t).join(",") : null, e.textColor ? e.textColor.evaluate(t) : null);
          }));
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          var _iterator8 = _createForOfIteratorHelper(this.sections),
              _step8;

          try {
            for (_iterator8.s(); !(_step8 = _iterator8.n()).done;) {
              var _e21 = _step8.value;
              t(_e21.content), _e21.scale && t(_e21.scale), _e21.font && t(_e21.font), _e21.textColor && t(_e21.textColor);
            }
          } catch (err) {
            _iterator8.e(err);
          } finally {
            _iterator8.f();
          }
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return !1;
        }
      }, {
        key: "serialize",
        value: function serialize() {
          var t = ["format"];

          var _iterator9 = _createForOfIteratorHelper(this.sections),
              _step9;

          try {
            for (_iterator9.s(); !(_step9 = _iterator9.n()).done;) {
              var _e22 = _step9.value;
              t.push(_e22.content.serialize());
              var _r18 = {};
              _e22.scale && (_r18["font-scale"] = _e22.scale.serialize()), _e22.font && (_r18["text-font"] = _e22.font.serialize()), _e22.textColor && (_r18["text-color"] = _e22.textColor.serialize()), t.push(_r18);
            }
          } catch (err) {
            _iterator9.e(err);
          } finally {
            _iterator9.f();
          }

          return t;
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (t.length < 2) return e.error("Expected at least one argument.");
          var r = t[1];
          if (!Array.isArray(r) && "object" == _typeof(r)) return e.error("First argument must be an image or text section.");
          var n = [];
          var i = !1;

          for (var _r19 = 1; _r19 <= t.length - 1; ++_r19) {
            var _s4 = t[_r19];

            if (i && "object" == _typeof(_s4) && !Array.isArray(_s4)) {
              i = !1;
              var _t11 = null;
              if (_s4["font-scale"] && (_t11 = e.parse(_s4["font-scale"], 1, Me), !_t11)) return null;
              var _r20 = null;
              if (_s4["text-font"] && (_r20 = e.parse(_s4["text-font"], 1, Le(Te)), !_r20)) return null;
              var _a3 = null;
              if (_s4["text-color"] && (_a3 = e.parse(_s4["text-color"], 1, Ce), !_a3)) return null;
              var _o2 = n[n.length - 1];
              _o2.scale = _t11, _o2.font = _r20, _o2.textColor = _a3;
            } else {
              var _s5 = e.parse(t[_r19], 1, Ee);

              if (!_s5) return null;
              var _a4 = _s5.type.kind;
              if ("string" !== _a4 && "value" !== _a4 && "null" !== _a4 && "resolvedImage" !== _a4) return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");
              i = !0, n.push({
                content: _s5,
                scale: null,
                font: null,
                textColor: null
              });
            }
          }

          return new ir(n);
        }
      }]);

      return ir;
    }();

    var sr = /*#__PURE__*/function () {
      function sr(t) {
        _classCallCheck(this, sr);

        this.type = Fe, this.input = t;
      }

      _createClass(sr, [{
        key: "evaluate",
        value: function evaluate(t) {
          var e = this.input.evaluate(t),
              r = Ye.fromString(e);
          return r && t.availableImages && (r.available = t.availableImages.indexOf(e) > -1), r;
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          t(this.input);
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return !1;
        }
      }, {
        key: "serialize",
        value: function serialize() {
          return ["image", this.input.serialize()];
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (2 !== t.length) return e.error("Expected two arguments.");
          var r = e.parse(t[1], 1, Te);
          return r ? new sr(r) : e.error("No image name provided.");
        }
      }]);

      return sr;
    }();

    var ar = {
      "to-boolean": Be,
      "to-color": Ce,
      "to-number": Me,
      "to-string": Te
    };

    var or = /*#__PURE__*/function () {
      function or(t, e) {
        _classCallCheck(this, or);

        this.type = t, this.args = e;
      }

      _createClass(or, [{
        key: "evaluate",
        value: function evaluate(t) {
          if ("boolean" === this.type.kind) return Boolean(this.args[0].evaluate(t));

          if ("color" === this.type.kind) {
            var _e23, _r21;

            var _iterator10 = _createForOfIteratorHelper(this.args),
                _step10;

            try {
              for (_iterator10.s(); !(_step10 = _iterator10.n()).done;) {
                var _n9 = _step10.value;
                if (_e23 = _n9.evaluate(t), _r21 = null, _e23 instanceof Ge) return _e23;

                if ("string" == typeof _e23) {
                  var _r22 = t.parseColor(_e23);

                  if (_r22) return _r22;
                } else if (Array.isArray(_e23) && (_r21 = _e23.length < 3 || _e23.length > 4 ? "Invalid rbga value ".concat(JSON.stringify(_e23), ": expected an array containing either three or four numeric values.") : He(_e23[0], _e23[1], _e23[2], _e23[3]), !_r21)) return new Ge(_e23[0] / 255, _e23[1] / 255, _e23[2] / 255, _e23[3]);
              }
            } catch (err) {
              _iterator10.e(err);
            } finally {
              _iterator10.f();
            }

            throw new er(_r21 || "Could not parse color from value '".concat("string" == typeof _e23 ? _e23 : String(JSON.stringify(_e23)), "'"));
          }

          if ("number" === this.type.kind) {
            var _e24 = null;

            var _iterator11 = _createForOfIteratorHelper(this.args),
                _step11;

            try {
              for (_iterator11.s(); !(_step11 = _iterator11.n()).done;) {
                var _r23 = _step11.value;
                if (_e24 = _r23.evaluate(t), null === _e24) return 0;

                var _n10 = Number(_e24);

                if (!isNaN(_n10)) return _n10;
              }
            } catch (err) {
              _iterator11.e(err);
            } finally {
              _iterator11.f();
            }

            throw new er("Could not convert ".concat(JSON.stringify(_e24), " to number."));
          }

          return "formatted" === this.type.kind ? Ke.fromString(Qe(this.args[0].evaluate(t))) : "resolvedImage" === this.type.kind ? Ye.fromString(Qe(this.args[0].evaluate(t))) : Qe(this.args[0].evaluate(t));
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          this.args.forEach(t);
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return this.args.every(function (t) {
            return t.outputDefined();
          });
        }
      }, {
        key: "serialize",
        value: function serialize() {
          if ("formatted" === this.type.kind) return new ir([{
            content: this.args[0],
            scale: null,
            font: null,
            textColor: null
          }]).serialize();
          if ("resolvedImage" === this.type.kind) return new sr(this.args[0]).serialize();
          var t = ["to-".concat(this.type.kind)];
          return this.eachChild(function (e) {
            t.push(e.serialize());
          }), t;
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (t.length < 2) return e.error("Expected at least one argument.");
          var r = t[0];
          if (("to-boolean" === r || "to-string" === r) && 2 !== t.length) return e.error("Expected one argument.");
          var n = ar[r],
              i = [];

          for (var _r24 = 1; _r24 < t.length; _r24++) {
            var _n11 = e.parse(t[_r24], _r24, Ee);

            if (!_n11) return null;
            i.push(_n11);
          }

          return new or(n, i);
        }
      }]);

      return or;
    }();

    var lr = ["Unknown", "Point", "LineString", "Polygon"];

    var ur = /*#__PURE__*/function () {
      function ur() {
        _classCallCheck(this, ur);

        this.globals = null, this.feature = null, this.featureState = null, this.formattedSection = null, this._parseColorCache = {}, this.availableImages = null, this.canonical = null, this.featureTileCoord = null, this.featureDistanceData = null;
      }

      _createClass(ur, [{
        key: "id",
        value: function id() {
          return this.feature && "id" in this.feature ? this.feature.id : null;
        }
      }, {
        key: "geometryType",
        value: function geometryType() {
          return this.feature ? "number" == typeof this.feature.type ? lr[this.feature.type] : this.feature.type : null;
        }
      }, {
        key: "geometry",
        value: function geometry() {
          return this.feature && "geometry" in this.feature ? this.feature.geometry : null;
        }
      }, {
        key: "canonicalID",
        value: function canonicalID() {
          return this.canonical;
        }
      }, {
        key: "properties",
        value: function properties() {
          return this.feature && this.feature.properties || {};
        }
      }, {
        key: "distanceFromCenter",
        value: function distanceFromCenter() {
          if (this.featureTileCoord && this.featureDistanceData) {
            var _t12 = this.featureDistanceData.center,
                _e25 = this.featureDistanceData.scale,
                _this$featureTileCoor = this.featureTileCoord,
                _r25 = _this$featureTileCoor.x,
                _n12 = _this$featureTileCoor.y;
            return this.featureDistanceData.bearing[0] * (_r25 * _e25 - _t12[0]) + this.featureDistanceData.bearing[1] * (_n12 * _e25 - _t12[1]);
          }

          return 0;
        }
      }, {
        key: "parseColor",
        value: function parseColor(t) {
          var e = this._parseColorCache[t];
          return e || (e = this._parseColorCache[t] = Ge.parse(t)), e;
        }
      }]);

      return ur;
    }();

    var cr = /*#__PURE__*/function () {
      function cr(t, e, r, n) {
        _classCallCheck(this, cr);

        this.name = t, this.type = e, this._evaluate = r, this.args = n;
      }

      _createClass(cr, [{
        key: "evaluate",
        value: function evaluate(t) {
          return this._evaluate(t, this.args);
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          this.args.forEach(t);
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return !1;
        }
      }, {
        key: "serialize",
        value: function serialize() {
          return [this.name].concat(this.args.map(function (t) {
            return t.serialize();
          }));
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          var _e$errors;

          var r = t[0],
              n = cr.definitions[r];
          if (!n) return e.error("Unknown expression \"".concat(r, "\". If you wanted a literal array, use [\"literal\", [...]]."), 0);
          var i = Array.isArray(n) ? n[0] : n.type,
              s = Array.isArray(n) ? [[n[1], n[2]]] : n.overloads,
              a = s.filter(function (_ref4) {
            var _ref5 = _slicedToArray(_ref4, 1),
                e = _ref5[0];

            return !Array.isArray(e) || e.length === t.length - 1;
          });
          var o = null;

          var _iterator12 = _createForOfIteratorHelper(a),
              _step12;

          try {
            for (_iterator12.s(); !(_step12 = _iterator12.n()).done;) {
              var _ref10 = _step12.value;

              var _ref7 = _slicedToArray(_ref10, 2);

              var _n14 = _ref7[0];
              var _s6 = _ref7[1];
              o = new Er(e.registry, e.path, null, e.scope);
              var _a5 = [];

              var _l2 = !1;

              for (var _e26 = 1; _e26 < t.length; _e26++) {
                var _r28 = t[_e26],
                    _i10 = Array.isArray(_n14) ? _n14[_e26 - 1] : _n14.type,
                    _s7 = o.parse(_r28, 1 + _a5.length, _i10);

                if (!_s7) {
                  _l2 = !0;
                  break;
                }

                _a5.push(_s7);
              }

              if (!_l2) if (Array.isArray(_n14) && _n14.length !== _a5.length) o.error("Expected ".concat(_n14.length, " arguments, but found ").concat(_a5.length, " instead."));else {
                for (var _t13 = 0; _t13 < _a5.length; _t13++) {
                  var _e27 = Array.isArray(_n14) ? _n14[_t13] : _n14.type,
                      _r29 = _a5[_t13];

                  o.concat(_t13 + 1).checkSubtype(_e27, _r29.type);
                }

                if (0 === o.errors.length) return new cr(r, i, _s6, _a5);
              }
            }
          } catch (err) {
            _iterator12.e(err);
          } finally {
            _iterator12.f();
          }

          if (1 === a.length) (_e$errors = e.errors).push.apply(_e$errors, _toConsumableArray(o.errors));else {
            var _r26 = (a.length ? a : s).map(function (_ref8) {
              var _ref9 = _slicedToArray(_ref8, 1),
                  t = _ref9[0];

              return e = t, Array.isArray(e) ? "(".concat(e.map(Re).join(", "), ")") : "(".concat(Re(e.type), "...)");
              var e;
            }).join(" | "),
                _n13 = [];

            for (var _r27 = 1; _r27 < t.length; _r27++) {
              var _i9 = e.parse(t[_r27], 1 + _n13.length);

              if (!_i9) return null;

              _n13.push(Re(_i9.type));
            }

            e.error("Expected arguments of type ".concat(_r26, ", but found (").concat(_n13.join(", "), ") instead."));
          }
          return null;
        }
      }, {
        key: "register",
        value: function register(t, e) {
          cr.definitions = e;

          for (var _r30 in e) {
            t[_r30] = cr;
          }
        }
      }]);

      return cr;
    }();

    var hr = /*#__PURE__*/function () {
      function hr(t, e, r) {
        _classCallCheck(this, hr);

        this.type = De, this.locale = r, this.caseSensitive = t, this.diacriticSensitive = e;
      }

      _createClass(hr, [{
        key: "evaluate",
        value: function evaluate(t) {
          return new Ze(this.caseSensitive.evaluate(t), this.diacriticSensitive.evaluate(t), this.locale ? this.locale.evaluate(t) : null);
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          t(this.caseSensitive), t(this.diacriticSensitive), this.locale && t(this.locale);
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return !1;
        }
      }, {
        key: "serialize",
        value: function serialize() {
          var t = {};
          return t["case-sensitive"] = this.caseSensitive.serialize(), t["diacritic-sensitive"] = this.diacriticSensitive.serialize(), this.locale && (t.locale = this.locale.serialize()), ["collator", t];
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (2 !== t.length) return e.error("Expected one argument.");
          var r = t[1];
          if ("object" != _typeof(r) || Array.isArray(r)) return e.error("Collator options argument must be an object.");
          var n = e.parse(void 0 !== r["case-sensitive"] && r["case-sensitive"], 1, Be);
          if (!n) return null;
          var i = e.parse(void 0 !== r["diacritic-sensitive"] && r["diacritic-sensitive"], 1, Be);
          if (!i) return null;
          var s = null;
          return r.locale && (s = e.parse(r.locale, 1, Te), !s) ? null : new hr(n, i, s);
        }
      }]);

      return hr;
    }();

    var pr = 8192;

    function dr(t, e) {
      t[0] = Math.min(t[0], e[0]), t[1] = Math.min(t[1], e[1]), t[2] = Math.max(t[2], e[0]), t[3] = Math.max(t[3], e[1]);
    }

    function fr(t, e) {
      return !(t[0] <= e[0] || t[2] >= e[2] || t[1] <= e[1] || t[3] >= e[3]);
    }

    function yr(t, e) {
      var r = (180 + t[0]) / 360,
          n = (180 - 180 / Math.PI * Math.log(Math.tan(Math.PI / 4 + t[1] * Math.PI / 360))) / 360,
          i = Math.pow(2, e.z);
      return [Math.round(r * i * pr), Math.round(n * i * pr)];
    }

    function mr(t, e, r) {
      var n = t[0] - e[0],
          i = t[1] - e[1],
          s = t[0] - r[0],
          a = t[1] - r[1];
      return n * a - s * i == 0 && n * s <= 0 && i * a <= 0;
    }

    function gr(t, e) {
      var r = !1;

      for (var _a6 = 0, _o3 = e.length; _a6 < _o3; _a6++) {
        var _o4 = e[_a6];

        for (var _e28 = 0, _a7 = _o4.length; _e28 < _a7 - 1; _e28++) {
          if (mr(t, _o4[_e28], _o4[_e28 + 1])) return !1;
          (i = _o4[_e28])[1] > (n = t)[1] != (s = _o4[_e28 + 1])[1] > n[1] && n[0] < (s[0] - i[0]) * (n[1] - i[1]) / (s[1] - i[1]) + i[0] && (r = !r);
        }
      }

      var n, i, s;
      return r;
    }

    function xr(t, e) {
      for (var _r31 = 0; _r31 < e.length; _r31++) {
        if (gr(t, e[_r31])) return !0;
      }

      return !1;
    }

    function vr(t, e, r, n) {
      var i = n[0] - r[0],
          s = n[1] - r[1],
          a = (t[0] - r[0]) * s - i * (t[1] - r[1]),
          o = (e[0] - r[0]) * s - i * (e[1] - r[1]);
      return a > 0 && o < 0 || a < 0 && o > 0;
    }

    function br(t, e, r) {
      var _iterator13 = _createForOfIteratorHelper(r),
          _step13;

      try {
        for (_iterator13.s(); !(_step13 = _iterator13.n()).done;) {
          var _u2 = _step13.value;

          for (var _r32 = 0; _r32 < _u2.length - 1; ++_r32) {
            if (0 != (o = [(a = _u2[_r32 + 1])[0] - (s = _u2[_r32])[0], a[1] - s[1]])[0] * (l = [(i = e)[0] - (n = t)[0], i[1] - n[1]])[1] - o[1] * l[0] && vr(n, i, s, a) && vr(s, a, n, i)) return !0;
          }
        }
      } catch (err) {
        _iterator13.e(err);
      } finally {
        _iterator13.f();
      }

      var n, i, s, a, o, l;
      return !1;
    }

    function wr(t, e) {
      for (var _r33 = 0; _r33 < t.length; ++_r33) {
        if (!gr(t[_r33], e)) return !1;
      }

      for (var _r34 = 0; _r34 < t.length - 1; ++_r34) {
        if (br(t[_r34], t[_r34 + 1], e)) return !1;
      }

      return !0;
    }

    function _r(t, e) {
      for (var _r35 = 0; _r35 < e.length; _r35++) {
        if (wr(t, e[_r35])) return !0;
      }

      return !1;
    }

    function Ar(t, e, r) {
      var n = [];

      for (var _i11 = 0; _i11 < t.length; _i11++) {
        var _s8 = [];

        for (var _n15 = 0; _n15 < t[_i11].length; _n15++) {
          var _a8 = yr(t[_i11][_n15], r);

          dr(e, _a8), _s8.push(_a8);
        }

        n.push(_s8);
      }

      return n;
    }

    function kr(t, e, r) {
      var n = [];

      for (var _i12 = 0; _i12 < t.length; _i12++) {
        var _s9 = Ar(t[_i12], e, r);

        n.push(_s9);
      }

      return n;
    }

    function Sr(t, e, r, n) {
      if (t[0] < r[0] || t[0] > r[2]) {
        var _e29 = .5 * n;

        var _i13 = t[0] - r[0] > _e29 ? -n : r[0] - t[0] > _e29 ? n : 0;

        0 === _i13 && (_i13 = t[0] - r[2] > _e29 ? -n : r[2] - t[0] > _e29 ? n : 0), t[0] += _i13;
      }

      dr(e, t);
    }

    function Ir(t, e, r, n) {
      var i = Math.pow(2, n.z) * pr,
          s = [n.x * pr, n.y * pr],
          a = [];

      var _iterator14 = _createForOfIteratorHelper(t),
          _step14;

      try {
        for (_iterator14.s(); !(_step14 = _iterator14.n()).done;) {
          var _n16 = _step14.value;

          var _iterator15 = _createForOfIteratorHelper(_n16),
              _step15;

          try {
            for (_iterator15.s(); !(_step15 = _iterator15.n()).done;) {
              var _t14 = _step15.value;
              var _n17 = [_t14.x + s[0], _t14.y + s[1]];
              Sr(_n17, e, r, i), a.push(_n17);
            }
          } catch (err) {
            _iterator15.e(err);
          } finally {
            _iterator15.f();
          }
        }
      } catch (err) {
        _iterator14.e(err);
      } finally {
        _iterator14.f();
      }

      return a;
    }

    function zr(t, e, r, n) {
      var i = Math.pow(2, n.z) * pr,
          s = [n.x * pr, n.y * pr],
          a = [];

      var _iterator16 = _createForOfIteratorHelper(t),
          _step16;

      try {
        for (_iterator16.s(); !(_step16 = _iterator16.n()).done;) {
          var _r36 = _step16.value;
          var _t16 = [];

          var _iterator19 = _createForOfIteratorHelper(_r36),
              _step19;

          try {
            for (_iterator19.s(); !(_step19 = _iterator19.n()).done;) {
              var _n19 = _step19.value;
              var _r37 = [_n19.x + s[0], _n19.y + s[1]];
              dr(e, _r37), _t16.push(_r37);
            }
          } catch (err) {
            _iterator19.e(err);
          } finally {
            _iterator19.f();
          }

          a.push(_t16);
        }
      } catch (err) {
        _iterator16.e(err);
      } finally {
        _iterator16.f();
      }

      if (e[2] - e[0] <= i / 2) {
        (o = e)[0] = o[1] = 1 / 0, o[2] = o[3] = -1 / 0;

        var _iterator17 = _createForOfIteratorHelper(a),
            _step17;

        try {
          for (_iterator17.s(); !(_step17 = _iterator17.n()).done;) {
            var _t15 = _step17.value;

            var _iterator18 = _createForOfIteratorHelper(_t15),
                _step18;

            try {
              for (_iterator18.s(); !(_step18 = _iterator18.n()).done;) {
                var _n18 = _step18.value;
                Sr(_n18, e, r, i);
              }
            } catch (err) {
              _iterator18.e(err);
            } finally {
              _iterator18.f();
            }
          }
        } catch (err) {
          _iterator17.e(err);
        } finally {
          _iterator17.f();
        }
      }

      var o;
      return a;
    }

    var Mr = /*#__PURE__*/function () {
      function Mr(t, e) {
        _classCallCheck(this, Mr);

        this.type = Be, this.geojson = t, this.geometries = e;
      }

      _createClass(Mr, [{
        key: "evaluate",
        value: function evaluate(t) {
          if (null != t.geometry() && null != t.canonicalID()) {
            if ("Point" === t.geometryType()) return function (t, e) {
              var r = [1 / 0, 1 / 0, -1 / 0, -1 / 0],
                  n = [1 / 0, 1 / 0, -1 / 0, -1 / 0],
                  i = t.canonicalID();

              if ("Polygon" === e.type) {
                var _s10 = Ar(e.coordinates, n, i),
                    _a9 = Ir(t.geometry(), r, n, i);

                if (!fr(r, n)) return !1;

                var _iterator20 = _createForOfIteratorHelper(_a9),
                    _step20;

                try {
                  for (_iterator20.s(); !(_step20 = _iterator20.n()).done;) {
                    var _t17 = _step20.value;
                    if (!gr(_t17, _s10)) return !1;
                  }
                } catch (err) {
                  _iterator20.e(err);
                } finally {
                  _iterator20.f();
                }
              }

              if ("MultiPolygon" === e.type) {
                var _s11 = kr(e.coordinates, n, i),
                    _a10 = Ir(t.geometry(), r, n, i);

                if (!fr(r, n)) return !1;

                var _iterator21 = _createForOfIteratorHelper(_a10),
                    _step21;

                try {
                  for (_iterator21.s(); !(_step21 = _iterator21.n()).done;) {
                    var _t18 = _step21.value;
                    if (!xr(_t18, _s11)) return !1;
                  }
                } catch (err) {
                  _iterator21.e(err);
                } finally {
                  _iterator21.f();
                }
              }

              return !0;
            }(t, this.geometries);
            if ("LineString" === t.geometryType()) return function (t, e) {
              var r = [1 / 0, 1 / 0, -1 / 0, -1 / 0],
                  n = [1 / 0, 1 / 0, -1 / 0, -1 / 0],
                  i = t.canonicalID();

              if ("Polygon" === e.type) {
                var _s12 = Ar(e.coordinates, n, i),
                    _a11 = zr(t.geometry(), r, n, i);

                if (!fr(r, n)) return !1;

                var _iterator22 = _createForOfIteratorHelper(_a11),
                    _step22;

                try {
                  for (_iterator22.s(); !(_step22 = _iterator22.n()).done;) {
                    var _t19 = _step22.value;
                    if (!wr(_t19, _s12)) return !1;
                  }
                } catch (err) {
                  _iterator22.e(err);
                } finally {
                  _iterator22.f();
                }
              }

              if ("MultiPolygon" === e.type) {
                var _s13 = kr(e.coordinates, n, i),
                    _a12 = zr(t.geometry(), r, n, i);

                if (!fr(r, n)) return !1;

                var _iterator23 = _createForOfIteratorHelper(_a12),
                    _step23;

                try {
                  for (_iterator23.s(); !(_step23 = _iterator23.n()).done;) {
                    var _t20 = _step23.value;
                    if (!_r(_t20, _s13)) return !1;
                  }
                } catch (err) {
                  _iterator23.e(err);
                } finally {
                  _iterator23.f();
                }
              }

              return !0;
            }(t, this.geometries);
          }

          return !1;
        }
      }, {
        key: "eachChild",
        value: function eachChild() {}
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return !0;
        }
      }, {
        key: "serialize",
        value: function serialize() {
          return ["within", this.geojson];
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (2 !== t.length) return e.error("'within' expression requires exactly one argument, but found ".concat(t.length - 1, " instead."));

          if (Je(t[1])) {
            var _e30 = t[1];
            if ("FeatureCollection" === _e30.type) for (var _t21 = 0; _t21 < _e30.features.length; ++_t21) {
              var _r38 = _e30.features[_t21].geometry.type;
              if ("Polygon" === _r38 || "MultiPolygon" === _r38) return new Mr(_e30, _e30.features[_t21].geometry);
            } else if ("Feature" === _e30.type) {
              var _t22 = _e30.geometry.type;
              if ("Polygon" === _t22 || "MultiPolygon" === _t22) return new Mr(_e30, _e30.geometry);
            } else if ("Polygon" === _e30.type || "MultiPolygon" === _e30.type) return new Mr(_e30, _e30);
          }

          return e.error("'within' expression requires valid geojson object that contains polygon geometry type.");
        }
      }]);

      return Mr;
    }();

    function Tr(t) {
      if (t instanceof cr) {
        if ("get" === t.name && 1 === t.args.length) return !1;
        if ("feature-state" === t.name) return !1;
        if ("has" === t.name && 1 === t.args.length) return !1;
        if ("properties" === t.name || "geometry-type" === t.name || "id" === t.name) return !1;
        if (/^filter-/.test(t.name)) return !1;
      }

      if (t instanceof Mr) return !1;
      var e = !0;
      return t.eachChild(function (t) {
        e && !Tr(t) && (e = !1);
      }), e;
    }

    function Br(t) {
      if (t instanceof cr && "feature-state" === t.name) return !1;
      var e = !0;
      return t.eachChild(function (t) {
        e && !Br(t) && (e = !1);
      }), e;
    }

    function Cr(t, e) {
      if (t instanceof cr && e.indexOf(t.name) >= 0) return !1;
      var r = !0;
      return t.eachChild(function (t) {
        r && !Cr(t, e) && (r = !1);
      }), r;
    }

    var Pr = /*#__PURE__*/function () {
      function Pr(t, e) {
        _classCallCheck(this, Pr);

        this.type = e.type, this.name = t, this.boundExpression = e;
      }

      _createClass(Pr, [{
        key: "evaluate",
        value: function evaluate(t) {
          return this.boundExpression.evaluate(t);
        }
      }, {
        key: "eachChild",
        value: function eachChild() {}
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return !1;
        }
      }, {
        key: "serialize",
        value: function serialize() {
          return ["var", this.name];
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (2 !== t.length || "string" != typeof t[1]) return e.error("'var' expression requires exactly one string literal argument.");
          var r = t[1];
          return e.scope.has(r) ? new Pr(r, e.scope.get(r)) : e.error("Unknown variable \"".concat(r, "\". Make sure \"").concat(r, "\" has been bound in an enclosing \"let\" expression before using it."), 1);
        }
      }]);

      return Pr;
    }();

    var Er = /*#__PURE__*/function () {
      function Er(t) {
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];
        var r = arguments.length > 2 ? arguments[2] : undefined;
        var n = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : new Ie();
        var i = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : [];

        _classCallCheck(this, Er);

        this.registry = t, this.path = e, this.key = e.map(function (t) {
          return "[".concat(t, "]");
        }).join(""), this.scope = n, this.errors = i, this.expectedType = r;
      }

      _createClass(Er, [{
        key: "parse",
        value: function parse(t, e, r, n) {
          var i = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {};
          return e ? this.concat(e, r, n)._parse(t, i) : this._parse(t, i);
        }
      }, {
        key: "_parse",
        value: function _parse(t, e) {
          function r(t, e, r) {
            return "assert" === r ? new nr(e, [t]) : "coerce" === r ? new or(e, [t]) : t;
          }

          if (null !== t && "string" != typeof t && "boolean" != typeof t && "number" != typeof t || (t = ["literal", t]), Array.isArray(t)) {
            if (0 === t.length) return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');
            var _n20 = t[0];
            if ("string" != typeof _n20) return this.error("Expression name must be a string, but found ".concat(_typeof(_n20), " instead. If you wanted a literal array, use [\"literal\", [...]]."), 0), null;
            var _i14 = this.registry[_n20];

            if (_i14) {
              var _n21 = _i14.parse(t, this);

              if (!_n21) return null;

              if (this.expectedType) {
                var _t23 = this.expectedType,
                    _i15 = _n21.type;
                if ("string" !== _t23.kind && "number" !== _t23.kind && "boolean" !== _t23.kind && "object" !== _t23.kind && "array" !== _t23.kind || "value" !== _i15.kind) {
                  if ("color" !== _t23.kind && "formatted" !== _t23.kind && "resolvedImage" !== _t23.kind || "value" !== _i15.kind && "string" !== _i15.kind) {
                    if (this.checkSubtype(_t23, _i15)) return null;
                  } else _n21 = r(_n21, _t23, e.typeAnnotation || "coerce");
                } else _n21 = r(_n21, _t23, e.typeAnnotation || "assert");
              }

              if (!(_n21 instanceof tr) && "resolvedImage" !== _n21.type.kind && Dr(_n21)) {
                var _t24 = new ur();

                try {
                  _n21 = new tr(_n21.type, _n21.evaluate(_t24));
                } catch (t) {
                  return this.error(t.message), null;
                }
              }

              return _n21;
            }

            return this.error("Unknown expression \"".concat(_n20, "\". If you wanted a literal array, use [\"literal\", [...]]."), 0);
          }

          return this.error(void 0 === t ? "'undefined' value invalid. Use null instead." : "object" == _typeof(t) ? 'Bare objects invalid. Use ["literal", {...}] instead.' : "Expected an array, but found ".concat(_typeof(t), " instead."));
        }
      }, {
        key: "concat",
        value: function concat(t, e, r) {
          var n = "number" == typeof t ? this.path.concat(t) : this.path,
              i = r ? this.scope.concat(r) : this.scope;
          return new Er(this.registry, n, e || null, i, this.errors);
        }
      }, {
        key: "error",
        value: function error(t) {
          for (var _len3 = arguments.length, e = new Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {
            e[_key3 - 1] = arguments[_key3];
          }

          var r = "".concat(this.key).concat(e.map(function (t) {
            return "[".concat(t, "]");
          }).join(""));
          this.errors.push(new Se(r, t));
        }
      }, {
        key: "checkSubtype",
        value: function checkSubtype(t, e) {
          var r = $e(t, e);
          return r && this.error(r), r;
        }
      }]);

      return Er;
    }();

    function Dr(t) {
      if (t instanceof Pr) return Dr(t.boundExpression);
      if (t instanceof cr && "error" === t.name) return !1;
      if (t instanceof hr) return !1;
      if (t instanceof Mr) return !1;
      var e = t instanceof or || t instanceof nr;
      var r = !0;
      return t.eachChild(function (t) {
        r = e ? r && Dr(t) : r && t instanceof tr;
      }), !!r && Tr(t) && Cr(t, ["zoom", "heatmap-density", "line-progress", "sky-radial-progress", "accumulated", "is-supported-script", "pitch", "distance-from-center"]);
    }

    function Vr(t, e) {
      var r = t.length - 1;
      var n,
          i,
          s = 0,
          a = r,
          o = 0;

      for (; s <= a;) {
        if (o = Math.floor((s + a) / 2), n = t[o], i = t[o + 1], n <= e) {
          if (o === r || e < i) return o;
          s = o + 1;
        } else {
          if (!(n > e)) throw new er("Input is not a number.");
          a = o - 1;
        }
      }

      return 0;
    }

    var Fr = /*#__PURE__*/function () {
      function Fr(t, e, r) {
        _classCallCheck(this, Fr);

        this.type = t, this.input = e, this.labels = [], this.outputs = [];

        var _iterator24 = _createForOfIteratorHelper(r),
            _step24;

        try {
          for (_iterator24.s(); !(_step24 = _iterator24.n()).done;) {
            var _ref13 = _step24.value;

            var _ref12 = _slicedToArray(_ref13, 2);

            var _t25 = _ref12[0];
            var _e31 = _ref12[1];
            this.labels.push(_t25), this.outputs.push(_e31);
          }
        } catch (err) {
          _iterator24.e(err);
        } finally {
          _iterator24.f();
        }
      }

      _createClass(Fr, [{
        key: "evaluate",
        value: function evaluate(t) {
          var e = this.labels,
              r = this.outputs;
          if (1 === e.length) return r[0].evaluate(t);
          var n = this.input.evaluate(t);
          if (n <= e[0]) return r[0].evaluate(t);
          var i = e.length;
          return n >= e[i - 1] ? r[i - 1].evaluate(t) : r[Vr(e, n)].evaluate(t);
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          t(this.input);

          var _iterator25 = _createForOfIteratorHelper(this.outputs),
              _step25;

          try {
            for (_iterator25.s(); !(_step25 = _iterator25.n()).done;) {
              var _e32 = _step25.value;
              t(_e32);
            }
          } catch (err) {
            _iterator25.e(err);
          } finally {
            _iterator25.f();
          }
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return this.outputs.every(function (t) {
            return t.outputDefined();
          });
        }
      }, {
        key: "serialize",
        value: function serialize() {
          var t = ["step", this.input.serialize()];

          for (var _e33 = 0; _e33 < this.labels.length; _e33++) {
            _e33 > 0 && t.push(this.labels[_e33]), t.push(this.outputs[_e33].serialize());
          }

          return t;
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (t.length - 1 < 4) return e.error("Expected at least 4 arguments, but found only ".concat(t.length - 1, "."));
          if ((t.length - 1) % 2 != 0) return e.error("Expected an even number of arguments.");
          var r = e.parse(t[1], 1, Me);
          if (!r) return null;
          var n = [];
          var i = null;
          e.expectedType && "value" !== e.expectedType.kind && (i = e.expectedType);

          for (var _r39 = 1; _r39 < t.length; _r39 += 2) {
            var _s14 = 1 === _r39 ? -1 / 0 : t[_r39],
                _a13 = t[_r39 + 1],
                _o5 = _r39,
                _l3 = _r39 + 1;

            if ("number" != typeof _s14) return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.', _o5);
            if (n.length && n[n.length - 1][0] >= _s14) return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.', _o5);

            var _u3 = e.parse(_a13, _l3, i);

            if (!_u3) return null;
            i = i || _u3.type, n.push([_s14, _u3]);
          }

          return new Fr(i, r, n);
        }
      }]);

      return Fr;
    }();

    function Lr(t, e, r) {
      return t * (1 - r) + e * r;
    }

    var Rr = Object.freeze({
      __proto__: null,
      number: Lr,
      color: function color(t, e, r) {
        return new Ge(Lr(t.r, e.r, r), Lr(t.g, e.g, r), Lr(t.b, e.b, r), Lr(t.a, e.a, r));
      },
      array: function array(t, e, r) {
        return t.map(function (t, n) {
          return Lr(t, e[n], r);
        });
      }
    });
    var Ur = .95047,
        $r = 1.08883,
        Or = 4 / 29,
        jr = 6 / 29,
        qr = 3 * jr * jr,
        Nr = Math.PI / 180,
        Gr = 180 / Math.PI;

    function Zr(t) {
      return t > .008856451679035631 ? Math.pow(t, 1 / 3) : t / qr + Or;
    }

    function Xr(t) {
      return t > jr ? t * t * t : qr * (t - Or);
    }

    function Kr(t) {
      return 255 * (t <= .0031308 ? 12.92 * t : 1.055 * Math.pow(t, 1 / 2.4) - .055);
    }

    function Yr(t) {
      return (t /= 255) <= .04045 ? t / 12.92 : Math.pow((t + .055) / 1.055, 2.4);
    }

    function Hr(t) {
      var e = Yr(t.r),
          r = Yr(t.g),
          n = Yr(t.b),
          i = Zr((.4124564 * e + .3575761 * r + .1804375 * n) / Ur),
          s = Zr((.2126729 * e + .7151522 * r + .072175 * n) / 1);
      return {
        l: 116 * s - 16,
        a: 500 * (i - s),
        b: 200 * (s - Zr((.0193339 * e + .119192 * r + .9503041 * n) / $r)),
        alpha: t.a
      };
    }

    function Jr(t) {
      var e = (t.l + 16) / 116,
          r = isNaN(t.a) ? e : e + t.a / 500,
          n = isNaN(t.b) ? e : e - t.b / 200;
      return e = 1 * Xr(e), r = Ur * Xr(r), n = $r * Xr(n), new Ge(Kr(3.2404542 * r - 1.5371385 * e - .4985314 * n), Kr(-.969266 * r + 1.8760108 * e + .041556 * n), Kr(.0556434 * r - .2040259 * e + 1.0572252 * n), t.alpha);
    }

    function Wr(t, e, r) {
      var n = e - t;
      return t + r * (n > 180 || n < -180 ? n - 360 * Math.round(n / 360) : n);
    }

    var Qr = {
      forward: Hr,
      reverse: Jr,
      interpolate: function interpolate(t, e, r) {
        return {
          l: Lr(t.l, e.l, r),
          a: Lr(t.a, e.a, r),
          b: Lr(t.b, e.b, r),
          alpha: Lr(t.alpha, e.alpha, r)
        };
      }
    },
        tn = {
      forward: function forward(t) {
        var _Hr = Hr(t),
            e = _Hr.l,
            r = _Hr.a,
            n = _Hr.b,
            i = Math.atan2(n, r) * Gr;

        return {
          h: i < 0 ? i + 360 : i,
          c: Math.sqrt(r * r + n * n),
          l: e,
          alpha: t.a
        };
      },
      reverse: function reverse(t) {
        var e = t.h * Nr,
            r = t.c;
        return Jr({
          l: t.l,
          a: Math.cos(e) * r,
          b: Math.sin(e) * r,
          alpha: t.alpha
        });
      },
      interpolate: function interpolate(t, e, r) {
        return {
          h: Wr(t.h, e.h, r),
          c: Lr(t.c, e.c, r),
          l: Lr(t.l, e.l, r),
          alpha: Lr(t.alpha, e.alpha, r)
        };
      }
    };
    var en = Object.freeze({
      __proto__: null,
      lab: Qr,
      hcl: tn
    });

    var rn = /*#__PURE__*/function () {
      function rn(t, e, r, n, i) {
        _classCallCheck(this, rn);

        this.type = t, this.operator = e, this.interpolation = r, this.input = n, this.labels = [], this.outputs = [];

        var _iterator26 = _createForOfIteratorHelper(i),
            _step26;

        try {
          for (_iterator26.s(); !(_step26 = _iterator26.n()).done;) {
            var _ref16 = _step26.value;

            var _ref15 = _slicedToArray(_ref16, 2);

            var _t26 = _ref15[0];
            var _e34 = _ref15[1];
            this.labels.push(_t26), this.outputs.push(_e34);
          }
        } catch (err) {
          _iterator26.e(err);
        } finally {
          _iterator26.f();
        }
      }

      _createClass(rn, [{
        key: "evaluate",
        value: function evaluate(t) {
          var e = this.labels,
              r = this.outputs;
          if (1 === e.length) return r[0].evaluate(t);
          var n = this.input.evaluate(t);
          if (n <= e[0]) return r[0].evaluate(t);
          var i = e.length;
          if (n >= e[i - 1]) return r[i - 1].evaluate(t);
          var s = Vr(e, n),
              a = rn.interpolationFactor(this.interpolation, n, e[s], e[s + 1]),
              o = r[s].evaluate(t),
              l = r[s + 1].evaluate(t);
          return "interpolate" === this.operator ? Rr[this.type.kind.toLowerCase()](o, l, a) : "interpolate-hcl" === this.operator ? tn.reverse(tn.interpolate(tn.forward(o), tn.forward(l), a)) : Qr.reverse(Qr.interpolate(Qr.forward(o), Qr.forward(l), a));
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          t(this.input);

          var _iterator27 = _createForOfIteratorHelper(this.outputs),
              _step27;

          try {
            for (_iterator27.s(); !(_step27 = _iterator27.n()).done;) {
              var _e35 = _step27.value;
              t(_e35);
            }
          } catch (err) {
            _iterator27.e(err);
          } finally {
            _iterator27.f();
          }
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return this.outputs.every(function (t) {
            return t.outputDefined();
          });
        }
      }, {
        key: "serialize",
        value: function serialize() {
          var t;
          t = "linear" === this.interpolation.name ? ["linear"] : "exponential" === this.interpolation.name ? 1 === this.interpolation.base ? ["linear"] : ["exponential", this.interpolation.base] : ["cubic-bezier"].concat(this.interpolation.controlPoints);
          var e = [this.operator, t, this.input.serialize()];

          for (var _t27 = 0; _t27 < this.labels.length; _t27++) {
            e.push(this.labels[_t27], this.outputs[_t27].serialize());
          }

          return e;
        }
      }], [{
        key: "interpolationFactor",
        value: function interpolationFactor(t, e, n, i) {
          var s = 0;
          if ("exponential" === t.name) s = nn(e, t.base, n, i);else if ("linear" === t.name) s = nn(e, 1, n, i);else if ("cubic-bezier" === t.name) {
            var _a14 = t.controlPoints;
            s = new r(_a14[0], _a14[1], _a14[2], _a14[3]).solve(nn(e, 1, n, i));
          }
          return s;
        }
      }, {
        key: "parse",
        value: function parse(t, e) {
          var _t28 = _toArray(t),
              r = _t28[0],
              n = _t28[1],
              i = _t28[2],
              s = _t28.slice(3);

          if (!Array.isArray(n) || 0 === n.length) return e.error("Expected an interpolation type expression.", 1);
          if ("linear" === n[0]) n = {
            name: "linear"
          };else if ("exponential" === n[0]) {
            var _t29 = n[1];
            if ("number" != typeof _t29) return e.error("Exponential interpolation requires a numeric base.", 1, 1);
            n = {
              name: "exponential",
              base: _t29
            };
          } else {
            if ("cubic-bezier" !== n[0]) return e.error("Unknown interpolation type ".concat(String(n[0])), 1, 0);
            {
              var _t30 = n.slice(1);

              if (4 !== _t30.length || _t30.some(function (t) {
                return "number" != typeof t || t < 0 || t > 1;
              })) return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.", 1);
              n = {
                name: "cubic-bezier",
                controlPoints: _t30
              };
            }
          }
          if (t.length - 1 < 4) return e.error("Expected at least 4 arguments, but found only ".concat(t.length - 1, "."));
          if ((t.length - 1) % 2 != 0) return e.error("Expected an even number of arguments.");
          if (i = e.parse(i, 2, Me), !i) return null;
          var a = [];
          var o = null;
          "interpolate-hcl" === r || "interpolate-lab" === r ? o = Ce : e.expectedType && "value" !== e.expectedType.kind && (o = e.expectedType);

          for (var _t31 = 0; _t31 < s.length; _t31 += 2) {
            var _r40 = s[_t31],
                _n22 = s[_t31 + 1],
                _i16 = _t31 + 3,
                _l4 = _t31 + 4;

            if ("number" != typeof _r40) return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.', _i16);
            if (a.length && a[a.length - 1][0] >= _r40) return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.', _i16);

            var _u4 = e.parse(_n22, _l4, o);

            if (!_u4) return null;
            o = o || _u4.type, a.push([_r40, _u4]);
          }

          return "number" === o.kind || "color" === o.kind || "array" === o.kind && "number" === o.itemType.kind && "number" == typeof o.N ? new rn(o, r, n, i, a) : e.error("Type ".concat(Re(o), " is not interpolatable."));
        }
      }]);

      return rn;
    }();

    function nn(t, e, r, n) {
      var i = n - r,
          s = t - r;
      return 0 === i ? 0 : 1 === e ? s / i : (Math.pow(e, s) - 1) / (Math.pow(e, i) - 1);
    }

    var sn = /*#__PURE__*/function () {
      function sn(t, e) {
        _classCallCheck(this, sn);

        this.type = t, this.args = e;
      }

      _createClass(sn, [{
        key: "evaluate",
        value: function evaluate(t) {
          var e,
              r = null,
              n = 0;

          var _iterator28 = _createForOfIteratorHelper(this.args),
              _step28;

          try {
            for (_iterator28.s(); !(_step28 = _iterator28.n()).done;) {
              var _i17 = _step28.value;
              if (n++, r = _i17.evaluate(t), r && r instanceof Ye && !r.available && (e || (e = r), r = null, n === this.args.length)) return e;
              if (null !== r) break;
            }
          } catch (err) {
            _iterator28.e(err);
          } finally {
            _iterator28.f();
          }

          return r;
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          this.args.forEach(t);
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return this.args.every(function (t) {
            return t.outputDefined();
          });
        }
      }, {
        key: "serialize",
        value: function serialize() {
          var t = ["coalesce"];
          return this.eachChild(function (e) {
            t.push(e.serialize());
          }), t;
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (t.length < 2) return e.error("Expectected at least one argument.");
          var r = null;
          var n = e.expectedType;
          n && "value" !== n.kind && (r = n);
          var i = [];

          var _iterator29 = _createForOfIteratorHelper(t.slice(1)),
              _step29;

          try {
            for (_iterator29.s(); !(_step29 = _iterator29.n()).done;) {
              var _n23 = _step29.value;

              var _t32 = e.parse(_n23, 1 + i.length, r, void 0, {
                typeAnnotation: "omit"
              });

              if (!_t32) return null;
              r = r || _t32.type, i.push(_t32);
            }
          } catch (err) {
            _iterator29.e(err);
          } finally {
            _iterator29.f();
          }

          var s = n && i.some(function (t) {
            return $e(n, t.type);
          });
          return new sn(s ? Ee : r, i);
        }
      }]);

      return sn;
    }();

    var an = /*#__PURE__*/function () {
      function an(t, e) {
        _classCallCheck(this, an);

        this.type = e.type, this.bindings = [].concat(t), this.result = e;
      }

      _createClass(an, [{
        key: "evaluate",
        value: function evaluate(t) {
          return this.result.evaluate(t);
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          var _iterator30 = _createForOfIteratorHelper(this.bindings),
              _step30;

          try {
            for (_iterator30.s(); !(_step30 = _iterator30.n()).done;) {
              var _e36 = _step30.value;
              t(_e36[1]);
            }
          } catch (err) {
            _iterator30.e(err);
          } finally {
            _iterator30.f();
          }

          t(this.result);
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return this.result.outputDefined();
        }
      }, {
        key: "serialize",
        value: function serialize() {
          var t = ["let"];

          var _iterator31 = _createForOfIteratorHelper(this.bindings),
              _step31;

          try {
            for (_iterator31.s(); !(_step31 = _iterator31.n()).done;) {
              var _ref19 = _step31.value;

              var _ref18 = _slicedToArray(_ref19, 2);

              var _e37 = _ref18[0];
              var _r41 = _ref18[1];
              t.push(_e37, _r41.serialize());
            }
          } catch (err) {
            _iterator31.e(err);
          } finally {
            _iterator31.f();
          }

          return t.push(this.result.serialize()), t;
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (t.length < 4) return e.error("Expected at least 3 arguments, but found ".concat(t.length - 1, " instead."));
          var r = [];

          for (var _n24 = 1; _n24 < t.length - 1; _n24 += 2) {
            var _i18 = t[_n24];
            if ("string" != typeof _i18) return e.error("Expected string, but found ".concat(_typeof(_i18), " instead."), _n24);
            if (/[^a-zA-Z0-9_]/.test(_i18)) return e.error("Variable names must contain only alphanumeric characters or '_'.", _n24);

            var _s15 = e.parse(t[_n24 + 1], _n24 + 1);

            if (!_s15) return null;
            r.push([_i18, _s15]);
          }

          var n = e.parse(t[t.length - 1], t.length - 1, e.expectedType, r);
          return n ? new an(r, n) : null;
        }
      }]);

      return an;
    }();

    var on = /*#__PURE__*/function () {
      function on(t, e, r) {
        _classCallCheck(this, on);

        this.type = t, this.index = e, this.input = r;
      }

      _createClass(on, [{
        key: "evaluate",
        value: function evaluate(t) {
          var e = this.index.evaluate(t),
              r = this.input.evaluate(t);
          if (e < 0) throw new er("Array index out of bounds: ".concat(e, " < 0."));
          if (e >= r.length) throw new er("Array index out of bounds: ".concat(e, " > ").concat(r.length - 1, "."));
          if (e !== Math.floor(e)) throw new er("Array index must be an integer, but found ".concat(e, " instead."));
          return r[e];
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          t(this.index), t(this.input);
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return !1;
        }
      }, {
        key: "serialize",
        value: function serialize() {
          return ["at", this.index.serialize(), this.input.serialize()];
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (3 !== t.length) return e.error("Expected 2 arguments, but found ".concat(t.length - 1, " instead."));
          var r = e.parse(t[1], 1, Me),
              n = e.parse(t[2], 2, Le(e.expectedType || Ee));
          return r && n ? new on(n.type.itemType, r, n) : null;
        }
      }]);

      return on;
    }();

    var ln = /*#__PURE__*/function () {
      function ln(t, e) {
        _classCallCheck(this, ln);

        this.type = Be, this.needle = t, this.haystack = e;
      }

      _createClass(ln, [{
        key: "evaluate",
        value: function evaluate(t) {
          var e = this.needle.evaluate(t),
              r = this.haystack.evaluate(t);
          if (!r) return !1;
          if (!je(e, ["boolean", "string", "number", "null"])) throw new er("Expected first argument to be of type boolean, string, number or null, but found ".concat(Re(We(e)), " instead."));
          if (!je(r, ["string", "array"])) throw new er("Expected second argument to be of type array or string, but found ".concat(Re(We(r)), " instead."));
          return r.indexOf(e) >= 0;
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          t(this.needle), t(this.haystack);
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return !0;
        }
      }, {
        key: "serialize",
        value: function serialize() {
          return ["in", this.needle.serialize(), this.haystack.serialize()];
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (3 !== t.length) return e.error("Expected 2 arguments, but found ".concat(t.length - 1, " instead."));
          var r = e.parse(t[1], 1, Ee),
              n = e.parse(t[2], 2, Ee);
          return r && n ? Oe(r.type, [Be, Te, Me, ze, Ee]) ? new ln(r, n) : e.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(Re(r.type), " instead")) : null;
        }
      }]);

      return ln;
    }();

    var un = /*#__PURE__*/function () {
      function un(t, e, r) {
        _classCallCheck(this, un);

        this.type = Me, this.needle = t, this.haystack = e, this.fromIndex = r;
      }

      _createClass(un, [{
        key: "evaluate",
        value: function evaluate(t) {
          var e = this.needle.evaluate(t),
              r = this.haystack.evaluate(t);
          if (!je(e, ["boolean", "string", "number", "null"])) throw new er("Expected first argument to be of type boolean, string, number or null, but found ".concat(Re(We(e)), " instead."));
          if (!je(r, ["string", "array"])) throw new er("Expected second argument to be of type array or string, but found ".concat(Re(We(r)), " instead."));

          if (this.fromIndex) {
            var _n25 = this.fromIndex.evaluate(t);

            return r.indexOf(e, _n25);
          }

          return r.indexOf(e);
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          t(this.needle), t(this.haystack), this.fromIndex && t(this.fromIndex);
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return !1;
        }
      }, {
        key: "serialize",
        value: function serialize() {
          if (null != this.fromIndex && void 0 !== this.fromIndex) {
            var _t33 = this.fromIndex.serialize();

            return ["index-of", this.needle.serialize(), this.haystack.serialize(), _t33];
          }

          return ["index-of", this.needle.serialize(), this.haystack.serialize()];
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (t.length <= 2 || t.length >= 5) return e.error("Expected 3 or 4 arguments, but found ".concat(t.length - 1, " instead."));
          var r = e.parse(t[1], 1, Ee),
              n = e.parse(t[2], 2, Ee);
          if (!r || !n) return null;
          if (!Oe(r.type, [Be, Te, Me, ze, Ee])) return e.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(Re(r.type), " instead"));

          if (4 === t.length) {
            var _i19 = e.parse(t[3], 3, Me);

            return _i19 ? new un(r, n, _i19) : null;
          }

          return new un(r, n);
        }
      }]);

      return un;
    }();

    var cn = /*#__PURE__*/function () {
      function cn(t, e, r, n, i, s) {
        _classCallCheck(this, cn);

        this.inputType = t, this.type = e, this.input = r, this.cases = n, this.outputs = i, this.otherwise = s;
      }

      _createClass(cn, [{
        key: "evaluate",
        value: function evaluate(t) {
          var e = this.input.evaluate(t);
          return (We(e) === this.inputType && this.outputs[this.cases[e]] || this.otherwise).evaluate(t);
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          t(this.input), this.outputs.forEach(t), t(this.otherwise);
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return this.outputs.every(function (t) {
            return t.outputDefined();
          }) && this.otherwise.outputDefined();
        }
      }, {
        key: "serialize",
        value: function serialize() {
          var _this12 = this;

          var t = ["match", this.input.serialize()],
              e = Object.keys(this.cases).sort(),
              r = [],
              n = {};

          var _iterator32 = _createForOfIteratorHelper(e),
              _step32;

          try {
            for (_iterator32.s(); !(_step32 = _iterator32.n()).done;) {
              var _t34 = _step32.value;
              var _e39 = n[this.cases[_t34]];
              void 0 === _e39 ? (n[this.cases[_t34]] = r.length, r.push([this.cases[_t34], [_t34]])) : r[_e39][1].push(_t34);
            }
          } catch (err) {
            _iterator32.e(err);
          } finally {
            _iterator32.f();
          }

          var i = function i(t) {
            return "number" === _this12.inputType.kind ? Number(t) : t;
          };

          for (var _i20 = 0, _r42 = r; _i20 < _r42.length; _i20++) {
            var _ref22 = _r42[_i20];

            var _ref21 = _slicedToArray(_ref22, 2);

            var _e38 = _ref21[0];
            var _n26 = _ref21[1];
            t.push(1 === _n26.length ? i(_n26[0]) : _n26.map(i)), t.push(this.outputs[_e38].serialize());
          }

          return t.push(this.otherwise.serialize()), t;
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (t.length < 5) return e.error("Expected at least 4 arguments, but found only ".concat(t.length - 1, "."));
          if (t.length % 2 != 1) return e.error("Expected an even number of arguments.");
          var r, n;
          e.expectedType && "value" !== e.expectedType.kind && (n = e.expectedType);
          var i = {},
              s = [];

          for (var _a15 = 2; _a15 < t.length - 1; _a15 += 2) {
            var _o6 = t[_a15];
            var _l5 = t[_a15 + 1];
            Array.isArray(_o6) || (_o6 = [_o6]);

            var _u5 = e.concat(_a15);

            if (0 === _o6.length) return _u5.error("Expected at least one branch label.");

            var _iterator33 = _createForOfIteratorHelper(_o6),
                _step33;

            try {
              for (_iterator33.s(); !(_step33 = _iterator33.n()).done;) {
                var _t35 = _step33.value;
                if ("number" != typeof _t35 && "string" != typeof _t35) return _u5.error("Branch labels must be numbers or strings.");
                if ("number" == typeof _t35 && Math.abs(_t35) > Number.MAX_SAFE_INTEGER) return _u5.error("Branch labels must be integers no larger than ".concat(Number.MAX_SAFE_INTEGER, "."));
                if ("number" == typeof _t35 && Math.floor(_t35) !== _t35) return _u5.error("Numeric branch labels must be integer values.");

                if (r) {
                  if (_u5.checkSubtype(r, We(_t35))) return null;
                } else r = We(_t35);

                if (void 0 !== i[String(_t35)]) return _u5.error("Branch labels must be unique.");
                i[String(_t35)] = s.length;
              }
            } catch (err) {
              _iterator33.e(err);
            } finally {
              _iterator33.f();
            }

            var _c2 = e.parse(_l5, _a15, n);

            if (!_c2) return null;
            n = n || _c2.type, s.push(_c2);
          }

          var a = e.parse(t[1], 1, Ee);
          if (!a) return null;
          var o = e.parse(t[t.length - 1], t.length - 1, n);
          return o ? "value" !== a.type.kind && e.concat(1).checkSubtype(r, a.type) ? null : new cn(r, n, a, i, s, o) : null;
        }
      }]);

      return cn;
    }();

    var hn = /*#__PURE__*/function () {
      function hn(t, e, r) {
        _classCallCheck(this, hn);

        this.type = t, this.branches = e, this.otherwise = r;
      }

      _createClass(hn, [{
        key: "evaluate",
        value: function evaluate(t) {
          var _iterator34 = _createForOfIteratorHelper(this.branches),
              _step34;

          try {
            for (_iterator34.s(); !(_step34 = _iterator34.n()).done;) {
              var _ref25 = _step34.value;

              var _ref24 = _slicedToArray(_ref25, 2);

              var _e40 = _ref24[0];
              var _r43 = _ref24[1];
              if (_e40.evaluate(t)) return _r43.evaluate(t);
            }
          } catch (err) {
            _iterator34.e(err);
          } finally {
            _iterator34.f();
          }

          return this.otherwise.evaluate(t);
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          var _iterator35 = _createForOfIteratorHelper(this.branches),
              _step35;

          try {
            for (_iterator35.s(); !(_step35 = _iterator35.n()).done;) {
              var _ref28 = _step35.value;

              var _ref27 = _slicedToArray(_ref28, 2);

              var _e41 = _ref27[0];
              var _r44 = _ref27[1];
              t(_e41), t(_r44);
            }
          } catch (err) {
            _iterator35.e(err);
          } finally {
            _iterator35.f();
          }

          t(this.otherwise);
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return this.branches.every(function (_ref29) {
            var _ref30 = _slicedToArray(_ref29, 2),
                t = _ref30[0],
                e = _ref30[1];

            return e.outputDefined();
          }) && this.otherwise.outputDefined();
        }
      }, {
        key: "serialize",
        value: function serialize() {
          var t = ["case"];
          return this.eachChild(function (e) {
            t.push(e.serialize());
          }), t;
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (t.length < 4) return e.error("Expected at least 3 arguments, but found only ".concat(t.length - 1, "."));
          if (t.length % 2 != 0) return e.error("Expected an odd number of arguments.");
          var r;
          e.expectedType && "value" !== e.expectedType.kind && (r = e.expectedType);
          var n = [];

          for (var _i21 = 1; _i21 < t.length - 1; _i21 += 2) {
            var _s16 = e.parse(t[_i21], _i21, Be);

            if (!_s16) return null;

            var _a16 = e.parse(t[_i21 + 1], _i21 + 1, r);

            if (!_a16) return null;
            n.push([_s16, _a16]), r = r || _a16.type;
          }

          var i = e.parse(t[t.length - 1], t.length - 1, r);
          return i ? new hn(r, n, i) : null;
        }
      }]);

      return hn;
    }();

    var pn = /*#__PURE__*/function () {
      function pn(t, e, r, n) {
        _classCallCheck(this, pn);

        this.type = t, this.input = e, this.beginIndex = r, this.endIndex = n;
      }

      _createClass(pn, [{
        key: "evaluate",
        value: function evaluate(t) {
          var e = this.input.evaluate(t),
              r = this.beginIndex.evaluate(t);
          if (!je(e, ["string", "array"])) throw new er("Expected first argument to be of type array or string, but found ".concat(Re(We(e)), " instead."));

          if (this.endIndex) {
            var _n27 = this.endIndex.evaluate(t);

            return e.slice(r, _n27);
          }

          return e.slice(r);
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          t(this.input), t(this.beginIndex), this.endIndex && t(this.endIndex);
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return !1;
        }
      }, {
        key: "serialize",
        value: function serialize() {
          if (null != this.endIndex && void 0 !== this.endIndex) {
            var _t36 = this.endIndex.serialize();

            return ["slice", this.input.serialize(), this.beginIndex.serialize(), _t36];
          }

          return ["slice", this.input.serialize(), this.beginIndex.serialize()];
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (t.length <= 2 || t.length >= 5) return e.error("Expected 3 or 4 arguments, but found ".concat(t.length - 1, " instead."));
          var r = e.parse(t[1], 1, Ee),
              n = e.parse(t[2], 2, Me);
          if (!r || !n) return null;
          if (!Oe(r.type, [Le(Ee), Te, Ee])) return e.error("Expected first argument to be of type array or string, but found ".concat(Re(r.type), " instead"));

          if (4 === t.length) {
            var _i22 = e.parse(t[3], 3, Me);

            return _i22 ? new pn(r.type, r, n, _i22) : null;
          }

          return new pn(r.type, r, n);
        }
      }]);

      return pn;
    }();

    function dn(t, e) {
      return "==" === t || "!=" === t ? "boolean" === e.kind || "string" === e.kind || "number" === e.kind || "null" === e.kind || "value" === e.kind : "string" === e.kind || "number" === e.kind || "value" === e.kind;
    }

    function fn(t, e, r, n) {
      return 0 === n.compare(e, r);
    }

    function yn(t, e, r) {
      var n = "==" !== t && "!=" !== t;
      return /*#__PURE__*/function () {
        function i(t, e, r) {
          _classCallCheck(this, i);

          this.type = Be, this.lhs = t, this.rhs = e, this.collator = r, this.hasUntypedArgument = "value" === t.type.kind || "value" === e.type.kind;
        }

        _createClass(i, [{
          key: "evaluate",
          value: function evaluate(_i23) {
            var s = this.lhs.evaluate(_i23),
                a = this.rhs.evaluate(_i23);

            if (n && this.hasUntypedArgument) {
              var _e42 = We(s),
                  _r45 = We(a);

              if (_e42.kind !== _r45.kind || "string" !== _e42.kind && "number" !== _e42.kind) throw new er("Expected arguments for \"".concat(t, "\" to be (string, string) or (number, number), but found (").concat(_e42.kind, ", ").concat(_r45.kind, ") instead."));
            }

            if (this.collator && !n && this.hasUntypedArgument) {
              var _t37 = We(s),
                  _r46 = We(a);

              if ("string" !== _t37.kind || "string" !== _r46.kind) return e(_i23, s, a);
            }

            return this.collator ? r(_i23, s, a, this.collator.evaluate(_i23)) : e(_i23, s, a);
          }
        }, {
          key: "eachChild",
          value: function eachChild(t) {
            t(this.lhs), t(this.rhs), this.collator && t(this.collator);
          }
        }, {
          key: "outputDefined",
          value: function outputDefined() {
            return !0;
          }
        }, {
          key: "serialize",
          value: function serialize() {
            var e = [t];
            return this.eachChild(function (t) {
              e.push(t.serialize());
            }), e;
          }
        }], [{
          key: "parse",
          value: function parse(t, e) {
            if (3 !== t.length && 4 !== t.length) return e.error("Expected two or three arguments.");
            var r = t[0];
            var s = e.parse(t[1], 1, Ee);
            if (!s) return null;
            if (!dn(r, s.type)) return e.concat(1).error("\"".concat(r, "\" comparisons are not supported for type '").concat(Re(s.type), "'."));
            var a = e.parse(t[2], 2, Ee);
            if (!a) return null;
            if (!dn(r, a.type)) return e.concat(2).error("\"".concat(r, "\" comparisons are not supported for type '").concat(Re(a.type), "'."));
            if (s.type.kind !== a.type.kind && "value" !== s.type.kind && "value" !== a.type.kind) return e.error("Cannot compare types '".concat(Re(s.type), "' and '").concat(Re(a.type), "'."));
            n && ("value" === s.type.kind && "value" !== a.type.kind ? s = new nr(a.type, [s]) : "value" !== s.type.kind && "value" === a.type.kind && (a = new nr(s.type, [a])));
            var o = null;

            if (4 === t.length) {
              if ("string" !== s.type.kind && "string" !== a.type.kind && "value" !== s.type.kind && "value" !== a.type.kind) return e.error("Cannot use collator to compare non-string types.");
              if (o = e.parse(t[3], 3, De), !o) return null;
            }

            return new i(s, a, o);
          }
        }]);

        return i;
      }();
    }

    var mn = yn("==", function (t, e, r) {
      return e === r;
    }, fn),
        gn = yn("!=", function (t, e, r) {
      return e !== r;
    }, function (t, e, r, n) {
      return !fn(0, e, r, n);
    }),
        xn = yn("<", function (t, e, r) {
      return e < r;
    }, function (t, e, r, n) {
      return n.compare(e, r) < 0;
    }),
        vn = yn(">", function (t, e, r) {
      return e > r;
    }, function (t, e, r, n) {
      return n.compare(e, r) > 0;
    }),
        bn = yn("<=", function (t, e, r) {
      return e <= r;
    }, function (t, e, r, n) {
      return n.compare(e, r) <= 0;
    }),
        wn = yn(">=", function (t, e, r) {
      return e >= r;
    }, function (t, e, r, n) {
      return n.compare(e, r) >= 0;
    });

    var _n = /*#__PURE__*/function () {
      function _n(t, e, r, n, i) {
        _classCallCheck(this, _n);

        this.type = Te, this.number = t, this.locale = e, this.currency = r, this.minFractionDigits = n, this.maxFractionDigits = i;
      }

      _createClass(_n, [{
        key: "evaluate",
        value: function evaluate(t) {
          return new Intl.NumberFormat(this.locale ? this.locale.evaluate(t) : [], {
            style: this.currency ? "currency" : "decimal",
            currency: this.currency ? this.currency.evaluate(t) : void 0,
            minimumFractionDigits: this.minFractionDigits ? this.minFractionDigits.evaluate(t) : void 0,
            maximumFractionDigits: this.maxFractionDigits ? this.maxFractionDigits.evaluate(t) : void 0
          }).format(this.number.evaluate(t));
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          t(this.number), this.locale && t(this.locale), this.currency && t(this.currency), this.minFractionDigits && t(this.minFractionDigits), this.maxFractionDigits && t(this.maxFractionDigits);
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return !1;
        }
      }, {
        key: "serialize",
        value: function serialize() {
          var t = {};
          return this.locale && (t.locale = this.locale.serialize()), this.currency && (t.currency = this.currency.serialize()), this.minFractionDigits && (t["min-fraction-digits"] = this.minFractionDigits.serialize()), this.maxFractionDigits && (t["max-fraction-digits"] = this.maxFractionDigits.serialize()), ["number-format", this.number.serialize(), t];
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (3 !== t.length) return e.error("Expected two arguments.");
          var r = e.parse(t[1], 1, Me);
          if (!r) return null;
          var n = t[2];
          if ("object" != _typeof(n) || Array.isArray(n)) return e.error("NumberFormat options argument must be an object.");
          var i = null;
          if (n.locale && (i = e.parse(n.locale, 1, Te), !i)) return null;
          var s = null;
          if (n.currency && (s = e.parse(n.currency, 1, Te), !s)) return null;
          var a = null;
          if (n["min-fraction-digits"] && (a = e.parse(n["min-fraction-digits"], 1, Me), !a)) return null;
          var o = null;
          return n["max-fraction-digits"] && (o = e.parse(n["max-fraction-digits"], 1, Me), !o) ? null : new _n(r, i, s, a, o);
        }
      }]);

      return _n;
    }();

    var An = /*#__PURE__*/function () {
      function An(t) {
        _classCallCheck(this, An);

        this.type = Me, this.input = t;
      }

      _createClass(An, [{
        key: "evaluate",
        value: function evaluate(t) {
          var e = this.input.evaluate(t);
          if ("string" == typeof e) return e.length;
          if (Array.isArray(e)) return e.length;
          throw new er("Expected value to be of type string or array, but found ".concat(Re(We(e)), " instead."));
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          t(this.input);
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return !1;
        }
      }, {
        key: "serialize",
        value: function serialize() {
          var t = ["length"];
          return this.eachChild(function (e) {
            t.push(e.serialize());
          }), t;
        }
      }], [{
        key: "parse",
        value: function parse(t, e) {
          if (2 !== t.length) return e.error("Expected 1 argument, but found ".concat(t.length - 1, " instead."));
          var r = e.parse(t[1], 1);
          return r ? "array" !== r.type.kind && "string" !== r.type.kind && "value" !== r.type.kind ? e.error("Expected argument of type string or array, but found ".concat(Re(r.type), " instead.")) : new An(r) : null;
        }
      }]);

      return An;
    }();

    var kn = {
      "==": mn,
      "!=": gn,
      ">": vn,
      "<": xn,
      ">=": wn,
      "<=": bn,
      array: nr,
      at: on,
      "boolean": nr,
      "case": hn,
      coalesce: sn,
      collator: hr,
      format: ir,
      image: sr,
      "in": ln,
      "index-of": un,
      interpolate: rn,
      "interpolate-hcl": rn,
      "interpolate-lab": rn,
      length: An,
      "let": an,
      literal: tr,
      match: cn,
      number: nr,
      "number-format": _n,
      object: nr,
      slice: pn,
      step: Fr,
      string: nr,
      "to-boolean": or,
      "to-color": or,
      "to-number": or,
      "to-string": or,
      "var": Pr,
      within: Mr
    };

    function Sn(t, _ref31) {
      var _ref32 = _slicedToArray(_ref31, 4),
          e = _ref32[0],
          r = _ref32[1],
          n = _ref32[2],
          i = _ref32[3];

      e = e.evaluate(t), r = r.evaluate(t), n = n.evaluate(t);
      var s = i ? i.evaluate(t) : 1,
          a = He(e, r, n, s);
      if (a) throw new er(a);
      return new Ge(e / 255 * s, r / 255 * s, n / 255 * s, s);
    }

    function In(t, e) {
      return t in e;
    }

    function zn(t, e) {
      var r = e[t];
      return void 0 === r ? null : r;
    }

    function Mn(t) {
      return {
        type: t
      };
    }

    function Tn(t) {
      return {
        result: "success",
        value: t
      };
    }

    function Bn(t) {
      return {
        result: "error",
        value: t
      };
    }

    function Cn(t) {
      return "data-driven" === t["property-type"] || "cross-faded-data-driven" === t["property-type"];
    }

    function Pn(t) {
      return !!t.expression && t.expression.parameters.indexOf("zoom") > -1;
    }

    function En(t) {
      return !!t.expression && t.expression.interpolated;
    }

    function Dn(t) {
      return t instanceof Number ? "number" : t instanceof String ? "string" : t instanceof Boolean ? "boolean" : Array.isArray(t) ? "array" : null === t ? "null" : _typeof(t);
    }

    function Vn(t) {
      return "object" == _typeof(t) && null !== t && !Array.isArray(t);
    }

    function Fn(t) {
      return t;
    }

    function Ln(t, e) {
      var r = "color" === e.type,
          n = t.stops && "object" == _typeof(t.stops[0][0]),
          i = n || !(n || void 0 !== t.property),
          s = t.type || (En(e) ? "exponential" : "interval");

      if (r && ((t = _e({}, t)).stops && (t.stops = t.stops.map(function (t) {
        return [t[0], Ge.parse(t[1])];
      })), t["default"] = Ge.parse(t["default"] ? t["default"] : e["default"])), t.colorSpace && "rgb" !== t.colorSpace && !en[t.colorSpace]) throw new Error("Unknown color space: ".concat(t.colorSpace));
      var a, o, l;
      if ("exponential" === s) a = On;else if ("interval" === s) a = $n;else if ("categorical" === s) {
        a = Un, o = Object.create(null);

        var _iterator36 = _createForOfIteratorHelper(t.stops),
            _step36;

        try {
          for (_iterator36.s(); !(_step36 = _iterator36.n()).done;) {
            var _e43 = _step36.value;
            o[_e43[0]] = _e43[1];
          }
        } catch (err) {
          _iterator36.e(err);
        } finally {
          _iterator36.f();
        }

        l = _typeof(t.stops[0][0]);
      } else {
        if ("identity" !== s) throw new Error("Unknown function type \"".concat(s, "\""));
        a = jn;
      }

      if (n) {
        var _r47 = {},
            _n28 = [];

        for (var _e44 = 0; _e44 < t.stops.length; _e44++) {
          var _i25 = t.stops[_e44],
              _s18 = _i25[0].zoom;
          void 0 === _r47[_s18] && (_r47[_s18] = {
            zoom: _s18,
            type: t.type,
            property: t.property,
            "default": t["default"],
            stops: []
          }, _n28.push(_s18)), _r47[_s18].stops.push([_i25[0].value, _i25[1]]);
        }

        var _i24 = [];

        for (var _i26 = 0, _n29 = _n28; _i26 < _n29.length; _i26++) {
          var _t38 = _n29[_i26];

          _i24.push([_r47[_t38].zoom, Ln(_r47[_t38], e)]);
        }

        var _s17 = {
          name: "linear"
        };
        return {
          kind: "composite",
          interpolationType: _s17,
          interpolationFactor: rn.interpolationFactor.bind(void 0, _s17),
          zoomStops: _i24.map(function (t) {
            return t[0];
          }),
          evaluate: function evaluate(_ref33, n) {
            var r = _ref33.zoom;
            return On({
              stops: _i24,
              base: t.base
            }, e, r).evaluate(r, n);
          }
        };
      }

      if (i) {
        var _r48 = "exponential" === s ? {
          name: "exponential",
          base: void 0 !== t.base ? t.base : 1
        } : null;

        return {
          kind: "camera",
          interpolationType: _r48,
          interpolationFactor: rn.interpolationFactor.bind(void 0, _r48),
          zoomStops: t.stops.map(function (t) {
            return t[0];
          }),
          evaluate: function evaluate(_ref34) {
            var r = _ref34.zoom;
            return a(t, e, r, o, l);
          }
        };
      }

      return {
        kind: "source",
        evaluate: function evaluate(r, n) {
          var i = n && n.properties ? n.properties[t.property] : void 0;
          return void 0 === i ? Rn(t["default"], e["default"]) : a(t, e, i, o, l);
        }
      };
    }

    function Rn(t, e, r) {
      return void 0 !== t ? t : void 0 !== e ? e : void 0 !== r ? r : void 0;
    }

    function Un(t, e, r, n, i) {
      return Rn(_typeof(r) === i ? n[r] : void 0, t["default"], e["default"]);
    }

    function $n(t, e, r) {
      if ("number" !== Dn(r)) return Rn(t["default"], e["default"]);
      var n = t.stops.length;
      if (1 === n) return t.stops[0][1];
      if (r <= t.stops[0][0]) return t.stops[0][1];
      if (r >= t.stops[n - 1][0]) return t.stops[n - 1][1];
      var i = Vr(t.stops.map(function (t) {
        return t[0];
      }), r);
      return t.stops[i][1];
    }

    function On(t, e, r) {
      var n = void 0 !== t.base ? t.base : 1;
      if ("number" !== Dn(r)) return Rn(t["default"], e["default"]);
      var i = t.stops.length;
      if (1 === i) return t.stops[0][1];
      if (r <= t.stops[0][0]) return t.stops[0][1];
      if (r >= t.stops[i - 1][0]) return t.stops[i - 1][1];

      var s = Vr(t.stops.map(function (t) {
        return t[0];
      }), r),
          a = function (t, e, r, n) {
        var i = n - r,
            s = t - r;
        return 0 === i ? 0 : 1 === e ? s / i : (Math.pow(e, s) - 1) / (Math.pow(e, i) - 1);
      }(r, n, t.stops[s][0], t.stops[s + 1][0]),
          o = t.stops[s][1],
          l = t.stops[s + 1][1];

      var u = Rr[e.type] || Fn;

      if (t.colorSpace && "rgb" !== t.colorSpace) {
        var _e45 = en[t.colorSpace];

        u = function u(t, r) {
          return _e45.reverse(_e45.interpolate(_e45.forward(t), _e45.forward(r), a));
        };
      }

      return "function" == typeof o.evaluate ? {
        evaluate: function evaluate() {
          for (var _len4 = arguments.length, t = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {
            t[_key4] = arguments[_key4];
          }

          var e = o.evaluate.apply(void 0, t),
              r = l.evaluate.apply(void 0, t);
          if (void 0 !== e && void 0 !== r) return u(e, r, a);
        }
      } : u(o, l, a);
    }

    function jn(t, e, r) {
      return "color" === e.type ? r = Ge.parse(r) : "formatted" === e.type ? r = Ke.fromString(r.toString()) : "resolvedImage" === e.type ? r = Ye.fromString(r.toString()) : Dn(r) === e.type || "enum" === e.type && e.values[r] || (r = void 0), Rn(r, t["default"], e["default"]);
    }

    cr.register(kn, {
      error: [{
        kind: "error"
      }, [Te], function (t, _ref35) {
        var _ref36 = _slicedToArray(_ref35, 1),
            e = _ref36[0];

        throw new er(e.evaluate(t));
      }],
      "typeof": [Te, [Ee], function (t, _ref37) {
        var _ref38 = _slicedToArray(_ref37, 1),
            e = _ref38[0];

        return Re(We(e.evaluate(t)));
      }],
      "to-rgba": [Le(Me, 4), [Ce], function (t, _ref39) {
        var _ref40 = _slicedToArray(_ref39, 1),
            e = _ref40[0];

        return e.evaluate(t).toArray();
      }],
      rgb: [Ce, [Me, Me, Me], Sn],
      rgba: [Ce, [Me, Me, Me, Me], Sn],
      has: {
        type: Be,
        overloads: [[[Te], function (t, _ref41) {
          var _ref42 = _slicedToArray(_ref41, 1),
              e = _ref42[0];

          return In(e.evaluate(t), t.properties());
        }], [[Te, Pe], function (t, _ref43) {
          var _ref44 = _slicedToArray(_ref43, 2),
              e = _ref44[0],
              r = _ref44[1];

          return In(e.evaluate(t), r.evaluate(t));
        }]]
      },
      get: {
        type: Ee,
        overloads: [[[Te], function (t, _ref45) {
          var _ref46 = _slicedToArray(_ref45, 1),
              e = _ref46[0];

          return zn(e.evaluate(t), t.properties());
        }], [[Te, Pe], function (t, _ref47) {
          var _ref48 = _slicedToArray(_ref47, 2),
              e = _ref48[0],
              r = _ref48[1];

          return zn(e.evaluate(t), r.evaluate(t));
        }]]
      },
      "feature-state": [Ee, [Te], function (t, _ref49) {
        var _ref50 = _slicedToArray(_ref49, 1),
            e = _ref50[0];

        return zn(e.evaluate(t), t.featureState || {});
      }],
      properties: [Pe, [], function (t) {
        return t.properties();
      }],
      "geometry-type": [Te, [], function (t) {
        return t.geometryType();
      }],
      id: [Ee, [], function (t) {
        return t.id();
      }],
      zoom: [Me, [], function (t) {
        return t.globals.zoom;
      }],
      pitch: [Me, [], function (t) {
        return t.globals.pitch || 0;
      }],
      "distance-from-center": [Me, [], function (t) {
        return t.distanceFromCenter();
      }],
      "heatmap-density": [Me, [], function (t) {
        return t.globals.heatmapDensity || 0;
      }],
      "line-progress": [Me, [], function (t) {
        return t.globals.lineProgress || 0;
      }],
      "sky-radial-progress": [Me, [], function (t) {
        return t.globals.skyRadialProgress || 0;
      }],
      accumulated: [Ee, [], function (t) {
        return void 0 === t.globals.accumulated ? null : t.globals.accumulated;
      }],
      "+": [Me, Mn(Me), function (t, e) {
        var r = 0;

        var _iterator37 = _createForOfIteratorHelper(e),
            _step37;

        try {
          for (_iterator37.s(); !(_step37 = _iterator37.n()).done;) {
            var _n30 = _step37.value;
            r += _n30.evaluate(t);
          }
        } catch (err) {
          _iterator37.e(err);
        } finally {
          _iterator37.f();
        }

        return r;
      }],
      "*": [Me, Mn(Me), function (t, e) {
        var r = 1;

        var _iterator38 = _createForOfIteratorHelper(e),
            _step38;

        try {
          for (_iterator38.s(); !(_step38 = _iterator38.n()).done;) {
            var _n31 = _step38.value;
            r *= _n31.evaluate(t);
          }
        } catch (err) {
          _iterator38.e(err);
        } finally {
          _iterator38.f();
        }

        return r;
      }],
      "-": {
        type: Me,
        overloads: [[[Me, Me], function (t, _ref51) {
          var _ref52 = _slicedToArray(_ref51, 2),
              e = _ref52[0],
              r = _ref52[1];

          return e.evaluate(t) - r.evaluate(t);
        }], [[Me], function (t, _ref53) {
          var _ref54 = _slicedToArray(_ref53, 1),
              e = _ref54[0];

          return -e.evaluate(t);
        }]]
      },
      "/": [Me, [Me, Me], function (t, _ref55) {
        var _ref56 = _slicedToArray(_ref55, 2),
            e = _ref56[0],
            r = _ref56[1];

        return e.evaluate(t) / r.evaluate(t);
      }],
      "%": [Me, [Me, Me], function (t, _ref57) {
        var _ref58 = _slicedToArray(_ref57, 2),
            e = _ref58[0],
            r = _ref58[1];

        return e.evaluate(t) % r.evaluate(t);
      }],
      ln2: [Me, [], function () {
        return Math.LN2;
      }],
      pi: [Me, [], function () {
        return Math.PI;
      }],
      e: [Me, [], function () {
        return Math.E;
      }],
      "^": [Me, [Me, Me], function (t, _ref59) {
        var _ref60 = _slicedToArray(_ref59, 2),
            e = _ref60[0],
            r = _ref60[1];

        return Math.pow(e.evaluate(t), r.evaluate(t));
      }],
      sqrt: [Me, [Me], function (t, _ref61) {
        var _ref62 = _slicedToArray(_ref61, 1),
            e = _ref62[0];

        return Math.sqrt(e.evaluate(t));
      }],
      log10: [Me, [Me], function (t, _ref63) {
        var _ref64 = _slicedToArray(_ref63, 1),
            e = _ref64[0];

        return Math.log(e.evaluate(t)) / Math.LN10;
      }],
      ln: [Me, [Me], function (t, _ref65) {
        var _ref66 = _slicedToArray(_ref65, 1),
            e = _ref66[0];

        return Math.log(e.evaluate(t));
      }],
      log2: [Me, [Me], function (t, _ref67) {
        var _ref68 = _slicedToArray(_ref67, 1),
            e = _ref68[0];

        return Math.log(e.evaluate(t)) / Math.LN2;
      }],
      sin: [Me, [Me], function (t, _ref69) {
        var _ref70 = _slicedToArray(_ref69, 1),
            e = _ref70[0];

        return Math.sin(e.evaluate(t));
      }],
      cos: [Me, [Me], function (t, _ref71) {
        var _ref72 = _slicedToArray(_ref71, 1),
            e = _ref72[0];

        return Math.cos(e.evaluate(t));
      }],
      tan: [Me, [Me], function (t, _ref73) {
        var _ref74 = _slicedToArray(_ref73, 1),
            e = _ref74[0];

        return Math.tan(e.evaluate(t));
      }],
      asin: [Me, [Me], function (t, _ref75) {
        var _ref76 = _slicedToArray(_ref75, 1),
            e = _ref76[0];

        return Math.asin(e.evaluate(t));
      }],
      acos: [Me, [Me], function (t, _ref77) {
        var _ref78 = _slicedToArray(_ref77, 1),
            e = _ref78[0];

        return Math.acos(e.evaluate(t));
      }],
      atan: [Me, [Me], function (t, _ref79) {
        var _ref80 = _slicedToArray(_ref79, 1),
            e = _ref80[0];

        return Math.atan(e.evaluate(t));
      }],
      min: [Me, Mn(Me), function (t, e) {
        return Math.min.apply(Math, _toConsumableArray(e.map(function (e) {
          return e.evaluate(t);
        })));
      }],
      max: [Me, Mn(Me), function (t, e) {
        return Math.max.apply(Math, _toConsumableArray(e.map(function (e) {
          return e.evaluate(t);
        })));
      }],
      abs: [Me, [Me], function (t, _ref81) {
        var _ref82 = _slicedToArray(_ref81, 1),
            e = _ref82[0];

        return Math.abs(e.evaluate(t));
      }],
      round: [Me, [Me], function (t, _ref83) {
        var _ref84 = _slicedToArray(_ref83, 1),
            e = _ref84[0];

        var r = e.evaluate(t);
        return r < 0 ? -Math.round(-r) : Math.round(r);
      }],
      floor: [Me, [Me], function (t, _ref85) {
        var _ref86 = _slicedToArray(_ref85, 1),
            e = _ref86[0];

        return Math.floor(e.evaluate(t));
      }],
      ceil: [Me, [Me], function (t, _ref87) {
        var _ref88 = _slicedToArray(_ref87, 1),
            e = _ref88[0];

        return Math.ceil(e.evaluate(t));
      }],
      "filter-==": [Be, [Te, Ee], function (t, _ref89) {
        var _ref90 = _slicedToArray(_ref89, 2),
            e = _ref90[0],
            r = _ref90[1];

        return t.properties()[e.value] === r.value;
      }],
      "filter-id-==": [Be, [Ee], function (t, _ref91) {
        var _ref92 = _slicedToArray(_ref91, 1),
            e = _ref92[0];

        return t.id() === e.value;
      }],
      "filter-type-==": [Be, [Te], function (t, _ref93) {
        var _ref94 = _slicedToArray(_ref93, 1),
            e = _ref94[0];

        return t.geometryType() === e.value;
      }],
      "filter-<": [Be, [Te, Ee], function (t, _ref95) {
        var _ref96 = _slicedToArray(_ref95, 2),
            e = _ref96[0],
            r = _ref96[1];

        var n = t.properties()[e.value],
            i = r.value;
        return _typeof(n) == _typeof(i) && n < i;
      }],
      "filter-id-<": [Be, [Ee], function (t, _ref97) {
        var _ref98 = _slicedToArray(_ref97, 1),
            e = _ref98[0];

        var r = t.id(),
            n = e.value;
        return _typeof(r) == _typeof(n) && r < n;
      }],
      "filter->": [Be, [Te, Ee], function (t, _ref99) {
        var _ref100 = _slicedToArray(_ref99, 2),
            e = _ref100[0],
            r = _ref100[1];

        var n = t.properties()[e.value],
            i = r.value;
        return _typeof(n) == _typeof(i) && n > i;
      }],
      "filter-id->": [Be, [Ee], function (t, _ref101) {
        var _ref102 = _slicedToArray(_ref101, 1),
            e = _ref102[0];

        var r = t.id(),
            n = e.value;
        return _typeof(r) == _typeof(n) && r > n;
      }],
      "filter-<=": [Be, [Te, Ee], function (t, _ref103) {
        var _ref104 = _slicedToArray(_ref103, 2),
            e = _ref104[0],
            r = _ref104[1];

        var n = t.properties()[e.value],
            i = r.value;
        return _typeof(n) == _typeof(i) && n <= i;
      }],
      "filter-id-<=": [Be, [Ee], function (t, _ref105) {
        var _ref106 = _slicedToArray(_ref105, 1),
            e = _ref106[0];

        var r = t.id(),
            n = e.value;
        return _typeof(r) == _typeof(n) && r <= n;
      }],
      "filter->=": [Be, [Te, Ee], function (t, _ref107) {
        var _ref108 = _slicedToArray(_ref107, 2),
            e = _ref108[0],
            r = _ref108[1];

        var n = t.properties()[e.value],
            i = r.value;
        return _typeof(n) == _typeof(i) && n >= i;
      }],
      "filter-id->=": [Be, [Ee], function (t, _ref109) {
        var _ref110 = _slicedToArray(_ref109, 1),
            e = _ref110[0];

        var r = t.id(),
            n = e.value;
        return _typeof(r) == _typeof(n) && r >= n;
      }],
      "filter-has": [Be, [Ee], function (t, _ref111) {
        var _ref112 = _slicedToArray(_ref111, 1),
            e = _ref112[0];

        return e.value in t.properties();
      }],
      "filter-has-id": [Be, [], function (t) {
        return null !== t.id() && void 0 !== t.id();
      }],
      "filter-type-in": [Be, [Le(Te)], function (t, _ref113) {
        var _ref114 = _slicedToArray(_ref113, 1),
            e = _ref114[0];

        return e.value.indexOf(t.geometryType()) >= 0;
      }],
      "filter-id-in": [Be, [Le(Ee)], function (t, _ref115) {
        var _ref116 = _slicedToArray(_ref115, 1),
            e = _ref116[0];

        return e.value.indexOf(t.id()) >= 0;
      }],
      "filter-in-small": [Be, [Te, Le(Ee)], function (t, _ref117) {
        var _ref118 = _slicedToArray(_ref117, 2),
            e = _ref118[0],
            r = _ref118[1];

        return r.value.indexOf(t.properties()[e.value]) >= 0;
      }],
      "filter-in-large": [Be, [Te, Le(Ee)], function (t, _ref119) {
        var _ref120 = _slicedToArray(_ref119, 2),
            e = _ref120[0],
            r = _ref120[1];

        return function (t, e, r, n) {
          for (; r <= n;) {
            var _i27 = r + n >> 1;

            if (e[_i27] === t) return !0;
            e[_i27] > t ? n = _i27 - 1 : r = _i27 + 1;
          }

          return !1;
        }(t.properties()[e.value], r.value, 0, r.value.length - 1);
      }],
      all: {
        type: Be,
        overloads: [[[Be, Be], function (t, _ref121) {
          var _ref122 = _slicedToArray(_ref121, 2),
              e = _ref122[0],
              r = _ref122[1];

          return e.evaluate(t) && r.evaluate(t);
        }], [Mn(Be), function (t, e) {
          var _iterator39 = _createForOfIteratorHelper(e),
              _step39;

          try {
            for (_iterator39.s(); !(_step39 = _iterator39.n()).done;) {
              var _r49 = _step39.value;
              if (!_r49.evaluate(t)) return !1;
            }
          } catch (err) {
            _iterator39.e(err);
          } finally {
            _iterator39.f();
          }

          return !0;
        }]]
      },
      any: {
        type: Be,
        overloads: [[[Be, Be], function (t, _ref123) {
          var _ref124 = _slicedToArray(_ref123, 2),
              e = _ref124[0],
              r = _ref124[1];

          return e.evaluate(t) || r.evaluate(t);
        }], [Mn(Be), function (t, e) {
          var _iterator40 = _createForOfIteratorHelper(e),
              _step40;

          try {
            for (_iterator40.s(); !(_step40 = _iterator40.n()).done;) {
              var _r50 = _step40.value;
              if (_r50.evaluate(t)) return !0;
            }
          } catch (err) {
            _iterator40.e(err);
          } finally {
            _iterator40.f();
          }

          return !1;
        }]]
      },
      "!": [Be, [Be], function (t, _ref125) {
        var _ref126 = _slicedToArray(_ref125, 1),
            e = _ref126[0];

        return !e.evaluate(t);
      }],
      "is-supported-script": [Be, [Te], function (t, _ref127) {
        var _ref128 = _slicedToArray(_ref127, 1),
            e = _ref128[0];

        var r = t.globals && t.globals.isSupportedScript;
        return !r || r(e.evaluate(t));
      }],
      upcase: [Te, [Te], function (t, _ref129) {
        var _ref130 = _slicedToArray(_ref129, 1),
            e = _ref130[0];

        return e.evaluate(t).toUpperCase();
      }],
      downcase: [Te, [Te], function (t, _ref131) {
        var _ref132 = _slicedToArray(_ref131, 1),
            e = _ref132[0];

        return e.evaluate(t).toLowerCase();
      }],
      concat: [Te, Mn(Ee), function (t, e) {
        return e.map(function (e) {
          return Qe(e.evaluate(t));
        }).join("");
      }],
      "resolved-locale": [Te, [De], function (t, _ref133) {
        var _ref134 = _slicedToArray(_ref133, 1),
            e = _ref134[0];

        return e.evaluate(t).resolvedLocale();
      }]
    });

    var qn = /*#__PURE__*/function () {
      function qn(t, e) {
        _classCallCheck(this, qn);

        this.expression = t, this._warningHistory = {}, this._evaluator = new ur(), this._defaultValue = e ? function (t) {
          return "color" === t.type && Vn(t["default"]) ? new Ge(0, 0, 0, 0) : "color" === t.type ? Ge.parse(t["default"]) || null : void 0 === t["default"] ? null : t["default"];
        }(e) : null, this._enumValues = e && "enum" === e.type ? e.values : null;
      }

      _createClass(qn, [{
        key: "evaluateWithoutErrorHandling",
        value: function evaluateWithoutErrorHandling(t, e, r, n, i, s, a, o) {
          return this._evaluator.globals = t, this._evaluator.feature = e, this._evaluator.featureState = r, this._evaluator.canonical = n, this._evaluator.availableImages = i || null, this._evaluator.formattedSection = s, this._evaluator.featureTileCoord = a || null, this._evaluator.featureDistanceData = o || null, this.expression.evaluate(this._evaluator);
        }
      }, {
        key: "evaluate",
        value: function evaluate(t, e, r, n, i, s, a, o) {
          this._evaluator.globals = t, this._evaluator.feature = e || null, this._evaluator.featureState = r || null, this._evaluator.canonical = n, this._evaluator.availableImages = i || null, this._evaluator.formattedSection = s || null, this._evaluator.featureTileCoord = a || null, this._evaluator.featureDistanceData = o || null;

          try {
            var _t39 = this.expression.evaluate(this._evaluator);

            if (null == _t39 || "number" == typeof _t39 && _t39 != _t39) return this._defaultValue;
            if (this._enumValues && !(_t39 in this._enumValues)) throw new er("Expected value to be one of ".concat(Object.keys(this._enumValues).map(function (t) {
              return JSON.stringify(t);
            }).join(", "), ", but found ").concat(JSON.stringify(_t39), " instead."));
            return _t39;
          } catch (t) {
            return this._warningHistory[t.message] || (this._warningHistory[t.message] = !0, "undefined" != typeof console && console.warn(t.message)), this._defaultValue;
          }
        }
      }]);

      return qn;
    }();

    function Nn(t) {
      return Array.isArray(t) && t.length > 0 && "string" == typeof t[0] && t[0] in kn;
    }

    function Gn(t, e) {
      var r = new Er(kn, [], e ? function (t) {
        var e = {
          color: Ce,
          string: Te,
          number: Me,
          "enum": Te,
          "boolean": Be,
          formatted: Ve,
          resolvedImage: Fe
        };
        return "array" === t.type ? Le(e[t.value] || Ee, t.length) : e[t.type];
      }(e) : void 0),
          n = r.parse(t, void 0, void 0, void 0, e && "string" === e.type ? {
        typeAnnotation: "coerce"
      } : void 0);
      return n ? Tn(new qn(n, e)) : Bn(r.errors);
    }

    var Zn = /*#__PURE__*/function () {
      function Zn(t, e) {
        _classCallCheck(this, Zn);

        this.kind = t, this._styleExpression = e, this.isStateDependent = "constant" !== t && !Br(e.expression);
      }

      _createClass(Zn, [{
        key: "evaluateWithoutErrorHandling",
        value: function evaluateWithoutErrorHandling(t, e, r, n, i, s) {
          return this._styleExpression.evaluateWithoutErrorHandling(t, e, r, n, i, s);
        }
      }, {
        key: "evaluate",
        value: function evaluate(t, e, r, n, i, s) {
          return this._styleExpression.evaluate(t, e, r, n, i, s);
        }
      }]);

      return Zn;
    }();

    var Xn = /*#__PURE__*/function () {
      function Xn(t, e, r, n) {
        _classCallCheck(this, Xn);

        this.kind = t, this.zoomStops = r, this._styleExpression = e, this.isStateDependent = "camera" !== t && !Br(e.expression), this.interpolationType = n;
      }

      _createClass(Xn, [{
        key: "evaluateWithoutErrorHandling",
        value: function evaluateWithoutErrorHandling(t, e, r, n, i, s) {
          return this._styleExpression.evaluateWithoutErrorHandling(t, e, r, n, i, s);
        }
      }, {
        key: "evaluate",
        value: function evaluate(t, e, r, n, i, s) {
          return this._styleExpression.evaluate(t, e, r, n, i, s);
        }
      }, {
        key: "interpolationFactor",
        value: function interpolationFactor(t, e, r) {
          return this.interpolationType ? rn.interpolationFactor(this.interpolationType, t, e, r) : 0;
        }
      }]);

      return Xn;
    }();

    function Kn(t, e) {
      if ("error" === (t = Gn(t, e)).result) return t;
      var r = t.value.expression,
          n = Tr(r);
      if (!n && !Cn(e)) return Bn([new Se("", "data expressions not supported")]);
      var i = Cr(r, ["zoom", "pitch", "distance-from-center"]);
      if (!i && !Pn(e)) return Bn([new Se("", "zoom expressions not supported")]);
      var s = Hn(r);
      return s || i ? s instanceof Se ? Bn([s]) : s instanceof rn && !En(e) ? Bn([new Se("", '"interpolate" expressions cannot be used with this property')]) : Tn(s ? new Xn(n ? "camera" : "composite", t.value, s.labels, s instanceof rn ? s.interpolation : void 0) : new Zn(n ? "constant" : "source", t.value)) : Bn([new Se("", '"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);
    }

    var Yn = /*#__PURE__*/function () {
      function Yn(t, e) {
        _classCallCheck(this, Yn);

        this._parameters = t, this._specification = e, _e(this, Ln(this._parameters, this._specification));
      }

      _createClass(Yn, null, [{
        key: "deserialize",
        value: function deserialize(t) {
          return new Yn(t._parameters, t._specification);
        }
      }, {
        key: "serialize",
        value: function serialize(t) {
          return {
            _parameters: t._parameters,
            _specification: t._specification
          };
        }
      }]);

      return Yn;
    }();

    function Hn(t) {
      var e = null;
      if (t instanceof an) e = Hn(t.result);else if (t instanceof sn) {
        var _iterator41 = _createForOfIteratorHelper(t.args),
            _step41;

        try {
          for (_iterator41.s(); !(_step41 = _iterator41.n()).done;) {
            var _r51 = _step41.value;
            if (e = Hn(_r51), e) break;
          }
        } catch (err) {
          _iterator41.e(err);
        } finally {
          _iterator41.f();
        }
      } else (t instanceof Fr || t instanceof rn) && t.input instanceof cr && "zoom" === t.input.name && (e = t);
      return e instanceof Se || t.eachChild(function (t) {
        var r = Hn(t);
        r instanceof Se ? e = r : !e && r ? e = new Se("", '"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.') : e && r && e !== r && (e = new Se("", 'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'));
      }), e;
    }

    function Jn(t) {
      var e = t.key,
          r = t.value,
          n = t.valueSpec || {},
          i = t.objectElementValidators || {},
          s = t.style,
          a = t.styleSpec;
      var o = [];
      var l = Dn(r);
      if ("object" !== l) return [new be(e, r, "object expected, ".concat(l, " found"))];

      for (var _t40 in r) {
        var _l6 = _t40.split(".")[0],
            _u6 = n[_l6] || n["*"];

        var _c3 = void 0;

        if (i[_l6]) _c3 = i[_l6];else if (n[_l6]) _c3 = Bi;else if (i["*"]) _c3 = i["*"];else {
          if (!n["*"]) {
            o.push(new be(e, r[_t40], "unknown property \"".concat(_t40, "\"")));
            continue;
          }

          _c3 = Bi;
        }
        o = o.concat(_c3({
          key: (e ? "".concat(e, ".") : e) + _t40,
          value: r[_t40],
          valueSpec: _u6,
          style: s,
          styleSpec: a,
          object: r,
          objectKey: _t40
        }, r));
      }

      for (var _t41 in n) {
        i[_t41] || n[_t41].required && void 0 === n[_t41]["default"] && void 0 === r[_t41] && o.push(new be(e, r, "missing required property \"".concat(_t41, "\"")));
      }

      return o;
    }

    function Wn(t) {
      var e = t.value,
          r = t.valueSpec,
          n = t.style,
          i = t.styleSpec,
          s = t.key,
          a = t.arrayElementValidator || Bi;
      if ("array" !== Dn(e)) return [new be(s, e, "array expected, ".concat(Dn(e), " found"))];
      if (r.length && e.length !== r.length) return [new be(s, e, "array length ".concat(r.length, " expected, length ").concat(e.length, " found"))];
      if (r["min-length"] && e.length < r["min-length"]) return [new be(s, e, "array length at least ".concat(r["min-length"], " expected, length ").concat(e.length, " found"))];
      var o = {
        type: r.value,
        values: r.values,
        minimum: r.minimum,
        maximum: r.maximum
      };
      i.$version < 7 && (o["function"] = r["function"]), "object" === Dn(r.value) && (o = r.value);
      var l = [];

      for (var _t42 = 0; _t42 < e.length; _t42++) {
        l = l.concat(a({
          array: e,
          arrayIndex: _t42,
          value: e[_t42],
          valueSpec: o,
          style: n,
          styleSpec: i,
          key: "".concat(s, "[").concat(_t42, "]")
        }));
      }

      return l;
    }

    function Qn(t) {
      var e = t.key,
          r = t.value,
          n = t.valueSpec;
      var i = Dn(r);
      if ("number" === i && r != r && (i = "NaN"), "number" !== i) return [new be(e, r, "number expected, ".concat(i, " found"))];

      if ("minimum" in n) {
        var _i28 = n.minimum;
        if ("array" === Dn(n.minimum) && (_i28 = n.minimum[t.arrayIndex]), r < _i28) return [new be(e, r, "".concat(r, " is less than the minimum value ").concat(_i28))];
      }

      if ("maximum" in n) {
        var _i29 = n.maximum;
        if ("array" === Dn(n.maximum) && (_i29 = n.maximum[t.arrayIndex]), r > _i29) return [new be(e, r, "".concat(r, " is greater than the maximum value ").concat(_i29))];
      }

      return [];
    }

    function ti(t) {
      var e = t.valueSpec,
          r = Ae(t.value.type);
      var n,
          i,
          s,
          a = {};
      var o = "categorical" !== r && void 0 === t.value.property,
          l = !o,
          u = "array" === Dn(t.value.stops) && "array" === Dn(t.value.stops[0]) && "object" === Dn(t.value.stops[0][0]),
          c = Jn({
        key: t.key,
        value: t.value,
        valueSpec: t.styleSpec["function"],
        style: t.style,
        styleSpec: t.styleSpec,
        objectElementValidators: {
          stops: function stops(t) {
            if ("identity" === r) return [new be(t.key, t.value, 'identity function may not have a "stops" property')];
            var e = [];
            var n = t.value;
            return e = e.concat(Wn({
              key: t.key,
              value: n,
              valueSpec: t.valueSpec,
              style: t.style,
              styleSpec: t.styleSpec,
              arrayElementValidator: h
            })), "array" === Dn(n) && 0 === n.length && e.push(new be(t.key, n, "array must have at least one stop")), e;
          },
          "default": function _default(t) {
            return Bi({
              key: t.key,
              value: t.value,
              valueSpec: e,
              style: t.style,
              styleSpec: t.styleSpec
            });
          }
        }
      });
      return "identity" === r && o && c.push(new be(t.key, t.value, 'missing required property "property"')), "identity" === r || t.value.stops || c.push(new be(t.key, t.value, 'missing required property "stops"')), "exponential" === r && t.valueSpec.expression && !En(t.valueSpec) && c.push(new be(t.key, t.value, "exponential functions not supported")), t.styleSpec.$version >= 8 && (l && !Cn(t.valueSpec) ? c.push(new be(t.key, t.value, "property functions not supported")) : o && !Pn(t.valueSpec) && c.push(new be(t.key, t.value, "zoom functions not supported"))), "categorical" !== r && !u || void 0 !== t.value.property || c.push(new be(t.key, t.value, '"property" property is required')), c;

      function h(t) {
        var r = [];
        var n = t.value,
            o = t.key;
        if ("array" !== Dn(n)) return [new be(o, n, "array expected, ".concat(Dn(n), " found"))];
        if (2 !== n.length) return [new be(o, n, "array length 2 expected, length ".concat(n.length, " found"))];

        if (u) {
          if ("object" !== Dn(n[0])) return [new be(o, n, "object expected, ".concat(Dn(n[0]), " found"))];
          if (void 0 === n[0].zoom) return [new be(o, n, "object stop key must have zoom")];
          if (void 0 === n[0].value) return [new be(o, n, "object stop key must have value")];
          if (s && s > Ae(n[0].zoom)) return [new be(o, n[0].zoom, "stop zoom values must appear in ascending order")];
          Ae(n[0].zoom) !== s && (s = Ae(n[0].zoom), i = void 0, a = {}), r = r.concat(Jn({
            key: "".concat(o, "[0]"),
            value: n[0],
            valueSpec: {
              zoom: {}
            },
            style: t.style,
            styleSpec: t.styleSpec,
            objectElementValidators: {
              zoom: Qn,
              value: p
            }
          }));
        } else r = r.concat(p({
          key: "".concat(o, "[0]"),
          value: n[0],
          valueSpec: {},
          style: t.style,
          styleSpec: t.styleSpec
        }, n));

        return Nn(ke(n[1])) ? r.concat([new be("".concat(o, "[1]"), n[1], "expressions are not allowed in function stops.")]) : r.concat(Bi({
          key: "".concat(o, "[1]"),
          value: n[1],
          valueSpec: e,
          style: t.style,
          styleSpec: t.styleSpec
        }));
      }

      function p(t, s) {
        var o = Dn(t.value),
            l = Ae(t.value),
            u = null !== t.value ? t.value : s;

        if (n) {
          if (o !== n) return [new be(t.key, u, "".concat(o, " stop domain type must match previous stop domain type ").concat(n))];
        } else n = o;

        if ("number" !== o && "string" !== o && "boolean" !== o) return [new be(t.key, u, "stop domain value must be a number, string, or boolean")];

        if ("number" !== o && "categorical" !== r) {
          var _n32 = "number expected, ".concat(o, " found");

          return Cn(e) && void 0 === r && (_n32 += '\nIf you intended to use a categorical function, specify `"type": "categorical"`.'), [new be(t.key, u, _n32)];
        }

        return "categorical" !== r || "number" !== o || isFinite(l) && Math.floor(l) === l ? "categorical" !== r && "number" === o && void 0 !== i && l < i ? [new be(t.key, u, "stop domain values must appear in ascending order")] : (i = l, "categorical" === r && l in a ? [new be(t.key, u, "stop domain values must be unique")] : (a[l] = !0, [])) : [new be(t.key, u, "integer expected, found ".concat(l))];
      }
    }

    function ei(t) {
      var e = ("property" === t.expressionContext ? Kn : Gn)(ke(t.value), t.valueSpec);
      if ("error" === e.result) return e.value.map(function (e) {
        return new be("".concat(t.key).concat(e.key), t.value, e.message);
      });
      var r = e.value.expression || e.value._styleExpression.expression;
      if ("property" === t.expressionContext && "text-font" === t.propertyKey && !r.outputDefined()) return [new be(t.key, t.value, "Invalid data expression for \"".concat(t.propertyKey, "\". Output values must be contained as literals within the expression."))];
      if ("property" === t.expressionContext && "layout" === t.propertyType && !Br(r)) return [new be(t.key, t.value, '"feature-state" data expressions are not supported with layout properties.')];
      if ("filter" === t.expressionContext) return ri(r, t);

      if (t.expressionContext && 0 === t.expressionContext.indexOf("cluster")) {
        if (!Cr(r, ["zoom", "feature-state"])) return [new be(t.key, t.value, '"zoom" and "feature-state" expressions are not supported with cluster properties.')];
        if ("cluster-initial" === t.expressionContext && !Tr(r)) return [new be(t.key, t.value, "Feature data expressions are not supported with initial expression part of cluster properties.")];
      }

      return [];
    }

    function ri(t, e) {
      var r = new Set(["zoom", "feature-state", "pitch", "distance-from-center"]);

      var _iterator42 = _createForOfIteratorHelper(e.valueSpec.expression.parameters),
          _step42;

      try {
        for (_iterator42.s(); !(_step42 = _iterator42.n()).done;) {
          var _t43 = _step42.value;
          r["delete"](_t43);
        }
      } catch (err) {
        _iterator42.e(err);
      } finally {
        _iterator42.f();
      }

      if (0 === r.size) return [];
      var n = [];
      return t instanceof cr && r.has(t.name) ? [new be(e.key, e.value, "[\"".concat(t.name, "\"] expression is not supported in a filter for a ").concat(e.object.type, " layer with id: ").concat(e.object.id))] : (t.eachChild(function (t) {
        n.push.apply(n, _toConsumableArray(ri(t, e)));
      }), n);
    }

    function ni(t) {
      var e = t.key,
          r = t.value,
          n = t.valueSpec,
          i = [];
      return Array.isArray(n.values) ? -1 === n.values.indexOf(Ae(r)) && i.push(new be(e, r, "expected one of [".concat(n.values.join(", "), "], ").concat(JSON.stringify(r), " found"))) : -1 === Object.keys(n.values).indexOf(Ae(r)) && i.push(new be(e, r, "expected one of [".concat(Object.keys(n.values).join(", "), "], ").concat(JSON.stringify(r), " found"))), i;
    }

    function ii(t) {
      if (!0 === t || !1 === t) return !0;
      if (!Array.isArray(t) || 0 === t.length) return !1;

      switch (t[0]) {
        case "has":
          return t.length >= 2 && "$id" !== t[1] && "$type" !== t[1];

        case "in":
          return t.length >= 3 && ("string" != typeof t[1] || Array.isArray(t[2]));

        case "!in":
        case "!has":
        case "none":
          return !1;

        case "==":
        case "!=":
        case ">":
        case ">=":
        case "<":
        case "<=":
          return 3 !== t.length || Array.isArray(t[1]) || Array.isArray(t[2]);

        case "any":
        case "all":
          var _iterator43 = _createForOfIteratorHelper(t.slice(1)),
              _step43;

          try {
            for (_iterator43.s(); !(_step43 = _iterator43.n()).done;) {
              var _e46 = _step43.value;
              if (!ii(_e46) && "boolean" != typeof _e46) return !1;
            }
          } catch (err) {
            _iterator43.e(err);
          } finally {
            _iterator43.f();
          }

          return !0;

        default:
          return !0;
      }
    }

    function si(t) {
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "fill";
      if (null == t) return {
        filter: function filter() {
          return !0;
        },
        needGeometry: !1,
        needFeature: !1
      };
      ii(t) || (t = pi(t));
      var r = t;
      var n = !0;

      try {
        n = function (t) {
          if (!li(t)) return t;
          var e = ke(t);
          return oi(e), e = ai(e), e;
        }(r);
      } catch (t) {
        console.warn("Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n".concat(JSON.stringify(r, null, 2), "\n        "));
      }

      var i = ve["filter_".concat(e)],
          s = Gn(n, i);
      var a = null;
      if ("error" === s.result) throw new Error(s.value.map(function (t) {
        return "".concat(t.key, ": ").concat(t.message);
      }).join(", "));

      a = function a(t, e, r) {
        return s.value.evaluate(t, e, {}, r);
      };

      var o = null,
          l = null;

      if (n !== r) {
        var _t44 = Gn(r, i);

        if ("error" === _t44.result) throw new Error(_t44.value.map(function (t) {
          return "".concat(t.key, ": ").concat(t.message);
        }).join(", "));
        o = function o(e, r, n, i, s) {
          return _t44.value.evaluate(e, r, {}, n, void 0, void 0, i, s);
        }, l = !Tr(_t44.value.expression);
      }

      return a = a, {
        filter: a,
        dynamicFilter: o || void 0,
        needGeometry: hi(n),
        needFeature: !!l
      };
    }

    function ai(t) {
      if (!Array.isArray(t)) return t;

      var e = function (t) {
        if (ui.has(t[0])) for (var _e47 = 1; _e47 < t.length; _e47++) {
          if (li(t[_e47])) return !0;
        }
        return t;
      }(t);

      return !0 === e ? e : e.map(function (t) {
        return ai(t);
      });
    }

    function oi(t) {
      var e = !1;
      var r = [];

      if ("case" === t[0]) {
        for (var _n33 = 1; _n33 < t.length - 1; _n33 += 2) {
          e = e || li(t[_n33]), r.push(t[_n33 + 1]);
        }

        r.push(t[t.length - 1]);
      } else if ("match" === t[0]) {
        e = e || li(t[1]);

        for (var _e48 = 2; _e48 < t.length - 1; _e48 += 2) {
          r.push(t[_e48 + 1]);
        }

        r.push(t[t.length - 1]);
      } else if ("step" === t[0]) {
        e = e || li(t[1]);

        for (var _e49 = 1; _e49 < t.length - 1; _e49 += 2) {
          r.push(t[_e49 + 1]);
        }
      }

      e && (t.length = 0, t.push.apply(t, ["any"].concat(r)));

      for (var _e50 = 1; _e50 < t.length; _e50++) {
        oi(t[_e50]);
      }
    }

    function li(t) {
      if (!Array.isArray(t)) return !1;
      if ("pitch" === (e = t[0]) || "distance-from-center" === e) return !0;
      var e;

      for (var _e51 = 1; _e51 < t.length; _e51++) {
        if (li(t[_e51])) return !0;
      }

      return !1;
    }

    var ui = new Set(["in", "==", "!=", ">", ">=", "<", "<=", "to-boolean"]);

    function ci(t, e) {
      return t < e ? -1 : t > e ? 1 : 0;
    }

    function hi(t) {
      if (!Array.isArray(t)) return !1;
      if ("within" === t[0]) return !0;

      for (var _e52 = 1; _e52 < t.length; _e52++) {
        if (hi(t[_e52])) return !0;
      }

      return !1;
    }

    function pi(t) {
      if (!t) return !0;
      var e = t[0];
      return t.length <= 1 ? "any" !== e : "==" === e ? di(t[1], t[2], "==") : "!=" === e ? mi(di(t[1], t[2], "==")) : "<" === e || ">" === e || "<=" === e || ">=" === e ? di(t[1], t[2], e) : "any" === e ? (r = t.slice(1), ["any"].concat(r.map(pi))) : "all" === e ? ["all"].concat(t.slice(1).map(pi)) : "none" === e ? ["all"].concat(t.slice(1).map(pi).map(mi)) : "in" === e ? fi(t[1], t.slice(2)) : "!in" === e ? mi(fi(t[1], t.slice(2))) : "has" === e ? yi(t[1]) : "!has" === e ? mi(yi(t[1])) : "within" !== e || t;
      var r;
    }

    function di(t, e, r) {
      switch (t) {
        case "$type":
          return ["filter-type-".concat(r), e];

        case "$id":
          return ["filter-id-".concat(r), e];

        default:
          return ["filter-".concat(r), t, e];
      }
    }

    function fi(t, e) {
      if (0 === e.length) return !1;

      switch (t) {
        case "$type":
          return ["filter-type-in", ["literal", e]];

        case "$id":
          return ["filter-id-in", ["literal", e]];

        default:
          return e.length > 200 && !e.some(function (t) {
            return _typeof(t) != _typeof(e[0]);
          }) ? ["filter-in-large", t, ["literal", e.sort(ci)]] : ["filter-in-small", t, ["literal", e]];
      }
    }

    function yi(t) {
      switch (t) {
        case "$type":
          return !0;

        case "$id":
          return ["filter-has-id"];

        default:
          return ["filter-has", t];
      }
    }

    function mi(t) {
      return ["!", t];
    }

    function gi(t) {
      if (ii(ke(t.value))) {
        var _e53 = ke(t.layerType);

        return ei(_e({}, t, {
          expressionContext: "filter",
          valueSpec: t.styleSpec["filter_".concat(_e53 || "fill")]
        }));
      }

      return xi(t);
    }

    function xi(t) {
      var e = t.value,
          r = t.key;
      if ("array" !== Dn(e)) return [new be(r, e, "array expected, ".concat(Dn(e), " found"))];
      var n = t.styleSpec;
      var i,
          s = [];
      if (e.length < 1) return [new be(r, e, "filter array must have at least 1 element")];

      switch (s = s.concat(ni({
        key: "".concat(r, "[0]"),
        value: e[0],
        valueSpec: n.filter_operator,
        style: t.style,
        styleSpec: t.styleSpec
      })), Ae(e[0])) {
        case "<":
        case "<=":
        case ">":
        case ">=":
          e.length >= 2 && "$type" === Ae(e[1]) && s.push(new be(r, e, "\"$type\" cannot be use with operator \"".concat(e[0], "\"")));

        case "==":
        case "!=":
          3 !== e.length && s.push(new be(r, e, "filter array for operator \"".concat(e[0], "\" must have 3 elements")));

        case "in":
        case "!in":
          e.length >= 2 && (i = Dn(e[1]), "string" !== i && s.push(new be("".concat(r, "[1]"), e[1], "string expected, ".concat(i, " found"))));

          for (var _a17 = 2; _a17 < e.length; _a17++) {
            i = Dn(e[_a17]), "$type" === Ae(e[1]) ? s = s.concat(ni({
              key: "".concat(r, "[").concat(_a17, "]"),
              value: e[_a17],
              valueSpec: n.geometry_type,
              style: t.style,
              styleSpec: t.styleSpec
            })) : "string" !== i && "number" !== i && "boolean" !== i && s.push(new be("".concat(r, "[").concat(_a17, "]"), e[_a17], "string, number, or boolean expected, ".concat(i, " found")));
          }

          break;

        case "any":
        case "all":
        case "none":
          for (var _n34 = 1; _n34 < e.length; _n34++) {
            s = s.concat(xi({
              key: "".concat(r, "[").concat(_n34, "]"),
              value: e[_n34],
              style: t.style,
              styleSpec: t.styleSpec
            }));
          }

          break;

        case "has":
        case "!has":
          i = Dn(e[1]), 2 !== e.length ? s.push(new be(r, e, "filter array for \"".concat(e[0], "\" operator must have 2 elements"))) : "string" !== i && s.push(new be("".concat(r, "[1]"), e[1], "string expected, ".concat(i, " found")));
          break;

        case "within":
          i = Dn(e[1]), 2 !== e.length ? s.push(new be(r, e, "filter array for \"".concat(e[0], "\" operator must have 2 elements"))) : "object" !== i && s.push(new be("".concat(r, "[1]"), e[1], "object expected, ".concat(i, " found")));
      }

      return s;
    }

    function vi(t, e) {
      var r = t.key,
          n = t.style,
          i = t.styleSpec,
          s = t.value,
          a = t.objectKey,
          o = i["".concat(e, "_").concat(t.layerType)];
      if (!o) return [];
      var l = a.match(/^(.*)-transition$/);
      if ("paint" === e && l && o[l[1]] && o[l[1]].transition) return Bi({
        key: r,
        value: s,
        valueSpec: i.transition,
        style: n,
        styleSpec: i
      });
      var u = t.valueSpec || o[a];
      if (!u) return [new be(r, s, "unknown property \"".concat(a, "\""))];
      var c;
      if ("string" === Dn(s) && Cn(u) && !u.tokens && (c = /^{([^}]+)}$/.exec(s))) return [new be(r, s, "\"".concat(a, "\" does not support interpolation syntax\nUse an identity property function instead: `{ \"type\": \"identity\", \"property\": ").concat(JSON.stringify(c[1]), " }`."))];
      var h = [];
      return "symbol" === t.layerType && ("text-field" === a && n && !n.glyphs && h.push(new be(r, s, 'use of "text-field" requires a style "glyphs" property')), "text-font" === a && Vn(ke(s)) && "identity" === Ae(s.type) && h.push(new be(r, s, '"text-font" does not support identity functions'))), h.concat(Bi({
        key: t.key,
        value: s,
        valueSpec: u,
        style: n,
        styleSpec: i,
        expressionContext: "property",
        propertyType: e,
        propertyKey: a
      }));
    }

    function bi(t) {
      return vi(t, "paint");
    }

    function wi(t) {
      return vi(t, "layout");
    }

    function _i(t) {
      var e = [];
      var r = t.value,
          n = t.key,
          i = t.style,
          s = t.styleSpec;
      r.type || r.ref || e.push(new be(n, r, 'either "type" or "ref" is required'));
      var a = Ae(r.type);
      var o = Ae(r.ref);

      if (r.id) {
        var _s19 = Ae(r.id);

        for (var _a18 = 0; _a18 < t.arrayIndex; _a18++) {
          var _t45 = i.layers[_a18];
          Ae(_t45.id) === _s19 && e.push(new be(n, r.id, "duplicate layer id \"".concat(r.id, "\", previously used at line ").concat(_t45.id.__line__)));
        }
      }

      if ("ref" in r) {
        var _t46;

        ["type", "source", "source-layer", "filter", "layout"].forEach(function (t) {
          t in r && e.push(new be(n, r[t], "\"".concat(t, "\" is prohibited for ref layers")));
        }), i.layers.forEach(function (e) {
          Ae(e.id) === o && (_t46 = e);
        }), _t46 ? _t46.ref ? e.push(new be(n, r.ref, "ref cannot reference another ref layer")) : a = Ae(_t46.type) : e.push(new be(n, r.ref, "ref layer \"".concat(o, "\" not found")));
      } else if ("background" !== a && "sky" !== a) if (r.source) {
        var _t47 = i.sources && i.sources[r.source],
            _s20 = _t47 && Ae(_t47.type);

        _t47 ? "vector" === _s20 && "raster" === a ? e.push(new be(n, r.source, "layer \"".concat(r.id, "\" requires a raster source"))) : "raster" === _s20 && "raster" !== a ? e.push(new be(n, r.source, "layer \"".concat(r.id, "\" requires a vector source"))) : "vector" !== _s20 || r["source-layer"] ? "raster-dem" === _s20 && "hillshade" !== a ? e.push(new be(n, r.source, "raster-dem source can only be used with layer type 'hillshade'.")) : "line" !== a || !r.paint || !r.paint["line-gradient"] || "geojson" === _s20 && _t47.lineMetrics || e.push(new be(n, r, "layer \"".concat(r.id, "\" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled."))) : e.push(new be(n, r, "layer \"".concat(r.id, "\" must specify a \"source-layer\""))) : e.push(new be(n, r.source, "source \"".concat(r.source, "\" not found")));
      } else e.push(new be(n, r, 'missing required property "source"'));

      return e = e.concat(Jn({
        key: n,
        value: r,
        valueSpec: s.layer,
        style: t.style,
        styleSpec: t.styleSpec,
        objectElementValidators: {
          "*": function _() {
            return [];
          },
          type: function type() {
            return Bi({
              key: "".concat(n, ".type"),
              value: r.type,
              valueSpec: s.layer.type,
              style: t.style,
              styleSpec: t.styleSpec,
              object: r,
              objectKey: "type"
            });
          },
          filter: function filter(t) {
            return gi(_e({
              layerType: a
            }, t));
          },
          layout: function layout(t) {
            return Jn({
              layer: r,
              key: t.key,
              value: t.value,
              style: t.style,
              styleSpec: t.styleSpec,
              objectElementValidators: {
                "*": function _(t) {
                  return wi(_e({
                    layerType: a
                  }, t));
                }
              }
            });
          },
          paint: function paint(t) {
            return Jn({
              layer: r,
              key: t.key,
              value: t.value,
              style: t.style,
              styleSpec: t.styleSpec,
              objectElementValidators: {
                "*": function _(t) {
                  return bi(_e({
                    layerType: a
                  }, t));
                }
              }
            });
          }
        }
      })), e;
    }

    function Ai(t) {
      var e = t.value,
          r = t.key,
          n = Dn(e);
      return "string" !== n ? [new be(r, e, "string expected, ".concat(n, " found"))] : [];
    }

    var ki = {
      promoteId: function promoteId(_ref135) {
        var t = _ref135.key,
            e = _ref135.value;
        if ("string" === Dn(e)) return Ai({
          key: t,
          value: e
        });
        {
          var _r52 = [];

          for (var _n35 in e) {
            _r52.push.apply(_r52, _toConsumableArray(Ai({
              key: "".concat(t, ".").concat(_n35),
              value: e[_n35]
            })));
          }

          return _r52;
        }
      }
    };

    function Si(t) {
      var e = t.value,
          r = t.key,
          n = t.styleSpec,
          i = t.style;
      if (!e.type) return [new be(r, e, '"type" is required')];
      var s = Ae(e.type);
      var a;

      switch (s) {
        case "vector":
        case "raster":
        case "raster-dem":
          return a = Jn({
            key: r,
            value: e,
            valueSpec: n["source_".concat(s.replace("-", "_"))],
            style: t.style,
            styleSpec: n,
            objectElementValidators: ki
          }), a;

        case "geojson":
          if (a = Jn({
            key: r,
            value: e,
            valueSpec: n.source_geojson,
            style: i,
            styleSpec: n,
            objectElementValidators: ki
          }), e.cluster) for (var _t48 in e.clusterProperties) {
            var _a19, _a20;

            var _e$clusterProperties$ = _slicedToArray(e.clusterProperties[_t48], 2),
                _n36 = _e$clusterProperties$[0],
                _i30 = _e$clusterProperties$[1],
                _s21 = "string" == typeof _n36 ? [_n36, ["accumulated"], ["get", _t48]] : _n36;

            (_a19 = a).push.apply(_a19, _toConsumableArray(ei({
              key: "".concat(r, ".").concat(_t48, ".map"),
              value: _i30,
              expressionContext: "cluster-map"
            }))), (_a20 = a).push.apply(_a20, _toConsumableArray(ei({
              key: "".concat(r, ".").concat(_t48, ".reduce"),
              value: _s21,
              expressionContext: "cluster-reduce"
            })));
          }
          return a;

        case "video":
          return Jn({
            key: r,
            value: e,
            valueSpec: n.source_video,
            style: i,
            styleSpec: n
          });

        case "image":
          return Jn({
            key: r,
            value: e,
            valueSpec: n.source_image,
            style: i,
            styleSpec: n
          });

        case "canvas":
          return [new be(r, null, "Please use runtime APIs to add canvas sources, rather than including them in stylesheets.", "source.canvas")];

        default:
          return ni({
            key: "".concat(r, ".type"),
            value: e.type,
            valueSpec: {
              values: ["vector", "raster", "raster-dem", "geojson", "video", "image"]
            },
            style: i,
            styleSpec: n
          });
      }
    }

    function Ii(t) {
      var e = t.value,
          r = t.styleSpec,
          n = r.light,
          i = t.style;
      var s = [];
      var a = Dn(e);
      if (void 0 === e) return s;
      if ("object" !== a) return s = s.concat([new be("light", e, "object expected, ".concat(a, " found"))]), s;

      for (var _t49 in e) {
        var _a21 = _t49.match(/^(.*)-transition$/);

        s = s.concat(_a21 && n[_a21[1]] && n[_a21[1]].transition ? Bi({
          key: _t49,
          value: e[_t49],
          valueSpec: r.transition,
          style: i,
          styleSpec: r
        }) : n[_t49] ? Bi({
          key: _t49,
          value: e[_t49],
          valueSpec: n[_t49],
          style: i,
          styleSpec: r
        }) : [new be(_t49, e[_t49], "unknown property \"".concat(_t49, "\""))]);
      }

      return s;
    }

    function zi(t) {
      var e = t.value,
          r = t.key,
          n = t.style,
          i = t.styleSpec,
          s = i.terrain;
      var a = [];
      var o = Dn(e);
      if (void 0 === e) return a;
      if ("object" !== o) return a = a.concat([new be("terrain", e, "object expected, ".concat(o, " found"))]), a;

      for (var _t50 in e) {
        var _r53 = _t50.match(/^(.*)-transition$/);

        a = a.concat(_r53 && s[_r53[1]] && s[_r53[1]].transition ? Bi({
          key: _t50,
          value: e[_t50],
          valueSpec: i.transition,
          style: n,
          styleSpec: i
        }) : s[_t50] ? Bi({
          key: _t50,
          value: e[_t50],
          valueSpec: s[_t50],
          style: n,
          styleSpec: i
        }) : [new be(_t50, e[_t50], "unknown property \"".concat(_t50, "\""))]);
      }

      if (e.source) {
        var _t51 = n.sources && n.sources[e.source],
            _i31 = _t51 && Ae(_t51.type);

        _t51 ? "raster-dem" !== _i31 && a.push(new be(r, e.source, "terrain cannot be used with a source of type ".concat(_i31, ", it only be used with a \"raster-dem\" source type"))) : a.push(new be(r, e.source, "source \"".concat(e.source, "\" not found")));
      } else a.push(new be(r, e, 'terrain is missing required property "source"'));

      return a;
    }

    function Mi(t) {
      var e = t.value,
          r = t.style,
          n = t.styleSpec,
          i = n.fog;
      var s = [];
      var a = Dn(e);
      if (void 0 === e) return s;
      if ("object" !== a) return s = s.concat([new be("fog", e, "object expected, ".concat(a, " found"))]), s;

      for (var _t52 in e) {
        var _a22 = _t52.match(/^(.*)-transition$/);

        s = s.concat(_a22 && i[_a22[1]] && i[_a22[1]].transition ? Bi({
          key: _t52,
          value: e[_t52],
          valueSpec: n.transition,
          style: r,
          styleSpec: n
        }) : i[_t52] ? Bi({
          key: _t52,
          value: e[_t52],
          valueSpec: i[_t52],
          style: r,
          styleSpec: n
        }) : [new be(_t52, e[_t52], "unknown property \"".concat(_t52, "\""))]);
      }

      return s;
    }

    var Ti = {
      "*": function _() {
        return [];
      },
      array: Wn,
      "boolean": function boolean(t) {
        var e = t.value,
            r = t.key,
            n = Dn(e);
        return "boolean" !== n ? [new be(r, e, "boolean expected, ".concat(n, " found"))] : [];
      },
      number: Qn,
      color: function color(t) {
        var e = t.key,
            r = t.value,
            n = Dn(r);
        return "string" !== n ? [new be(e, r, "color expected, ".concat(n, " found"))] : null === Ne.parseCSSColor(r) ? [new be(e, r, "color expected, \"".concat(r, "\" found"))] : [];
      },
      constants: we,
      "enum": ni,
      filter: gi,
      "function": ti,
      layer: _i,
      object: Jn,
      source: Si,
      light: Ii,
      terrain: zi,
      fog: Mi,
      string: Ai,
      formatted: function formatted(t) {
        return 0 === Ai(t).length ? [] : ei(t);
      },
      resolvedImage: function resolvedImage(t) {
        return 0 === Ai(t).length ? [] : ei(t);
      },
      projection: function projection(t) {
        var e = t.value,
            r = t.styleSpec,
            n = r.projection,
            i = t.style;
        var s = [];
        var a = Dn(e);
        if ("object" === a) for (var _t53 in e) {
          s = s.concat(Bi({
            key: _t53,
            value: e[_t53],
            valueSpec: n[_t53],
            style: i,
            styleSpec: r
          }));
        } else "string" !== a && (s = s.concat([new be("projection", e, "object or string expected, ".concat(a, " found"))]));
        return s;
      }
    };

    function Bi(t) {
      var e = t.value,
          r = t.valueSpec,
          n = t.styleSpec;
      return r.expression && Vn(Ae(e)) ? ti(t) : r.expression && Nn(ke(e)) ? ei(t) : r.type && Ti[r.type] ? Ti[r.type](t) : Jn(_e({}, t, {
        valueSpec: r.type ? n[r.type] : r
      }));
    }

    function Ci(t) {
      var e = t.value,
          r = t.key,
          n = Ai(t);
      return n.length || (-1 === e.indexOf("{fontstack}") && n.push(new be(r, e, '"glyphs" url must include a "{fontstack}" token')), -1 === e.indexOf("{range}") && n.push(new be(r, e, '"glyphs" url must include a "{range}" token'))), n;
    }

    function Pi(t) {
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : ve;
      var r = [];
      return r = r.concat(Bi({
        key: "",
        value: t,
        valueSpec: e.$root,
        styleSpec: e,
        style: t,
        objectElementValidators: {
          glyphs: Ci,
          "*": function _() {
            return [];
          }
        }
      })), t.constants && (r = r.concat(we({
        key: "constants",
        value: t.constants,
        style: t,
        styleSpec: e
      }))), Ei(r);
    }

    function Ei(t) {
      return [].concat(t).sort(function (t, e) {
        return t.line - e.line;
      });
    }

    function Di(t) {
      return function () {
        for (var _len5 = arguments.length, e = new Array(_len5), _key5 = 0; _key5 < _len5; _key5++) {
          e[_key5] = arguments[_key5];
        }

        return Ei(t.apply(this, e));
      };
    }

    Pi.source = Di(Si), Pi.light = Di(Ii), Pi.terrain = Di(zi), Pi.fog = Di(Mi), Pi.layer = Di(_i), Pi.filter = Di(gi), Pi.paintProperty = Di(bi), Pi.layoutProperty = Di(wi);
    var Vi = Pi,
        Fi = Vi.light,
        Li = Vi.fog,
        Ri = Vi.paintProperty,
        Ui = Vi.layoutProperty;

    function $i(t, e) {
      var r = !1;

      if (e && e.length) {
        var _iterator44 = _createForOfIteratorHelper(e),
            _step44;

        try {
          for (_iterator44.s(); !(_step44 = _iterator44.n()).done;) {
            var _n37 = _step44.value;
            t.fire(new ge(new Error(_n37.message))), r = !0;
          }
        } catch (err) {
          _iterator44.e(err);
        } finally {
          _iterator44.f();
        }
      }

      return r;
    }

    var Oi = ji;

    function ji(t, e, r) {
      var n = this.cells = [];

      if (t instanceof ArrayBuffer) {
        this.arrayBuffer = t;
        var i = new Int32Array(this.arrayBuffer);
        t = i[0], this.d = (e = i[1]) + 2 * (r = i[2]);

        for (var s = 0; s < this.d * this.d; s++) {
          var a = i[3 + s],
              o = i[3 + s + 1];
          n.push(a === o ? null : i.subarray(a, o));
        }

        var l = i[3 + n.length + 1];
        this.keys = i.subarray(i[3 + n.length], l), this.bboxes = i.subarray(l), this.insert = this._insertReadonly;
      } else {
        this.d = e + 2 * r;

        for (var u = 0; u < this.d * this.d; u++) {
          n.push([]);
        }

        this.keys = [], this.bboxes = [];
      }

      this.n = e, this.extent = t, this.padding = r, this.scale = e / t, this.uid = 0;
      var c = r / e * t;
      this.min = -c, this.max = t + c;
    }

    ji.prototype.insert = function (t, e, r, n, i) {
      this._forEachCell(e, r, n, i, this._insertCell, this.uid++), this.keys.push(t), this.bboxes.push(e), this.bboxes.push(r), this.bboxes.push(n), this.bboxes.push(i);
    }, ji.prototype._insertReadonly = function () {
      throw "Cannot insert into a GridIndex created from an ArrayBuffer.";
    }, ji.prototype._insertCell = function (t, e, r, n, i, s) {
      this.cells[i].push(s);
    }, ji.prototype.query = function (t, e, r, n, i) {
      var s = this.min,
          a = this.max;
      if (t <= s && e <= s && a <= r && a <= n && !i) return Array.prototype.slice.call(this.keys);
      var o = [];
      return this._forEachCell(t, e, r, n, this._queryCell, o, {}, i), o;
    }, ji.prototype._queryCell = function (t, e, r, n, i, s, a, o) {
      var l = this.cells[i];
      if (null !== l) for (var u = this.keys, c = this.bboxes, h = 0; h < l.length; h++) {
        var p = l[h];

        if (void 0 === a[p]) {
          var d = 4 * p;
          (o ? o(c[d + 0], c[d + 1], c[d + 2], c[d + 3]) : t <= c[d + 2] && e <= c[d + 3] && r >= c[d + 0] && n >= c[d + 1]) ? (a[p] = !0, s.push(u[p])) : a[p] = !1;
        }
      }
    }, ji.prototype._forEachCell = function (t, e, r, n, i, s, a, o) {
      for (var l = this._convertToCellCoord(t), u = this._convertToCellCoord(e), c = this._convertToCellCoord(r), h = this._convertToCellCoord(n), p = l; p <= c; p++) {
        for (var d = u; d <= h; d++) {
          var f = this.d * d + p;
          if ((!o || o(this._convertFromCellCoord(p), this._convertFromCellCoord(d), this._convertFromCellCoord(p + 1), this._convertFromCellCoord(d + 1))) && i.call(this, t, e, r, n, f, s, a, o)) return;
        }
      }
    }, ji.prototype._convertFromCellCoord = function (t) {
      return (t - this.padding) / this.scale;
    }, ji.prototype._convertToCellCoord = function (t) {
      return Math.max(0, Math.min(this.d - 1, Math.floor(t * this.scale) + this.padding));
    }, ji.prototype.toArrayBuffer = function () {
      if (this.arrayBuffer) return this.arrayBuffer;

      for (var t = this.cells, e = 3 + this.cells.length + 1 + 1, r = 0, n = 0; n < this.cells.length; n++) {
        r += this.cells[n].length;
      }

      var i = new Int32Array(e + r + this.keys.length + this.bboxes.length);
      i[0] = this.extent, i[1] = this.n, i[2] = this.padding;

      for (var s = e, a = 0; a < t.length; a++) {
        var o = t[a];
        i[3 + a] = s, i.set(o, s), s += o.length;
      }

      return i[3 + t.length] = s, i.set(this.keys, s), i[3 + t.length + 1] = s += this.keys.length, i.set(this.bboxes, s), s += this.bboxes.length, i.buffer;
    };
    var qi = a.ImageData,
        Ni = a.ImageBitmap,
        Gi = {};

    function Zi(t, e) {
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
      Object.defineProperty(e, "_classRegistryKey", {
        value: t,
        writeable: !1
      }), Gi[t] = {
        klass: e,
        omit: r.omit || [],
        shallow: r.shallow || []
      };
    }

    Zi("Object", Object), Oi.serialize = function (t, e) {
      var r = t.toArrayBuffer();
      return e && e.push(r), {
        buffer: r
      };
    }, Oi.deserialize = function (t) {
      return new Oi(t.buffer);
    }, Zi("Grid", Oi), Zi("Color", Ge), Zi("Error", Error), Zi("ResolvedImage", Ye), Zi("StylePropertyFunction", Yn), Zi("StyleExpression", qn, {
      omit: ["_evaluator"]
    }), Zi("ZoomDependentExpression", Xn), Zi("ZoomConstantExpression", Zn), Zi("CompoundExpression", cr, {
      omit: ["_evaluate"]
    });

    for (var _t54 in kn) {
      kn[_t54]._classRegistryKey || Zi("Expression_".concat(_t54), kn[_t54]);
    }

    function Xi(t) {
      return t && "undefined" != typeof ArrayBuffer && (t instanceof ArrayBuffer || t.constructor && "ArrayBuffer" === t.constructor.name);
    }

    function Ki(t) {
      return Ni && t instanceof Ni;
    }

    function Yi(t, e) {
      if (null == t || "boolean" == typeof t || "number" == typeof t || "string" == typeof t || t instanceof Boolean || t instanceof Number || t instanceof String || t instanceof Date || t instanceof RegExp) return t;
      if (Xi(t) || Ki(t)) return e && e.push(t), t;

      if (ArrayBuffer.isView(t)) {
        var _r54 = t;
        return e && e.push(_r54.buffer), _r54;
      }

      if (t instanceof qi) return e && e.push(t.data.buffer), t;

      if (Array.isArray(t)) {
        var _r55 = [];

        var _iterator45 = _createForOfIteratorHelper(t),
            _step45;

        try {
          for (_iterator45.s(); !(_step45 = _iterator45.n()).done;) {
            var _n38 = _step45.value;

            _r55.push(Yi(_n38, e));
          }
        } catch (err) {
          _iterator45.e(err);
        } finally {
          _iterator45.f();
        }

        return _r55;
      }

      if ("object" == _typeof(t)) {
        var _r56 = t.constructor,
            _n39 = _r56._classRegistryKey;
        if (!_n39) throw new Error("can't serialize object of unregistered class");

        var _i32 = _r56.serialize ? _r56.serialize(t, e) : {};

        if (!_r56.serialize) {
          for (var _r57 in t) {
            if (!t.hasOwnProperty(_r57)) continue;
            if (Gi[_n39].omit.indexOf(_r57) >= 0) continue;
            var _s22 = t[_r57];
            _i32[_r57] = Gi[_n39].shallow.indexOf(_r57) >= 0 ? _s22 : Yi(_s22, e);
          }

          t instanceof Error && (_i32.message = t.message);
        }

        if (_i32.$name) throw new Error("$name property is reserved for worker serialization logic.");
        return "Object" !== _n39 && (_i32.$name = _n39), _i32;
      }

      throw new Error("can't serialize object of type " + _typeof(t));
    }

    function Hi(t) {
      if (null == t || "boolean" == typeof t || "number" == typeof t || "string" == typeof t || t instanceof Boolean || t instanceof Number || t instanceof String || t instanceof Date || t instanceof RegExp || Xi(t) || Ki(t) || ArrayBuffer.isView(t) || t instanceof qi) return t;
      if (Array.isArray(t)) return t.map(Hi);

      if ("object" == _typeof(t)) {
        var _e54 = t.$name || "Object",
            _r58 = Gi[_e54].klass;

        if (!_r58) throw new Error("can't deserialize unregistered class ".concat(_e54));
        if (_r58.deserialize) return _r58.deserialize(t);

        var _n40 = Object.create(_r58.prototype);

        for (var _i33 = 0, _Object$keys = Object.keys(t); _i33 < _Object$keys.length; _i33++) {
          var _r59 = _Object$keys[_i33];
          if ("$name" === _r59) continue;
          var _i34 = t[_r59];
          _n40[_r59] = Gi[_e54].shallow.indexOf(_r59) >= 0 ? _i34 : Hi(_i34);
        }

        return _n40;
      }

      throw new Error("can't deserialize object of type " + _typeof(t));
    }

    var Ji = /*#__PURE__*/function () {
      function Ji() {
        _classCallCheck(this, Ji);

        this.first = !0;
      }

      _createClass(Ji, [{
        key: "update",
        value: function update(t, e) {
          var r = Math.floor(t);
          return this.first ? (this.first = !1, this.lastIntegerZoom = r, this.lastIntegerZoomTime = 0, this.lastZoom = t, this.lastFloorZoom = r, !0) : (this.lastFloorZoom > r ? (this.lastIntegerZoom = r + 1, this.lastIntegerZoomTime = e) : this.lastFloorZoom < r && (this.lastIntegerZoom = r, this.lastIntegerZoomTime = e), t !== this.lastZoom && (this.lastZoom = t, this.lastFloorZoom = r, !0));
        }
      }]);

      return Ji;
    }();

    var Wi = function Wi(t) {
      return t >= 1536 && t <= 1791;
    },
        Qi = function Qi(t) {
      return t >= 1872 && t <= 1919;
    },
        ts = function ts(t) {
      return t >= 2208 && t <= 2303;
    },
        es = function es(t) {
      return t >= 11904 && t <= 12031;
    },
        rs = function rs(t) {
      return t >= 12032 && t <= 12255;
    },
        ns = function ns(t) {
      return t >= 12272 && t <= 12287;
    },
        is = function is(t) {
      return t >= 12288 && t <= 12351;
    },
        ss = function ss(t) {
      return t >= 12352 && t <= 12447;
    },
        as = function as(t) {
      return t >= 12448 && t <= 12543;
    },
        os = function os(t) {
      return t >= 12544 && t <= 12591;
    },
        ls = function ls(t) {
      return t >= 12704 && t <= 12735;
    },
        us = function us(t) {
      return t >= 12736 && t <= 12783;
    },
        cs = function cs(t) {
      return t >= 12784 && t <= 12799;
    },
        hs = function hs(t) {
      return t >= 12800 && t <= 13055;
    },
        ps = function ps(t) {
      return t >= 13056 && t <= 13311;
    },
        ds = function ds(t) {
      return t >= 13312 && t <= 19903;
    },
        fs = function fs(t) {
      return t >= 19968 && t <= 40959;
    },
        ys = function ys(t) {
      return t >= 40960 && t <= 42127;
    },
        ms = function ms(t) {
      return t >= 42128 && t <= 42191;
    },
        gs = function gs(t) {
      return t >= 44032 && t <= 55215;
    },
        xs = function xs(t) {
      return t >= 63744 && t <= 64255;
    },
        vs = function vs(t) {
      return t >= 64336 && t <= 65023;
    },
        bs = function bs(t) {
      return t >= 65040 && t <= 65055;
    },
        ws = function ws(t) {
      return t >= 65072 && t <= 65103;
    },
        _s = function _s(t) {
      return t >= 65104 && t <= 65135;
    },
        As = function As(t) {
      return t >= 65136 && t <= 65279;
    },
        ks = function ks(t) {
      return t >= 65280 && t <= 65519;
    };

    function Ss(t) {
      var _iterator46 = _createForOfIteratorHelper(t),
          _step46;

      try {
        for (_iterator46.s(); !(_step46 = _iterator46.n()).done;) {
          var _e55 = _step46.value;
          if (Ms(_e55.charCodeAt(0))) return !0;
        }
      } catch (err) {
        _iterator46.e(err);
      } finally {
        _iterator46.f();
      }

      return !1;
    }

    function Is(t) {
      var _iterator47 = _createForOfIteratorHelper(t),
          _step47;

      try {
        for (_iterator47.s(); !(_step47 = _iterator47.n()).done;) {
          var _e56 = _step47.value;
          if (!zs(_e56.charCodeAt(0))) return !1;
        }
      } catch (err) {
        _iterator47.e(err);
      } finally {
        _iterator47.f();
      }

      return !0;
    }

    function zs(t) {
      return !(Wi(t) || Qi(t) || ts(t) || vs(t) || As(t));
    }

    function Ms(t) {
      return !(746 !== t && 747 !== t && (t < 4352 || !(ls(t) || os(t) || ws(t) && !(t >= 65097 && t <= 65103) || xs(t) || ps(t) || es(t) || us(t) || !(!is(t) || t >= 12296 && t <= 12305 || t >= 12308 && t <= 12319 || 12336 === t) || ds(t) || fs(t) || hs(t) || function (t) {
        return t >= 12592 && t <= 12687;
      }(t) || function (t) {
        return t >= 43360 && t <= 43391;
      }(t) || function (t) {
        return t >= 55216 && t <= 55295;
      }(t) || function (t) {
        return t >= 4352 && t <= 4607;
      }(t) || gs(t) || ss(t) || ns(t) || function (t) {
        return t >= 12688 && t <= 12703;
      }(t) || rs(t) || cs(t) || as(t) && 12540 !== t || !(!ks(t) || 65288 === t || 65289 === t || 65293 === t || t >= 65306 && t <= 65310 || 65339 === t || 65341 === t || 65343 === t || t >= 65371 && t <= 65503 || 65507 === t || t >= 65512 && t <= 65519) || !(!_s(t) || t >= 65112 && t <= 65118 || t >= 65123 && t <= 65126) || function (t) {
        return t >= 5120 && t <= 5759;
      }(t) || function (t) {
        return t >= 6320 && t <= 6399;
      }(t) || bs(t) || function (t) {
        return t >= 19904 && t <= 19967;
      }(t) || ys(t) || ms(t))));
    }

    function Ts(t) {
      return !(Ms(t) || function (t) {
        return !!(function (t) {
          return t >= 128 && t <= 255;
        }(t) && (167 === t || 169 === t || 174 === t || 177 === t || 188 === t || 189 === t || 190 === t || 215 === t || 247 === t) || function (t) {
          return t >= 8192 && t <= 8303;
        }(t) && (8214 === t || 8224 === t || 8225 === t || 8240 === t || 8241 === t || 8251 === t || 8252 === t || 8258 === t || 8263 === t || 8264 === t || 8265 === t || 8273 === t) || function (t) {
          return t >= 8448 && t <= 8527;
        }(t) || function (t) {
          return t >= 8528 && t <= 8591;
        }(t) || function (t) {
          return t >= 8960 && t <= 9215;
        }(t) && (t >= 8960 && t <= 8967 || t >= 8972 && t <= 8991 || t >= 8996 && t <= 9e3 || 9003 === t || t >= 9085 && t <= 9114 || t >= 9150 && t <= 9165 || 9167 === t || t >= 9169 && t <= 9179 || t >= 9186 && t <= 9215) || function (t) {
          return t >= 9216 && t <= 9279;
        }(t) && 9251 !== t || function (t) {
          return t >= 9280 && t <= 9311;
        }(t) || function (t) {
          return t >= 9312 && t <= 9471;
        }(t) || function (t) {
          return t >= 9632 && t <= 9727;
        }(t) || function (t) {
          return t >= 9728 && t <= 9983;
        }(t) && !(t >= 9754 && t <= 9759) || function (t) {
          return t >= 11008 && t <= 11263;
        }(t) && (t >= 11026 && t <= 11055 || t >= 11088 && t <= 11097 || t >= 11192 && t <= 11243) || is(t) || as(t) || function (t) {
          return t >= 57344 && t <= 63743;
        }(t) || ws(t) || _s(t) || ks(t) || 8734 === t || 8756 === t || 8757 === t || t >= 9984 && t <= 10087 || t >= 10102 && t <= 10131 || 65532 === t || 65533 === t);
      }(t));
    }

    function Bs(t) {
      return t >= 1424 && t <= 2303 || vs(t) || As(t);
    }

    function Cs(t, e) {
      return !(!e && Bs(t) || t >= 2304 && t <= 3583 || t >= 3840 && t <= 4255 || function (t) {
        return t >= 6016 && t <= 6143;
      }(t));
    }

    function Ps(t) {
      var _iterator48 = _createForOfIteratorHelper(t),
          _step48;

      try {
        for (_iterator48.s(); !(_step48 = _iterator48.n()).done;) {
          var _e57 = _step48.value;
          if (Bs(_e57.charCodeAt(0))) return !0;
        }
      } catch (err) {
        _iterator48.e(err);
      } finally {
        _iterator48.f();
      }

      return !1;
    }

    var Es = "deferred",
        Ds = "loading",
        Vs = "loaded";
    var Fs = null,
        Ls = "unavailable",
        Rs = null;

    var Us = function Us(t) {
      t && "string" == typeof t && t.indexOf("NetworkError") > -1 && (Ls = "error"), Fs && Fs(t);
    };

    function $s() {
      Os.fire(new me("pluginStateChange", {
        pluginStatus: Ls,
        pluginURL: Rs
      }));
    }

    var Os = new xe(),
        js = function js() {
      return Ls;
    },
        qs = function qs() {
      if (Ls !== Es || !Rs) throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");
      Ls = Ds, $s(), Rs && ae({
        url: Rs
      }, function (t) {
        t ? Us(t) : (Ls = Vs, $s());
      });
    },
        Ns = {
      applyArabicShaping: null,
      processBidirectionalText: null,
      processStyledBidirectionalText: null,
      isLoaded: function isLoaded() {
        return Ls === Vs || null != Ns.applyArabicShaping;
      },
      isLoading: function isLoading() {
        return Ls === Ds;
      },
      setState: function setState(t) {
        Ls = t.pluginStatus, Rs = t.pluginURL;
      },
      isParsed: function isParsed() {
        return null != Ns.applyArabicShaping && null != Ns.processBidirectionalText && null != Ns.processStyledBidirectionalText;
      },
      getPluginURL: function getPluginURL() {
        return Rs;
      }
    };

    var Gs = /*#__PURE__*/function () {
      function Gs(t, e) {
        _classCallCheck(this, Gs);

        this.zoom = t, e ? (this.now = e.now, this.fadeDuration = e.fadeDuration, this.zoomHistory = e.zoomHistory, this.transition = e.transition, this.pitch = e.pitch) : (this.now = 0, this.fadeDuration = 0, this.zoomHistory = new Ji(), this.transition = {}, this.pitch = 0);
      }

      _createClass(Gs, [{
        key: "isSupportedScript",
        value: function isSupportedScript(t) {
          return function (t, e) {
            var _iterator49 = _createForOfIteratorHelper(t),
                _step49;

            try {
              for (_iterator49.s(); !(_step49 = _iterator49.n()).done;) {
                var _r60 = _step49.value;
                if (!Cs(_r60.charCodeAt(0), e)) return !1;
              }
            } catch (err) {
              _iterator49.e(err);
            } finally {
              _iterator49.f();
            }

            return !0;
          }(t, Ns.isLoaded());
        }
      }, {
        key: "crossFadingFactor",
        value: function crossFadingFactor() {
          return 0 === this.fadeDuration ? 1 : Math.min((this.now - this.zoomHistory.lastIntegerZoomTime) / this.fadeDuration, 1);
        }
      }, {
        key: "getCrossfadeParameters",
        value: function getCrossfadeParameters() {
          var t = this.zoom,
              e = t - Math.floor(t),
              r = this.crossFadingFactor();
          return t > this.zoomHistory.lastIntegerZoom ? {
            fromScale: 2,
            toScale: 1,
            t: e + (1 - e) * r
          } : {
            fromScale: .5,
            toScale: 1,
            t: 1 - (1 - r) * e
          };
        }
      }]);

      return Gs;
    }();

    var Zs = /*#__PURE__*/function () {
      function Zs(t, e) {
        _classCallCheck(this, Zs);

        this.property = t, this.value = e, this.expression = function (t, e) {
          if (Vn(t)) return new Yn(t, e);

          if (Nn(t)) {
            var _r61 = Kn(t, e);

            if ("error" === _r61.result) throw new Error(_r61.value.map(function (t) {
              return "".concat(t.key, ": ").concat(t.message);
            }).join(", "));
            return _r61.value;
          }

          {
            var _r62 = t;
            return "string" == typeof t && "color" === e.type && (_r62 = Ge.parse(t)), {
              kind: "constant",
              evaluate: function evaluate() {
                return _r62;
              }
            };
          }
        }(void 0 === e ? t.specification["default"] : e, t.specification);
      }

      _createClass(Zs, [{
        key: "isDataDriven",
        value: function isDataDriven() {
          return "source" === this.expression.kind || "composite" === this.expression.kind;
        }
      }, {
        key: "possiblyEvaluate",
        value: function possiblyEvaluate(t, e, r) {
          return this.property.possiblyEvaluate(this, t, e, r);
        }
      }]);

      return Zs;
    }();

    var Xs = /*#__PURE__*/function () {
      function Xs(t) {
        _classCallCheck(this, Xs);

        this.property = t, this.value = new Zs(t, void 0);
      }

      _createClass(Xs, [{
        key: "transitioned",
        value: function transitioned(t, e) {
          return new Ys(this.property, this.value, e, tt({}, t.transition, this.transition), t.now);
        }
      }, {
        key: "untransitioned",
        value: function untransitioned() {
          return new Ys(this.property, this.value, null, {}, 0);
        }
      }]);

      return Xs;
    }();

    var Ks = /*#__PURE__*/function () {
      function Ks(t) {
        _classCallCheck(this, Ks);

        this._properties = t, this._values = Object.create(t.defaultTransitionablePropertyValues);
      }

      _createClass(Ks, [{
        key: "getValue",
        value: function getValue(t) {
          return ct(this._values[t].value.value);
        }
      }, {
        key: "setValue",
        value: function setValue(t, e) {
          this._values.hasOwnProperty(t) || (this._values[t] = new Xs(this._values[t].property)), this._values[t].value = new Zs(this._values[t].property, null === e ? void 0 : ct(e));
        }
      }, {
        key: "getTransition",
        value: function getTransition(t) {
          return ct(this._values[t].transition);
        }
      }, {
        key: "setTransition",
        value: function setTransition(t, e) {
          this._values.hasOwnProperty(t) || (this._values[t] = new Xs(this._values[t].property)), this._values[t].transition = ct(e) || void 0;
        }
      }, {
        key: "serialize",
        value: function serialize() {
          var t = {};

          for (var _i35 = 0, _Object$keys2 = Object.keys(this._values); _i35 < _Object$keys2.length; _i35++) {
            var _e58 = _Object$keys2[_i35];

            var _r63 = this.getValue(_e58);

            void 0 !== _r63 && (t[_e58] = _r63);

            var _n41 = this.getTransition(_e58);

            void 0 !== _n41 && (t["".concat(_e58, "-transition")] = _n41);
          }

          return t;
        }
      }, {
        key: "transitioned",
        value: function transitioned(t, e) {
          var r = new Hs(this._properties);

          for (var _i36 = 0, _Object$keys3 = Object.keys(this._values); _i36 < _Object$keys3.length; _i36++) {
            var _n42 = _Object$keys3[_i36];
            r._values[_n42] = this._values[_n42].transitioned(t, e._values[_n42]);
          }

          return r;
        }
      }, {
        key: "untransitioned",
        value: function untransitioned() {
          var t = new Hs(this._properties);

          for (var _i37 = 0, _Object$keys4 = Object.keys(this._values); _i37 < _Object$keys4.length; _i37++) {
            var _e59 = _Object$keys4[_i37];
            t._values[_e59] = this._values[_e59].untransitioned();
          }

          return t;
        }
      }]);

      return Ks;
    }();

    var Ys = /*#__PURE__*/function () {
      function Ys(t, e, r, n, i) {
        _classCallCheck(this, Ys);

        var s = n.delay || 0,
            a = n.duration || 0;
        i = i || 0, this.property = t, this.value = e, this.begin = i + s, this.end = this.begin + a, t.specification.transition && (n.delay || n.duration) && (this.prior = r);
      }

      _createClass(Ys, [{
        key: "possiblyEvaluate",
        value: function possiblyEvaluate(t, e, r) {
          var n = t.now || 0,
              i = this.value.possiblyEvaluate(t, e, r),
              s = this.prior;

          if (s) {
            if (n > this.end) return this.prior = null, i;
            if (this.value.isDataDriven()) return this.prior = null, i;
            if (n < this.begin) return s.possiblyEvaluate(t, e, r);
            {
              var _a23 = (n - this.begin) / (this.end - this.begin);

              return this.property.interpolate(s.possiblyEvaluate(t, e, r), i, Z(_a23));
            }
          }

          return i;
        }
      }]);

      return Ys;
    }();

    var Hs = /*#__PURE__*/function () {
      function Hs(t) {
        _classCallCheck(this, Hs);

        this._properties = t, this._values = Object.create(t.defaultTransitioningPropertyValues);
      }

      _createClass(Hs, [{
        key: "possiblyEvaluate",
        value: function possiblyEvaluate(t, e, r) {
          var n = new Qs(this._properties);

          for (var _i38 = 0, _Object$keys5 = Object.keys(this._values); _i38 < _Object$keys5.length; _i38++) {
            var _i39 = _Object$keys5[_i38];
            n._values[_i39] = this._values[_i39].possiblyEvaluate(t, e, r);
          }

          return n;
        }
      }, {
        key: "hasTransition",
        value: function hasTransition() {
          for (var _i40 = 0, _Object$keys6 = Object.keys(this._values); _i40 < _Object$keys6.length; _i40++) {
            var _t55 = _Object$keys6[_i40];
            if (this._values[_t55].prior) return !0;
          }

          return !1;
        }
      }]);

      return Hs;
    }();

    var Js = /*#__PURE__*/function () {
      function Js(t) {
        _classCallCheck(this, Js);

        this._properties = t, this._values = Object.create(t.defaultPropertyValues);
      }

      _createClass(Js, [{
        key: "getValue",
        value: function getValue(t) {
          return ct(this._values[t].value);
        }
      }, {
        key: "setValue",
        value: function setValue(t, e) {
          this._values[t] = new Zs(this._values[t].property, null === e ? void 0 : ct(e));
        }
      }, {
        key: "serialize",
        value: function serialize() {
          var t = {};

          for (var _i41 = 0, _Object$keys7 = Object.keys(this._values); _i41 < _Object$keys7.length; _i41++) {
            var _e60 = _Object$keys7[_i41];

            var _r64 = this.getValue(_e60);

            void 0 !== _r64 && (t[_e60] = _r64);
          }

          return t;
        }
      }, {
        key: "possiblyEvaluate",
        value: function possiblyEvaluate(t, e, r) {
          var n = new Qs(this._properties);

          for (var _i42 = 0, _Object$keys8 = Object.keys(this._values); _i42 < _Object$keys8.length; _i42++) {
            var _i43 = _Object$keys8[_i42];
            n._values[_i43] = this._values[_i43].possiblyEvaluate(t, e, r);
          }

          return n;
        }
      }]);

      return Js;
    }();

    var Ws = /*#__PURE__*/function () {
      function Ws(t, e, r) {
        _classCallCheck(this, Ws);

        this.property = t, this.value = e, this.parameters = r;
      }

      _createClass(Ws, [{
        key: "isConstant",
        value: function isConstant() {
          return "constant" === this.value.kind;
        }
      }, {
        key: "constantOr",
        value: function constantOr(t) {
          return "constant" === this.value.kind ? this.value.value : t;
        }
      }, {
        key: "evaluate",
        value: function evaluate(t, e, r, n) {
          return this.property.evaluate(this.value, this.parameters, t, e, r, n);
        }
      }]);

      return Ws;
    }();

    var Qs = /*#__PURE__*/function () {
      function Qs(t) {
        _classCallCheck(this, Qs);

        this._properties = t, this._values = Object.create(t.defaultPossiblyEvaluatedValues);
      }

      _createClass(Qs, [{
        key: "get",
        value: function get(t) {
          return this._values[t];
        }
      }]);

      return Qs;
    }();

    var ta = /*#__PURE__*/function () {
      function ta(t) {
        _classCallCheck(this, ta);

        this.specification = t;
      }

      _createClass(ta, [{
        key: "possiblyEvaluate",
        value: function possiblyEvaluate(t, e) {
          return t.expression.evaluate(e);
        }
      }, {
        key: "interpolate",
        value: function interpolate(t, e, r) {
          var n = Rr[this.specification.type];
          return n ? n(t, e, r) : t;
        }
      }]);

      return ta;
    }();

    var ea = /*#__PURE__*/function () {
      function ea(t, e) {
        _classCallCheck(this, ea);

        this.specification = t, this.overrides = e;
      }

      _createClass(ea, [{
        key: "possiblyEvaluate",
        value: function possiblyEvaluate(t, e, r, n) {
          return new Ws(this, "constant" === t.expression.kind || "camera" === t.expression.kind ? {
            kind: "constant",
            value: t.expression.evaluate(e, null, {}, r, n)
          } : t.expression, e);
        }
      }, {
        key: "interpolate",
        value: function interpolate(t, e, r) {
          if ("constant" !== t.value.kind || "constant" !== e.value.kind) return t;
          if (void 0 === t.value.value || void 0 === e.value.value) return new Ws(this, {
            kind: "constant",
            value: void 0
          }, t.parameters);
          var n = Rr[this.specification.type];
          return n ? new Ws(this, {
            kind: "constant",
            value: n(t.value.value, e.value.value, r)
          }, t.parameters) : t;
        }
      }, {
        key: "evaluate",
        value: function evaluate(t, e, r, n, i, s) {
          return "constant" === t.kind ? t.value : t.evaluate(e, r, n, i, s);
        }
      }]);

      return ea;
    }();

    var ra = /*#__PURE__*/function (_ea) {
      _inherits(ra, _ea);

      var _super7 = _createSuper(ra);

      function ra() {
        _classCallCheck(this, ra);

        return _super7.apply(this, arguments);
      }

      _createClass(ra, [{
        key: "possiblyEvaluate",
        value: function possiblyEvaluate(t, e, r, n) {
          if (void 0 === t.value) return new Ws(this, {
            kind: "constant",
            value: void 0
          }, e);

          if ("constant" === t.expression.kind) {
            var _i44 = t.expression.evaluate(e, null, {}, r, n),
                _s23 = "resolvedImage" === t.property.specification.type && "string" != typeof _i44 ? _i44.name : _i44,
                _a24 = this._calculate(_s23, _s23, _s23, e);

            return new Ws(this, {
              kind: "constant",
              value: _a24
            }, e);
          }

          if ("camera" === t.expression.kind) {
            var _r65 = this._calculate(t.expression.evaluate({
              zoom: e.zoom - 1
            }), t.expression.evaluate({
              zoom: e.zoom
            }), t.expression.evaluate({
              zoom: e.zoom + 1
            }), e);

            return new Ws(this, {
              kind: "constant",
              value: _r65
            }, e);
          }

          return new Ws(this, t.expression, e);
        }
      }, {
        key: "evaluate",
        value: function evaluate(t, e, r, n, i, s) {
          if ("source" === t.kind) {
            var _a25 = t.evaluate(e, r, n, i, s);

            return this._calculate(_a25, _a25, _a25, e);
          }

          return "composite" === t.kind ? this._calculate(t.evaluate({
            zoom: Math.floor(e.zoom) - 1
          }, r, n), t.evaluate({
            zoom: Math.floor(e.zoom)
          }, r, n), t.evaluate({
            zoom: Math.floor(e.zoom) + 1
          }, r, n), e) : t.value;
        }
      }, {
        key: "_calculate",
        value: function _calculate(t, e, r, n) {
          return n.zoom > n.zoomHistory.lastIntegerZoom ? {
            from: t,
            to: e,
            other: r
          } : {
            from: r,
            to: e,
            other: t
          };
        }
      }, {
        key: "interpolate",
        value: function interpolate(t) {
          return t;
        }
      }]);

      return ra;
    }(ea);

    var na = /*#__PURE__*/function () {
      function na(t) {
        _classCallCheck(this, na);

        this.specification = t;
      }

      _createClass(na, [{
        key: "possiblyEvaluate",
        value: function possiblyEvaluate(t, e, r, n) {
          if (void 0 !== t.value) {
            if ("constant" === t.expression.kind) {
              var _i45 = t.expression.evaluate(e, null, {}, r, n);

              return this._calculate(_i45, _i45, _i45, e);
            }

            return this._calculate(t.expression.evaluate(new Gs(Math.floor(e.zoom - 1), e)), t.expression.evaluate(new Gs(Math.floor(e.zoom), e)), t.expression.evaluate(new Gs(Math.floor(e.zoom + 1), e)), e);
          }
        }
      }, {
        key: "_calculate",
        value: function _calculate(t, e, r, n) {
          return n.zoom > n.zoomHistory.lastIntegerZoom ? {
            from: t,
            to: e
          } : {
            from: r,
            to: e
          };
        }
      }, {
        key: "interpolate",
        value: function interpolate(t) {
          return t;
        }
      }]);

      return na;
    }();

    var ia = /*#__PURE__*/function () {
      function ia(t) {
        _classCallCheck(this, ia);

        this.specification = t;
      }

      _createClass(ia, [{
        key: "possiblyEvaluate",
        value: function possiblyEvaluate(t, e, r, n) {
          return !!t.expression.evaluate(e, null, {}, r, n);
        }
      }, {
        key: "interpolate",
        value: function interpolate() {
          return !1;
        }
      }]);

      return ia;
    }();

    var sa = /*#__PURE__*/_createClass(function sa(t) {
      _classCallCheck(this, sa);

      this.properties = t, this.defaultPropertyValues = {}, this.defaultTransitionablePropertyValues = {}, this.defaultTransitioningPropertyValues = {}, this.defaultPossiblyEvaluatedValues = {}, this.overridableProperties = [];

      for (var _e61 in t) {
        var _r66 = t[_e61];
        _r66.specification.overridable && this.overridableProperties.push(_e61);

        var _n43 = this.defaultPropertyValues[_e61] = new Zs(_r66, void 0),
            _i46 = this.defaultTransitionablePropertyValues[_e61] = new Xs(_r66);

        this.defaultTransitioningPropertyValues[_e61] = _i46.untransitioned(), this.defaultPossiblyEvaluatedValues[_e61] = _n43.possiblyEvaluate({});
      }
    });

    function aa(t, e) {
      return 256 * (t = Y(Math.floor(t), 0, 255)) + Y(Math.floor(e), 0, 255);
    }

    Zi("DataDrivenProperty", ea), Zi("DataConstantProperty", ta), Zi("CrossFadedDataDrivenProperty", ra), Zi("CrossFadedProperty", na), Zi("ColorRampProperty", ia);
    var oa = {
      Int8: Int8Array,
      Uint8: Uint8Array,
      Int16: Int16Array,
      Uint16: Uint16Array,
      Int32: Int32Array,
      Uint32: Uint32Array,
      Float32: Float32Array
    };

    var la = /*#__PURE__*/_createClass(function la(t, e) {
      _classCallCheck(this, la);

      this._structArray = t, this._pos1 = e * this.size, this._pos2 = this._pos1 / 2, this._pos4 = this._pos1 / 4, this._pos8 = this._pos1 / 8;
    });

    var ua = /*#__PURE__*/function () {
      function ua() {
        _classCallCheck(this, ua);

        this.isTransferred = !1, this.capacity = -1, this.resize(0);
      }

      _createClass(ua, [{
        key: "_trim",
        value: function _trim() {
          this.length !== this.capacity && (this.capacity = this.length, this.arrayBuffer = this.arrayBuffer.slice(0, this.length * this.bytesPerElement), this._refreshViews());
        }
      }, {
        key: "clear",
        value: function clear() {
          this.length = 0;
        }
      }, {
        key: "resize",
        value: function resize(t) {
          this.reserve(t), this.length = t;
        }
      }, {
        key: "reserve",
        value: function reserve(t) {
          if (t > this.capacity) {
            this.capacity = Math.max(t, Math.floor(5 * this.capacity), 128), this.arrayBuffer = new ArrayBuffer(this.capacity * this.bytesPerElement);
            var _e62 = this.uint8;
            this._refreshViews(), _e62 && this.uint8.set(_e62);
          }
        }
      }, {
        key: "_refreshViews",
        value: function _refreshViews() {
          throw new Error("_refreshViews() must be implemented by each concrete StructArray layout");
        }
      }], [{
        key: "serialize",
        value: function serialize(t, e) {
          return t._trim(), e && (t.isTransferred = !0, e.push(t.arrayBuffer)), {
            length: t.length,
            arrayBuffer: t.arrayBuffer
          };
        }
      }, {
        key: "deserialize",
        value: function deserialize(t) {
          var e = Object.create(this.prototype);
          return e.arrayBuffer = t.arrayBuffer, e.length = t.length, e.capacity = t.arrayBuffer.byteLength / e.bytesPerElement, e._refreshViews(), e;
        }
      }]);

      return ua;
    }();

    function ca(t) {
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
      var r = 0,
          n = 0;
      return {
        members: t.map(function (t) {
          var i = oa[t.type].BYTES_PER_ELEMENT,
              s = r = ha(r, Math.max(e, i)),
              a = t.components || 1;
          return n = Math.max(n, i), r += i * a, {
            name: t.name,
            type: t.type,
            components: a,
            offset: s
          };
        }),
        size: ha(r, Math.max(n, e)),
        alignment: e
      };
    }

    function ha(t, e) {
      return Math.ceil(t / e) * e;
    }

    var pa = /*#__PURE__*/function (_ua) {
      _inherits(pa, _ua);

      var _super8 = _createSuper(pa);

      function pa() {
        _classCallCheck(this, pa);

        return _super8.apply(this, arguments);
      }

      _createClass(pa, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.int16 = new Int16Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e) {
          var r = this.length;
          return this.resize(r + 1), this.emplace(r, t, e);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r) {
          var n = 2 * t;
          return this.int16[n + 0] = e, this.int16[n + 1] = r, t;
        }
      }]);

      return pa;
    }(ua);

    pa.prototype.bytesPerElement = 4, Zi("StructArrayLayout2i4", pa);

    var da = /*#__PURE__*/function (_ua2) {
      _inherits(da, _ua2);

      var _super9 = _createSuper(da);

      function da() {
        _classCallCheck(this, da);

        return _super9.apply(this, arguments);
      }

      _createClass(da, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.int16 = new Int16Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e, r, n) {
          var i = this.length;
          return this.resize(i + 1), this.emplace(i, t, e, r, n);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r, n, i) {
          var s = 4 * t;
          return this.int16[s + 0] = e, this.int16[s + 1] = r, this.int16[s + 2] = n, this.int16[s + 3] = i, t;
        }
      }]);

      return da;
    }(ua);

    da.prototype.bytesPerElement = 8, Zi("StructArrayLayout4i8", da);

    var fa = /*#__PURE__*/function (_ua3) {
      _inherits(fa, _ua3);

      var _super10 = _createSuper(fa);

      function fa() {
        _classCallCheck(this, fa);

        return _super10.apply(this, arguments);
      }

      _createClass(fa, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.int16 = new Int16Array(this.arrayBuffer), this.float32 = new Float32Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e, r, n, i, s, a) {
          var o = this.length;
          return this.resize(o + 1), this.emplace(o, t, e, r, n, i, s, a);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r, n, i, s, a, o) {
          var l = 6 * t,
              u = 12 * t,
              c = 3 * t;
          return this.int16[l + 0] = e, this.int16[l + 1] = r, this.uint8[u + 4] = n, this.uint8[u + 5] = i, this.uint8[u + 6] = s, this.uint8[u + 7] = a, this.float32[c + 2] = o, t;
        }
      }]);

      return fa;
    }(ua);

    fa.prototype.bytesPerElement = 12, Zi("StructArrayLayout2i4ub1f12", fa);

    var ya = /*#__PURE__*/function (_ua4) {
      _inherits(ya, _ua4);

      var _super11 = _createSuper(ya);

      function ya() {
        _classCallCheck(this, ya);

        return _super11.apply(this, arguments);
      }

      _createClass(ya, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.float32 = new Float32Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e, r) {
          var n = this.length;
          return this.resize(n + 1), this.emplace(n, t, e, r);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r, n) {
          var i = 3 * t;
          return this.float32[i + 0] = e, this.float32[i + 1] = r, this.float32[i + 2] = n, t;
        }
      }]);

      return ya;
    }(ua);

    ya.prototype.bytesPerElement = 12, Zi("StructArrayLayout3f12", ya);

    var ma = /*#__PURE__*/function (_ua5) {
      _inherits(ma, _ua5);

      var _super12 = _createSuper(ma);

      function ma() {
        _classCallCheck(this, ma);

        return _super12.apply(this, arguments);
      }

      _createClass(ma, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.uint16 = new Uint16Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e, r, n, i, s, a, o, l, u) {
          var c = this.length;
          return this.resize(c + 1), this.emplace(c, t, e, r, n, i, s, a, o, l, u);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r, n, i, s, a, o, l, u, c) {
          var h = 10 * t;
          return this.uint16[h + 0] = e, this.uint16[h + 1] = r, this.uint16[h + 2] = n, this.uint16[h + 3] = i, this.uint16[h + 4] = s, this.uint16[h + 5] = a, this.uint16[h + 6] = o, this.uint16[h + 7] = l, this.uint16[h + 8] = u, this.uint16[h + 9] = c, t;
        }
      }]);

      return ma;
    }(ua);

    ma.prototype.bytesPerElement = 20, Zi("StructArrayLayout10ui20", ma);

    var ga = /*#__PURE__*/function (_ua6) {
      _inherits(ga, _ua6);

      var _super13 = _createSuper(ga);

      function ga() {
        _classCallCheck(this, ga);

        return _super13.apply(this, arguments);
      }

      _createClass(ga, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.uint16 = new Uint16Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e, r, n, i, s, a, o) {
          var l = this.length;
          return this.resize(l + 1), this.emplace(l, t, e, r, n, i, s, a, o);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r, n, i, s, a, o, l) {
          var u = 8 * t;
          return this.uint16[u + 0] = e, this.uint16[u + 1] = r, this.uint16[u + 2] = n, this.uint16[u + 3] = i, this.uint16[u + 4] = s, this.uint16[u + 5] = a, this.uint16[u + 6] = o, this.uint16[u + 7] = l, t;
        }
      }]);

      return ga;
    }(ua);

    ga.prototype.bytesPerElement = 16, Zi("StructArrayLayout8ui16", ga);

    var xa = /*#__PURE__*/function (_ua7) {
      _inherits(xa, _ua7);

      var _super14 = _createSuper(xa);

      function xa() {
        _classCallCheck(this, xa);

        return _super14.apply(this, arguments);
      }

      _createClass(xa, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.int16 = new Int16Array(this.arrayBuffer), this.uint16 = new Uint16Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e, r, n, i, s, a, o, l, u, c, h, p, d, f, y) {
          var m = this.length;
          return this.resize(m + 1), this.emplace(m, t, e, r, n, i, s, a, o, l, u, c, h, p, d, f, y);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r, n, i, s, a, o, l, u, c, h, p, d, f, y, m) {
          var g = 16 * t;
          return this.int16[g + 0] = e, this.int16[g + 1] = r, this.int16[g + 2] = n, this.int16[g + 3] = i, this.uint16[g + 4] = s, this.uint16[g + 5] = a, this.uint16[g + 6] = o, this.uint16[g + 7] = l, this.int16[g + 8] = u, this.int16[g + 9] = c, this.int16[g + 10] = h, this.int16[g + 11] = p, this.int16[g + 12] = d, this.int16[g + 13] = f, this.int16[g + 14] = y, this.int16[g + 15] = m, t;
        }
      }]);

      return xa;
    }(ua);

    xa.prototype.bytesPerElement = 32, Zi("StructArrayLayout4i4ui4i4i32", xa);

    var va = /*#__PURE__*/function (_ua8) {
      _inherits(va, _ua8);

      var _super15 = _createSuper(va);

      function va() {
        _classCallCheck(this, va);

        return _super15.apply(this, arguments);
      }

      _createClass(va, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.uint32 = new Uint32Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t) {
          var e = this.length;
          return this.resize(e + 1), this.emplace(e, t);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e) {
          return this.uint32[1 * t + 0] = e, t;
        }
      }]);

      return va;
    }(ua);

    va.prototype.bytesPerElement = 4, Zi("StructArrayLayout1ul4", va);

    var ba = /*#__PURE__*/function (_ua9) {
      _inherits(ba, _ua9);

      var _super16 = _createSuper(ba);

      function ba() {
        _classCallCheck(this, ba);

        return _super16.apply(this, arguments);
      }

      _createClass(ba, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.int16 = new Int16Array(this.arrayBuffer), this.float32 = new Float32Array(this.arrayBuffer), this.uint32 = new Uint32Array(this.arrayBuffer), this.uint16 = new Uint16Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e, r, n, i, s, a, o, l, u, c, h, p) {
          var d = this.length;
          return this.resize(d + 1), this.emplace(d, t, e, r, n, i, s, a, o, l, u, c, h, p);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r, n, i, s, a, o, l, u, c, h, p, d) {
          var f = 20 * t,
              y = 10 * t;
          return this.int16[f + 0] = e, this.int16[f + 1] = r, this.int16[f + 2] = n, this.int16[f + 3] = i, this.int16[f + 4] = s, this.float32[y + 3] = a, this.float32[y + 4] = o, this.float32[y + 5] = l, this.float32[y + 6] = u, this.int16[f + 14] = c, this.uint32[y + 8] = h, this.uint16[f + 18] = p, this.uint16[f + 19] = d, t;
        }
      }]);

      return ba;
    }(ua);

    ba.prototype.bytesPerElement = 40, Zi("StructArrayLayout5i4f1i1ul2ui40", ba);

    var wa = /*#__PURE__*/function (_ua10) {
      _inherits(wa, _ua10);

      var _super17 = _createSuper(wa);

      function wa() {
        _classCallCheck(this, wa);

        return _super17.apply(this, arguments);
      }

      _createClass(wa, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.int16 = new Int16Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e, r, n, i, s, a) {
          var o = this.length;
          return this.resize(o + 1), this.emplace(o, t, e, r, n, i, s, a);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r, n, i, s, a, o) {
          var l = 8 * t;
          return this.int16[l + 0] = e, this.int16[l + 1] = r, this.int16[l + 2] = n, this.int16[l + 4] = i, this.int16[l + 5] = s, this.int16[l + 6] = a, this.int16[l + 7] = o, t;
        }
      }]);

      return wa;
    }(ua);

    wa.prototype.bytesPerElement = 16, Zi("StructArrayLayout3i2i2i16", wa);

    var _a = /*#__PURE__*/function (_ua11) {
      _inherits(_a, _ua11);

      var _super18 = _createSuper(_a);

      function _a() {
        _classCallCheck(this, _a);

        return _super18.apply(this, arguments);
      }

      _createClass(_a, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.float32 = new Float32Array(this.arrayBuffer), this.int16 = new Int16Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e, r, n, i) {
          var s = this.length;
          return this.resize(s + 1), this.emplace(s, t, e, r, n, i);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r, n, i, s) {
          var a = 4 * t,
              o = 8 * t;
          return this.float32[a + 0] = e, this.float32[a + 1] = r, this.float32[a + 2] = n, this.int16[o + 6] = i, this.int16[o + 7] = s, t;
        }
      }]);

      return _a;
    }(ua);

    _a.prototype.bytesPerElement = 16, Zi("StructArrayLayout2f1f2i16", _a);

    var Aa = /*#__PURE__*/function (_ua12) {
      _inherits(Aa, _ua12);

      var _super19 = _createSuper(Aa);

      function Aa() {
        _classCallCheck(this, Aa);

        return _super19.apply(this, arguments);
      }

      _createClass(Aa, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.float32 = new Float32Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e, r, n) {
          var i = this.length;
          return this.resize(i + 1), this.emplace(i, t, e, r, n);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r, n, i) {
          var s = 12 * t,
              a = 3 * t;
          return this.uint8[s + 0] = e, this.uint8[s + 1] = r, this.float32[a + 1] = n, this.float32[a + 2] = i, t;
        }
      }]);

      return Aa;
    }(ua);

    Aa.prototype.bytesPerElement = 12, Zi("StructArrayLayout2ub2f12", Aa);

    var ka = /*#__PURE__*/function (_ua13) {
      _inherits(ka, _ua13);

      var _super20 = _createSuper(ka);

      function ka() {
        _classCallCheck(this, ka);

        return _super20.apply(this, arguments);
      }

      _createClass(ka, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.uint16 = new Uint16Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e, r) {
          var n = this.length;
          return this.resize(n + 1), this.emplace(n, t, e, r);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r, n) {
          var i = 3 * t;
          return this.uint16[i + 0] = e, this.uint16[i + 1] = r, this.uint16[i + 2] = n, t;
        }
      }]);

      return ka;
    }(ua);

    ka.prototype.bytesPerElement = 6, Zi("StructArrayLayout3ui6", ka);

    var Sa = /*#__PURE__*/function (_ua14) {
      _inherits(Sa, _ua14);

      var _super21 = _createSuper(Sa);

      function Sa() {
        _classCallCheck(this, Sa);

        return _super21.apply(this, arguments);
      }

      _createClass(Sa, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.int16 = new Int16Array(this.arrayBuffer), this.float32 = new Float32Array(this.arrayBuffer), this.uint16 = new Uint16Array(this.arrayBuffer), this.uint32 = new Uint32Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e, r, n, i, s, a, o, l, u, c, h, p, d, f, y, m, g, x, v, b) {
          var w = this.length;
          return this.resize(w + 1), this.emplace(w, t, e, r, n, i, s, a, o, l, u, c, h, p, d, f, y, m, g, x, v, b);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r, n, i, s, a, o, l, u, c, h, p, d, f, y, m, g, x, v, b, w) {
          var _ = 30 * t,
              A = 15 * t,
              k = 60 * t;

          return this.int16[_ + 0] = e, this.int16[_ + 1] = r, this.int16[_ + 2] = n, this.float32[A + 2] = i, this.float32[A + 3] = s, this.uint16[_ + 8] = a, this.uint16[_ + 9] = o, this.uint32[A + 5] = l, this.uint32[A + 6] = u, this.uint32[A + 7] = c, this.uint16[_ + 16] = h, this.uint16[_ + 17] = p, this.uint16[_ + 18] = d, this.float32[A + 10] = f, this.float32[A + 11] = y, this.uint8[k + 48] = m, this.uint8[k + 49] = g, this.uint8[k + 50] = x, this.uint32[A + 13] = v, this.int16[_ + 28] = b, this.uint8[k + 58] = w, t;
        }
      }]);

      return Sa;
    }(ua);

    Sa.prototype.bytesPerElement = 60, Zi("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60", Sa);

    var Ia = /*#__PURE__*/function (_ua15) {
      _inherits(Ia, _ua15);

      var _super22 = _createSuper(Ia);

      function Ia() {
        _classCallCheck(this, Ia);

        return _super22.apply(this, arguments);
      }

      _createClass(Ia, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.int16 = new Int16Array(this.arrayBuffer), this.float32 = new Float32Array(this.arrayBuffer), this.uint16 = new Uint16Array(this.arrayBuffer), this.uint32 = new Uint32Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e, r, n, i, s, a, o, l, u, c, h, p, d, f, y, m, g, x, v, b, w, _, A, k, S, I, z, M, T) {
          var B = this.length;
          return this.resize(B + 1), this.emplace(B, t, e, r, n, i, s, a, o, l, u, c, h, p, d, f, y, m, g, x, v, b, w, _, A, k, S, I, z, M, T);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r, n, i, s, a, o, l, u, c, h, p, d, f, y, m, g, x, v, b, w, _, A, k, S, I, z, M, T, B) {
          var C = 38 * t,
              P = 19 * t;
          return this.int16[C + 0] = e, this.int16[C + 1] = r, this.int16[C + 2] = n, this.float32[P + 2] = i, this.float32[P + 3] = s, this.int16[C + 8] = a, this.int16[C + 9] = o, this.int16[C + 10] = l, this.int16[C + 11] = u, this.int16[C + 12] = c, this.int16[C + 13] = h, this.uint16[C + 14] = p, this.uint16[C + 15] = d, this.uint16[C + 16] = f, this.uint16[C + 17] = y, this.uint16[C + 18] = m, this.uint16[C + 19] = g, this.uint16[C + 20] = x, this.uint16[C + 21] = v, this.uint16[C + 22] = b, this.uint16[C + 23] = w, this.uint16[C + 24] = _, this.uint16[C + 25] = A, this.uint16[C + 26] = k, this.uint16[C + 27] = S, this.uint16[C + 28] = I, this.uint32[P + 15] = z, this.float32[P + 16] = M, this.float32[P + 17] = T, this.float32[P + 18] = B, t;
        }
      }]);

      return Ia;
    }(ua);

    Ia.prototype.bytesPerElement = 76, Zi("StructArrayLayout3i2f6i15ui1ul3f76", Ia);

    var za = /*#__PURE__*/function (_ua16) {
      _inherits(za, _ua16);

      var _super23 = _createSuper(za);

      function za() {
        _classCallCheck(this, za);

        return _super23.apply(this, arguments);
      }

      _createClass(za, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.float32 = new Float32Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t) {
          var e = this.length;
          return this.resize(e + 1), this.emplace(e, t);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e) {
          return this.float32[1 * t + 0] = e, t;
        }
      }]);

      return za;
    }(ua);

    za.prototype.bytesPerElement = 4, Zi("StructArrayLayout1f4", za);

    var Ma = /*#__PURE__*/function (_ua17) {
      _inherits(Ma, _ua17);

      var _super24 = _createSuper(Ma);

      function Ma() {
        _classCallCheck(this, Ma);

        return _super24.apply(this, arguments);
      }

      _createClass(Ma, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.int16 = new Int16Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e, r) {
          var n = this.length;
          return this.resize(n + 1), this.emplace(n, t, e, r);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r, n) {
          var i = 3 * t;
          return this.int16[i + 0] = e, this.int16[i + 1] = r, this.int16[i + 2] = n, t;
        }
      }]);

      return Ma;
    }(ua);

    Ma.prototype.bytesPerElement = 6, Zi("StructArrayLayout3i6", Ma);

    var Ta = /*#__PURE__*/function (_ua18) {
      _inherits(Ta, _ua18);

      var _super25 = _createSuper(Ta);

      function Ta() {
        _classCallCheck(this, Ta);

        return _super25.apply(this, arguments);
      }

      _createClass(Ta, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.float32 = new Float32Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e, r, n, i, s, a) {
          var o = this.length;
          return this.resize(o + 1), this.emplace(o, t, e, r, n, i, s, a);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r, n, i, s, a, o) {
          var l = 7 * t;
          return this.float32[l + 0] = e, this.float32[l + 1] = r, this.float32[l + 2] = n, this.float32[l + 3] = i, this.float32[l + 4] = s, this.float32[l + 5] = a, this.float32[l + 6] = o, t;
        }
      }]);

      return Ta;
    }(ua);

    Ta.prototype.bytesPerElement = 28, Zi("StructArrayLayout7f28", Ta);

    var Ba = /*#__PURE__*/function (_ua19) {
      _inherits(Ba, _ua19);

      var _super26 = _createSuper(Ba);

      function Ba() {
        _classCallCheck(this, Ba);

        return _super26.apply(this, arguments);
      }

      _createClass(Ba, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.uint32 = new Uint32Array(this.arrayBuffer), this.uint16 = new Uint16Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e, r, n) {
          var i = this.length;
          return this.resize(i + 1), this.emplace(i, t, e, r, n);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r, n, i) {
          var s = 6 * t;
          return this.uint32[3 * t + 0] = e, this.uint16[s + 2] = r, this.uint16[s + 3] = n, this.uint16[s + 4] = i, t;
        }
      }]);

      return Ba;
    }(ua);

    Ba.prototype.bytesPerElement = 12, Zi("StructArrayLayout1ul3ui12", Ba);

    var Ca = /*#__PURE__*/function (_ua20) {
      _inherits(Ca, _ua20);

      var _super27 = _createSuper(Ca);

      function Ca() {
        _classCallCheck(this, Ca);

        return _super27.apply(this, arguments);
      }

      _createClass(Ca, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.uint16 = new Uint16Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e) {
          var r = this.length;
          return this.resize(r + 1), this.emplace(r, t, e);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r) {
          var n = 2 * t;
          return this.uint16[n + 0] = e, this.uint16[n + 1] = r, t;
        }
      }]);

      return Ca;
    }(ua);

    Ca.prototype.bytesPerElement = 4, Zi("StructArrayLayout2ui4", Ca);

    var Pa = /*#__PURE__*/function (_ua21) {
      _inherits(Pa, _ua21);

      var _super28 = _createSuper(Pa);

      function Pa() {
        _classCallCheck(this, Pa);

        return _super28.apply(this, arguments);
      }

      _createClass(Pa, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.uint16 = new Uint16Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t) {
          var e = this.length;
          return this.resize(e + 1), this.emplace(e, t);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e) {
          return this.uint16[1 * t + 0] = e, t;
        }
      }]);

      return Pa;
    }(ua);

    Pa.prototype.bytesPerElement = 2, Zi("StructArrayLayout1ui2", Pa);

    var Ea = /*#__PURE__*/function (_ua22) {
      _inherits(Ea, _ua22);

      var _super29 = _createSuper(Ea);

      function Ea() {
        _classCallCheck(this, Ea);

        return _super29.apply(this, arguments);
      }

      _createClass(Ea, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.float32 = new Float32Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e) {
          var r = this.length;
          return this.resize(r + 1), this.emplace(r, t, e);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r) {
          var n = 2 * t;
          return this.float32[n + 0] = e, this.float32[n + 1] = r, t;
        }
      }]);

      return Ea;
    }(ua);

    Ea.prototype.bytesPerElement = 8, Zi("StructArrayLayout2f8", Ea);

    var Da = /*#__PURE__*/function (_ua23) {
      _inherits(Da, _ua23);

      var _super30 = _createSuper(Da);

      function Da() {
        _classCallCheck(this, Da);

        return _super30.apply(this, arguments);
      }

      _createClass(Da, [{
        key: "_refreshViews",
        value: function _refreshViews() {
          this.uint8 = new Uint8Array(this.arrayBuffer), this.float32 = new Float32Array(this.arrayBuffer);
        }
      }, {
        key: "emplaceBack",
        value: function emplaceBack(t, e, r, n) {
          var i = this.length;
          return this.resize(i + 1), this.emplace(i, t, e, r, n);
        }
      }, {
        key: "emplace",
        value: function emplace(t, e, r, n, i) {
          var s = 4 * t;
          return this.float32[s + 0] = e, this.float32[s + 1] = r, this.float32[s + 2] = n, this.float32[s + 3] = i, t;
        }
      }]);

      return Da;
    }(ua);

    Da.prototype.bytesPerElement = 16, Zi("StructArrayLayout4f16", Da);

    var Va = /*#__PURE__*/function (_la) {
      _inherits(Va, _la);

      var _super31 = _createSuper(Va);

      function Va() {
        _classCallCheck(this, Va);

        return _super31.apply(this, arguments);
      }

      _createClass(Va, [{
        key: "projectedAnchorX",
        get: function get() {
          return this._structArray.int16[this._pos2 + 0];
        }
      }, {
        key: "projectedAnchorY",
        get: function get() {
          return this._structArray.int16[this._pos2 + 1];
        }
      }, {
        key: "projectedAnchorZ",
        get: function get() {
          return this._structArray.int16[this._pos2 + 2];
        }
      }, {
        key: "tileAnchorX",
        get: function get() {
          return this._structArray.int16[this._pos2 + 3];
        }
      }, {
        key: "tileAnchorY",
        get: function get() {
          return this._structArray.int16[this._pos2 + 4];
        }
      }, {
        key: "x1",
        get: function get() {
          return this._structArray.float32[this._pos4 + 3];
        }
      }, {
        key: "y1",
        get: function get() {
          return this._structArray.float32[this._pos4 + 4];
        }
      }, {
        key: "x2",
        get: function get() {
          return this._structArray.float32[this._pos4 + 5];
        }
      }, {
        key: "y2",
        get: function get() {
          return this._structArray.float32[this._pos4 + 6];
        }
      }, {
        key: "padding",
        get: function get() {
          return this._structArray.int16[this._pos2 + 14];
        }
      }, {
        key: "featureIndex",
        get: function get() {
          return this._structArray.uint32[this._pos4 + 8];
        }
      }, {
        key: "sourceLayerIndex",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 18];
        }
      }, {
        key: "bucketIndex",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 19];
        }
      }]);

      return Va;
    }(la);

    Va.prototype.size = 40;

    var Fa = /*#__PURE__*/function (_ba) {
      _inherits(Fa, _ba);

      var _super32 = _createSuper(Fa);

      function Fa() {
        _classCallCheck(this, Fa);

        return _super32.apply(this, arguments);
      }

      _createClass(Fa, [{
        key: "get",
        value: function get(t) {
          return new Va(this, t);
        }
      }]);

      return Fa;
    }(ba);

    Zi("CollisionBoxArray", Fa);

    var La = /*#__PURE__*/function (_la2) {
      _inherits(La, _la2);

      var _super33 = _createSuper(La);

      function La() {
        _classCallCheck(this, La);

        return _super33.apply(this, arguments);
      }

      _createClass(La, [{
        key: "projectedAnchorX",
        get: function get() {
          return this._structArray.int16[this._pos2 + 0];
        }
      }, {
        key: "projectedAnchorY",
        get: function get() {
          return this._structArray.int16[this._pos2 + 1];
        }
      }, {
        key: "projectedAnchorZ",
        get: function get() {
          return this._structArray.int16[this._pos2 + 2];
        }
      }, {
        key: "tileAnchorX",
        get: function get() {
          return this._structArray.float32[this._pos4 + 2];
        }
      }, {
        key: "tileAnchorY",
        get: function get() {
          return this._structArray.float32[this._pos4 + 3];
        }
      }, {
        key: "glyphStartIndex",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 8];
        }
      }, {
        key: "numGlyphs",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 9];
        }
      }, {
        key: "vertexStartIndex",
        get: function get() {
          return this._structArray.uint32[this._pos4 + 5];
        }
      }, {
        key: "lineStartIndex",
        get: function get() {
          return this._structArray.uint32[this._pos4 + 6];
        }
      }, {
        key: "lineLength",
        get: function get() {
          return this._structArray.uint32[this._pos4 + 7];
        }
      }, {
        key: "segment",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 16];
        }
      }, {
        key: "lowerSize",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 17];
        }
      }, {
        key: "upperSize",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 18];
        }
      }, {
        key: "lineOffsetX",
        get: function get() {
          return this._structArray.float32[this._pos4 + 10];
        }
      }, {
        key: "lineOffsetY",
        get: function get() {
          return this._structArray.float32[this._pos4 + 11];
        }
      }, {
        key: "writingMode",
        get: function get() {
          return this._structArray.uint8[this._pos1 + 48];
        }
      }, {
        key: "placedOrientation",
        get: function get() {
          return this._structArray.uint8[this._pos1 + 49];
        },
        set: function set(t) {
          this._structArray.uint8[this._pos1 + 49] = t;
        }
      }, {
        key: "hidden",
        get: function get() {
          return this._structArray.uint8[this._pos1 + 50];
        },
        set: function set(t) {
          this._structArray.uint8[this._pos1 + 50] = t;
        }
      }, {
        key: "crossTileID",
        get: function get() {
          return this._structArray.uint32[this._pos4 + 13];
        },
        set: function set(t) {
          this._structArray.uint32[this._pos4 + 13] = t;
        }
      }, {
        key: "associatedIconIndex",
        get: function get() {
          return this._structArray.int16[this._pos2 + 28];
        }
      }, {
        key: "flipState",
        get: function get() {
          return this._structArray.uint8[this._pos1 + 58];
        },
        set: function set(t) {
          this._structArray.uint8[this._pos1 + 58] = t;
        }
      }]);

      return La;
    }(la);

    La.prototype.size = 60;

    var Ra = /*#__PURE__*/function (_Sa) {
      _inherits(Ra, _Sa);

      var _super34 = _createSuper(Ra);

      function Ra() {
        _classCallCheck(this, Ra);

        return _super34.apply(this, arguments);
      }

      _createClass(Ra, [{
        key: "get",
        value: function get(t) {
          return new La(this, t);
        }
      }]);

      return Ra;
    }(Sa);

    Zi("PlacedSymbolArray", Ra);

    var Ua = /*#__PURE__*/function (_la3) {
      _inherits(Ua, _la3);

      var _super35 = _createSuper(Ua);

      function Ua() {
        _classCallCheck(this, Ua);

        return _super35.apply(this, arguments);
      }

      _createClass(Ua, [{
        key: "projectedAnchorX",
        get: function get() {
          return this._structArray.int16[this._pos2 + 0];
        }
      }, {
        key: "projectedAnchorY",
        get: function get() {
          return this._structArray.int16[this._pos2 + 1];
        }
      }, {
        key: "projectedAnchorZ",
        get: function get() {
          return this._structArray.int16[this._pos2 + 2];
        }
      }, {
        key: "tileAnchorX",
        get: function get() {
          return this._structArray.float32[this._pos4 + 2];
        }
      }, {
        key: "tileAnchorY",
        get: function get() {
          return this._structArray.float32[this._pos4 + 3];
        }
      }, {
        key: "rightJustifiedTextSymbolIndex",
        get: function get() {
          return this._structArray.int16[this._pos2 + 8];
        }
      }, {
        key: "centerJustifiedTextSymbolIndex",
        get: function get() {
          return this._structArray.int16[this._pos2 + 9];
        }
      }, {
        key: "leftJustifiedTextSymbolIndex",
        get: function get() {
          return this._structArray.int16[this._pos2 + 10];
        }
      }, {
        key: "verticalPlacedTextSymbolIndex",
        get: function get() {
          return this._structArray.int16[this._pos2 + 11];
        }
      }, {
        key: "placedIconSymbolIndex",
        get: function get() {
          return this._structArray.int16[this._pos2 + 12];
        }
      }, {
        key: "verticalPlacedIconSymbolIndex",
        get: function get() {
          return this._structArray.int16[this._pos2 + 13];
        }
      }, {
        key: "key",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 14];
        }
      }, {
        key: "textBoxStartIndex",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 15];
        }
      }, {
        key: "textBoxEndIndex",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 16];
        }
      }, {
        key: "verticalTextBoxStartIndex",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 17];
        }
      }, {
        key: "verticalTextBoxEndIndex",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 18];
        }
      }, {
        key: "iconBoxStartIndex",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 19];
        }
      }, {
        key: "iconBoxEndIndex",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 20];
        }
      }, {
        key: "verticalIconBoxStartIndex",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 21];
        }
      }, {
        key: "verticalIconBoxEndIndex",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 22];
        }
      }, {
        key: "featureIndex",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 23];
        }
      }, {
        key: "numHorizontalGlyphVertices",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 24];
        }
      }, {
        key: "numVerticalGlyphVertices",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 25];
        }
      }, {
        key: "numIconVertices",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 26];
        }
      }, {
        key: "numVerticalIconVertices",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 27];
        }
      }, {
        key: "useRuntimeCollisionCircles",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 28];
        }
      }, {
        key: "crossTileID",
        get: function get() {
          return this._structArray.uint32[this._pos4 + 15];
        },
        set: function set(t) {
          this._structArray.uint32[this._pos4 + 15] = t;
        }
      }, {
        key: "textOffset0",
        get: function get() {
          return this._structArray.float32[this._pos4 + 16];
        }
      }, {
        key: "textOffset1",
        get: function get() {
          return this._structArray.float32[this._pos4 + 17];
        }
      }, {
        key: "collisionCircleDiameter",
        get: function get() {
          return this._structArray.float32[this._pos4 + 18];
        }
      }]);

      return Ua;
    }(la);

    Ua.prototype.size = 76;

    var $a = /*#__PURE__*/function (_Ia) {
      _inherits($a, _Ia);

      var _super36 = _createSuper($a);

      function $a() {
        _classCallCheck(this, $a);

        return _super36.apply(this, arguments);
      }

      _createClass($a, [{
        key: "get",
        value: function get(t) {
          return new Ua(this, t);
        }
      }]);

      return $a;
    }(Ia);

    Zi("SymbolInstanceArray", $a);

    var Oa = /*#__PURE__*/function (_za) {
      _inherits(Oa, _za);

      var _super37 = _createSuper(Oa);

      function Oa() {
        _classCallCheck(this, Oa);

        return _super37.apply(this, arguments);
      }

      _createClass(Oa, [{
        key: "getoffsetX",
        value: function getoffsetX(t) {
          return this.float32[1 * t + 0];
        }
      }]);

      return Oa;
    }(za);

    Zi("GlyphOffsetArray", Oa);

    var ja = /*#__PURE__*/function (_Ma) {
      _inherits(ja, _Ma);

      var _super38 = _createSuper(ja);

      function ja() {
        _classCallCheck(this, ja);

        return _super38.apply(this, arguments);
      }

      _createClass(ja, [{
        key: "getx",
        value: function getx(t) {
          return this.int16[3 * t + 0];
        }
      }, {
        key: "gety",
        value: function gety(t) {
          return this.int16[3 * t + 1];
        }
      }, {
        key: "gettileUnitDistanceFromAnchor",
        value: function gettileUnitDistanceFromAnchor(t) {
          return this.int16[3 * t + 2];
        }
      }]);

      return ja;
    }(Ma);

    Zi("SymbolLineVertexArray", ja);

    var qa = /*#__PURE__*/function (_la4) {
      _inherits(qa, _la4);

      var _super39 = _createSuper(qa);

      function qa() {
        _classCallCheck(this, qa);

        return _super39.apply(this, arguments);
      }

      _createClass(qa, [{
        key: "featureIndex",
        get: function get() {
          return this._structArray.uint32[this._pos4 + 0];
        }
      }, {
        key: "sourceLayerIndex",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 2];
        }
      }, {
        key: "bucketIndex",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 3];
        }
      }, {
        key: "layoutVertexArrayOffset",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 4];
        }
      }]);

      return qa;
    }(la);

    qa.prototype.size = 12;

    var Na = /*#__PURE__*/function (_Ba) {
      _inherits(Na, _Ba);

      var _super40 = _createSuper(Na);

      function Na() {
        _classCallCheck(this, Na);

        return _super40.apply(this, arguments);
      }

      _createClass(Na, [{
        key: "get",
        value: function get(t) {
          return new qa(this, t);
        }
      }]);

      return Na;
    }(Ba);

    Zi("FeatureIndexArray", Na);

    var Ga = /*#__PURE__*/function (_la5) {
      _inherits(Ga, _la5);

      var _super41 = _createSuper(Ga);

      function Ga() {
        _classCallCheck(this, Ga);

        return _super41.apply(this, arguments);
      }

      _createClass(Ga, [{
        key: "a_centroid_pos0",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 0];
        }
      }, {
        key: "a_centroid_pos1",
        get: function get() {
          return this._structArray.uint16[this._pos2 + 1];
        }
      }]);

      return Ga;
    }(la);

    Ga.prototype.size = 4;

    var Za = /*#__PURE__*/function (_Ca) {
      _inherits(Za, _Ca);

      var _super42 = _createSuper(Za);

      function Za() {
        _classCallCheck(this, Za);

        return _super42.apply(this, arguments);
      }

      _createClass(Za, [{
        key: "get",
        value: function get(t) {
          return new Ga(this, t);
        }
      }]);

      return Za;
    }(Ca);

    Zi("FillExtrusionCentroidArray", Za);
    var Xa = ca([{
      name: "a_pattern_to",
      components: 4,
      type: "Uint16"
    }, {
      name: "a_pattern_from",
      components: 4,
      type: "Uint16"
    }, {
      name: "a_pixel_ratio_to",
      components: 1,
      type: "Uint16"
    }, {
      name: "a_pixel_ratio_from",
      components: 1,
      type: "Uint16"
    }]),
        Ka = ca([{
      name: "a_dash_to",
      components: 4,
      type: "Uint16"
    }, {
      name: "a_dash_from",
      components: 4,
      type: "Uint16"
    }]);
    var Ya = qe(function (t) {
      t.exports = function (t, e) {
        var r, n, i, s, a, o, l, u;

        for (n = t.length - (r = 3 & t.length), i = e, a = 3432918353, o = 461845907, u = 0; u < n;) {
          l = 255 & t.charCodeAt(u) | (255 & t.charCodeAt(++u)) << 8 | (255 & t.charCodeAt(++u)) << 16 | (255 & t.charCodeAt(++u)) << 24, ++u, i = 27492 + (65535 & (s = 5 * (65535 & (i = (i ^= l = (65535 & (l = (l = (65535 & l) * a + (((l >>> 16) * a & 65535) << 16) & 4294967295) << 15 | l >>> 17)) * o + (((l >>> 16) * o & 65535) << 16) & 4294967295) << 13 | i >>> 19)) + ((5 * (i >>> 16) & 65535) << 16) & 4294967295)) + ((58964 + (s >>> 16) & 65535) << 16);
        }

        switch (l = 0, r) {
          case 3:
            l ^= (255 & t.charCodeAt(u + 2)) << 16;

          case 2:
            l ^= (255 & t.charCodeAt(u + 1)) << 8;

          case 1:
            i ^= l = (65535 & (l = (l = (65535 & (l ^= 255 & t.charCodeAt(u))) * a + (((l >>> 16) * a & 65535) << 16) & 4294967295) << 15 | l >>> 17)) * o + (((l >>> 16) * o & 65535) << 16) & 4294967295;
        }

        return i ^= t.length, i = 2246822507 * (65535 & (i ^= i >>> 16)) + ((2246822507 * (i >>> 16) & 65535) << 16) & 4294967295, i = 3266489909 * (65535 & (i ^= i >>> 13)) + ((3266489909 * (i >>> 16) & 65535) << 16) & 4294967295, (i ^= i >>> 16) >>> 0;
      };
    }),
        Ha = qe(function (t) {
      t.exports = function (t, e) {
        for (var r, n = t.length, i = e ^ n, s = 0; n >= 4;) {
          r = 1540483477 * (65535 & (r = 255 & t.charCodeAt(s) | (255 & t.charCodeAt(++s)) << 8 | (255 & t.charCodeAt(++s)) << 16 | (255 & t.charCodeAt(++s)) << 24)) + ((1540483477 * (r >>> 16) & 65535) << 16), i = 1540483477 * (65535 & i) + ((1540483477 * (i >>> 16) & 65535) << 16) ^ (r = 1540483477 * (65535 & (r ^= r >>> 24)) + ((1540483477 * (r >>> 16) & 65535) << 16)), n -= 4, ++s;
        }

        switch (n) {
          case 3:
            i ^= (255 & t.charCodeAt(s + 2)) << 16;

          case 2:
            i ^= (255 & t.charCodeAt(s + 1)) << 8;

          case 1:
            i = 1540483477 * (65535 & (i ^= 255 & t.charCodeAt(s))) + ((1540483477 * (i >>> 16) & 65535) << 16);
        }

        return i = 1540483477 * (65535 & (i ^= i >>> 13)) + ((1540483477 * (i >>> 16) & 65535) << 16), (i ^= i >>> 15) >>> 0;
      };
    }),
        Ja = Ya,
        Wa = Ha;
    Ja.murmur3 = Ya, Ja.murmur2 = Wa;

    var Qa = /*#__PURE__*/function () {
      function Qa() {
        _classCallCheck(this, Qa);

        this.ids = [], this.positions = [], this.indexed = !1;
      }

      _createClass(Qa, [{
        key: "add",
        value: function add(t, e, r, n) {
          this.ids.push(to(t)), this.positions.push(e, r, n);
        }
      }, {
        key: "getPositions",
        value: function getPositions(t) {
          var e = to(t);
          var r = 0,
              n = this.ids.length - 1;

          for (; r < n;) {
            var _t56 = r + n >> 1;

            this.ids[_t56] >= e ? n = _t56 : r = _t56 + 1;
          }

          var i = [];

          for (; this.ids[r] === e;) {
            i.push({
              index: this.positions[3 * r],
              start: this.positions[3 * r + 1],
              end: this.positions[3 * r + 2]
            }), r++;
          }

          return i;
        }
      }], [{
        key: "serialize",
        value: function serialize(t, e) {
          var r = new Float64Array(t.ids),
              n = new Uint32Array(t.positions);
          return eo(r, n, 0, r.length - 1), e && e.push(r.buffer, n.buffer), {
            ids: r,
            positions: n
          };
        }
      }, {
        key: "deserialize",
        value: function deserialize(t) {
          var e = new Qa();
          return e.ids = t.ids, e.positions = t.positions, e.indexed = !0, e;
        }
      }]);

      return Qa;
    }();

    function to(t) {
      var e = +t;
      return !isNaN(e) && Number.MIN_SAFE_INTEGER <= e && e <= Number.MAX_SAFE_INTEGER ? e : Ja(String(t));
    }

    function eo(t, e, r, n) {
      for (; r < n;) {
        var _i47 = t[r + n >> 1];

        var _s24 = r - 1,
            _a26 = n + 1;

        for (;;) {
          do {
            _s24++;
          } while (t[_s24] < _i47);

          do {
            _a26--;
          } while (t[_a26] > _i47);

          if (_s24 >= _a26) break;
          ro(t, _s24, _a26), ro(e, 3 * _s24, 3 * _a26), ro(e, 3 * _s24 + 1, 3 * _a26 + 1), ro(e, 3 * _s24 + 2, 3 * _a26 + 2);
        }

        _a26 - r < n - _a26 ? (eo(t, e, r, _a26), r = _a26 + 1) : (eo(t, e, _a26 + 1, n), n = _a26);
      }
    }

    function ro(t, e, r) {
      var n = t[e];
      t[e] = t[r], t[r] = n;
    }

    Zi("FeaturePositionMap", Qa);

    var no = /*#__PURE__*/_createClass(function no(t, e) {
      _classCallCheck(this, no);

      this.gl = t.gl, this.location = e;
    });

    var io = /*#__PURE__*/function (_no) {
      _inherits(io, _no);

      var _super43 = _createSuper(io);

      function io(t, e) {
        var _this13;

        _classCallCheck(this, io);

        _this13 = _super43.call(this, t, e), _this13.current = 0;
        return _this13;
      }

      _createClass(io, [{
        key: "set",
        value: function set(t) {
          this.current !== t && (this.current = t, this.gl.uniform1f(this.location, t));
        }
      }]);

      return io;
    }(no);

    var so = /*#__PURE__*/function (_no2) {
      _inherits(so, _no2);

      var _super44 = _createSuper(so);

      function so(t, e) {
        var _this14;

        _classCallCheck(this, so);

        _this14 = _super44.call(this, t, e), _this14.current = [0, 0, 0, 0];
        return _this14;
      }

      _createClass(so, [{
        key: "set",
        value: function set(t) {
          t[0] === this.current[0] && t[1] === this.current[1] && t[2] === this.current[2] && t[3] === this.current[3] || (this.current = t, this.gl.uniform4f(this.location, t[0], t[1], t[2], t[3]));
        }
      }]);

      return so;
    }(no);

    var ao = /*#__PURE__*/function (_no3) {
      _inherits(ao, _no3);

      var _super45 = _createSuper(ao);

      function ao(t, e) {
        var _this15;

        _classCallCheck(this, ao);

        _this15 = _super45.call(this, t, e), _this15.current = Ge.transparent;
        return _this15;
      }

      _createClass(ao, [{
        key: "set",
        value: function set(t) {
          t.r === this.current.r && t.g === this.current.g && t.b === this.current.b && t.a === this.current.a || (this.current = t, this.gl.uniform4f(this.location, t.r, t.g, t.b, t.a));
        }
      }]);

      return ao;
    }(no);

    var oo = new Float32Array(16),
        lo = new Float32Array(9),
        uo = new Float32Array(4);

    function co(t) {
      return [aa(255 * t.r, 255 * t.g), aa(255 * t.b, 255 * t.a)];
    }

    var ho = /*#__PURE__*/function () {
      function ho(t, e, r) {
        _classCallCheck(this, ho);

        this.value = t, this.uniformNames = e.map(function (t) {
          return "u_".concat(t);
        }), this.type = r;
      }

      _createClass(ho, [{
        key: "setUniform",
        value: function setUniform(t, e, r) {
          t.set(r.constantOr(this.value));
        }
      }, {
        key: "getBinding",
        value: function getBinding(t, e, r) {
          return "color" === this.type ? new ao(t, e) : new io(t, e);
        }
      }]);

      return ho;
    }();

    var po = /*#__PURE__*/function () {
      function po(t, e) {
        _classCallCheck(this, po);

        this.uniformNames = e.map(function (t) {
          return "u_".concat(t);
        }), this.patternFrom = null, this.patternTo = null, this.pixelRatioFrom = 1, this.pixelRatioTo = 1;
      }

      _createClass(po, [{
        key: "setConstantPatternPositions",
        value: function setConstantPatternPositions(t, e) {
          this.pixelRatioFrom = e.pixelRatio, this.pixelRatioTo = t.pixelRatio, this.patternFrom = e.tl.concat(e.br), this.patternTo = t.tl.concat(t.br);
        }
      }, {
        key: "setUniform",
        value: function setUniform(t, e, r, n) {
          var i = "u_pattern_to" === n || "u_dash_to" === n ? this.patternTo : "u_pattern_from" === n || "u_dash_from" === n ? this.patternFrom : "u_pixel_ratio_to" === n ? this.pixelRatioTo : "u_pixel_ratio_from" === n ? this.pixelRatioFrom : null;
          i && t.set(i);
        }
      }, {
        key: "getBinding",
        value: function getBinding(t, e, r) {
          return "u_pattern_from" === r || "u_pattern_to" === r || "u_dash_from" === r || "u_dash_to" === r ? new so(t, e) : new io(t, e);
        }
      }]);

      return po;
    }();

    var fo = /*#__PURE__*/function () {
      function fo(t, e, r, n) {
        _classCallCheck(this, fo);

        this.expression = t, this.type = r, this.maxValue = 0, this.paintVertexAttributes = e.map(function (t) {
          return {
            name: "a_".concat(t),
            type: "Float32",
            components: "color" === r ? 2 : 1,
            offset: 0
          };
        }), this.paintVertexArray = new n();
      }

      _createClass(fo, [{
        key: "populatePaintArray",
        value: function populatePaintArray(t, e, r, n, i, s) {
          var a = this.paintVertexArray.length,
              o = this.expression.evaluate(new Gs(0), e, {}, i, n, s);
          this.paintVertexArray.resize(t), this._setPaintValue(a, t, o);
        }
      }, {
        key: "updatePaintArray",
        value: function updatePaintArray(t, e, r, n, i) {
          var s = this.expression.evaluate({
            zoom: 0
          }, r, n, void 0, i);

          this._setPaintValue(t, e, s);
        }
      }, {
        key: "_setPaintValue",
        value: function _setPaintValue(t, e, r) {
          if ("color" === this.type) {
            var _n44 = co(r);

            for (var _r67 = t; _r67 < e; _r67++) {
              this.paintVertexArray.emplace(_r67, _n44[0], _n44[1]);
            }
          } else {
            for (var _n45 = t; _n45 < e; _n45++) {
              this.paintVertexArray.emplace(_n45, r);
            }

            this.maxValue = Math.max(this.maxValue, Math.abs(r));
          }
        }
      }, {
        key: "upload",
        value: function upload(t) {
          this.paintVertexArray && this.paintVertexArray.arrayBuffer && (this.paintVertexBuffer && this.paintVertexBuffer.buffer ? this.paintVertexBuffer.updateData(this.paintVertexArray) : this.paintVertexBuffer = t.createVertexBuffer(this.paintVertexArray, this.paintVertexAttributes, this.expression.isStateDependent));
        }
      }, {
        key: "destroy",
        value: function destroy() {
          this.paintVertexBuffer && this.paintVertexBuffer.destroy();
        }
      }]);

      return fo;
    }();

    var yo = /*#__PURE__*/function () {
      function yo(t, e, r, n, i, s) {
        _classCallCheck(this, yo);

        this.expression = t, this.uniformNames = e.map(function (t) {
          return "u_".concat(t, "_t");
        }), this.type = r, this.useIntegerZoom = n, this.zoom = i, this.maxValue = 0, this.paintVertexAttributes = e.map(function (t) {
          return {
            name: "a_".concat(t),
            type: "Float32",
            components: "color" === r ? 4 : 2,
            offset: 0
          };
        }), this.paintVertexArray = new s();
      }

      _createClass(yo, [{
        key: "populatePaintArray",
        value: function populatePaintArray(t, e, r, n, i, s) {
          var a = this.expression.evaluate(new Gs(this.zoom), e, {}, i, n, s),
              o = this.expression.evaluate(new Gs(this.zoom + 1), e, {}, i, n, s),
              l = this.paintVertexArray.length;
          this.paintVertexArray.resize(t), this._setPaintValue(l, t, a, o);
        }
      }, {
        key: "updatePaintArray",
        value: function updatePaintArray(t, e, r, n, i) {
          var s = this.expression.evaluate({
            zoom: this.zoom
          }, r, n, void 0, i),
              a = this.expression.evaluate({
            zoom: this.zoom + 1
          }, r, n, void 0, i);

          this._setPaintValue(t, e, s, a);
        }
      }, {
        key: "_setPaintValue",
        value: function _setPaintValue(t, e, r, n) {
          if ("color" === this.type) {
            var _i48 = co(r),
                _s25 = co(n);

            for (var _r68 = t; _r68 < e; _r68++) {
              this.paintVertexArray.emplace(_r68, _i48[0], _i48[1], _s25[0], _s25[1]);
            }
          } else {
            for (var _i49 = t; _i49 < e; _i49++) {
              this.paintVertexArray.emplace(_i49, r, n);
            }

            this.maxValue = Math.max(this.maxValue, Math.abs(r), Math.abs(n));
          }
        }
      }, {
        key: "upload",
        value: function upload(t) {
          this.paintVertexArray && this.paintVertexArray.arrayBuffer && (this.paintVertexBuffer && this.paintVertexBuffer.buffer ? this.paintVertexBuffer.updateData(this.paintVertexArray) : this.paintVertexBuffer = t.createVertexBuffer(this.paintVertexArray, this.paintVertexAttributes, this.expression.isStateDependent));
        }
      }, {
        key: "destroy",
        value: function destroy() {
          this.paintVertexBuffer && this.paintVertexBuffer.destroy();
        }
      }, {
        key: "setUniform",
        value: function setUniform(t, e) {
          var r = this.useIntegerZoom ? Math.floor(e.zoom) : e.zoom,
              n = Y(this.expression.interpolationFactor(r, this.zoom, this.zoom + 1), 0, 1);
          t.set(n);
        }
      }, {
        key: "getBinding",
        value: function getBinding(t, e, r) {
          return new io(t, e);
        }
      }]);

      return yo;
    }();

    var mo = /*#__PURE__*/function () {
      function mo(t, e, r, n, i, s, a) {
        _classCallCheck(this, mo);

        this.expression = t, this.type = r, this.useIntegerZoom = n, this.zoom = i, this.layerId = a, this.paintVertexAttributes = ("array" === r ? Ka : Xa).members;

        for (var _t57 = 0; _t57 < e.length; ++_t57) {
          ;
        }

        this.zoomInPaintVertexArray = new s(), this.zoomOutPaintVertexArray = new s();
      }

      _createClass(mo, [{
        key: "populatePaintArray",
        value: function populatePaintArray(t, e, r) {
          var n = this.zoomInPaintVertexArray.length;
          this.zoomInPaintVertexArray.resize(t), this.zoomOutPaintVertexArray.resize(t), this._setPaintValues(n, t, e.patterns && e.patterns[this.layerId], r);
        }
      }, {
        key: "updatePaintArray",
        value: function updatePaintArray(t, e, r, n, i, s) {
          this._setPaintValues(t, e, r.patterns && r.patterns[this.layerId], s);
        }
      }, {
        key: "_setPaintValues",
        value: function _setPaintValues(t, e, r, n) {
          if (!n || !r) return;
          var i = r.min,
              s = r.mid,
              a = r.max,
              o = n[i],
              l = n[s],
              u = n[a];
          if (o && l && u) for (var _r69 = t; _r69 < e; _r69++) {
            this._setPaintValue(this.zoomInPaintVertexArray, _r69, l, o), this._setPaintValue(this.zoomOutPaintVertexArray, _r69, l, u);
          }
        }
      }, {
        key: "_setPaintValue",
        value: function _setPaintValue(t, e, r, n) {
          t.emplace(e, r.tl[0], r.tl[1], r.br[0], r.br[1], n.tl[0], n.tl[1], n.br[0], n.br[1], r.pixelRatio, n.pixelRatio);
        }
      }, {
        key: "upload",
        value: function upload(t) {
          this.zoomInPaintVertexArray && this.zoomInPaintVertexArray.arrayBuffer && this.zoomOutPaintVertexArray && this.zoomOutPaintVertexArray.arrayBuffer && (this.zoomInPaintVertexBuffer = t.createVertexBuffer(this.zoomInPaintVertexArray, this.paintVertexAttributes, this.expression.isStateDependent), this.zoomOutPaintVertexBuffer = t.createVertexBuffer(this.zoomOutPaintVertexArray, this.paintVertexAttributes, this.expression.isStateDependent));
        }
      }, {
        key: "destroy",
        value: function destroy() {
          this.zoomOutPaintVertexBuffer && this.zoomOutPaintVertexBuffer.destroy(), this.zoomInPaintVertexBuffer && this.zoomInPaintVertexBuffer.destroy();
        }
      }]);

      return mo;
    }();

    var go = /*#__PURE__*/function () {
      function go(t, e) {
        var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : function () {
          return !0;
        };

        _classCallCheck(this, go);

        this.binders = {}, this._buffers = [];
        var n = [];

        for (var _i50 in t.paint._values) {
          if (!r(_i50)) continue;

          var _s26 = t.paint.get(_i50);

          if (!(_s26 instanceof Ws && Cn(_s26.property.specification))) continue;

          var _a27 = bo(_i50, t.type),
              _o7 = _s26.value,
              _l7 = _s26.property.specification.type,
              _u7 = _s26.property.useIntegerZoom,
              _c4 = _s26.property.specification["property-type"],
              _h2 = "cross-faded" === _c4 || "cross-faded-data-driven" === _c4,
              _p2 = "line-dasharray" === String(_i50) && "constant" !== t.layout.get("line-cap").value.kind;

          if ("constant" !== _o7.kind || _p2) {
            if ("source" === _o7.kind || _p2 || _h2) {
              var _r70 = Ao(_i50, _l7, "source");

              this.binders[_i50] = _h2 ? new mo(_o7, _a27, _l7, _u7, e, _r70, t.id) : new fo(_o7, _a27, _l7, _r70), n.push("/a_".concat(_i50));
            } else {
              var _t58 = Ao(_i50, _l7, "composite");

              this.binders[_i50] = new yo(_o7, _a27, _l7, _u7, e, _t58), n.push("/z_".concat(_i50));
            }
          } else this.binders[_i50] = _h2 ? new po(_o7.value, _a27) : new ho(_o7.value, _a27, _l7), n.push("/u_".concat(_i50));
        }

        this.cacheKey = n.sort().join("");
      }

      _createClass(go, [{
        key: "getMaxValue",
        value: function getMaxValue(t) {
          var e = this.binders[t];
          return e instanceof fo || e instanceof yo ? e.maxValue : 0;
        }
      }, {
        key: "populatePaintArrays",
        value: function populatePaintArrays(t, e, r, n, i, s) {
          for (var _a28 in this.binders) {
            var _o8 = this.binders[_a28];
            (_o8 instanceof fo || _o8 instanceof yo || _o8 instanceof mo) && _o8.populatePaintArray(t, e, r, n, i, s);
          }
        }
      }, {
        key: "setConstantPatternPositions",
        value: function setConstantPatternPositions(t, e) {
          for (var _r71 in this.binders) {
            var _n46 = this.binders[_r71];
            _n46 instanceof po && _n46.setConstantPatternPositions(t, e);
          }
        }
      }, {
        key: "updatePaintArrays",
        value: function updatePaintArrays(t, e, r, n, i, s) {
          var a = !1;

          for (var _o9 in t) {
            var _l8 = e.getPositions(_o9);

            var _iterator50 = _createForOfIteratorHelper(_l8),
                _step50;

            try {
              for (_iterator50.s(); !(_step50 = _iterator50.n()).done;) {
                var _e63 = _step50.value;

                var _l9 = r.feature(_e63.index);

                for (var _r72 in this.binders) {
                  var _u8 = this.binders[_r72];

                  if ((_u8 instanceof fo || _u8 instanceof yo || _u8 instanceof mo) && !0 === _u8.expression.isStateDependent) {
                    var _c5 = n.paint.get(_r72);

                    _u8.expression = _c5.value, _u8.updatePaintArray(_e63.start, _e63.end, _l9, t[_o9], i, s), a = !0;
                  }
                }
              }
            } catch (err) {
              _iterator50.e(err);
            } finally {
              _iterator50.f();
            }
          }

          return a;
        }
      }, {
        key: "defines",
        value: function defines() {
          var t = [];

          for (var _e64 in this.binders) {
            var _r73 = this.binders[_e64];
            (_r73 instanceof ho || _r73 instanceof po) && t.push.apply(t, _toConsumableArray(_r73.uniformNames.map(function (t) {
              return "#define HAS_UNIFORM_".concat(t);
            })));
          }

          return t;
        }
      }, {
        key: "getBinderAttributes",
        value: function getBinderAttributes() {
          var t = [];

          for (var _e65 in this.binders) {
            var _r74 = this.binders[_e65];
            if (_r74 instanceof fo || _r74 instanceof yo || _r74 instanceof mo) for (var _e66 = 0; _e66 < _r74.paintVertexAttributes.length; _e66++) {
              t.push(_r74.paintVertexAttributes[_e66].name);
            }
          }

          return t;
        }
      }, {
        key: "getBinderUniforms",
        value: function getBinderUniforms() {
          var t = [];

          for (var _e67 in this.binders) {
            var _r75 = this.binders[_e67];

            if (_r75 instanceof ho || _r75 instanceof po || _r75 instanceof yo) {
              var _iterator51 = _createForOfIteratorHelper(_r75.uniformNames),
                  _step51;

              try {
                for (_iterator51.s(); !(_step51 = _iterator51.n()).done;) {
                  var _e68 = _step51.value;
                  t.push(_e68);
                }
              } catch (err) {
                _iterator51.e(err);
              } finally {
                _iterator51.f();
              }
            }
          }

          return t;
        }
      }, {
        key: "getPaintVertexBuffers",
        value: function getPaintVertexBuffers() {
          return this._buffers;
        }
      }, {
        key: "getUniforms",
        value: function getUniforms(t, e) {
          var r = [];

          for (var _n47 in this.binders) {
            var _i51 = this.binders[_n47];

            if (_i51 instanceof ho || _i51 instanceof po || _i51 instanceof yo) {
              var _iterator52 = _createForOfIteratorHelper(_i51.uniformNames),
                  _step52;

              try {
                for (_iterator52.s(); !(_step52 = _iterator52.n()).done;) {
                  var _s27 = _step52.value;

                  if (e[_s27]) {
                    var _a29 = _i51.getBinding(t, e[_s27], _s27);

                    r.push({
                      name: _s27,
                      property: _n47,
                      binding: _a29
                    });
                  }
                }
              } catch (err) {
                _iterator52.e(err);
              } finally {
                _iterator52.f();
              }
            }
          }

          return r;
        }
      }, {
        key: "setUniforms",
        value: function setUniforms(t, e, r, n) {
          var _iterator53 = _createForOfIteratorHelper(e),
              _step53;

          try {
            for (_iterator53.s(); !(_step53 = _iterator53.n()).done;) {
              var _ref137 = _step53.value;
              var _t59 = _ref137.name;
              var _i52 = _ref137.property;
              var _s28 = _ref137.binding;

              this.binders[_i52].setUniform(_s28, n, r.get(_i52), _t59);
            }
          } catch (err) {
            _iterator53.e(err);
          } finally {
            _iterator53.f();
          }
        }
      }, {
        key: "updatePaintBuffers",
        value: function updatePaintBuffers(t) {
          this._buffers = [];

          for (var _e69 in this.binders) {
            var _r76 = this.binders[_e69];

            if (t && _r76 instanceof mo) {
              var _e70 = 2 === t.fromScale ? _r76.zoomInPaintVertexBuffer : _r76.zoomOutPaintVertexBuffer;

              _e70 && this._buffers.push(_e70);
            } else (_r76 instanceof fo || _r76 instanceof yo) && _r76.paintVertexBuffer && this._buffers.push(_r76.paintVertexBuffer);
          }
        }
      }, {
        key: "upload",
        value: function upload(t) {
          for (var _e71 in this.binders) {
            var _r77 = this.binders[_e71];
            (_r77 instanceof fo || _r77 instanceof yo || _r77 instanceof mo) && _r77.upload(t);
          }

          this.updatePaintBuffers();
        }
      }, {
        key: "destroy",
        value: function destroy() {
          for (var _t60 in this.binders) {
            var _e72 = this.binders[_t60];
            (_e72 instanceof fo || _e72 instanceof yo || _e72 instanceof mo) && _e72.destroy();
          }
        }
      }]);

      return go;
    }();

    var xo = /*#__PURE__*/function () {
      function xo(t, e) {
        var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : function () {
          return !0;
        };

        _classCallCheck(this, xo);

        this.programConfigurations = {};

        var _iterator54 = _createForOfIteratorHelper(t),
            _step54;

        try {
          for (_iterator54.s(); !(_step54 = _iterator54.n()).done;) {
            var _n48 = _step54.value;
            this.programConfigurations[_n48.id] = new go(_n48, e, r);
          }
        } catch (err) {
          _iterator54.e(err);
        } finally {
          _iterator54.f();
        }

        this.needsUpload = !1, this._featureMap = new Qa(), this._bufferOffset = 0;
      }

      _createClass(xo, [{
        key: "populatePaintArrays",
        value: function populatePaintArrays(t, e, r, n, i, s, a) {
          for (var _r78 in this.programConfigurations) {
            this.programConfigurations[_r78].populatePaintArrays(t, e, n, i, s, a);
          }

          void 0 !== e.id && this._featureMap.add(e.id, r, this._bufferOffset, t), this._bufferOffset = t, this.needsUpload = !0;
        }
      }, {
        key: "updatePaintArrays",
        value: function updatePaintArrays(t, e, r, n, i) {
          var _iterator55 = _createForOfIteratorHelper(r),
              _step55;

          try {
            for (_iterator55.s(); !(_step55 = _iterator55.n()).done;) {
              var _s29 = _step55.value;
              this.needsUpload = this.programConfigurations[_s29.id].updatePaintArrays(t, this._featureMap, e, _s29, n, i) || this.needsUpload;
            }
          } catch (err) {
            _iterator55.e(err);
          } finally {
            _iterator55.f();
          }
        }
      }, {
        key: "get",
        value: function get(t) {
          return this.programConfigurations[t];
        }
      }, {
        key: "upload",
        value: function upload(t) {
          if (this.needsUpload) {
            for (var _e73 in this.programConfigurations) {
              this.programConfigurations[_e73].upload(t);
            }

            this.needsUpload = !1;
          }
        }
      }, {
        key: "destroy",
        value: function destroy() {
          for (var _t61 in this.programConfigurations) {
            this.programConfigurations[_t61].destroy();
          }
        }
      }]);

      return xo;
    }();

    var vo = {
      "text-opacity": ["opacity"],
      "icon-opacity": ["opacity"],
      "text-color": ["fill_color"],
      "icon-color": ["fill_color"],
      "text-halo-color": ["halo_color"],
      "icon-halo-color": ["halo_color"],
      "text-halo-blur": ["halo_blur"],
      "icon-halo-blur": ["halo_blur"],
      "text-halo-width": ["halo_width"],
      "icon-halo-width": ["halo_width"],
      "line-gap-width": ["gapwidth"],
      "line-pattern": ["pattern_to", "pattern_from", "pixel_ratio_to", "pixel_ratio_from"],
      "fill-pattern": ["pattern_to", "pattern_from", "pixel_ratio_to", "pixel_ratio_from"],
      "fill-extrusion-pattern": ["pattern_to", "pattern_from", "pixel_ratio_to", "pixel_ratio_from"],
      "line-dasharray": ["dash_to", "dash_from"]
    };

    function bo(t, e) {
      return vo[t] || [t.replace("".concat(e, "-"), "").replace(/-/g, "_")];
    }

    var wo = {
      "line-pattern": {
        source: ma,
        composite: ma
      },
      "fill-pattern": {
        source: ma,
        composite: ma
      },
      "fill-extrusion-pattern": {
        source: ma,
        composite: ma
      },
      "line-dasharray": {
        source: ga,
        composite: ga
      }
    },
        _o = {
      color: {
        source: Ea,
        composite: Da
      },
      number: {
        source: za,
        composite: Ea
      }
    };

    function Ao(t, e, r) {
      var n = wo[t];
      return n && n[r] || _o[e][r];
    }

    Zi("ConstantBinder", ho), Zi("CrossFadedConstantBinder", po), Zi("SourceExpressionBinder", fo), Zi("CrossFadedCompositeBinder", mo), Zi("CompositeExpressionBinder", yo), Zi("ProgramConfiguration", go, {
      omit: ["_buffers"]
    }), Zi("ProgramConfigurationSet", xo);
    var ko = "-transition";

    var So = /*#__PURE__*/function (_xe) {
      _inherits(So, _xe);

      var _super46 = _createSuper(So);

      function So(t, e) {
        var _this16;

        _classCallCheck(this, So);

        if (_this16 = _super46.call(this), _this16.id = t.id, _this16.type = t.type, _this16._featureFilter = {
          filter: function filter() {
            return !0;
          },
          needGeometry: !1,
          needFeature: !1
        }, _this16._filterCompiled = !1, "custom" !== t.type && (_this16.metadata = (t = t).metadata, _this16.minzoom = t.minzoom, _this16.maxzoom = t.maxzoom, "background" !== t.type && "sky" !== t.type && (_this16.source = t.source, _this16.sourceLayer = t["source-layer"], _this16.filter = t.filter), e.layout && (_this16._unevaluatedLayout = new Js(e.layout)), e.paint)) {
          _this16._transitionablePaint = new Ks(e.paint);

          for (var _e74 in t.paint) {
            _this16.setPaintProperty(_e74, t.paint[_e74], {
              validate: !1
            });
          }

          for (var _e75 in t.layout) {
            _this16.setLayoutProperty(_e75, t.layout[_e75], {
              validate: !1
            });
          }

          _this16._transitioningPaint = _this16._transitionablePaint.untransitioned(), _this16.paint = new Qs(e.paint);
        }

        return _possibleConstructorReturn(_this16);
      }

      _createClass(So, [{
        key: "getCrossfadeParameters",
        value: function getCrossfadeParameters() {
          return this._crossfadeParameters;
        }
      }, {
        key: "getLayoutProperty",
        value: function getLayoutProperty(t) {
          return "visibility" === t ? this.visibility : this._unevaluatedLayout.getValue(t);
        }
      }, {
        key: "setLayoutProperty",
        value: function setLayoutProperty(t, e) {
          var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
          null != e && this._validate(Ui, "layers.".concat(this.id, ".layout.").concat(t), t, e, r) || ("visibility" !== t ? this._unevaluatedLayout.setValue(t, e) : this.visibility = e);
        }
      }, {
        key: "getPaintProperty",
        value: function getPaintProperty(t) {
          return ot(t, ko) ? this._transitionablePaint.getTransition(t.slice(0, -ko.length)) : this._transitionablePaint.getValue(t);
        }
      }, {
        key: "setPaintProperty",
        value: function setPaintProperty(t, e) {
          var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
          if (null != e && this._validate(Ri, "layers.".concat(this.id, ".paint.").concat(t), t, e, r)) return !1;
          if (ot(t, ko)) return this._transitionablePaint.setTransition(t.slice(0, -ko.length), e || void 0), !1;
          {
            var _r79 = this._transitionablePaint._values[t],
                _n49 = "cross-faded-data-driven" === _r79.property.specification["property-type"],
                _i53 = _r79.value.isDataDriven(),
                _s30 = _r79.value;

            this._transitionablePaint.setValue(t, e), this._handleSpecialPaintPropertyUpdate(t);
            var _a30 = this._transitionablePaint._values[t].value;
            return _a30.isDataDriven() || _i53 || _n49 || this._handleOverridablePaintPropertyUpdate(t, _s30, _a30);
          }
        }
      }, {
        key: "_handleSpecialPaintPropertyUpdate",
        value: function _handleSpecialPaintPropertyUpdate(t) {}
      }, {
        key: "getProgramIds",
        value: function getProgramIds() {
          return null;
        }
      }, {
        key: "getProgramConfiguration",
        value: function getProgramConfiguration(t) {
          return null;
        }
      }, {
        key: "_handleOverridablePaintPropertyUpdate",
        value: function _handleOverridablePaintPropertyUpdate(t, e, r) {
          return !1;
        }
      }, {
        key: "isHidden",
        value: function isHidden(t) {
          return !!(this.minzoom && t < this.minzoom) || !!(this.maxzoom && t >= this.maxzoom) || "none" === this.visibility;
        }
      }, {
        key: "updateTransitions",
        value: function updateTransitions(t) {
          this._transitioningPaint = this._transitionablePaint.transitioned(t, this._transitioningPaint);
        }
      }, {
        key: "hasTransition",
        value: function hasTransition() {
          return this._transitioningPaint.hasTransition();
        }
      }, {
        key: "recalculate",
        value: function recalculate(t, e) {
          t.getCrossfadeParameters && (this._crossfadeParameters = t.getCrossfadeParameters()), this._unevaluatedLayout && (this.layout = this._unevaluatedLayout.possiblyEvaluate(t, void 0, e)), this.paint = this._transitioningPaint.possiblyEvaluate(t, void 0, e);
        }
      }, {
        key: "serialize",
        value: function serialize() {
          var t = {
            id: this.id,
            type: this.type,
            source: this.source,
            "source-layer": this.sourceLayer,
            metadata: this.metadata,
            minzoom: this.minzoom,
            maxzoom: this.maxzoom,
            filter: this.filter,
            layout: this._unevaluatedLayout && this._unevaluatedLayout.serialize(),
            paint: this._transitionablePaint && this._transitionablePaint.serialize()
          };
          return this.visibility && (t.layout = t.layout || {}, t.layout.visibility = this.visibility), ut(t, function (t, e) {
            return !(void 0 === t || "layout" === e && !Object.keys(t).length || "paint" === e && !Object.keys(t).length);
          });
        }
      }, {
        key: "_validate",
        value: function _validate(t, e, r, n) {
          var i = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {};
          return (!i || !1 !== i.validate) && $i(this, t.call(Vi, {
            key: e,
            layerType: this.type,
            objectKey: r,
            value: n,
            styleSpec: ve,
            style: {
              glyphs: !0,
              sprite: !0
            }
          }));
        }
      }, {
        key: "is3D",
        value: function is3D() {
          return !1;
        }
      }, {
        key: "isSky",
        value: function isSky() {
          return !1;
        }
      }, {
        key: "isTileClipped",
        value: function isTileClipped() {
          return !1;
        }
      }, {
        key: "hasOffscreenPass",
        value: function hasOffscreenPass() {
          return !1;
        }
      }, {
        key: "resize",
        value: function resize() {}
      }, {
        key: "isStateDependent",
        value: function isStateDependent() {
          for (var _t62 in this.paint._values) {
            var _e76 = this.paint.get(_t62);

            if (_e76 instanceof Ws && Cn(_e76.property.specification) && ("source" === _e76.value.kind || "composite" === _e76.value.kind) && _e76.value.isStateDependent) return !0;
          }

          return !1;
        }
      }, {
        key: "compileFilter",
        value: function compileFilter() {
          this._filterCompiled || (this._featureFilter = si(this.filter), this._filterCompiled = !0);
        }
      }, {
        key: "invalidateCompiledFilter",
        value: function invalidateCompiledFilter() {
          this._filterCompiled = !1;
        }
      }, {
        key: "dynamicFilter",
        value: function dynamicFilter() {
          return this._featureFilter.dynamicFilter;
        }
      }, {
        key: "dynamicFilterNeedsFeature",
        value: function dynamicFilterNeedsFeature() {
          return this._featureFilter.needFeature;
        }
      }]);

      return So;
    }(xe);

    var Io = ca([{
      name: "a_pos",
      components: 2,
      type: "Int16"
    }], 4),
        zo = Io.members;

    var Mo = /*#__PURE__*/function () {
      function Mo() {
        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];

        _classCallCheck(this, Mo);

        this.segments = t;
      }

      _createClass(Mo, [{
        key: "prepareSegment",
        value: function prepareSegment(t, e, r, n) {
          var i = this.segments[this.segments.length - 1];
          return t > Mo.MAX_VERTEX_ARRAY_LENGTH && pt("Max vertices per segment is ".concat(Mo.MAX_VERTEX_ARRAY_LENGTH, ": bucket requested ").concat(t)), (!i || i.vertexLength + t > Mo.MAX_VERTEX_ARRAY_LENGTH || i.sortKey !== n) && (i = {
            vertexOffset: e.length,
            primitiveOffset: r.length,
            vertexLength: 0,
            primitiveLength: 0
          }, void 0 !== n && (i.sortKey = n), this.segments.push(i)), i;
        }
      }, {
        key: "get",
        value: function get() {
          return this.segments;
        }
      }, {
        key: "destroy",
        value: function destroy() {
          var _iterator56 = _createForOfIteratorHelper(this.segments),
              _step56;

          try {
            for (_iterator56.s(); !(_step56 = _iterator56.n()).done;) {
              var _t63 = _step56.value;

              for (var _e77 in _t63.vaos) {
                _t63.vaos[_e77].destroy();
              }
            }
          } catch (err) {
            _iterator56.e(err);
          } finally {
            _iterator56.f();
          }
        }
      }], [{
        key: "simpleSegment",
        value: function simpleSegment(t, e, r, n) {
          return new Mo([{
            vertexOffset: t,
            primitiveOffset: e,
            vertexLength: r,
            primitiveLength: n,
            vaos: {},
            sortKey: 0
          }]);
        }
      }]);

      return Mo;
    }();

    Mo.MAX_VERTEX_ARRAY_LENGTH = Math.pow(2, 16) - 1, Zi("SegmentVector", Mo);
    var To = 8192;

    var Bo = /*#__PURE__*/function () {
      function Bo(t, e) {
        _classCallCheck(this, Bo);

        t && (e ? this.setSouthWest(t).setNorthEast(e) : 4 === t.length ? this.setSouthWest([t[0], t[1]]).setNorthEast([t[2], t[3]]) : this.setSouthWest(t[0]).setNorthEast(t[1]));
      }

      _createClass(Bo, [{
        key: "setNorthEast",
        value: function setNorthEast(t) {
          return this._ne = t instanceof Po ? new Po(t.lng, t.lat) : Po.convert(t), this;
        }
      }, {
        key: "setSouthWest",
        value: function setSouthWest(t) {
          return this._sw = t instanceof Po ? new Po(t.lng, t.lat) : Po.convert(t), this;
        }
      }, {
        key: "extend",
        value: function extend(t) {
          var e = this._sw,
              r = this._ne;
          var n, i;
          if (t instanceof Po) n = t, i = t;else {
            if (!(t instanceof Bo)) return Array.isArray(t) ? 4 === t.length || t.every(Array.isArray) ? this.extend(Bo.convert(t)) : this.extend(Po.convert(t)) : this;
            if (n = t._sw, i = t._ne, !n || !i) return this;
          }
          return e || r ? (e.lng = Math.min(n.lng, e.lng), e.lat = Math.min(n.lat, e.lat), r.lng = Math.max(i.lng, r.lng), r.lat = Math.max(i.lat, r.lat)) : (this._sw = new Po(n.lng, n.lat), this._ne = new Po(i.lng, i.lat)), this;
        }
      }, {
        key: "getCenter",
        value: function getCenter() {
          return new Po((this._sw.lng + this._ne.lng) / 2, (this._sw.lat + this._ne.lat) / 2);
        }
      }, {
        key: "getSouthWest",
        value: function getSouthWest() {
          return this._sw;
        }
      }, {
        key: "getNorthEast",
        value: function getNorthEast() {
          return this._ne;
        }
      }, {
        key: "getNorthWest",
        value: function getNorthWest() {
          return new Po(this.getWest(), this.getNorth());
        }
      }, {
        key: "getSouthEast",
        value: function getSouthEast() {
          return new Po(this.getEast(), this.getSouth());
        }
      }, {
        key: "getWest",
        value: function getWest() {
          return this._sw.lng;
        }
      }, {
        key: "getSouth",
        value: function getSouth() {
          return this._sw.lat;
        }
      }, {
        key: "getEast",
        value: function getEast() {
          return this._ne.lng;
        }
      }, {
        key: "getNorth",
        value: function getNorth() {
          return this._ne.lat;
        }
      }, {
        key: "toArray",
        value: function toArray() {
          return [this._sw.toArray(), this._ne.toArray()];
        }
      }, {
        key: "toString",
        value: function toString() {
          return "LngLatBounds(".concat(this._sw.toString(), ", ").concat(this._ne.toString(), ")");
        }
      }, {
        key: "isEmpty",
        value: function isEmpty() {
          return !(this._sw && this._ne);
        }
      }, {
        key: "contains",
        value: function contains(t) {
          var _Po$convert = Po.convert(t),
              e = _Po$convert.lng,
              r = _Po$convert.lat;

          var n = this._sw.lng <= e && e <= this._ne.lng;
          return this._sw.lng > this._ne.lng && (n = this._sw.lng >= e && e >= this._ne.lng), this._sw.lat <= r && r <= this._ne.lat && n;
        }
      }], [{
        key: "convert",
        value: function convert(t) {
          return !t || t instanceof Bo ? t : new Bo(t);
        }
      }]);

      return Bo;
    }();

    var Co = 6371008.8;

    var Po = /*#__PURE__*/function () {
      function Po(t, e) {
        _classCallCheck(this, Po);

        if (isNaN(t) || isNaN(e)) throw new Error("Invalid LngLat object: (".concat(t, ", ").concat(e, ")"));
        if (this.lng = +t, this.lat = +e, this.lat > 90 || this.lat < -90) throw new Error("Invalid LngLat latitude value: must be between -90 and 90");
      }

      _createClass(Po, [{
        key: "wrap",
        value: function wrap() {
          return new Po(J(this.lng, -180, 180), this.lat);
        }
      }, {
        key: "toArray",
        value: function toArray() {
          return [this.lng, this.lat];
        }
      }, {
        key: "toString",
        value: function toString() {
          return "LngLat(".concat(this.lng, ", ").concat(this.lat, ")");
        }
      }, {
        key: "distanceTo",
        value: function distanceTo(t) {
          var e = Math.PI / 180,
              r = this.lat * e,
              n = t.lat * e,
              i = Math.sin(r) * Math.sin(n) + Math.cos(r) * Math.cos(n) * Math.cos((t.lng - this.lng) * e);
          return Co * Math.acos(Math.min(i, 1));
        }
      }, {
        key: "toBounds",
        value: function toBounds() {
          var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
          var e = 360 * t / 40075017,
              r = e / Math.cos(Math.PI / 180 * this.lat);
          return new Bo(new Po(this.lng - r, this.lat - e), new Po(this.lng + r, this.lat + e));
        }
      }], [{
        key: "convert",
        value: function convert(t) {
          if (t instanceof Po) return t;
          if (Array.isArray(t) && (2 === t.length || 3 === t.length)) return new Po(Number(t[0]), Number(t[1]));
          if (!Array.isArray(t) && "object" == _typeof(t) && null !== t) return new Po(Number("lng" in t ? t.lng : t.lon), Number(t.lat));
          throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]");
        }
      }]);

      return Po;
    }();

    var Eo = 2 * Math.PI * Co;

    function Do(t) {
      return Eo * Math.cos(t * Math.PI / 180);
    }

    function Vo(t) {
      return (180 + t) / 360;
    }

    function Fo(t) {
      return (180 - 180 / Math.PI * Math.log(Math.tan(Math.PI / 4 + t * Math.PI / 360))) / 360;
    }

    function Lo(t, e) {
      return t / Do(e);
    }

    function Ro(t) {
      return 360 * t - 180;
    }

    function Uo(t) {
      return 360 / Math.PI * Math.atan(Math.exp((180 - 360 * t) * Math.PI / 180)) - 90;
    }

    function $o(t, e) {
      return t * Do(Uo(e));
    }

    var Oo = 85.051129;

    var jo = /*#__PURE__*/function () {
      function jo(t, e) {
        var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;

        _classCallCheck(this, jo);

        this.x = +t, this.y = +e, this.z = +r;
      }

      _createClass(jo, [{
        key: "toLngLat",
        value: function toLngLat() {
          return new Po(Ro(this.x), Uo(this.y));
        }
      }, {
        key: "toAltitude",
        value: function toAltitude() {
          return $o(this.z, this.y);
        }
      }, {
        key: "meterInMercatorCoordinateUnits",
        value: function meterInMercatorCoordinateUnits() {
          return 1 / Eo * (t = Uo(this.y), 1 / Math.cos(t * Math.PI / 180));
          var t;
        }
      }], [{
        key: "fromLngLat",
        value: function fromLngLat(t) {
          var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
          var r = Po.convert(t);
          return new jo(Vo(r.lng), Fo(r.lat), Lo(e, r.lat));
        }
      }]);

      return jo;
    }();

    function qo(t, e, r, n, s, a, o, l, u) {
      var c = (e + n) / 2,
          h = (r + s) / 2,
          p = new i(c, h);
      l(p), function (t, e, r, n, i, s) {
        var a = r - i,
            o = n - s;
        return Math.abs((n - e) * a - (r - t) * o) / Math.hypot(a, o);
      }(p.x, p.y, a.x, a.y, o.x, o.y) >= u ? (qo(t, e, r, c, h, a, p, l, u), qo(t, c, h, n, s, p, o, l, u)) : t.push(o);
    }

    function No(t, e, r) {
      var n = [];
      var i, s, a;

      var _iterator57 = _createForOfIteratorHelper(t),
          _step57;

      try {
        for (_iterator57.s(); !(_step57 = _iterator57.n()).done;) {
          var _o10 = _step57.value;
          var _t64 = _o10.x,
              _l10 = _o10.y;
          e(_o10), a ? qo(n, i, s, _t64, _l10, a, _o10, e, r) : n.push(_o10), i = _t64, s = _l10, a = _o10;
        }
      } catch (err) {
        _iterator57.e(err);
      } finally {
        _iterator57.f();
      }

      return n;
    }

    var Go = Math.pow(2, 14) - 1,
        Zo = -Go - 1;

    function Xo(t, e) {
      var r = Math.round(t.x * e),
          n = Math.round(t.y * e);
      return t.x = Y(r, Zo, Go), t.y = Y(n, Zo, Go), (r < t.x || r > t.x + 1 || n < t.y || n > t.y + 1) && pt("Geometry exceeds allowed extent, reduce your vector tile buffer size"), t;
    }

    function Ko(t, e, r) {
      var n = t.loadGeometry(),
          i = t.extent,
          s = To / i;

      if (e && r && r.projection.isReprojectedInTileSpace) {
        var _s31 = 1 << e.z,
            _a31 = r.scale,
            _o11 = r.x,
            _l11 = r.y,
            _u9 = r.projection,
            _c6 = function _c6(t) {
          var r = Ro((e.x + t.x / i) / _s31),
              n = Uo((e.y + t.y / i) / _s31),
              c = _u9.project(r, n);

          t.x = (c.x * _a31 - _o11) * i, t.y = (c.y * _a31 - _l11) * i;
        };

        for (var _e78 = 0; _e78 < n.length; _e78++) {
          if (1 !== t.type) n[_e78] = No(n[_e78], _c6, 1);else {
            var _t65 = [];

            var _iterator58 = _createForOfIteratorHelper(n[_e78]),
                _step58;

            try {
              for (_iterator58.s(); !(_step58 = _iterator58.n()).done;) {
                var _r80 = _step58.value;
                _r80.x < 0 || _r80.x >= i || _r80.y < 0 || _r80.y >= i || (_c6(_r80), _t65.push(_r80));
              }
            } catch (err) {
              _iterator58.e(err);
            } finally {
              _iterator58.f();
            }

            n[_e78] = _t65;
          }
        }
      }

      var _iterator59 = _createForOfIteratorHelper(n),
          _step59;

      try {
        for (_iterator59.s(); !(_step59 = _iterator59.n()).done;) {
          var _t66 = _step59.value;

          var _iterator60 = _createForOfIteratorHelper(_t66),
              _step60;

          try {
            for (_iterator60.s(); !(_step60 = _iterator60.n()).done;) {
              var _e79 = _step60.value;
              Xo(_e79, s);
            }
          } catch (err) {
            _iterator60.e(err);
          } finally {
            _iterator60.f();
          }
        }
      } catch (err) {
        _iterator59.e(err);
      } finally {
        _iterator59.f();
      }

      return n;
    }

    function Yo(t, e) {
      return {
        type: t.type,
        id: t.id,
        properties: t.properties,
        geometry: e ? Ko(t) : []
      };
    }

    function Ho(t, e, r, n, i) {
      t.emplaceBack(2 * e + (n + 1) / 2, 2 * r + (i + 1) / 2);
    }

    var Jo = /*#__PURE__*/function () {
      function Jo(t) {
        _classCallCheck(this, Jo);

        this.zoom = t.zoom, this.overscaling = t.overscaling, this.layers = t.layers, this.layerIds = this.layers.map(function (t) {
          return t.id;
        }), this.index = t.index, this.hasPattern = !1, this.layoutVertexArray = new pa(), this.indexArray = new ka(), this.segments = new Mo(), this.programConfigurations = new xo(t.layers, t.zoom), this.stateDependentLayerIds = this.layers.filter(function (t) {
          return t.isStateDependent();
        }).map(function (t) {
          return t.id;
        });
      }

      _createClass(Jo, [{
        key: "populate",
        value: function populate(t, e, r, n) {
          var i = this.layers[0],
              s = [];
          var a = null;
          "circle" === i.type && (a = i.layout.get("circle-sort-key"));

          var _iterator61 = _createForOfIteratorHelper(t),
              _step61;

          try {
            for (_iterator61.s(); !(_step61 = _iterator61.n()).done;) {
              var _ref139 = _step61.value;
              var _e80 = _ref139.feature;
              var _i56 = _ref139.id;
              var _o13 = _ref139.index;
              var _l12 = _ref139.sourceLayerIndex;

              var _t67 = this.layers[0]._featureFilter.needGeometry,
                  _u10 = Yo(_e80, _t67);

              if (!this.layers[0]._featureFilter.filter(new Gs(this.zoom), _u10, r)) continue;

              var _c7 = a ? a.evaluate(_u10, {}, r) : void 0,
                  _h3 = {
                id: _i56,
                properties: _e80.properties,
                type: _e80.type,
                sourceLayerIndex: _l12,
                index: _o13,
                geometry: _t67 ? _u10.geometry : Ko(_e80, r, n),
                patterns: {},
                sortKey: _c7
              };

              s.push(_h3);
            }
          } catch (err) {
            _iterator61.e(err);
          } finally {
            _iterator61.f();
          }

          a && s.sort(function (t, e) {
            return t.sortKey - e.sortKey;
          });

          for (var _i54 = 0, _s32 = s; _i54 < _s32.length; _i54++) {
            var _n50 = _s32[_i54];
            var _i55 = _n50.geometry,
                _s33 = _n50.index,
                _a32 = _n50.sourceLayerIndex,
                _o12 = t[_s33].feature;
            this.addFeature(_n50, _i55, _s33, e.availableImages, r), e.featureIndex.insert(_o12, _i55, _s33, _a32, this.index);
          }
        }
      }, {
        key: "update",
        value: function update(t, e, r, n) {
          this.stateDependentLayers.length && this.programConfigurations.updatePaintArrays(t, e, this.stateDependentLayers, r, n);
        }
      }, {
        key: "isEmpty",
        value: function isEmpty() {
          return 0 === this.layoutVertexArray.length;
        }
      }, {
        key: "uploadPending",
        value: function uploadPending() {
          return !this.uploaded || this.programConfigurations.needsUpload;
        }
      }, {
        key: "upload",
        value: function upload(t) {
          this.uploaded || (this.layoutVertexBuffer = t.createVertexBuffer(this.layoutVertexArray, zo), this.indexBuffer = t.createIndexBuffer(this.indexArray)), this.programConfigurations.upload(t), this.uploaded = !0;
        }
      }, {
        key: "destroy",
        value: function destroy() {
          this.layoutVertexBuffer && (this.layoutVertexBuffer.destroy(), this.indexBuffer.destroy(), this.programConfigurations.destroy(), this.segments.destroy());
        }
      }, {
        key: "addFeature",
        value: function addFeature(t, e, r, n, i) {
          var _iterator62 = _createForOfIteratorHelper(e),
              _step62;

          try {
            for (_iterator62.s(); !(_step62 = _iterator62.n()).done;) {
              var _r81 = _step62.value;

              var _iterator63 = _createForOfIteratorHelper(_r81),
                  _step63;

              try {
                for (_iterator63.s(); !(_step63 = _iterator63.n()).done;) {
                  var _e81 = _step63.value;
                  var _r82 = _e81.x,
                      _n51 = _e81.y;
                  if (_r82 < 0 || _r82 >= To || _n51 < 0 || _n51 >= To) continue;

                  var _i57 = this.segments.prepareSegment(4, this.layoutVertexArray, this.indexArray, t.sortKey),
                      _s34 = _i57.vertexLength;

                  Ho(this.layoutVertexArray, _r82, _n51, -1, -1), Ho(this.layoutVertexArray, _r82, _n51, 1, -1), Ho(this.layoutVertexArray, _r82, _n51, 1, 1), Ho(this.layoutVertexArray, _r82, _n51, -1, 1), this.indexArray.emplaceBack(_s34, _s34 + 1, _s34 + 2), this.indexArray.emplaceBack(_s34, _s34 + 3, _s34 + 2), _i57.vertexLength += 4, _i57.primitiveLength += 2;
                }
              } catch (err) {
                _iterator63.e(err);
              } finally {
                _iterator63.f();
              }
            }
          } catch (err) {
            _iterator62.e(err);
          } finally {
            _iterator62.f();
          }

          this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length, t, r, {}, n, i);
        }
      }]);

      return Jo;
    }();

    function Wo(t, e) {
      for (var _r83 = 0; _r83 < t.length; _r83++) {
        if (ol(e, t[_r83])) return !0;
      }

      for (var _r84 = 0; _r84 < e.length; _r84++) {
        if (ol(t, e[_r84])) return !0;
      }

      return !!rl(t, e);
    }

    function Qo(t, e, r) {
      return !!ol(t, e) || !!il(e, t, r);
    }

    function tl(t, e) {
      if (1 === t.length) return al(e, t[0]);

      for (var _r85 = 0; _r85 < e.length; _r85++) {
        var _n52 = e[_r85];

        for (var _e82 = 0; _e82 < _n52.length; _e82++) {
          if (ol(t, _n52[_e82])) return !0;
        }
      }

      for (var _r86 = 0; _r86 < t.length; _r86++) {
        if (al(e, t[_r86])) return !0;
      }

      for (var _r87 = 0; _r87 < e.length; _r87++) {
        if (rl(t, e[_r87])) return !0;
      }

      return !1;
    }

    function el(t, e, r) {
      if (t.length > 1) {
        if (rl(t, e)) return !0;

        for (var _n53 = 0; _n53 < e.length; _n53++) {
          if (il(e[_n53], t, r)) return !0;
        }
      }

      for (var _n54 = 0; _n54 < t.length; _n54++) {
        if (il(t[_n54], e, r)) return !0;
      }

      return !1;
    }

    function rl(t, e) {
      if (0 === t.length || 0 === e.length) return !1;

      for (var _r88 = 0; _r88 < t.length - 1; _r88++) {
        var _n55 = t[_r88],
            _i58 = t[_r88 + 1];

        for (var _t68 = 0; _t68 < e.length - 1; _t68++) {
          if (nl(_n55, _i58, e[_t68], e[_t68 + 1])) return !0;
        }
      }

      return !1;
    }

    function nl(t, e, r, n) {
      return dt(t, r, n) !== dt(e, r, n) && dt(t, e, r) !== dt(t, e, n);
    }

    function il(t, e, r) {
      var n = r * r;
      if (1 === e.length) return t.distSqr(e[0]) < n;

      for (var _r89 = 1; _r89 < e.length; _r89++) {
        if (sl(t, e[_r89 - 1], e[_r89]) < n) return !0;
      }

      return !1;
    }

    function sl(t, e, r) {
      var n = e.distSqr(r);
      if (0 === n) return t.distSqr(e);
      var i = ((t.x - e.x) * (r.x - e.x) + (t.y - e.y) * (r.y - e.y)) / n;
      return t.distSqr(i < 0 ? e : i > 1 ? r : r.sub(e)._mult(i)._add(e));
    }

    function al(t, e) {
      var r,
          n,
          i,
          s = !1;

      for (var _a33 = 0; _a33 < t.length; _a33++) {
        r = t[_a33];

        for (var _t69 = 0, _a34 = r.length - 1; _t69 < r.length; _a34 = _t69++) {
          n = r[_t69], i = r[_a34], n.y > e.y != i.y > e.y && e.x < (i.x - n.x) * (e.y - n.y) / (i.y - n.y) + n.x && (s = !s);
        }
      }

      return s;
    }

    function ol(t, e) {
      var r = !1;

      for (var _n56 = 0, _i59 = t.length - 1; _n56 < t.length; _i59 = _n56++) {
        var _s35 = t[_n56],
            _a35 = t[_i59];
        _s35.y > e.y != _a35.y > e.y && e.x < (_a35.x - _s35.x) * (e.y - _s35.y) / (_a35.y - _s35.y) + _s35.x && (r = !r);
      }

      return r;
    }

    function ll(t, e, r, n, s) {
      var _iterator64 = _createForOfIteratorHelper(t),
          _step64;

      try {
        for (_iterator64.s(); !(_step64 = _iterator64.n()).done;) {
          var _i60 = _step64.value;
          if (e <= _i60.x && r <= _i60.y && n >= _i60.x && s >= _i60.y) return !0;
        }
      } catch (err) {
        _iterator64.e(err);
      } finally {
        _iterator64.f();
      }

      var a = [new i(e, r), new i(e, s), new i(n, s), new i(n, r)];

      if (t.length > 2) {
        var _iterator65 = _createForOfIteratorHelper(a),
            _step65;

        try {
          for (_iterator65.s(); !(_step65 = _iterator65.n()).done;) {
            var _e83 = _step65.value;
            if (ol(t, _e83)) return !0;
          }
        } catch (err) {
          _iterator65.e(err);
        } finally {
          _iterator65.f();
        }
      }

      for (var _e84 = 0; _e84 < t.length - 1; _e84++) {
        if (ul(t[_e84], t[_e84 + 1], a)) return !0;
      }

      return !1;
    }

    function ul(t, e, r) {
      var n = r[0],
          i = r[2];
      if (t.x < n.x && e.x < n.x || t.x > i.x && e.x > i.x || t.y < n.y && e.y < n.y || t.y > i.y && e.y > i.y) return !1;
      var s = dt(t, e, r[0]);
      return s !== dt(t, e, r[1]) || s !== dt(t, e, r[2]) || s !== dt(t, e, r[3]);
    }

    function cl(t, e, r) {
      var n = e.paint.get(t).value;
      return "constant" === n.kind ? n.value : r.programConfigurations.get(e.id).getMaxValue(t);
    }

    function hl(t) {
      return Math.sqrt(t[0] * t[0] + t[1] * t[1]);
    }

    function pl(t, e, r, n, s) {
      if (!e[0] && !e[1]) return t;

      var a = i.convert(e)._mult(s);

      "viewport" === r && a._rotate(-n);
      var o = [];

      for (var _e85 = 0; _e85 < t.length; _e85++) {
        o.push(t[_e85].sub(a));
      }

      return o;
    }

    function dl(t, e, r, n) {
      var s = i.convert(t)._mult(n);

      return "viewport" === e && s._rotate(-r), s;
    }

    Zi("CircleBucket", Jo, {
      omit: ["layers"]
    });
    var fl = new sa({
      "circle-sort-key": new ea(ve.layout_circle["circle-sort-key"])
    });
    var yl = {
      paint: new sa({
        "circle-radius": new ea(ve.paint_circle["circle-radius"]),
        "circle-color": new ea(ve.paint_circle["circle-color"]),
        "circle-blur": new ea(ve.paint_circle["circle-blur"]),
        "circle-opacity": new ea(ve.paint_circle["circle-opacity"]),
        "circle-translate": new ta(ve.paint_circle["circle-translate"]),
        "circle-translate-anchor": new ta(ve.paint_circle["circle-translate-anchor"]),
        "circle-pitch-scale": new ta(ve.paint_circle["circle-pitch-scale"]),
        "circle-pitch-alignment": new ta(ve.paint_circle["circle-pitch-alignment"]),
        "circle-stroke-width": new ea(ve.paint_circle["circle-stroke-width"]),
        "circle-stroke-color": new ea(ve.paint_circle["circle-stroke-color"]),
        "circle-stroke-opacity": new ea(ve.paint_circle["circle-stroke-opacity"])
      }),
      layout: fl
    };

    var ml = /*#__PURE__*/function () {
      function ml(t, e) {
        _classCallCheck(this, ml);

        this.points = t, this.planes = e;
      }

      _createClass(ml, null, [{
        key: "fromInvProjectionMatrix",
        value: function fromInvProjectionMatrix(t, e, r, n) {
          var i = Math.pow(2, r),
              s = [[-1, 1, -1, 1], [1, 1, -1, 1], [1, -1, -1, 1], [-1, -1, -1, 1], [-1, 1, 1, 1], [1, 1, 1, 1], [1, -1, 1, 1], [-1, -1, 1, 1]].map(function (r) {
            var s = F([], r, t),
                a = 1 / s[3] / e * i;
            return function (t, e, r) {
              return t[0] = e[0] * r[0], t[1] = e[1] * r[1], t[2] = e[2] * r[2], t[3] = e[3] * r[3], t;
            }(s, s, [a, a, n ? 1 / s[3] : a, a]);
          }),
              a = [[0, 1, 2], [6, 5, 4], [0, 3, 7], [2, 1, 5], [3, 2, 6], [0, 4, 5]].map(function (t) {
            var e = z([], T([], E([], s[t[0]], s[t[1]]), E([], s[t[2]], s[t[1]]))),
                r = -M(e, s[t[1]]);
            return e.concat(r);
          });
          return new ml(s, a);
        }
      }]);

      return ml;
    }();

    var gl = /*#__PURE__*/function () {
      function gl(t, e) {
        _classCallCheck(this, gl);

        this.min = t, this.max = e, this.center = S([], w([], this.min, this.max), .5);
      }

      _createClass(gl, [{
        key: "quadrant",
        value: function quadrant(t) {
          var e = [t % 2 == 0, t < 2],
              r = x(this.min),
              n = x(this.max);

          for (var _t70 = 0; _t70 < e.length; _t70++) {
            r[_t70] = e[_t70] ? this.min[_t70] : this.center[_t70], n[_t70] = e[_t70] ? this.center[_t70] : this.max[_t70];
          }

          return n[2] = this.max[2], new gl(r, n);
        }
      }, {
        key: "distanceX",
        value: function distanceX(t) {
          return Math.max(Math.min(this.max[0], t[0]), this.min[0]) - t[0];
        }
      }, {
        key: "distanceY",
        value: function distanceY(t) {
          return Math.max(Math.min(this.max[1], t[1]), this.min[1]) - t[1];
        }
      }, {
        key: "distanceZ",
        value: function distanceZ(t) {
          return Math.max(Math.min(this.max[2], t[2]), this.min[2]) - t[2];
        }
      }, {
        key: "getCorners",
        value: function getCorners() {
          var t = this.min,
              e = this.max;
          return [[t[0], t[1], t[2]], [e[0], t[1], t[2]], [e[0], e[1], t[2]], [t[0], e[1], t[2]], [t[0], t[1], e[2]], [e[0], t[1], e[2]], [e[0], e[1], e[2]], [t[0], e[1], e[2]]];
        }
      }, {
        key: "intersects",
        value: function intersects(t) {
          var e = this.getCorners();
          var r = !0;

          for (var _n57 = 0; _n57 < t.planes.length; _n57++) {
            var _i61 = t.planes[_n57];
            var _s36 = 0;

            for (var _t71 = 0; _t71 < e.length; _t71++) {
              _s36 += M(_i61, e[_t71]) + _i61[3] >= 0;
            }

            if (0 === _s36) return 0;
            _s36 !== e.length && (r = !1);
          }

          if (r) return 2;

          for (var _e86 = 0; _e86 < 3; _e86++) {
            var _r90 = Number.MAX_VALUE,
                _n58 = -Number.MAX_VALUE;

            for (var _i62 = 0; _i62 < t.points.length; _i62++) {
              var _s37 = t.points[_i62][_e86] - this.min[_e86];

              _r90 = Math.min(_r90, _s37), _n58 = Math.max(_n58, _s37);
            }

            if (_n58 < 0 || _r90 > this.max[_e86] - this.min[_e86]) return 0;
          }

          return 1;
        }
      }]);

      return gl;
    }();

    function xl(t, e, r, n, i, s, a, o, l) {
      if (s && t.queryGeometry.isAboveHorizon) return !1;
      s && (l *= t.pixelToTileUnitsFactor);

      var _iterator66 = _createForOfIteratorHelper(e),
          _step66;

      try {
        for (_iterator66.s(); !(_step66 = _iterator66.n()).done;) {
          var _u11 = _step66.value;

          var _iterator67 = _createForOfIteratorHelper(_u11),
              _step67;

          try {
            var _loop = function _loop() {
              var e = _step67.value;
              var u = e.add(o),
                  c = i && r.elevation ? r.elevation.exaggeration() * i.getElevationAt(u.x, u.y, !0) : 0,
                  h = s ? u : vl(u, c, n),
                  p = s ? t.tilespaceRays.map(function (t) {
                return _l(t, c);
              }) : t.queryGeometry.screenGeometry,
                  d = F([], [e.x, e.y, c, 1], n);
              if (!a && s ? l *= d[3] / r.cameraToCenterDistance : a && !s && (l *= r.cameraToCenterDistance / d[3]), Qo(p, h, l)) return {
                v: !0
              };
            };

            for (_iterator67.s(); !(_step67 = _iterator67.n()).done;) {
              var _ret = _loop();

              if (_typeof(_ret) === "object") return _ret.v;
            }
          } catch (err) {
            _iterator67.e(err);
          } finally {
            _iterator67.f();
          }
        }
      } catch (err) {
        _iterator66.e(err);
      } finally {
        _iterator66.f();
      }

      return !1;
    }

    function vl(t, e, r) {
      var n = F([], [t.x, t.y, e, 1], r);
      return new i(n[0] / n[3], n[1] / n[3]);
    }

    var bl = b(0, 0, 0),
        wl = b(0, 0, 1);

    function _l(t, e) {
      var r = g();
      return bl[2] = e, t.intersectsPlane(bl, wl, r), new i(r[0], r[1]);
    }

    var Al = /*#__PURE__*/function (_Jo) {
      _inherits(Al, _Jo);

      var _super47 = _createSuper(Al);

      function Al() {
        _classCallCheck(this, Al);

        return _super47.apply(this, arguments);
      }

      return _createClass(Al);
    }(Jo);

    function kl(t, _ref140, n, i) {
      var e = _ref140.width,
          r = _ref140.height;

      if (i) {
        if (i instanceof Uint8ClampedArray) i = new Uint8Array(i.buffer);else if (i.length !== e * r * n) throw new RangeError("mismatched image size");
      } else i = new Uint8Array(e * r * n);

      return t.width = e, t.height = r, t.data = i, t;
    }

    function Sl(t, _ref141, n) {
      var e = _ref141.width,
          r = _ref141.height;
      if (e === t.width && r === t.height) return;
      var i = kl({}, {
        width: e,
        height: r
      }, n);
      Il(t, i, {
        x: 0,
        y: 0
      }, {
        x: 0,
        y: 0
      }, {
        width: Math.min(t.width, e),
        height: Math.min(t.height, r)
      }, n), t.width = e, t.height = r, t.data = i.data;
    }

    function Il(t, e, r, n, i, s) {
      if (0 === i.width || 0 === i.height) return e;
      if (i.width > t.width || i.height > t.height || r.x > t.width - i.width || r.y > t.height - i.height) throw new RangeError("out of range source coordinates for image copy");
      if (i.width > e.width || i.height > e.height || n.x > e.width - i.width || n.y > e.height - i.height) throw new RangeError("out of range destination coordinates for image copy");
      var a = t.data,
          o = e.data;

      for (var _l13 = 0; _l13 < i.height; _l13++) {
        var _u12 = ((r.y + _l13) * t.width + r.x) * s,
            _c8 = ((n.y + _l13) * e.width + n.x) * s;

        for (var _t72 = 0; _t72 < i.width * s; _t72++) {
          o[_c8 + _t72] = a[_u12 + _t72];
        }
      }

      return e;
    }

    Zi("HeatmapBucket", Al, {
      omit: ["layers"]
    });

    var zl = /*#__PURE__*/function () {
      function zl(t, e) {
        _classCallCheck(this, zl);

        kl(this, t, 1, e);
      }

      _createClass(zl, [{
        key: "resize",
        value: function resize(t) {
          Sl(this, t, 1);
        }
      }, {
        key: "clone",
        value: function clone() {
          return new zl({
            width: this.width,
            height: this.height
          }, new Uint8Array(this.data));
        }
      }], [{
        key: "copy",
        value: function copy(t, e, r, n, i) {
          Il(t, e, r, n, i, 1);
        }
      }]);

      return zl;
    }();

    var Ml = /*#__PURE__*/function () {
      function Ml(t, e) {
        _classCallCheck(this, Ml);

        kl(this, t, 4, e);
      }

      _createClass(Ml, [{
        key: "resize",
        value: function resize(t) {
          Sl(this, t, 4);
        }
      }, {
        key: "replace",
        value: function replace(t, e) {
          e ? this.data.set(t) : this.data = t instanceof Uint8ClampedArray ? new Uint8Array(t.buffer) : t;
        }
      }, {
        key: "clone",
        value: function clone() {
          return new Ml({
            width: this.width,
            height: this.height
          }, new Uint8Array(this.data));
        }
      }], [{
        key: "copy",
        value: function copy(t, e, r, n, i) {
          Il(t, e, r, n, i, 4);
        }
      }]);

      return Ml;
    }();

    Zi("AlphaImage", zl), Zi("RGBAImage", Ml);
    var Tl = {
      paint: new sa({
        "heatmap-radius": new ea(ve.paint_heatmap["heatmap-radius"]),
        "heatmap-weight": new ea(ve.paint_heatmap["heatmap-weight"]),
        "heatmap-intensity": new ta(ve.paint_heatmap["heatmap-intensity"]),
        "heatmap-color": new ia(ve.paint_heatmap["heatmap-color"]),
        "heatmap-opacity": new ta(ve.paint_heatmap["heatmap-opacity"])
      })
    };

    function Bl(t) {
      var e = {},
          r = t.resolution || 256,
          n = t.clips ? t.clips.length : 1,
          i = t.image || new Ml({
        width: r,
        height: n
      }),
          s = function s(r, n, _s38) {
        e[t.evaluationKey] = _s38;
        var a = t.expression.evaluate(e);
        i.data[r + n + 0] = Math.floor(255 * a.r / a.a), i.data[r + n + 1] = Math.floor(255 * a.g / a.a), i.data[r + n + 2] = Math.floor(255 * a.b / a.a), i.data[r + n + 3] = Math.floor(255 * a.a);
      };

      if (t.clips) for (var _e87 = 0, _i63 = 0; _e87 < n; ++_e87, _i63 += 4 * r) {
        for (var _n59 = 0, _a36 = 0; _n59 < r; _n59++, _a36 += 4) {
          var _o14 = _n59 / (r - 1),
              _t$clips$_e = t.clips[_e87],
              _l14 = _t$clips$_e.start,
              _u13 = _t$clips$_e.end;

          s(_i63, _a36, _l14 * (1 - _o14) + _u13 * _o14);
        }
      } else for (var _t73 = 0, _e88 = 0; _t73 < r; _t73++, _e88 += 4) {
        s(0, _e88, _t73 / (r - 1));
      }
      return i;
    }

    var Cl = {
      paint: new sa({
        "hillshade-illumination-direction": new ta(ve.paint_hillshade["hillshade-illumination-direction"]),
        "hillshade-illumination-anchor": new ta(ve.paint_hillshade["hillshade-illumination-anchor"]),
        "hillshade-exaggeration": new ta(ve.paint_hillshade["hillshade-exaggeration"]),
        "hillshade-shadow-color": new ta(ve.paint_hillshade["hillshade-shadow-color"]),
        "hillshade-highlight-color": new ta(ve.paint_hillshade["hillshade-highlight-color"]),
        "hillshade-accent-color": new ta(ve.paint_hillshade["hillshade-accent-color"])
      })
    };
    var Pl = ca([{
      name: "a_pos",
      components: 2,
      type: "Int16"
    }], 4),
        El = Pl.members;
    var Dl = Fl,
        Vl = Fl;

    function Fl(t, e, r) {
      r = r || 2;
      var n,
          i,
          s,
          a,
          o,
          l,
          u,
          c = e && e.length,
          h = c ? e[0] * r : t.length,
          p = Ll(t, 0, h, r, !0),
          d = [];
      if (!p || p.next === p.prev) return d;

      if (c && (p = function (t, e, r, n) {
        var i,
            s,
            a,
            o = [];

        for (i = 0, s = e.length; i < s; i++) {
          (a = Ll(t, e[i] * n, i < s - 1 ? e[i + 1] * n : t.length, n, !1)) === a.next && (a.steiner = !0), o.push(Kl(a));
        }

        for (o.sort(Nl), i = 0; i < o.length; i++) {
          r = Rl(r = Gl(o[i], r), r.next);
        }

        return r;
      }(t, e, p, r)), t.length > 80 * r) {
        n = s = t[0], i = a = t[1];

        for (var f = r; f < h; f += r) {
          (o = t[f]) < n && (n = o), (l = t[f + 1]) < i && (i = l), o > s && (s = o), l > a && (a = l);
        }

        u = 0 !== (u = Math.max(s - n, a - i)) ? 1 / u : 0;
      }

      return Ul(p, d, r, n, i, u), d;
    }

    function Ll(t, e, r, n, i) {
      var s, a;
      if (i === ou(t, e, r, n) > 0) for (s = e; s < r; s += n) {
        a = iu(s, t[s], t[s + 1], a);
      } else for (s = r - n; s >= e; s -= n) {
        a = iu(s, t[s], t[s + 1], a);
      }
      return a && Wl(a, a.next) && (su(a), a = a.next), a;
    }

    function Rl(t, e) {
      if (!t) return t;
      e || (e = t);
      var r,
          n = t;

      do {
        if (r = !1, n.steiner || !Wl(n, n.next) && 0 !== Jl(n.prev, n, n.next)) n = n.next;else {
          if (su(n), (n = e = n.prev) === n.next) break;
          r = !0;
        }
      } while (r || n !== e);

      return e;
    }

    function Ul(t, e, r, n, i, s, a) {
      if (t) {
        !a && s && function (t, e, r, n) {
          var i = t;

          do {
            null === i.z && (i.z = Xl(i.x, i.y, e, r, n)), i.prevZ = i.prev, i.nextZ = i.next, i = i.next;
          } while (i !== t);

          i.prevZ.nextZ = null, i.prevZ = null, function (t) {
            var e,
                r,
                n,
                i,
                s,
                a,
                o,
                l,
                u = 1;

            do {
              for (r = t, t = null, s = null, a = 0; r;) {
                for (a++, n = r, o = 0, e = 0; e < u && (o++, n = n.nextZ); e++) {
                  ;
                }

                for (l = u; o > 0 || l > 0 && n;) {
                  0 !== o && (0 === l || !n || r.z <= n.z) ? (i = r, r = r.nextZ, o--) : (i = n, n = n.nextZ, l--), s ? s.nextZ = i : t = i, i.prevZ = s, s = i;
                }

                r = n;
              }

              s.nextZ = null, u *= 2;
            } while (a > 1);
          }(i);
        }(t, n, i, s);

        for (var o, l, u = t; t.prev !== t.next;) {
          if (o = t.prev, l = t.next, s ? Ol(t, n, i, s) : $l(t)) e.push(o.i / r), e.push(t.i / r), e.push(l.i / r), su(t), t = l.next, u = l.next;else if ((t = l) === u) {
            a ? 1 === a ? Ul(t = jl(Rl(t), e, r), e, r, n, i, s, 2) : 2 === a && ql(t, e, r, n, i, s) : Ul(Rl(t), e, r, n, i, s, 1);
            break;
          }
        }
      }
    }

    function $l(t) {
      var e = t.prev,
          r = t,
          n = t.next;
      if (Jl(e, r, n) >= 0) return !1;

      for (var i = t.next.next; i !== t.prev;) {
        if (Yl(e.x, e.y, r.x, r.y, n.x, n.y, i.x, i.y) && Jl(i.prev, i, i.next) >= 0) return !1;
        i = i.next;
      }

      return !0;
    }

    function Ol(t, e, r, n) {
      var i = t.prev,
          s = t,
          a = t.next;
      if (Jl(i, s, a) >= 0) return !1;

      for (var o = i.x > s.x ? i.x > a.x ? i.x : a.x : s.x > a.x ? s.x : a.x, l = i.y > s.y ? i.y > a.y ? i.y : a.y : s.y > a.y ? s.y : a.y, u = Xl(i.x < s.x ? i.x < a.x ? i.x : a.x : s.x < a.x ? s.x : a.x, i.y < s.y ? i.y < a.y ? i.y : a.y : s.y < a.y ? s.y : a.y, e, r, n), c = Xl(o, l, e, r, n), h = t.prevZ, p = t.nextZ; h && h.z >= u && p && p.z <= c;) {
        if (h !== t.prev && h !== t.next && Yl(i.x, i.y, s.x, s.y, a.x, a.y, h.x, h.y) && Jl(h.prev, h, h.next) >= 0) return !1;
        if (h = h.prevZ, p !== t.prev && p !== t.next && Yl(i.x, i.y, s.x, s.y, a.x, a.y, p.x, p.y) && Jl(p.prev, p, p.next) >= 0) return !1;
        p = p.nextZ;
      }

      for (; h && h.z >= u;) {
        if (h !== t.prev && h !== t.next && Yl(i.x, i.y, s.x, s.y, a.x, a.y, h.x, h.y) && Jl(h.prev, h, h.next) >= 0) return !1;
        h = h.prevZ;
      }

      for (; p && p.z <= c;) {
        if (p !== t.prev && p !== t.next && Yl(i.x, i.y, s.x, s.y, a.x, a.y, p.x, p.y) && Jl(p.prev, p, p.next) >= 0) return !1;
        p = p.nextZ;
      }

      return !0;
    }

    function jl(t, e, r) {
      var n = t;

      do {
        var i = n.prev,
            s = n.next.next;
        !Wl(i, s) && Ql(i, n, n.next, s) && ru(i, s) && ru(s, i) && (e.push(i.i / r), e.push(n.i / r), e.push(s.i / r), su(n), su(n.next), n = t = s), n = n.next;
      } while (n !== t);

      return Rl(n);
    }

    function ql(t, e, r, n, i, s) {
      var a = t;

      do {
        for (var o = a.next.next; o !== a.prev;) {
          if (a.i !== o.i && Hl(a, o)) {
            var l = nu(a, o);
            return a = Rl(a, a.next), l = Rl(l, l.next), Ul(a, e, r, n, i, s), void Ul(l, e, r, n, i, s);
          }

          o = o.next;
        }

        a = a.next;
      } while (a !== t);
    }

    function Nl(t, e) {
      return t.x - e.x;
    }

    function Gl(t, e) {
      var r = function (t, e) {
        var r,
            n = e,
            i = t.x,
            s = t.y,
            a = -1 / 0;

        do {
          if (s <= n.y && s >= n.next.y && n.next.y !== n.y) {
            var o = n.x + (s - n.y) * (n.next.x - n.x) / (n.next.y - n.y);

            if (o <= i && o > a) {
              if (a = o, o === i) {
                if (s === n.y) return n;
                if (s === n.next.y) return n.next;
              }

              r = n.x < n.next.x ? n : n.next;
            }
          }

          n = n.next;
        } while (n !== e);

        if (!r) return null;
        if (i === a) return r;
        var l,
            u = r,
            c = r.x,
            h = r.y,
            p = 1 / 0;
        n = r;

        do {
          i >= n.x && n.x >= c && i !== n.x && Yl(s < h ? i : a, s, c, h, s < h ? a : i, s, n.x, n.y) && (l = Math.abs(s - n.y) / (i - n.x), ru(n, t) && (l < p || l === p && (n.x > r.x || n.x === r.x && Zl(r, n))) && (r = n, p = l)), n = n.next;
        } while (n !== u);

        return r;
      }(t, e);

      if (!r) return e;
      var n = nu(r, t),
          i = Rl(r, r.next);
      return Rl(n, n.next), e === r ? i : e;
    }

    function Zl(t, e) {
      return Jl(t.prev, t, e.prev) < 0 && Jl(e.next, t, t.next) < 0;
    }

    function Xl(t, e, r, n, i) {
      return (t = 1431655765 & ((t = 858993459 & ((t = 252645135 & ((t = 16711935 & ((t = 32767 * (t - r) * i) | t << 8)) | t << 4)) | t << 2)) | t << 1)) | (e = 1431655765 & ((e = 858993459 & ((e = 252645135 & ((e = 16711935 & ((e = 32767 * (e - n) * i) | e << 8)) | e << 4)) | e << 2)) | e << 1)) << 1;
    }

    function Kl(t) {
      var e = t,
          r = t;

      do {
        (e.x < r.x || e.x === r.x && e.y < r.y) && (r = e), e = e.next;
      } while (e !== t);

      return r;
    }

    function Yl(t, e, r, n, i, s, a, o) {
      return (i - a) * (e - o) - (t - a) * (s - o) >= 0 && (t - a) * (n - o) - (r - a) * (e - o) >= 0 && (r - a) * (s - o) - (i - a) * (n - o) >= 0;
    }

    function Hl(t, e) {
      return t.next.i !== e.i && t.prev.i !== e.i && !function (t, e) {
        var r = t;

        do {
          if (r.i !== t.i && r.next.i !== t.i && r.i !== e.i && r.next.i !== e.i && Ql(r, r.next, t, e)) return !0;
          r = r.next;
        } while (r !== t);

        return !1;
      }(t, e) && (ru(t, e) && ru(e, t) && function (t, e) {
        var r = t,
            n = !1,
            i = (t.x + e.x) / 2,
            s = (t.y + e.y) / 2;

        do {
          r.y > s != r.next.y > s && r.next.y !== r.y && i < (r.next.x - r.x) * (s - r.y) / (r.next.y - r.y) + r.x && (n = !n), r = r.next;
        } while (r !== t);

        return n;
      }(t, e) && (Jl(t.prev, t, e.prev) || Jl(t, e.prev, e)) || Wl(t, e) && Jl(t.prev, t, t.next) > 0 && Jl(e.prev, e, e.next) > 0);
    }

    function Jl(t, e, r) {
      return (e.y - t.y) * (r.x - e.x) - (e.x - t.x) * (r.y - e.y);
    }

    function Wl(t, e) {
      return t.x === e.x && t.y === e.y;
    }

    function Ql(t, e, r, n) {
      var i = eu(Jl(t, e, r)),
          s = eu(Jl(t, e, n)),
          a = eu(Jl(r, n, t)),
          o = eu(Jl(r, n, e));
      return i !== s && a !== o || !(0 !== i || !tu(t, r, e)) || !(0 !== s || !tu(t, n, e)) || !(0 !== a || !tu(r, t, n)) || !(0 !== o || !tu(r, e, n));
    }

    function tu(t, e, r) {
      return e.x <= Math.max(t.x, r.x) && e.x >= Math.min(t.x, r.x) && e.y <= Math.max(t.y, r.y) && e.y >= Math.min(t.y, r.y);
    }

    function eu(t) {
      return t > 0 ? 1 : t < 0 ? -1 : 0;
    }

    function ru(t, e) {
      return Jl(t.prev, t, t.next) < 0 ? Jl(t, e, t.next) >= 0 && Jl(t, t.prev, e) >= 0 : Jl(t, e, t.prev) < 0 || Jl(t, t.next, e) < 0;
    }

    function nu(t, e) {
      var r = new au(t.i, t.x, t.y),
          n = new au(e.i, e.x, e.y),
          i = t.next,
          s = e.prev;
      return t.next = e, e.prev = t, r.next = i, i.prev = r, n.next = r, r.prev = n, s.next = n, n.prev = s, n;
    }

    function iu(t, e, r, n) {
      var i = new au(t, e, r);
      return n ? (i.next = n.next, i.prev = n, n.next.prev = i, n.next = i) : (i.prev = i, i.next = i), i;
    }

    function su(t) {
      t.next.prev = t.prev, t.prev.next = t.next, t.prevZ && (t.prevZ.nextZ = t.nextZ), t.nextZ && (t.nextZ.prevZ = t.prevZ);
    }

    function au(t, e, r) {
      this.i = t, this.x = e, this.y = r, this.prev = null, this.next = null, this.z = null, this.prevZ = null, this.nextZ = null, this.steiner = !1;
    }

    function ou(t, e, r, n) {
      for (var i = 0, s = e, a = r - n; s < r; s += n) {
        i += (t[a] - t[s]) * (t[s + 1] + t[a + 1]), a = s;
      }

      return i;
    }

    function lu(t, e, r, n, i) {
      uu(t, e, r || 0, n || t.length - 1, i || hu);
    }

    function uu(t, e, r, n, i) {
      for (; n > r;) {
        if (n - r > 600) {
          var s = n - r + 1,
              a = e - r + 1,
              o = Math.log(s),
              l = .5 * Math.exp(2 * o / 3),
              u = .5 * Math.sqrt(o * l * (s - l) / s) * (a - s / 2 < 0 ? -1 : 1);
          uu(t, e, Math.max(r, Math.floor(e - a * l / s + u)), Math.min(n, Math.floor(e + (s - a) * l / s + u)), i);
        }

        var c = t[e],
            h = r,
            p = n;

        for (cu(t, r, e), i(t[n], c) > 0 && cu(t, r, n); h < p;) {
          for (cu(t, h, p), h++, p--; i(t[h], c) < 0;) {
            h++;
          }

          for (; i(t[p], c) > 0;) {
            p--;
          }
        }

        0 === i(t[r], c) ? cu(t, r, p) : cu(t, ++p, n), p <= e && (r = p + 1), e <= p && (n = p - 1);
      }
    }

    function cu(t, e, r) {
      var n = t[e];
      t[e] = t[r], t[r] = n;
    }

    function hu(t, e) {
      return t < e ? -1 : t > e ? 1 : 0;
    }

    function pu(t, e) {
      var r = t.length;
      if (r <= 1) return [t];
      var n = [];
      var i, s;

      for (var _e89 = 0; _e89 < r; _e89++) {
        var _r91 = ft(t[_e89]);

        0 !== _r91 && (t[_e89].area = Math.abs(_r91), void 0 === s && (s = _r91 < 0), s === _r91 < 0 ? (i && n.push(i), i = [t[_e89]]) : i.push(t[_e89]));
      }

      if (i && n.push(i), e > 1) for (var _t74 = 0; _t74 < n.length; _t74++) {
        n[_t74].length <= e || (lu(n[_t74], e, 1, n[_t74].length - 1, du), n[_t74] = n[_t74].slice(0, e));
      }
      return n;
    }

    function du(t, e) {
      return e.area - t.area;
    }

    function fu(t, e, r) {
      var n = r.patternDependencies;
      var i = !1;

      var _iterator68 = _createForOfIteratorHelper(e),
          _step68;

      try {
        for (_iterator68.s(); !(_step68 = _iterator68.n()).done;) {
          var _r92 = _step68.value;

          var _e90 = _r92.paint.get("".concat(t, "-pattern"));

          _e90.isConstant() || (i = !0);

          var _s39 = _e90.constantOr(null);

          _s39 && (i = !0, n[_s39.to] = !0, n[_s39.from] = !0);
        }
      } catch (err) {
        _iterator68.e(err);
      } finally {
        _iterator68.f();
      }

      return i;
    }

    function yu(t, e, r, n, i) {
      var s = i.patternDependencies;

      var _iterator69 = _createForOfIteratorHelper(e),
          _step69;

      try {
        for (_iterator69.s(); !(_step69 = _iterator69.n()).done;) {
          var _a37 = _step69.value;

          var _e91 = _a37.paint.get("".concat(t, "-pattern")).value;

          if ("constant" !== _e91.kind) {
            var _t75 = _e91.evaluate({
              zoom: n - 1
            }, r, {}, i.availableImages),
                _o15 = _e91.evaluate({
              zoom: n
            }, r, {}, i.availableImages),
                _l15 = _e91.evaluate({
              zoom: n + 1
            }, r, {}, i.availableImages);

            _t75 = _t75 && _t75.name ? _t75.name : _t75, _o15 = _o15 && _o15.name ? _o15.name : _o15, _l15 = _l15 && _l15.name ? _l15.name : _l15, s[_t75] = !0, s[_o15] = !0, s[_l15] = !0, r.patterns[_a37.id] = {
              min: _t75,
              mid: _o15,
              max: _l15
            };
          }
        }
      } catch (err) {
        _iterator69.e(err);
      } finally {
        _iterator69.f();
      }

      return r;
    }

    Fl.deviation = function (t, e, r, n) {
      var i = e && e.length,
          s = Math.abs(ou(t, 0, i ? e[0] * r : t.length, r));
      if (i) for (var a = 0, o = e.length; a < o; a++) {
        s -= Math.abs(ou(t, e[a] * r, a < o - 1 ? e[a + 1] * r : t.length, r));
      }
      var l = 0;

      for (a = 0; a < n.length; a += 3) {
        var u = n[a] * r,
            c = n[a + 1] * r,
            h = n[a + 2] * r;
        l += Math.abs((t[u] - t[h]) * (t[c + 1] - t[u + 1]) - (t[u] - t[c]) * (t[h + 1] - t[u + 1]));
      }

      return 0 === s && 0 === l ? 0 : Math.abs((l - s) / s);
    }, Fl.flatten = function (t) {
      for (var e = t[0][0].length, r = {
        vertices: [],
        holes: [],
        dimensions: e
      }, n = 0, i = 0; i < t.length; i++) {
        for (var s = 0; s < t[i].length; s++) {
          for (var a = 0; a < e; a++) {
            r.vertices.push(t[i][s][a]);
          }
        }

        i > 0 && r.holes.push(n += t[i - 1].length);
      }

      return r;
    }, Dl["default"] = Vl;

    var mu = /*#__PURE__*/function () {
      function mu(t) {
        _classCallCheck(this, mu);

        this.zoom = t.zoom, this.overscaling = t.overscaling, this.layers = t.layers, this.layerIds = this.layers.map(function (t) {
          return t.id;
        }), this.index = t.index, this.hasPattern = !1, this.patternFeatures = [], this.layoutVertexArray = new pa(), this.indexArray = new ka(), this.indexArray2 = new Ca(), this.programConfigurations = new xo(t.layers, t.zoom), this.segments = new Mo(), this.segments2 = new Mo(), this.stateDependentLayerIds = this.layers.filter(function (t) {
          return t.isStateDependent();
        }).map(function (t) {
          return t.id;
        });
      }

      _createClass(mu, [{
        key: "populate",
        value: function populate(t, e, r, n) {
          this.hasPattern = fu("fill", this.layers, e);
          var i = this.layers[0].layout.get("fill-sort-key"),
              s = [];

          var _iterator70 = _createForOfIteratorHelper(t),
              _step70;

          try {
            for (_iterator70.s(); !(_step70 = _iterator70.n()).done;) {
              var _ref143 = _step70.value;
              var _a39 = _ref143.feature;
              var _o16 = _ref143.id;
              var _l16 = _ref143.index;
              var _u14 = _ref143.sourceLayerIndex;

              var _t77 = this.layers[0]._featureFilter.needGeometry,
                  _c9 = Yo(_a39, _t77);

              if (!this.layers[0]._featureFilter.filter(new Gs(this.zoom), _c9, r)) continue;

              var _h4 = i ? i.evaluate(_c9, {}, r, e.availableImages) : void 0,
                  _p3 = {
                id: _o16,
                properties: _a39.properties,
                type: _a39.type,
                sourceLayerIndex: _u14,
                index: _l16,
                geometry: _t77 ? _c9.geometry : Ko(_a39, r, n),
                patterns: {},
                sortKey: _h4
              };

              s.push(_p3);
            }
          } catch (err) {
            _iterator70.e(err);
          } finally {
            _iterator70.f();
          }

          i && s.sort(function (t, e) {
            return t.sortKey - e.sortKey;
          });

          for (var _i64 = 0, _s40 = s; _i64 < _s40.length; _i64++) {
            var _n60 = _s40[_i64];
            var _i65 = _n60.geometry,
                _s41 = _n60.index,
                _a38 = _n60.sourceLayerIndex;

            if (this.hasPattern) {
              var _t76 = yu("fill", this.layers, _n60, this.zoom, e);

              this.patternFeatures.push(_t76);
            } else this.addFeature(_n60, _i65, _s41, r, {}, e.availableImages);

            e.featureIndex.insert(t[_s41].feature, _i65, _s41, _a38, this.index);
          }
        }
      }, {
        key: "update",
        value: function update(t, e, r, n) {
          this.stateDependentLayers.length && this.programConfigurations.updatePaintArrays(t, e, this.stateDependentLayers, r, n);
        }
      }, {
        key: "addFeatures",
        value: function addFeatures(t, e, r, n) {
          var _iterator71 = _createForOfIteratorHelper(this.patternFeatures),
              _step71;

          try {
            for (_iterator71.s(); !(_step71 = _iterator71.n()).done;) {
              var _t78 = _step71.value;
              this.addFeature(_t78, _t78.geometry, _t78.index, e, r, n);
            }
          } catch (err) {
            _iterator71.e(err);
          } finally {
            _iterator71.f();
          }
        }
      }, {
        key: "isEmpty",
        value: function isEmpty() {
          return 0 === this.layoutVertexArray.length;
        }
      }, {
        key: "uploadPending",
        value: function uploadPending() {
          return !this.uploaded || this.programConfigurations.needsUpload;
        }
      }, {
        key: "upload",
        value: function upload(t) {
          this.uploaded || (this.layoutVertexBuffer = t.createVertexBuffer(this.layoutVertexArray, El), this.indexBuffer = t.createIndexBuffer(this.indexArray), this.indexBuffer2 = t.createIndexBuffer(this.indexArray2)), this.programConfigurations.upload(t), this.uploaded = !0;
        }
      }, {
        key: "destroy",
        value: function destroy() {
          this.layoutVertexBuffer && (this.layoutVertexBuffer.destroy(), this.indexBuffer.destroy(), this.indexBuffer2.destroy(), this.programConfigurations.destroy(), this.segments.destroy(), this.segments2.destroy());
        }
      }, {
        key: "addFeature",
        value: function addFeature(t, e, r, n, i) {
          var s = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : [];

          var _iterator72 = _createForOfIteratorHelper(pu(e, 500)),
              _step72;

          try {
            for (_iterator72.s(); !(_step72 = _iterator72.n()).done;) {
              var _t79 = _step72.value;
              var _e92 = 0;

              var _iterator73 = _createForOfIteratorHelper(_t79),
                  _step73;

              try {
                for (_iterator73.s(); !(_step73 = _iterator73.n()).done;) {
                  var _r94 = _step73.value;
                  _e92 += _r94.length;
                }
              } catch (err) {
                _iterator73.e(err);
              } finally {
                _iterator73.f();
              }

              var _r93 = this.segments.prepareSegment(_e92, this.layoutVertexArray, this.indexArray),
                  _n61 = _r93.vertexLength,
                  _i66 = [],
                  _s42 = [];

              var _iterator74 = _createForOfIteratorHelper(_t79),
                  _step74;

              try {
                for (_iterator74.s(); !(_step74 = _iterator74.n()).done;) {
                  var _e93 = _step74.value;
                  if (0 === _e93.length) continue;
                  _e93 !== _t79[0] && _s42.push(_i66.length / 2);

                  var _r95 = this.segments2.prepareSegment(_e93.length, this.layoutVertexArray, this.indexArray2),
                      _n62 = _r95.vertexLength;

                  this.layoutVertexArray.emplaceBack(_e93[0].x, _e93[0].y), this.indexArray2.emplaceBack(_n62 + _e93.length - 1, _n62), _i66.push(_e93[0].x), _i66.push(_e93[0].y);

                  for (var _t81 = 1; _t81 < _e93.length; _t81++) {
                    this.layoutVertexArray.emplaceBack(_e93[_t81].x, _e93[_t81].y), this.indexArray2.emplaceBack(_n62 + _t81 - 1, _n62 + _t81), _i66.push(_e93[_t81].x), _i66.push(_e93[_t81].y);
                  }

                  _r95.vertexLength += _e93.length, _r95.primitiveLength += _e93.length;
                }
              } catch (err) {
                _iterator74.e(err);
              } finally {
                _iterator74.f();
              }

              var _a40 = Dl(_i66, _s42);

              for (var _t80 = 0; _t80 < _a40.length; _t80 += 3) {
                this.indexArray.emplaceBack(_n61 + _a40[_t80], _n61 + _a40[_t80 + 1], _n61 + _a40[_t80 + 2]);
              }

              _r93.vertexLength += _e92, _r93.primitiveLength += _a40.length / 3;
            }
          } catch (err) {
            _iterator72.e(err);
          } finally {
            _iterator72.f();
          }

          this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length, t, r, i, s, n);
        }
      }]);

      return mu;
    }();

    Zi("FillBucket", mu, {
      omit: ["layers", "patternFeatures"]
    });
    var gu = new sa({
      "fill-sort-key": new ea(ve.layout_fill["fill-sort-key"])
    });
    var xu = {
      paint: new sa({
        "fill-antialias": new ta(ve.paint_fill["fill-antialias"]),
        "fill-opacity": new ea(ve.paint_fill["fill-opacity"]),
        "fill-color": new ea(ve.paint_fill["fill-color"]),
        "fill-outline-color": new ea(ve.paint_fill["fill-outline-color"]),
        "fill-translate": new ta(ve.paint_fill["fill-translate"]),
        "fill-translate-anchor": new ta(ve.paint_fill["fill-translate-anchor"]),
        "fill-pattern": new ra(ve.paint_fill["fill-pattern"])
      }),
      layout: gu
    };
    var vu = ca([{
      name: "a_pos_normal_ed",
      components: 4,
      type: "Int16"
    }]),
        bu = ca([{
      name: "a_centroid_pos",
      components: 2,
      type: "Uint16"
    }]),
        wu = vu.members;
    var _u = Au;

    function Au(t, e, r, n, i) {
      this.properties = {}, this.extent = r, this.type = 0, this._pbf = t, this._geometry = -1, this._keys = n, this._values = i, t.readFields(ku, this, e);
    }

    function ku(t, e, r) {
      1 == t ? e.id = r.readVarint() : 2 == t ? function (t, e) {
        for (var r = t.readVarint() + t.pos; t.pos < r;) {
          var n = e._keys[t.readVarint()],
              i = e._values[t.readVarint()];

          e.properties[n] = i;
        }
      }(r, e) : 3 == t ? e.type = r.readVarint() : 4 == t && (e._geometry = r.pos);
    }

    function Su(t) {
      for (var e, r, n = 0, i = 0, s = t.length, a = s - 1; i < s; a = i++) {
        n += ((r = t[a]).x - (e = t[i]).x) * (e.y + r.y);
      }

      return n;
    }

    Au.types = ["Unknown", "Point", "LineString", "Polygon"], Au.prototype.loadGeometry = function () {
      var t = this._pbf;
      t.pos = this._geometry;

      for (var e, r = t.readVarint() + t.pos, n = 1, s = 0, a = 0, o = 0, l = []; t.pos < r;) {
        if (s <= 0) {
          var u = t.readVarint();
          n = 7 & u, s = u >> 3;
        }

        if (s--, 1 === n || 2 === n) a += t.readSVarint(), o += t.readSVarint(), 1 === n && (e && l.push(e), e = []), e.push(new i(a, o));else {
          if (7 !== n) throw new Error("unknown command " + n);
          e && e.push(e[0].clone());
        }
      }

      return e && l.push(e), l;
    }, Au.prototype.bbox = function () {
      var t = this._pbf;
      t.pos = this._geometry;

      for (var e = t.readVarint() + t.pos, r = 1, n = 0, i = 0, s = 0, a = 1 / 0, o = -1 / 0, l = 1 / 0, u = -1 / 0; t.pos < e;) {
        if (n <= 0) {
          var c = t.readVarint();
          r = 7 & c, n = c >> 3;
        }

        if (n--, 1 === r || 2 === r) (i += t.readSVarint()) < a && (a = i), i > o && (o = i), (s += t.readSVarint()) < l && (l = s), s > u && (u = s);else if (7 !== r) throw new Error("unknown command " + r);
      }

      return [a, l, o, u];
    }, Au.prototype.toGeoJSON = function (t, e, r) {
      var n,
          i,
          s = this.extent * Math.pow(2, r),
          a = this.extent * t,
          o = this.extent * e,
          l = this.loadGeometry(),
          u = Au.types[this.type];

      function c(t) {
        for (var e = 0; e < t.length; e++) {
          var r = t[e];
          t[e] = [360 * (r.x + a) / s - 180, 360 / Math.PI * Math.atan(Math.exp((180 - 360 * (r.y + o) / s) * Math.PI / 180)) - 90];
        }
      }

      switch (this.type) {
        case 1:
          var h = [];

          for (n = 0; n < l.length; n++) {
            h[n] = l[n][0];
          }

          c(l = h);
          break;

        case 2:
          for (n = 0; n < l.length; n++) {
            c(l[n]);
          }

          break;

        case 3:
          for (l = function (t) {
            var e = t.length;
            if (e <= 1) return [t];

            for (var r, n, i = [], s = 0; s < e; s++) {
              var a = Su(t[s]);
              0 !== a && (void 0 === n && (n = a < 0), n === a < 0 ? (r && i.push(r), r = [t[s]]) : r.push(t[s]));
            }

            return r && i.push(r), i;
          }(l), n = 0; n < l.length; n++) {
            for (i = 0; i < l[n].length; i++) {
              c(l[n][i]);
            }
          }

      }

      1 === l.length ? l = l[0] : u = "Multi" + u;
      var p = {
        type: "Feature",
        geometry: {
          type: u,
          coordinates: l
        },
        properties: this.properties
      };
      return "id" in this && (p.id = this.id), p;
    };
    var Iu = zu;

    function zu(t, e) {
      this.version = 1, this.name = null, this.extent = 4096, this.length = 0, this._pbf = t, this._keys = [], this._values = [], this._features = [], t.readFields(Mu, this, e), this.length = this._features.length;
    }

    function Mu(t, e, r) {
      15 === t ? e.version = r.readVarint() : 1 === t ? e.name = r.readString() : 5 === t ? e.extent = r.readVarint() : 2 === t ? e._features.push(r.pos) : 3 === t ? e._keys.push(r.readString()) : 4 === t && e._values.push(function (t) {
        for (var e = null, r = t.readVarint() + t.pos; t.pos < r;) {
          var n = t.readVarint() >> 3;
          e = 1 === n ? t.readString() : 2 === n ? t.readFloat() : 3 === n ? t.readDouble() : 4 === n ? t.readVarint64() : 5 === n ? t.readVarint() : 6 === n ? t.readSVarint() : 7 === n ? t.readBoolean() : null;
        }

        return e;
      }(r));
    }

    function Tu(t, e, r) {
      if (3 === t) {
        var n = new Iu(r, r.readVarint() + r.pos);
        n.length && (e[n.name] = n);
      }
    }

    zu.prototype.feature = function (t) {
      if (t < 0 || t >= this._features.length) throw new Error("feature index out of bounds");
      this._pbf.pos = this._features[t];

      var e = this._pbf.readVarint() + this._pbf.pos;

      return new _u(this._pbf, e, this.extent, this._keys, this._values);
    };

    var Bu = {
      VectorTile: function VectorTile(t, e) {
        this.layers = t.readFields(Tu, {}, e);
      },
      VectorTileFeature: _u,
      VectorTileLayer: Iu
    };
    var Cu = Bu.VectorTileFeature.types,
        Pu = Math.pow(2, 13);

    function Eu(t, e, r, n, i, s, a, o) {
      t.emplaceBack((e << 1) + a, (r << 1) + s, (Math.floor(n * Pu) << 1) + i, Math.round(o));
    }

    var Du = /*#__PURE__*/function () {
      function Du() {
        _classCallCheck(this, Du);

        this.acc = new i(0, 0), this.polyCount = [];
      }

      _createClass(Du, [{
        key: "startRing",
        value: function startRing(t) {
          this.currentPolyCount = {
            edges: 0,
            top: 0
          }, this.polyCount.push(this.currentPolyCount), this.min || (this.min = new i(t.x, t.y), this.max = new i(t.x, t.y));
        }
      }, {
        key: "append",
        value: function append(t, e) {
          this.currentPolyCount.edges++, this.acc._add(t);
          var r = !!this.borders;
          var n = this.min,
              i = this.max;
          t.x < n.x ? (n.x = t.x, r = !0) : t.x > i.x && (i.x = t.x, r = !0), t.y < n.y ? (n.y = t.y, r = !0) : t.y > i.y && (i.y = t.y, r = !0), ((0 === t.x || t.x === To) && t.x === e.x) != ((0 === t.y || t.y === To) && t.y === e.y) && this.processBorderOverlap(t, e), r && this.checkBorderIntersection(t, e);
        }
      }, {
        key: "checkBorderIntersection",
        value: function checkBorderIntersection(t, e) {
          e.x < 0 != t.x < 0 && this.addBorderIntersection(0, Lr(e.y, t.y, (0 - e.x) / (t.x - e.x))), e.x > To != t.x > To && this.addBorderIntersection(1, Lr(e.y, t.y, (To - e.x) / (t.x - e.x))), e.y < 0 != t.y < 0 && this.addBorderIntersection(2, Lr(e.x, t.x, (0 - e.y) / (t.y - e.y))), e.y > To != t.y > To && this.addBorderIntersection(3, Lr(e.x, t.x, (To - e.y) / (t.y - e.y)));
        }
      }, {
        key: "addBorderIntersection",
        value: function addBorderIntersection(t, e) {
          this.borders || (this.borders = [[Number.MAX_VALUE, -Number.MAX_VALUE], [Number.MAX_VALUE, -Number.MAX_VALUE], [Number.MAX_VALUE, -Number.MAX_VALUE], [Number.MAX_VALUE, -Number.MAX_VALUE]]);
          var r = this.borders[t];
          e < r[0] && (r[0] = e), e > r[1] && (r[1] = e);
        }
      }, {
        key: "processBorderOverlap",
        value: function processBorderOverlap(t, e) {
          if (t.x === e.x) {
            if (t.y === e.y) return;

            var _r96 = 0 === t.x ? 0 : 1;

            this.addBorderIntersection(_r96, e.y), this.addBorderIntersection(_r96, t.y);
          } else {
            var _r97 = 0 === t.y ? 2 : 3;

            this.addBorderIntersection(_r97, e.x), this.addBorderIntersection(_r97, t.x);
          }
        }
      }, {
        key: "centroid",
        value: function centroid() {
          var t = this.polyCount.reduce(function (t, e) {
            return t + e.edges;
          }, 0);
          return 0 !== t ? this.acc.div(t)._round() : new i(0, 0);
        }
      }, {
        key: "span",
        value: function span() {
          return new i(this.max.x - this.min.x, this.max.y - this.min.y);
        }
      }, {
        key: "intersectsCount",
        value: function intersectsCount() {
          return this.borders.reduce(function (t, e) {
            return t + +(e[0] !== Number.MAX_VALUE);
          }, 0);
        }
      }]);

      return Du;
    }();

    var Vu = /*#__PURE__*/function () {
      function Vu(t) {
        _classCallCheck(this, Vu);

        this.zoom = t.zoom, this.overscaling = t.overscaling, this.layers = t.layers, this.layerIds = this.layers.map(function (t) {
          return t.id;
        }), this.index = t.index, this.hasPattern = !1, this.layoutVertexArray = new da(), this.centroidVertexArray = new Za(), this.indexArray = new ka(), this.programConfigurations = new xo(t.layers, t.zoom), this.segments = new Mo(), this.stateDependentLayerIds = this.layers.filter(function (t) {
          return t.isStateDependent();
        }).map(function (t) {
          return t.id;
        }), this.enableTerrain = t.enableTerrain;
      }

      _createClass(Vu, [{
        key: "populate",
        value: function populate(t, e, r, n) {
          this.features = [], this.hasPattern = fu("fill-extrusion", this.layers, e), this.featuresOnBorder = [], this.borders = [[], [], [], []], this.borderDone = [!1, !1, !1, !1], this.tileToMeter = function (t) {
            var e = Math.exp(Math.PI * (1 - t.y / (1 << t.z) * 2));
            return 80150034 * e / (e * e + 1) / To / (1 << t.z);
          }(r);

          var _iterator75 = _createForOfIteratorHelper(t),
              _step75;

          try {
            for (_iterator75.s(); !(_step75 = _iterator75.n()).done;) {
              var _ref145 = _step75.value;
              var _i67 = _ref145.feature;
              var _s43 = _ref145.id;
              var _a41 = _ref145.index;
              var _o17 = _ref145.sourceLayerIndex;

              var _t82 = this.layers[0]._featureFilter.needGeometry,
                  _l17 = Yo(_i67, _t82);

              if (!this.layers[0]._featureFilter.filter(new Gs(this.zoom), _l17, r)) continue;
              var _u15 = {
                id: _s43,
                sourceLayerIndex: _o17,
                index: _a41,
                geometry: _t82 ? _l17.geometry : Ko(_i67, r, n),
                properties: _i67.properties,
                type: _i67.type,
                patterns: {}
              },
                  _c10 = this.layoutVertexArray.length;
              this.hasPattern ? this.features.push(yu("fill-extrusion", this.layers, _u15, this.zoom, e)) : this.addFeature(_u15, _u15.geometry, _a41, r, {}, e.availableImages), e.featureIndex.insert(_i67, _u15.geometry, _a41, _o17, this.index, _c10);
            }
          } catch (err) {
            _iterator75.e(err);
          } finally {
            _iterator75.f();
          }

          this.sortBorders();
        }
      }, {
        key: "addFeatures",
        value: function addFeatures(t, e, r, n) {
          var _iterator76 = _createForOfIteratorHelper(this.features),
              _step76;

          try {
            for (_iterator76.s(); !(_step76 = _iterator76.n()).done;) {
              var _t83 = _step76.value;
              var _i68 = _t83.geometry;
              this.addFeature(_t83, _i68, _t83.index, e, r, n);
            }
          } catch (err) {
            _iterator76.e(err);
          } finally {
            _iterator76.f();
          }

          this.sortBorders();
        }
      }, {
        key: "update",
        value: function update(t, e, r, n) {
          this.stateDependentLayers.length && this.programConfigurations.updatePaintArrays(t, e, this.stateDependentLayers, r, n);
        }
      }, {
        key: "isEmpty",
        value: function isEmpty() {
          return 0 === this.layoutVertexArray.length;
        }
      }, {
        key: "uploadPending",
        value: function uploadPending() {
          return !this.uploaded || this.programConfigurations.needsUpload;
        }
      }, {
        key: "upload",
        value: function upload(t) {
          this.uploaded || (this.layoutVertexBuffer = t.createVertexBuffer(this.layoutVertexArray, wu), this.indexBuffer = t.createIndexBuffer(this.indexArray)), this.programConfigurations.upload(t), this.uploaded = !0;
        }
      }, {
        key: "uploadCentroid",
        value: function uploadCentroid(t) {
          0 !== this.centroidVertexArray.length && (this.centroidVertexBuffer ? this.needsCentroidUpdate && this.centroidVertexBuffer.updateData(this.centroidVertexArray) : this.centroidVertexBuffer = t.createVertexBuffer(this.centroidVertexArray, bu.members, !0), this.needsCentroidUpdate = !1);
        }
      }, {
        key: "destroy",
        value: function destroy() {
          this.layoutVertexBuffer && (this.layoutVertexBuffer.destroy(), this.centroidVertexBuffer && this.centroidVertexBuffer.destroy(), this.indexBuffer.destroy(), this.programConfigurations.destroy(), this.segments.destroy());
        }
      }, {
        key: "addFeature",
        value: function addFeature(t, e, r, n, i, s) {
          var a = this.enableTerrain ? new Du() : null;

          var _iterator77 = _createForOfIteratorHelper(pu(e, 500)),
              _step77;

          try {
            for (_iterator77.s(); !(_step77 = _iterator77.n()).done;) {
              var _r99 = _step77.value;

              var _e95 = 0,
                  _n63 = this.segments.prepareSegment(4, this.layoutVertexArray, this.indexArray);

              if (0 === _r99.length || (o = _r99[0]).every(function (t) {
                return t.x <= 0;
              }) || o.every(function (t) {
                return t.x >= To;
              }) || o.every(function (t) {
                return t.y <= 0;
              }) || o.every(function (t) {
                return t.y >= To;
              })) continue;

              for (var _t85 = 0; _t85 < _r99.length; _t85++) {
                var _i70 = _r99[_t85];
                if (0 === _i70.length) continue;
                _e95 += _i70.length;
                var _s45 = 0;
                a && a.startRing(_i70[0]);

                for (var _t86 = 0; _t86 < _i70.length; _t86++) {
                  var _e96 = _i70[_t86];

                  if (_t86 >= 1) {
                    var _r100 = _i70[_t86 - 1];

                    if (!Fu(_e96, _r100)) {
                      a && a.append(_e96, _r100), _n63.vertexLength + 4 > Mo.MAX_VERTEX_ARRAY_LENGTH && (_n63 = this.segments.prepareSegment(4, this.layoutVertexArray, this.indexArray));

                      var _t87 = _e96.sub(_r100)._perp(),
                          _i71 = _t87.x / (Math.abs(_t87.x) + Math.abs(_t87.y)),
                          _o18 = _t87.y > 0 ? 1 : 0,
                          _l19 = _r100.dist(_e96);

                      _s45 + _l19 > 32768 && (_s45 = 0), Eu(this.layoutVertexArray, _e96.x, _e96.y, _i71, _o18, 0, 0, _s45), Eu(this.layoutVertexArray, _e96.x, _e96.y, _i71, _o18, 0, 1, _s45), _s45 += _l19, Eu(this.layoutVertexArray, _r100.x, _r100.y, _i71, _o18, 0, 0, _s45), Eu(this.layoutVertexArray, _r100.x, _r100.y, _i71, _o18, 0, 1, _s45);
                      var _u17 = _n63.vertexLength;
                      this.indexArray.emplaceBack(_u17, _u17 + 2, _u17 + 1), this.indexArray.emplaceBack(_u17 + 1, _u17 + 2, _u17 + 3), _n63.vertexLength += 4, _n63.primitiveLength += 2;
                    }
                  }
                }
              }

              if (_n63.vertexLength + _e95 > Mo.MAX_VERTEX_ARRAY_LENGTH && (_n63 = this.segments.prepareSegment(_e95, this.layoutVertexArray, this.indexArray)), "Polygon" !== Cu[t.type]) continue;
              var _i69 = [],
                  _s44 = [],
                  _l18 = _n63.vertexLength;

              for (var _t88 = 0; _t88 < _r99.length; _t88++) {
                var _e97 = _r99[_t88];

                if (0 !== _e97.length) {
                  _e97 !== _r99[0] && _s44.push(_i69.length / 2);

                  for (var _t89 = 0; _t89 < _e97.length; _t89++) {
                    var _r101 = _e97[_t89];
                    Eu(this.layoutVertexArray, _r101.x, _r101.y, 0, 0, 1, 1, 0), _i69.push(_r101.x), _i69.push(_r101.y), a && a.currentPolyCount.top++;
                  }
                }
              }

              var _u16 = Dl(_i69, _s44);

              for (var _t90 = 0; _t90 < _u16.length; _t90 += 3) {
                this.indexArray.emplaceBack(_l18 + _u16[_t90], _l18 + _u16[_t90 + 2], _l18 + _u16[_t90 + 1]);
              }

              _n63.primitiveLength += _u16.length / 3, _n63.vertexLength += _e95;
            }
          } catch (err) {
            _iterator77.e(err);
          } finally {
            _iterator77.f();
          }

          var o;

          if (a && a.polyCount.length > 0) {
            if (a.borders) {
              a.vertexArrayOffset = this.centroidVertexArray.length;

              var _t84 = a.borders,
                  _e94 = this.featuresOnBorder.push(a) - 1;

              for (var _r98 = 0; _r98 < 4; _r98++) {
                _t84[_r98][0] !== Number.MAX_VALUE && this.borders[_r98].push(_e94);
              }
            }

            this.encodeCentroid(a.borders ? void 0 : a.centroid(), a);
          }

          this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length, t, r, i, s, n);
        }
      }, {
        key: "sortBorders",
        value: function sortBorders() {
          var _this17 = this;

          var _loop2 = function _loop2(_t91) {
            _this17.borders[_t91].sort(function (e, r) {
              return _this17.featuresOnBorder[e].borders[_t91][0] - _this17.featuresOnBorder[r].borders[_t91][0];
            });
          };

          for (var _t91 = 0; _t91 < 4; _t91++) {
            _loop2(_t91);
          }
        }
      }, {
        key: "encodeCentroid",
        value: function encodeCentroid(t, e) {
          var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !0;
          var n, i;
          if (t) {
            if (0 !== t.y) {
              var _r102 = e.span()._mult(this.tileToMeter);

              n = (Math.max(t.x, 1) << 3) + Math.min(7, Math.round(_r102.x / 10)), i = (Math.max(t.y, 1) << 3) + Math.min(7, Math.round(_r102.y / 10));
            } else n = Math.ceil(7 * (t.x + 450)), i = 0;
          } else n = 0, i = +r;
          var s = r ? this.centroidVertexArray.length : e.vertexArrayOffset;

          var _iterator78 = _createForOfIteratorHelper(e.polyCount),
              _step78;

          try {
            for (_iterator78.s(); !(_step78 = _iterator78.n()).done;) {
              var _t92 = _step78.value;
              r && this.centroidVertexArray.resize(this.centroidVertexArray.length + 4 * _t92.edges + _t92.top);

              for (var _e98 = 0; _e98 < 2 * _t92.edges; _e98++) {
                this.centroidVertexArray.emplace(s++, 0, i), this.centroidVertexArray.emplace(s++, n, i);
              }

              for (var _e99 = 0; _e99 < _t92.top; _e99++) {
                this.centroidVertexArray.emplace(s++, n, i);
              }
            }
          } catch (err) {
            _iterator78.e(err);
          } finally {
            _iterator78.f();
          }
        }
      }]);

      return Vu;
    }();

    function Fu(t, e) {
      return t.x === e.x && (t.x < 0 || t.x > To) || t.y === e.y && (t.y < 0 || t.y > To);
    }

    Zi("FillExtrusionBucket", Vu, {
      omit: ["layers", "features"]
    }), Zi("PartMetadata", Du);
    var Lu = {
      paint: new sa({
        "fill-extrusion-opacity": new ta(ve["paint_fill-extrusion"]["fill-extrusion-opacity"]),
        "fill-extrusion-color": new ea(ve["paint_fill-extrusion"]["fill-extrusion-color"]),
        "fill-extrusion-translate": new ta(ve["paint_fill-extrusion"]["fill-extrusion-translate"]),
        "fill-extrusion-translate-anchor": new ta(ve["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),
        "fill-extrusion-pattern": new ra(ve["paint_fill-extrusion"]["fill-extrusion-pattern"]),
        "fill-extrusion-height": new ea(ve["paint_fill-extrusion"]["fill-extrusion-height"]),
        "fill-extrusion-base": new ea(ve["paint_fill-extrusion"]["fill-extrusion-base"]),
        "fill-extrusion-vertical-gradient": new ta(ve["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])
      })
    };

    function Ru(t, e) {
      return t.x * e.x + t.y * e.y;
    }

    function Uu(t, e) {
      if (1 === t.length) {
        var _r103 = 0;
        var _n64 = e[_r103++];

        var _i72;

        for (; !_i72 || _n64.equals(_i72);) {
          if (_i72 = e[_r103++], !_i72) return 1 / 0;
        }

        for (; _r103 < e.length; _r103++) {
          var _s46 = e[_r103],
              _a42 = t[0],
              _o19 = _i72.sub(_n64),
              _l20 = _s46.sub(_n64),
              _u18 = _a42.sub(_n64),
              _c11 = Ru(_o19, _o19),
              _h5 = Ru(_o19, _l20),
              _p4 = Ru(_l20, _l20),
              _d2 = Ru(_u18, _o19),
              _f = Ru(_u18, _l20),
              _y = _c11 * _p4 - _h5 * _h5,
              _m = (_p4 * _d2 - _h5 * _f) / _y,
              _g = (_c11 * _f - _h5 * _d2) / _y,
              _x = _n64.z * (1 - _m - _g) + _i72.z * _m + _s46.z * _g;

          if (isFinite(_x)) return _x;
        }

        return 1 / 0;
      }

      {
        var _t93 = 1 / 0;

        var _iterator79 = _createForOfIteratorHelper(e),
            _step79;

        try {
          for (_iterator79.s(); !(_step79 = _iterator79.n()).done;) {
            var _r104 = _step79.value;
            _t93 = Math.min(_t93, _r104.z);
          }
        } catch (err) {
          _iterator79.e(err);
        } finally {
          _iterator79.f();
        }

        return _t93;
      }
    }

    function $u(t) {
      var e = new i(t[0], t[1]);
      return e.z = t[2], e;
    }

    function Ou(t, e, r, n, i, s, a, o) {
      var l = a * i.getElevationAt(t, e, !0, !0),
          u = 0 !== s[0],
          c = u ? 0 === s[1] ? a * (s[0] / 7 - 450) : a * function (t, e, r) {
        var n = Math.floor(e[0] / 8),
            i = Math.floor(e[1] / 8),
            s = 10 * (e[0] - 8 * n),
            a = 10 * (e[1] - 8 * i),
            o = t.getElevationAt(n, i, !0, !0),
            l = t.getMeterToDEM(r),
            u = Math.floor(.5 * (s * l - 1)),
            c = Math.floor(.5 * (a * l - 1)),
            h = t.tileCoordToPixel(n, i),
            p = 2 * u + 1,
            d = 2 * c + 1,
            f = function (t, e, r, n, i) {
          return [t.getElevationAtPixel(e, r, !0), t.getElevationAtPixel(e + i, r, !0), t.getElevationAtPixel(e, r + i, !0), t.getElevationAtPixel(e + n, r + i, !0)];
        }(t, h.x - u, h.y - c, p, d),
            y = Math.abs(f[0] - f[1]),
            m = Math.abs(f[2] - f[3]),
            g = Math.abs(f[0] - f[2]) + Math.abs(f[1] - f[3]),
            x = Math.min(.25, .5 * l * (y + m) / p),
            v = Math.min(.25, .5 * l * g / d);

        return o + Math.max(x * s, v * a);
      }(i, s, o) : l;
      return {
        base: l + (0 === r) ? -1 : r,
        top: u ? Math.max(c + n, l + r + 2) : l + n
      };
    }

    var ju = ca([{
      name: "a_pos_normal",
      components: 2,
      type: "Int16"
    }, {
      name: "a_data",
      components: 4,
      type: "Uint8"
    }, {
      name: "a_linesofar",
      components: 1,
      type: "Float32"
    }], 4),
        qu = ju.members,
        Nu = ca([{
      name: "a_packed",
      components: 3,
      type: "Float32"
    }]),
        Gu = Nu.members,
        Zu = Bu.VectorTileFeature.types,
        Xu = Math.cos(Math.PI / 180 * 37.5);

    var Ku = /*#__PURE__*/function () {
      function Ku(t) {
        var _this18 = this;

        _classCallCheck(this, Ku);

        this.zoom = t.zoom, this.overscaling = t.overscaling, this.layers = t.layers, this.layerIds = this.layers.map(function (t) {
          return t.id;
        }), this.index = t.index, this.hasPattern = !1, this.patternFeatures = [], this.lineClipsArray = [], this.gradients = {}, this.layers.forEach(function (t) {
          _this18.gradients[t.id] = {};
        }), this.layoutVertexArray = new fa(), this.layoutVertexArray2 = new ya(), this.indexArray = new ka(), this.programConfigurations = new xo(t.layers, t.zoom), this.segments = new Mo(), this.maxLineLength = 0, this.stateDependentLayerIds = this.layers.filter(function (t) {
          return t.isStateDependent();
        }).map(function (t) {
          return t.id;
        });
      }

      _createClass(Ku, [{
        key: "populate",
        value: function populate(t, e, r, n) {
          this.hasPattern = fu("line", this.layers, e);
          var i = this.layers[0].layout.get("line-sort-key"),
              s = [];

          var _iterator80 = _createForOfIteratorHelper(t),
              _step80;

          try {
            for (_iterator80.s(); !(_step80 = _iterator80.n()).done;) {
              var _ref147 = _step80.value;
              var _e100 = _ref147.feature;
              var _a43 = _ref147.id;
              var _o20 = _ref147.index;
              var _l21 = _ref147.sourceLayerIndex;

              var _t95 = this.layers[0]._featureFilter.needGeometry,
                  _u20 = Yo(_e100, _t95);

              if (!this.layers[0]._featureFilter.filter(new Gs(this.zoom), _u20, r)) continue;

              var _c12 = i ? i.evaluate(_u20, {}, r) : void 0,
                  _h6 = {
                id: _a43,
                properties: _e100.properties,
                type: _e100.type,
                sourceLayerIndex: _l21,
                index: _o20,
                geometry: _t95 ? _u20.geometry : Ko(_e100, r, n),
                patterns: {},
                sortKey: _c12
              };

              s.push(_h6);
            }
          } catch (err) {
            _iterator80.e(err);
          } finally {
            _iterator80.f();
          }

          i && s.sort(function (t, e) {
            return t.sortKey - e.sortKey;
          });
          var a = e.lineAtlas,
              o = e.featureIndex,
              l = this.addConstantDashes(a);

          for (var _i73 = 0, _s47 = s; _i73 < _s47.length; _i73++) {
            var _n65 = _s47[_i73];
            var _i74 = _n65.geometry,
                _s48 = _n65.index,
                _u19 = _n65.sourceLayerIndex;

            if (l && this.addFeatureDashes(_n65, a), this.hasPattern) {
              var _t94 = yu("line", this.layers, _n65, this.zoom, e);

              this.patternFeatures.push(_t94);
            } else this.addFeature(_n65, _i74, _s48, r, a.positions, e.availableImages);

            o.insert(t[_s48].feature, _i74, _s48, _u19, this.index);
          }
        }
      }, {
        key: "addConstantDashes",
        value: function addConstantDashes(t) {
          var e = !1;

          var _iterator81 = _createForOfIteratorHelper(this.layers),
              _step81;

          try {
            for (_iterator81.s(); !(_step81 = _iterator81.n()).done;) {
              var _r105 = _step81.value;

              var _n66 = _r105.paint.get("line-dasharray").value,
                  _i75 = _r105.layout.get("line-cap").value;

              if ("constant" !== _n66.kind || "constant" !== _i75.kind) e = !0;else {
                var _e101 = _i75.value,
                    _r106 = _n66.value;
                if (!_r106) continue;
                t.addDash(_r106.from, _e101), t.addDash(_r106.to, _e101), _r106.other && t.addDash(_r106.other, _e101);
              }
            }
          } catch (err) {
            _iterator81.e(err);
          } finally {
            _iterator81.f();
          }

          return e;
        }
      }, {
        key: "addFeatureDashes",
        value: function addFeatureDashes(t, e) {
          var r = this.zoom;

          var _iterator82 = _createForOfIteratorHelper(this.layers),
              _step82;

          try {
            for (_iterator82.s(); !(_step82 = _iterator82.n()).done;) {
              var _n67 = _step82.value;

              var _i76 = _n67.paint.get("line-dasharray").value,
                  _s49 = _n67.layout.get("line-cap").value;

              if ("constant" === _i76.kind && "constant" === _s49.kind) continue;

              var _a44 = void 0,
                  _o21 = void 0,
                  _l22 = void 0,
                  _u21 = void 0,
                  _c13 = void 0,
                  _h7 = void 0;

              if ("constant" === _i76.kind) {
                var _t96 = _i76.value;
                if (!_t96) continue;
                _a44 = _t96.other || _t96.to, _o21 = _t96.to, _l22 = _t96.from;
              } else _a44 = _i76.evaluate({
                zoom: r - 1
              }, t), _o21 = _i76.evaluate({
                zoom: r
              }, t), _l22 = _i76.evaluate({
                zoom: r + 1
              }, t);

              "constant" === _s49.kind ? _u21 = _c13 = _h7 = _s49.value : (_u21 = _s49.evaluate({
                zoom: r - 1
              }, t), _c13 = _s49.evaluate({
                zoom: r
              }, t), _h7 = _s49.evaluate({
                zoom: r + 1
              }, t)), e.addDash(_a44, _u21), e.addDash(_o21, _c13), e.addDash(_l22, _h7);

              var _p5 = e.getKey(_a44, _u21),
                  _d3 = e.getKey(_o21, _c13),
                  _f2 = e.getKey(_l22, _h7);

              t.patterns[_n67.id] = {
                min: _p5,
                mid: _d3,
                max: _f2
              };
            }
          } catch (err) {
            _iterator82.e(err);
          } finally {
            _iterator82.f();
          }
        }
      }, {
        key: "update",
        value: function update(t, e, r, n) {
          this.stateDependentLayers.length && this.programConfigurations.updatePaintArrays(t, e, this.stateDependentLayers, r, n);
        }
      }, {
        key: "addFeatures",
        value: function addFeatures(t, e, r, n) {
          var _iterator83 = _createForOfIteratorHelper(this.patternFeatures),
              _step83;

          try {
            for (_iterator83.s(); !(_step83 = _iterator83.n()).done;) {
              var _t97 = _step83.value;
              this.addFeature(_t97, _t97.geometry, _t97.index, e, r, n);
            }
          } catch (err) {
            _iterator83.e(err);
          } finally {
            _iterator83.f();
          }
        }
      }, {
        key: "isEmpty",
        value: function isEmpty() {
          return 0 === this.layoutVertexArray.length;
        }
      }, {
        key: "uploadPending",
        value: function uploadPending() {
          return !this.uploaded || this.programConfigurations.needsUpload;
        }
      }, {
        key: "upload",
        value: function upload(t) {
          this.uploaded || (0 !== this.layoutVertexArray2.length && (this.layoutVertexBuffer2 = t.createVertexBuffer(this.layoutVertexArray2, Gu)), this.layoutVertexBuffer = t.createVertexBuffer(this.layoutVertexArray, qu), this.indexBuffer = t.createIndexBuffer(this.indexArray)), this.programConfigurations.upload(t), this.uploaded = !0;
        }
      }, {
        key: "destroy",
        value: function destroy() {
          this.layoutVertexBuffer && (this.layoutVertexBuffer.destroy(), this.indexBuffer.destroy(), this.programConfigurations.destroy(), this.segments.destroy());
        }
      }, {
        key: "lineFeatureClips",
        value: function lineFeatureClips(t) {
          if (t.properties && t.properties.hasOwnProperty("mapbox_clip_start") && t.properties.hasOwnProperty("mapbox_clip_end")) return {
            start: +t.properties.mapbox_clip_start,
            end: +t.properties.mapbox_clip_end
          };
        }
      }, {
        key: "addFeature",
        value: function addFeature(t, e, r, n, i, s) {
          var a = this.layers[0].layout,
              o = a.get("line-join").evaluate(t, {}),
              l = a.get("line-cap").evaluate(t, {}),
              u = a.get("line-miter-limit"),
              c = a.get("line-round-limit");
          this.lineClips = this.lineFeatureClips(t);

          var _iterator84 = _createForOfIteratorHelper(e),
              _step84;

          try {
            for (_iterator84.s(); !(_step84 = _iterator84.n()).done;) {
              var _r107 = _step84.value;
              this.addLine(_r107, t, o, l, u, c);
            }
          } catch (err) {
            _iterator84.e(err);
          } finally {
            _iterator84.f();
          }

          this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length, t, r, i, s, n);
        }
      }, {
        key: "addLine",
        value: function addLine(t, e, r, n, i, s) {
          if (this.distance = 0, this.scaledDistance = 0, this.totalDistance = 0, this.lineSoFar = 0, this.lineClips) {
            this.lineClipsArray.push(this.lineClips);

            for (var _e102 = 0; _e102 < t.length - 1; _e102++) {
              this.totalDistance += t[_e102].dist(t[_e102 + 1]);
            }

            this.updateScaledDistance(), this.maxLineLength = Math.max(this.maxLineLength, this.totalDistance);
          }

          var a = "Polygon" === Zu[e.type];
          var o = t.length;

          for (; o >= 2 && t[o - 1].equals(t[o - 2]);) {
            o--;
          }

          var l = 0;

          for (; l < o - 1 && t[l].equals(t[l + 1]);) {
            l++;
          }

          if (o < (a ? 3 : 2)) return;
          "bevel" === r && (i = 1.05);
          var u = this.overscaling <= 16 ? 122880 / (512 * this.overscaling) : 0,
              c = this.segments.prepareSegment(10 * o, this.layoutVertexArray, this.indexArray);
          var h, p, d, f, y;
          this.e1 = this.e2 = -1, a && (h = t[o - 2], y = t[l].sub(h)._unit()._perp());

          for (var _e103 = l; _e103 < o; _e103++) {
            if (d = _e103 === o - 1 ? a ? t[l + 1] : void 0 : t[_e103 + 1], d && t[_e103].equals(d)) continue;
            y && (f = y), h && (p = h), h = t[_e103], y = d ? d.sub(h)._unit()._perp() : f, f = f || y;

            var _m2 = f.add(y);

            0 === _m2.x && 0 === _m2.y || _m2._unit();

            var _g2 = f.x * y.x + f.y * y.y,
                _x2 = _m2.x * y.x + _m2.y * y.y,
                _v = 0 !== _x2 ? 1 / _x2 : 1 / 0,
                _b = 2 * Math.sqrt(2 - 2 * _x2),
                _w = _x2 < Xu && p && d,
                _2 = f.x * y.y - f.y * y.x > 0;

            if (_w && _e103 > l) {
              var _t98 = h.dist(p);

              if (_t98 > 2 * u) {
                var _e104 = h.sub(h.sub(p)._mult(u / _t98)._round());

                this.updateDistance(p, _e104), this.addCurrentVertex(_e104, f, 0, 0, c), p = _e104;
              }
            }

            var _A = p && d;

            var _k = _A ? r : a ? "butt" : n;

            if (_A && "round" === _k && (_v < s ? _k = "miter" : _v <= 2 && (_k = "fakeround")), "miter" === _k && _v > i && (_k = "bevel"), "bevel" === _k && (_v > 2 && (_k = "flipbevel"), _v < i && (_k = "miter")), p && this.updateDistance(p, h), "miter" === _k) _m2._mult(_v), this.addCurrentVertex(h, _m2, 0, 0, c);else if ("flipbevel" === _k) {
              if (_v > 100) _m2 = y.mult(-1);else {
                var _t99 = _v * f.add(y).mag() / f.sub(y).mag();

                _m2._perp()._mult(_t99 * (_2 ? -1 : 1));
              }
              this.addCurrentVertex(h, _m2, 0, 0, c), this.addCurrentVertex(h, _m2.mult(-1), 0, 0, c);
            } else if ("bevel" === _k || "fakeround" === _k) {
              var _t100 = -Math.sqrt(_v * _v - 1),
                  _e105 = _2 ? _t100 : 0,
                  _r108 = _2 ? 0 : _t100;

              if (p && this.addCurrentVertex(h, f, _e105, _r108, c), "fakeround" === _k) {
                var _t101 = Math.round(180 * _b / Math.PI / 20);

                for (var _e106 = 1; _e106 < _t101; _e106++) {
                  var _r109 = _e106 / _t101;

                  if (.5 !== _r109) {
                    var _t102 = _r109 - .5;

                    _r109 += _r109 * _t102 * (_r109 - 1) * ((1.0904 + _g2 * (_g2 * (3.55645 - 1.43519 * _g2) - 3.2452)) * _t102 * _t102 + (.848013 + _g2 * (.215638 * _g2 - 1.06021)));
                  }

                  var _n68 = y.sub(f)._mult(_r109)._add(f)._unit()._mult(_2 ? -1 : 1);

                  this.addHalfVertex(h, _n68.x, _n68.y, !1, _2, 0, c);
                }
              }

              d && this.addCurrentVertex(h, y, -_e105, -_r108, c);
            } else if ("butt" === _k) this.addCurrentVertex(h, _m2, 0, 0, c);else if ("square" === _k) {
              var _t103 = p ? 1 : -1;

              p || this.addCurrentVertex(h, _m2, _t103, _t103, c), this.addCurrentVertex(h, _m2, 0, 0, c), p && this.addCurrentVertex(h, _m2, _t103, _t103, c);
            } else "round" === _k && (p && (this.addCurrentVertex(h, f, 0, 0, c), this.addCurrentVertex(h, f, 1, 1, c, !0)), d && (this.addCurrentVertex(h, y, -1, -1, c, !0), this.addCurrentVertex(h, y, 0, 0, c)));

            if (_w && _e103 < o - 1) {
              var _t104 = h.dist(d);

              if (_t104 > 2 * u) {
                var _e107 = h.add(d.sub(h)._mult(u / _t104)._round());

                this.updateDistance(h, _e107), this.addCurrentVertex(_e107, y, 0, 0, c), h = _e107;
              }
            }
          }
        }
      }, {
        key: "addCurrentVertex",
        value: function addCurrentVertex(t, e, r, n, i) {
          var s = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : !1;
          var a = e.y * n - e.x,
              o = -e.y - e.x * n;
          this.addHalfVertex(t, e.x + e.y * r, e.y - e.x * r, s, !1, r, i), this.addHalfVertex(t, a, o, s, !0, -n, i);
        }
      }, {
        key: "addHalfVertex",
        value: function addHalfVertex(_ref148, r, n, i, s, a, o) {
          var t = _ref148.x,
              e = _ref148.y;
          this.layoutVertexArray.emplaceBack((t << 1) + (i ? 1 : 0), (e << 1) + (s ? 1 : 0), Math.round(63 * r) + 128, Math.round(63 * n) + 128, 1 + (0 === a ? 0 : a < 0 ? -1 : 1), 0, this.lineSoFar), this.lineClips && this.layoutVertexArray2.emplaceBack(this.scaledDistance, this.lineClipsArray.length, this.lineSoFar);
          var l = o.vertexLength++;
          this.e1 >= 0 && this.e2 >= 0 && (this.indexArray.emplaceBack(this.e1, this.e2, l), o.primitiveLength++), s ? this.e2 = l : this.e1 = l;
        }
      }, {
        key: "updateScaledDistance",
        value: function updateScaledDistance() {
          if (this.lineClips) {
            var _t105 = this.totalDistance / (this.lineClips.end - this.lineClips.start);

            this.scaledDistance = this.distance / this.totalDistance, this.lineSoFar = _t105 * this.lineClips.start + this.distance;
          } else this.lineSoFar = this.distance;
        }
      }, {
        key: "updateDistance",
        value: function updateDistance(t, e) {
          this.distance += t.dist(e), this.updateScaledDistance();
        }
      }]);

      return Ku;
    }();

    Zi("LineBucket", Ku, {
      omit: ["layers", "patternFeatures"]
    });
    var Yu = new sa({
      "line-cap": new ea(ve.layout_line["line-cap"]),
      "line-join": new ea(ve.layout_line["line-join"]),
      "line-miter-limit": new ta(ve.layout_line["line-miter-limit"]),
      "line-round-limit": new ta(ve.layout_line["line-round-limit"]),
      "line-sort-key": new ea(ve.layout_line["line-sort-key"])
    });
    var Hu = {
      paint: new sa({
        "line-opacity": new ea(ve.paint_line["line-opacity"]),
        "line-color": new ea(ve.paint_line["line-color"]),
        "line-translate": new ta(ve.paint_line["line-translate"]),
        "line-translate-anchor": new ta(ve.paint_line["line-translate-anchor"]),
        "line-width": new ea(ve.paint_line["line-width"]),
        "line-gap-width": new ea(ve.paint_line["line-gap-width"]),
        "line-offset": new ea(ve.paint_line["line-offset"]),
        "line-blur": new ea(ve.paint_line["line-blur"]),
        "line-dasharray": new ra(ve.paint_line["line-dasharray"]),
        "line-pattern": new ra(ve.paint_line["line-pattern"]),
        "line-gradient": new ia(ve.paint_line["line-gradient"])
      }),
      layout: Yu
    };
    var Ju = new ( /*#__PURE__*/function (_ea2) {
      _inherits(_class4, _ea2);

      var _super48 = _createSuper(_class4);

      function _class4() {
        _classCallCheck(this, _class4);

        return _super48.apply(this, arguments);
      }

      _createClass(_class4, [{
        key: "possiblyEvaluate",
        value: function possiblyEvaluate(t, e) {
          return e = new Gs(Math.floor(e.zoom), {
            now: e.now,
            fadeDuration: e.fadeDuration,
            zoomHistory: e.zoomHistory,
            transition: e.transition
          }), _get(_getPrototypeOf(_class4.prototype), "possiblyEvaluate", this).call(this, t, e);
        }
      }, {
        key: "evaluate",
        value: function evaluate(t, e, r, n) {
          return e = tt({}, e, {
            zoom: Math.floor(e.zoom)
          }), _get(_getPrototypeOf(_class4.prototype), "evaluate", this).call(this, t, e, r, n);
        }
      }]);

      return _class4;
    }(ea))(Hu.paint.properties["line-width"].specification);

    function Wu(t, e) {
      return e > 0 ? e + 2 * t : t;
    }

    Ju.useIntegerZoom = !0;
    var Qu = ca([{
      name: "a_pos_offset",
      components: 4,
      type: "Int16"
    }, {
      name: "a_tex_size",
      components: 4,
      type: "Uint16"
    }, {
      name: "a_pixeloffset",
      components: 4,
      type: "Int16"
    }, {
      name: "a_z_tile_anchor",
      components: 4,
      type: "Int16"
    }], 4),
        tc = ca([{
      name: "a_projected_pos",
      components: 3,
      type: "Float32"
    }], 4);
    ca([{
      name: "a_fade_opacity",
      components: 1,
      type: "Uint32"
    }], 4);
    var ec = ca([{
      name: "a_placed",
      components: 2,
      type: "Uint8"
    }, {
      name: "a_shift",
      components: 2,
      type: "Float32"
    }]),
        rc = ca([{
      name: "a_size_scale",
      components: 1,
      type: "Float32"
    }, {
      name: "a_padding",
      components: 2,
      type: "Float32"
    }]);
    ca([{
      type: "Int16",
      name: "projectedAnchorX"
    }, {
      type: "Int16",
      name: "projectedAnchorY"
    }, {
      type: "Int16",
      name: "projectedAnchorZ"
    }, {
      type: "Int16",
      name: "tileAnchorX"
    }, {
      type: "Int16",
      name: "tileAnchorY"
    }, {
      type: "Float32",
      name: "x1"
    }, {
      type: "Float32",
      name: "y1"
    }, {
      type: "Float32",
      name: "x2"
    }, {
      type: "Float32",
      name: "y2"
    }, {
      type: "Int16",
      name: "padding"
    }, {
      type: "Uint32",
      name: "featureIndex"
    }, {
      type: "Uint16",
      name: "sourceLayerIndex"
    }, {
      type: "Uint16",
      name: "bucketIndex"
    }]);
    var nc = ca([{
      name: "a_pos",
      components: 3,
      type: "Int16"
    }, {
      name: "a_anchor_pos",
      components: 2,
      type: "Int16"
    }, {
      name: "a_extrude",
      components: 2,
      type: "Int16"
    }], 4),
        ic = ca([{
      name: "a_pos_2f",
      components: 2,
      type: "Float32"
    }, {
      name: "a_radius",
      components: 1,
      type: "Float32"
    }, {
      name: "a_flags",
      components: 2,
      type: "Int16"
    }], 4);
    ca([{
      name: "triangle",
      components: 3,
      type: "Uint16"
    }]), ca([{
      type: "Int16",
      name: "projectedAnchorX"
    }, {
      type: "Int16",
      name: "projectedAnchorY"
    }, {
      type: "Int16",
      name: "projectedAnchorZ"
    }, {
      type: "Float32",
      name: "tileAnchorX"
    }, {
      type: "Float32",
      name: "tileAnchorY"
    }, {
      type: "Uint16",
      name: "glyphStartIndex"
    }, {
      type: "Uint16",
      name: "numGlyphs"
    }, {
      type: "Uint32",
      name: "vertexStartIndex"
    }, {
      type: "Uint32",
      name: "lineStartIndex"
    }, {
      type: "Uint32",
      name: "lineLength"
    }, {
      type: "Uint16",
      name: "segment"
    }, {
      type: "Uint16",
      name: "lowerSize"
    }, {
      type: "Uint16",
      name: "upperSize"
    }, {
      type: "Float32",
      name: "lineOffsetX"
    }, {
      type: "Float32",
      name: "lineOffsetY"
    }, {
      type: "Uint8",
      name: "writingMode"
    }, {
      type: "Uint8",
      name: "placedOrientation"
    }, {
      type: "Uint8",
      name: "hidden"
    }, {
      type: "Uint32",
      name: "crossTileID"
    }, {
      type: "Int16",
      name: "associatedIconIndex"
    }, {
      type: "Uint8",
      name: "flipState"
    }]), ca([{
      type: "Int16",
      name: "projectedAnchorX"
    }, {
      type: "Int16",
      name: "projectedAnchorY"
    }, {
      type: "Int16",
      name: "projectedAnchorZ"
    }, {
      type: "Float32",
      name: "tileAnchorX"
    }, {
      type: "Float32",
      name: "tileAnchorY"
    }, {
      type: "Int16",
      name: "rightJustifiedTextSymbolIndex"
    }, {
      type: "Int16",
      name: "centerJustifiedTextSymbolIndex"
    }, {
      type: "Int16",
      name: "leftJustifiedTextSymbolIndex"
    }, {
      type: "Int16",
      name: "verticalPlacedTextSymbolIndex"
    }, {
      type: "Int16",
      name: "placedIconSymbolIndex"
    }, {
      type: "Int16",
      name: "verticalPlacedIconSymbolIndex"
    }, {
      type: "Uint16",
      name: "key"
    }, {
      type: "Uint16",
      name: "textBoxStartIndex"
    }, {
      type: "Uint16",
      name: "textBoxEndIndex"
    }, {
      type: "Uint16",
      name: "verticalTextBoxStartIndex"
    }, {
      type: "Uint16",
      name: "verticalTextBoxEndIndex"
    }, {
      type: "Uint16",
      name: "iconBoxStartIndex"
    }, {
      type: "Uint16",
      name: "iconBoxEndIndex"
    }, {
      type: "Uint16",
      name: "verticalIconBoxStartIndex"
    }, {
      type: "Uint16",
      name: "verticalIconBoxEndIndex"
    }, {
      type: "Uint16",
      name: "featureIndex"
    }, {
      type: "Uint16",
      name: "numHorizontalGlyphVertices"
    }, {
      type: "Uint16",
      name: "numVerticalGlyphVertices"
    }, {
      type: "Uint16",
      name: "numIconVertices"
    }, {
      type: "Uint16",
      name: "numVerticalIconVertices"
    }, {
      type: "Uint16",
      name: "useRuntimeCollisionCircles"
    }, {
      type: "Uint32",
      name: "crossTileID"
    }, {
      type: "Float32",
      components: 2,
      name: "textOffset"
    }, {
      type: "Float32",
      name: "collisionCircleDiameter"
    }]), ca([{
      type: "Float32",
      name: "offsetX"
    }]), ca([{
      type: "Int16",
      name: "x"
    }, {
      type: "Int16",
      name: "y"
    }, {
      type: "Int16",
      name: "tileUnitDistanceFromAnchor"
    }]);
    var sc = 24;
    var ac = 128;

    function oc(t, e) {
      var r = e.expression;
      if ("constant" === r.kind) return {
        kind: "constant",
        layoutSize: r.evaluate(new Gs(t + 1))
      };
      if ("source" === r.kind) return {
        kind: "source"
      };
      {
        var _e108 = r.zoomStops,
            _n69 = r.interpolationType;
        var _i77 = 0;

        for (; _i77 < _e108.length && _e108[_i77] <= t;) {
          _i77++;
        }

        _i77 = Math.max(0, _i77 - 1);
        var _s50 = _i77;

        for (; _s50 < _e108.length && _e108[_s50] < t + 1;) {
          _s50++;
        }

        _s50 = Math.min(_e108.length - 1, _s50);
        var _a45 = _e108[_i77],
            _o22 = _e108[_s50];
        return "composite" === r.kind ? {
          kind: "composite",
          minZoom: _a45,
          maxZoom: _o22,
          interpolationType: _n69
        } : {
          kind: "camera",
          minZoom: _a45,
          maxZoom: _o22,
          minSize: r.evaluate(new Gs(_a45)),
          maxSize: r.evaluate(new Gs(_o22)),
          interpolationType: _n69
        };
      }
    }

    function lc(t, _ref149, _ref150) {
      var e = _ref149.uSize,
          r = _ref149.uSizeT;
      var n = _ref150.lowerSize,
          i = _ref150.upperSize;
      return "source" === t.kind ? n / ac : "composite" === t.kind ? Lr(n / ac, i / ac, r) : e;
    }

    function uc(t, e) {
      var r = 0,
          n = 0;
      if ("constant" === t.kind) n = t.layoutSize;else if ("source" !== t.kind) {
        var _i78 = t.interpolationType,
            _s51 = t.minZoom,
            _a46 = t.maxZoom,
            _o23 = _i78 ? Y(rn.interpolationFactor(_i78, e, _s51, _a46), 0, 1) : 0;

        "camera" === t.kind ? n = Lr(t.minSize, t.maxSize, _o23) : r = _o23;
      }
      return {
        uSizeT: r,
        uSize: n
      };
    }

    var cc = Object.freeze({
      __proto__: null,
      getSizeData: oc,
      evaluateSizeForFeature: lc,
      evaluateSizeForZoom: uc,
      SIZE_PACK_FACTOR: ac
    });

    function hc(t, e, r) {
      return t.sections.forEach(function (t) {
        t.text = function (t, e, r) {
          var n = e.layout.get("text-transform").evaluate(r, {});
          return "uppercase" === n ? t = t.toLocaleUpperCase() : "lowercase" === n && (t = t.toLocaleLowerCase()), Ns.applyArabicShaping && (t = Ns.applyArabicShaping(t)), t;
        }(t.text, e, r);
      }), t;
    }

    var pc = {
      "!": "︕",
      "#": "＃",
      $: "＄",
      "%": "％",
      "&": "＆",
      "(": "︵",
      ")": "︶",
      "*": "＊",
      "+": "＋",
      ",": "︐",
      "-": "︲",
      ".": "・",
      "/": "／",
      ":": "︓",
      ";": "︔",
      "<": "︿",
      "=": "＝",
      ">": "﹀",
      "?": "︖",
      "@": "＠",
      "[": "﹇",
      "\\": "＼",
      "]": "﹈",
      "^": "＾",
      _: "︳",
      "`": "｀",
      "{": "︷",
      "|": "―",
      "}": "︸",
      "~": "～",
      "¢": "￠",
      "£": "￡",
      "¥": "￥",
      "¦": "￤",
      "¬": "￢",
      "¯": "￣",
      "–": "︲",
      "—": "︱",
      "‘": "﹃",
      "’": "﹄",
      "“": "﹁",
      "”": "﹂",
      "…": "︙",
      "‧": "・",
      "₩": "￦",
      "、": "︑",
      "。": "︒",
      "〈": "︿",
      "〉": "﹀",
      "《": "︽",
      "》": "︾",
      "「": "﹁",
      "」": "﹂",
      "『": "﹃",
      "』": "﹄",
      "【": "︻",
      "】": "︼",
      "〔": "︹",
      "〕": "︺",
      "〖": "︗",
      "〗": "︘",
      "！": "︕",
      "（": "︵",
      "）": "︶",
      "，": "︐",
      "－": "︲",
      "．": "・",
      "：": "︓",
      "；": "︔",
      "＜": "︿",
      "＞": "﹀",
      "？": "︖",
      "［": "﹇",
      "］": "﹈",
      "＿": "︳",
      "｛": "︷",
      "｜": "―",
      "｝": "︸",
      "｟": "︵",
      "｠": "︶",
      "｡": "︒",
      "｢": "﹁",
      "｣": "﹂"
    };

    function dc(t) {
      return "︶" === t || "﹈" === t || "︸" === t || "﹄" === t || "﹂" === t || "︾" === t || "︼" === t || "︺" === t || "︘" === t || "﹀" === t || "︐" === t || "︓" === t || "︔" === t || "｀" === t || "￣" === t || "︑" === t || "︒" === t;
    }

    function fc(t) {
      return "︵" === t || "﹇" === t || "︷" === t || "﹃" === t || "﹁" === t || "︽" === t || "︻" === t || "︹" === t || "︗" === t || "︿" === t;
    }

    var yc = function yc(t, e, r, n, i) {
      var s,
          a,
          o = 8 * i - n - 1,
          l = (1 << o) - 1,
          u = l >> 1,
          c = -7,
          h = r ? i - 1 : 0,
          p = r ? -1 : 1,
          d = t[e + h];

      for (h += p, s = d & (1 << -c) - 1, d >>= -c, c += o; c > 0; s = 256 * s + t[e + h], h += p, c -= 8) {
        ;
      }

      for (a = s & (1 << -c) - 1, s >>= -c, c += n; c > 0; a = 256 * a + t[e + h], h += p, c -= 8) {
        ;
      }

      if (0 === s) s = 1 - u;else {
        if (s === l) return a ? NaN : 1 / 0 * (d ? -1 : 1);
        a += Math.pow(2, n), s -= u;
      }
      return (d ? -1 : 1) * a * Math.pow(2, s - n);
    },
        mc = function mc(t, e, r, n, i, s) {
      var a,
          o,
          l,
          u = 8 * s - i - 1,
          c = (1 << u) - 1,
          h = c >> 1,
          p = 23 === i ? Math.pow(2, -24) - Math.pow(2, -77) : 0,
          d = n ? 0 : s - 1,
          f = n ? 1 : -1,
          y = e < 0 || 0 === e && 1 / e < 0 ? 1 : 0;

      for (e = Math.abs(e), isNaN(e) || e === 1 / 0 ? (o = isNaN(e) ? 1 : 0, a = c) : (a = Math.floor(Math.log(e) / Math.LN2), e * (l = Math.pow(2, -a)) < 1 && (a--, l *= 2), (e += a + h >= 1 ? p / l : p * Math.pow(2, 1 - h)) * l >= 2 && (a++, l /= 2), a + h >= c ? (o = 0, a = c) : a + h >= 1 ? (o = (e * l - 1) * Math.pow(2, i), a += h) : (o = e * Math.pow(2, h - 1) * Math.pow(2, i), a = 0)); i >= 8; t[r + d] = 255 & o, d += f, o /= 256, i -= 8) {
        ;
      }

      for (a = a << i | o, u += i; u > 0; t[r + d] = 255 & a, d += f, a /= 256, u -= 8) {
        ;
      }

      t[r + d - f] |= 128 * y;
    },
        gc = xc;

    function xc(t) {
      this.buf = ArrayBuffer.isView && ArrayBuffer.isView(t) ? t : new Uint8Array(t || 0), this.pos = 0, this.type = 0, this.length = this.buf.length;
    }

    xc.Varint = 0, xc.Fixed64 = 1, xc.Bytes = 2, xc.Fixed32 = 5;
    var vc = 4294967296,
        bc = 1 / vc,
        wc = "undefined" == typeof TextDecoder ? null : new TextDecoder("utf8");

    function _c(t) {
      return t.type === xc.Bytes ? t.readVarint() + t.pos : t.pos + 1;
    }

    function Ac(t, e, r) {
      return r ? 4294967296 * e + (t >>> 0) : 4294967296 * (e >>> 0) + (t >>> 0);
    }

    function kc(t, e, r) {
      var n = e <= 16383 ? 1 : e <= 2097151 ? 2 : e <= 268435455 ? 3 : Math.floor(Math.log(e) / (7 * Math.LN2));
      r.realloc(n);

      for (var i = r.pos - 1; i >= t; i--) {
        r.buf[i + n] = r.buf[i];
      }
    }

    function Sc(t, e) {
      for (var r = 0; r < t.length; r++) {
        e.writeVarint(t[r]);
      }
    }

    function Ic(t, e) {
      for (var r = 0; r < t.length; r++) {
        e.writeSVarint(t[r]);
      }
    }

    function zc(t, e) {
      for (var r = 0; r < t.length; r++) {
        e.writeFloat(t[r]);
      }
    }

    function Mc(t, e) {
      for (var r = 0; r < t.length; r++) {
        e.writeDouble(t[r]);
      }
    }

    function Tc(t, e) {
      for (var r = 0; r < t.length; r++) {
        e.writeBoolean(t[r]);
      }
    }

    function Bc(t, e) {
      for (var r = 0; r < t.length; r++) {
        e.writeFixed32(t[r]);
      }
    }

    function Cc(t, e) {
      for (var r = 0; r < t.length; r++) {
        e.writeSFixed32(t[r]);
      }
    }

    function Pc(t, e) {
      for (var r = 0; r < t.length; r++) {
        e.writeFixed64(t[r]);
      }
    }

    function Ec(t, e) {
      for (var r = 0; r < t.length; r++) {
        e.writeSFixed64(t[r]);
      }
    }

    function Dc(t, e) {
      return (t[e] | t[e + 1] << 8 | t[e + 2] << 16) + 16777216 * t[e + 3];
    }

    function Vc(t, e, r) {
      t[r] = e, t[r + 1] = e >>> 8, t[r + 2] = e >>> 16, t[r + 3] = e >>> 24;
    }

    function Fc(t, e) {
      return (t[e] | t[e + 1] << 8 | t[e + 2] << 16) + (t[e + 3] << 24);
    }

    function Lc(t, e, r) {
      e.glyphs = [], 1 === t && r.readMessage(Rc, e);
    }

    function Rc(t, e, r) {
      if (3 === t) {
        var _r$readMessage = r.readMessage(Uc, {}),
            _t106 = _r$readMessage.id,
            _n70 = _r$readMessage.bitmap,
            _i79 = _r$readMessage.width,
            _s52 = _r$readMessage.height,
            _a47 = _r$readMessage.left,
            _o24 = _r$readMessage.top,
            _l23 = _r$readMessage.advance;

        e.glyphs.push({
          id: _t106,
          bitmap: new zl({
            width: _i79 + 6,
            height: _s52 + 6
          }, _n70),
          metrics: {
            width: _i79,
            height: _s52,
            left: _a47,
            top: _o24,
            advance: _l23
          }
        });
      } else 4 === t ? e.ascender = r.readSVarint() : 5 === t && (e.descender = r.readSVarint());
    }

    function Uc(t, e, r) {
      1 === t ? e.id = r.readVarint() : 2 === t ? e.bitmap = r.readBytes() : 3 === t ? e.width = r.readVarint() : 4 === t ? e.height = r.readVarint() : 5 === t ? e.left = r.readSVarint() : 6 === t ? e.top = r.readSVarint() : 7 === t && (e.advance = r.readVarint());
    }

    function $c(t) {
      var e = 0,
          r = 0;

      var _iterator85 = _createForOfIteratorHelper(t),
          _step85;

      try {
        for (_iterator85.s(); !(_step85 = _iterator85.n()).done;) {
          var _n71 = _step85.value;
          e += _n71.w * _n71.h, r = Math.max(r, _n71.w);
        }
      } catch (err) {
        _iterator85.e(err);
      } finally {
        _iterator85.f();
      }

      t.sort(function (t, e) {
        return e.h - t.h;
      });
      var n = [{
        x: 0,
        y: 0,
        w: Math.max(Math.ceil(Math.sqrt(e / .95)), r),
        h: 1 / 0
      }];
      var i = 0,
          s = 0;

      var _iterator86 = _createForOfIteratorHelper(t),
          _step86;

      try {
        for (_iterator86.s(); !(_step86 = _iterator86.n()).done;) {
          var _e109 = _step86.value;

          for (var _t107 = n.length - 1; _t107 >= 0; _t107--) {
            var _r110 = n[_t107];

            if (!(_e109.w > _r110.w || _e109.h > _r110.h)) {
              if (_e109.x = _r110.x, _e109.y = _r110.y, s = Math.max(s, _e109.y + _e109.h), i = Math.max(i, _e109.x + _e109.w), _e109.w === _r110.w && _e109.h === _r110.h) {
                var _e110 = n.pop();

                _t107 < n.length && (n[_t107] = _e110);
              } else _e109.h === _r110.h ? (_r110.x += _e109.w, _r110.w -= _e109.w) : _e109.w === _r110.w ? (_r110.y += _e109.h, _r110.h -= _e109.h) : (n.push({
                x: _r110.x + _e109.w,
                y: _r110.y,
                w: _r110.w - _e109.w,
                h: _e109.h
              }), _r110.y += _e109.h, _r110.h -= _e109.h);

              break;
            }
          }
        }
      } catch (err) {
        _iterator86.e(err);
      } finally {
        _iterator86.f();
      }

      return {
        w: i,
        h: s,
        fill: e / (i * s) || 0
      };
    }

    xc.prototype = {
      destroy: function destroy() {
        this.buf = null;
      },
      readFields: function readFields(t, e, r) {
        for (r = r || this.length; this.pos < r;) {
          var n = this.readVarint(),
              i = n >> 3,
              s = this.pos;
          this.type = 7 & n, t(i, e, this), this.pos === s && this.skip(n);
        }

        return e;
      },
      readMessage: function readMessage(t, e) {
        return this.readFields(t, e, this.readVarint() + this.pos);
      },
      readFixed32: function readFixed32() {
        var t = Dc(this.buf, this.pos);
        return this.pos += 4, t;
      },
      readSFixed32: function readSFixed32() {
        var t = Fc(this.buf, this.pos);
        return this.pos += 4, t;
      },
      readFixed64: function readFixed64() {
        var t = Dc(this.buf, this.pos) + Dc(this.buf, this.pos + 4) * vc;
        return this.pos += 8, t;
      },
      readSFixed64: function readSFixed64() {
        var t = Dc(this.buf, this.pos) + Fc(this.buf, this.pos + 4) * vc;
        return this.pos += 8, t;
      },
      readFloat: function readFloat() {
        var t = yc(this.buf, this.pos, !0, 23, 4);
        return this.pos += 4, t;
      },
      readDouble: function readDouble() {
        var t = yc(this.buf, this.pos, !0, 52, 8);
        return this.pos += 8, t;
      },
      readVarint: function readVarint(t) {
        var e,
            r,
            n = this.buf;
        return e = 127 & (r = n[this.pos++]), r < 128 ? e : (e |= (127 & (r = n[this.pos++])) << 7, r < 128 ? e : (e |= (127 & (r = n[this.pos++])) << 14, r < 128 ? e : (e |= (127 & (r = n[this.pos++])) << 21, r < 128 ? e : function (t, e, r) {
          var n,
              i,
              s = r.buf;
          if (n = (112 & (i = s[r.pos++])) >> 4, i < 128) return Ac(t, n, e);
          if (n |= (127 & (i = s[r.pos++])) << 3, i < 128) return Ac(t, n, e);
          if (n |= (127 & (i = s[r.pos++])) << 10, i < 128) return Ac(t, n, e);
          if (n |= (127 & (i = s[r.pos++])) << 17, i < 128) return Ac(t, n, e);
          if (n |= (127 & (i = s[r.pos++])) << 24, i < 128) return Ac(t, n, e);
          if (n |= (1 & (i = s[r.pos++])) << 31, i < 128) return Ac(t, n, e);
          throw new Error("Expected varint not more than 10 bytes");
        }(e |= (15 & (r = n[this.pos])) << 28, t, this))));
      },
      readVarint64: function readVarint64() {
        return this.readVarint(!0);
      },
      readSVarint: function readSVarint() {
        var t = this.readVarint();
        return t % 2 == 1 ? (t + 1) / -2 : t / 2;
      },
      readBoolean: function readBoolean() {
        return Boolean(this.readVarint());
      },
      readString: function readString() {
        var t = this.readVarint() + this.pos,
            e = this.pos;
        return this.pos = t, t - e >= 12 && wc ? function (t, e, r) {
          return wc.decode(t.subarray(e, r));
        }(this.buf, e, t) : function (t, e, r) {
          for (var n = "", i = e; i < r;) {
            var s,
                a,
                o,
                l = t[i],
                u = null,
                c = l > 239 ? 4 : l > 223 ? 3 : l > 191 ? 2 : 1;
            if (i + c > r) break;
            1 === c ? l < 128 && (u = l) : 2 === c ? 128 == (192 & (s = t[i + 1])) && (u = (31 & l) << 6 | 63 & s) <= 127 && (u = null) : 3 === c ? (a = t[i + 2], 128 == (192 & (s = t[i + 1])) && 128 == (192 & a) && ((u = (15 & l) << 12 | (63 & s) << 6 | 63 & a) <= 2047 || u >= 55296 && u <= 57343) && (u = null)) : 4 === c && (a = t[i + 2], o = t[i + 3], 128 == (192 & (s = t[i + 1])) && 128 == (192 & a) && 128 == (192 & o) && ((u = (15 & l) << 18 | (63 & s) << 12 | (63 & a) << 6 | 63 & o) <= 65535 || u >= 1114112) && (u = null)), null === u ? (u = 65533, c = 1) : u > 65535 && (u -= 65536, n += String.fromCharCode(u >>> 10 & 1023 | 55296), u = 56320 | 1023 & u), n += String.fromCharCode(u), i += c;
          }

          return n;
        }(this.buf, e, t);
      },
      readBytes: function readBytes() {
        var t = this.readVarint() + this.pos,
            e = this.buf.subarray(this.pos, t);
        return this.pos = t, e;
      },
      readPackedVarint: function readPackedVarint(t, e) {
        if (this.type !== xc.Bytes) return t.push(this.readVarint(e));

        var r = _c(this);

        for (t = t || []; this.pos < r;) {
          t.push(this.readVarint(e));
        }

        return t;
      },
      readPackedSVarint: function readPackedSVarint(t) {
        if (this.type !== xc.Bytes) return t.push(this.readSVarint());

        var e = _c(this);

        for (t = t || []; this.pos < e;) {
          t.push(this.readSVarint());
        }

        return t;
      },
      readPackedBoolean: function readPackedBoolean(t) {
        if (this.type !== xc.Bytes) return t.push(this.readBoolean());

        var e = _c(this);

        for (t = t || []; this.pos < e;) {
          t.push(this.readBoolean());
        }

        return t;
      },
      readPackedFloat: function readPackedFloat(t) {
        if (this.type !== xc.Bytes) return t.push(this.readFloat());

        var e = _c(this);

        for (t = t || []; this.pos < e;) {
          t.push(this.readFloat());
        }

        return t;
      },
      readPackedDouble: function readPackedDouble(t) {
        if (this.type !== xc.Bytes) return t.push(this.readDouble());

        var e = _c(this);

        for (t = t || []; this.pos < e;) {
          t.push(this.readDouble());
        }

        return t;
      },
      readPackedFixed32: function readPackedFixed32(t) {
        if (this.type !== xc.Bytes) return t.push(this.readFixed32());

        var e = _c(this);

        for (t = t || []; this.pos < e;) {
          t.push(this.readFixed32());
        }

        return t;
      },
      readPackedSFixed32: function readPackedSFixed32(t) {
        if (this.type !== xc.Bytes) return t.push(this.readSFixed32());

        var e = _c(this);

        for (t = t || []; this.pos < e;) {
          t.push(this.readSFixed32());
        }

        return t;
      },
      readPackedFixed64: function readPackedFixed64(t) {
        if (this.type !== xc.Bytes) return t.push(this.readFixed64());

        var e = _c(this);

        for (t = t || []; this.pos < e;) {
          t.push(this.readFixed64());
        }

        return t;
      },
      readPackedSFixed64: function readPackedSFixed64(t) {
        if (this.type !== xc.Bytes) return t.push(this.readSFixed64());

        var e = _c(this);

        for (t = t || []; this.pos < e;) {
          t.push(this.readSFixed64());
        }

        return t;
      },
      skip: function skip(t) {
        var e = 7 & t;
        if (e === xc.Varint) for (; this.buf[this.pos++] > 127;) {
          ;
        } else if (e === xc.Bytes) this.pos = this.readVarint() + this.pos;else if (e === xc.Fixed32) this.pos += 4;else {
          if (e !== xc.Fixed64) throw new Error("Unimplemented type: " + e);
          this.pos += 8;
        }
      },
      writeTag: function writeTag(t, e) {
        this.writeVarint(t << 3 | e);
      },
      realloc: function realloc(t) {
        for (var e = this.length || 16; e < this.pos + t;) {
          e *= 2;
        }

        if (e !== this.length) {
          var r = new Uint8Array(e);
          r.set(this.buf), this.buf = r, this.length = e;
        }
      },
      finish: function finish() {
        return this.length = this.pos, this.pos = 0, this.buf.subarray(0, this.length);
      },
      writeFixed32: function writeFixed32(t) {
        this.realloc(4), Vc(this.buf, t, this.pos), this.pos += 4;
      },
      writeSFixed32: function writeSFixed32(t) {
        this.realloc(4), Vc(this.buf, t, this.pos), this.pos += 4;
      },
      writeFixed64: function writeFixed64(t) {
        this.realloc(8), Vc(this.buf, -1 & t, this.pos), Vc(this.buf, Math.floor(t * bc), this.pos + 4), this.pos += 8;
      },
      writeSFixed64: function writeSFixed64(t) {
        this.realloc(8), Vc(this.buf, -1 & t, this.pos), Vc(this.buf, Math.floor(t * bc), this.pos + 4), this.pos += 8;
      },
      writeVarint: function writeVarint(t) {
        (t = +t || 0) > 268435455 || t < 0 ? function (t, e) {
          var r, n;
          if (t >= 0 ? (r = t % 4294967296 | 0, n = t / 4294967296 | 0) : (n = ~(-t / 4294967296), 4294967295 ^ (r = ~(-t % 4294967296)) ? r = r + 1 | 0 : (r = 0, n = n + 1 | 0)), t >= 0x10000000000000000 || t < -0x10000000000000000) throw new Error("Given varint doesn't fit into 10 bytes");
          e.realloc(10), function (t, e, r) {
            r.buf[r.pos++] = 127 & t | 128, t >>>= 7, r.buf[r.pos++] = 127 & t | 128, t >>>= 7, r.buf[r.pos++] = 127 & t | 128, t >>>= 7, r.buf[r.pos++] = 127 & t | 128, r.buf[r.pos] = 127 & (t >>>= 7);
          }(r, 0, e), function (t, e) {
            var r = (7 & t) << 4;
            e.buf[e.pos++] |= r | ((t >>>= 3) ? 128 : 0), t && (e.buf[e.pos++] = 127 & t | ((t >>>= 7) ? 128 : 0), t && (e.buf[e.pos++] = 127 & t | ((t >>>= 7) ? 128 : 0), t && (e.buf[e.pos++] = 127 & t | ((t >>>= 7) ? 128 : 0), t && (e.buf[e.pos++] = 127 & t | ((t >>>= 7) ? 128 : 0), t && (e.buf[e.pos++] = 127 & t)))));
          }(n, e);
        }(t, this) : (this.realloc(4), this.buf[this.pos++] = 127 & t | (t > 127 ? 128 : 0), t <= 127 || (this.buf[this.pos++] = 127 & (t >>>= 7) | (t > 127 ? 128 : 0), t <= 127 || (this.buf[this.pos++] = 127 & (t >>>= 7) | (t > 127 ? 128 : 0), t <= 127 || (this.buf[this.pos++] = t >>> 7 & 127))));
      },
      writeSVarint: function writeSVarint(t) {
        this.writeVarint(t < 0 ? 2 * -t - 1 : 2 * t);
      },
      writeBoolean: function writeBoolean(t) {
        this.writeVarint(Boolean(t));
      },
      writeString: function writeString(t) {
        t = String(t), this.realloc(4 * t.length), this.pos++;
        var e = this.pos;

        this.pos = function (t, e, r) {
          for (var n, i, s = 0; s < e.length; s++) {
            if ((n = e.charCodeAt(s)) > 55295 && n < 57344) {
              if (!i) {
                n > 56319 || s + 1 === e.length ? (t[r++] = 239, t[r++] = 191, t[r++] = 189) : i = n;
                continue;
              }

              if (n < 56320) {
                t[r++] = 239, t[r++] = 191, t[r++] = 189, i = n;
                continue;
              }

              n = i - 55296 << 10 | n - 56320 | 65536, i = null;
            } else i && (t[r++] = 239, t[r++] = 191, t[r++] = 189, i = null);

            n < 128 ? t[r++] = n : (n < 2048 ? t[r++] = n >> 6 | 192 : (n < 65536 ? t[r++] = n >> 12 | 224 : (t[r++] = n >> 18 | 240, t[r++] = n >> 12 & 63 | 128), t[r++] = n >> 6 & 63 | 128), t[r++] = 63 & n | 128);
          }

          return r;
        }(this.buf, t, this.pos);

        var r = this.pos - e;
        r >= 128 && kc(e, r, this), this.pos = e - 1, this.writeVarint(r), this.pos += r;
      },
      writeFloat: function writeFloat(t) {
        this.realloc(4), mc(this.buf, t, this.pos, !0, 23, 4), this.pos += 4;
      },
      writeDouble: function writeDouble(t) {
        this.realloc(8), mc(this.buf, t, this.pos, !0, 52, 8), this.pos += 8;
      },
      writeBytes: function writeBytes(t) {
        var e = t.length;
        this.writeVarint(e), this.realloc(e);

        for (var r = 0; r < e; r++) {
          this.buf[this.pos++] = t[r];
        }
      },
      writeRawMessage: function writeRawMessage(t, e) {
        this.pos++;
        var r = this.pos;
        t(e, this);
        var n = this.pos - r;
        n >= 128 && kc(r, n, this), this.pos = r - 1, this.writeVarint(n), this.pos += n;
      },
      writeMessage: function writeMessage(t, e, r) {
        this.writeTag(t, xc.Bytes), this.writeRawMessage(e, r);
      },
      writePackedVarint: function writePackedVarint(t, e) {
        e.length && this.writeMessage(t, Sc, e);
      },
      writePackedSVarint: function writePackedSVarint(t, e) {
        e.length && this.writeMessage(t, Ic, e);
      },
      writePackedBoolean: function writePackedBoolean(t, e) {
        e.length && this.writeMessage(t, Tc, e);
      },
      writePackedFloat: function writePackedFloat(t, e) {
        e.length && this.writeMessage(t, zc, e);
      },
      writePackedDouble: function writePackedDouble(t, e) {
        e.length && this.writeMessage(t, Mc, e);
      },
      writePackedFixed32: function writePackedFixed32(t, e) {
        e.length && this.writeMessage(t, Bc, e);
      },
      writePackedSFixed32: function writePackedSFixed32(t, e) {
        e.length && this.writeMessage(t, Cc, e);
      },
      writePackedFixed64: function writePackedFixed64(t, e) {
        e.length && this.writeMessage(t, Pc, e);
      },
      writePackedSFixed64: function writePackedSFixed64(t, e) {
        e.length && this.writeMessage(t, Ec, e);
      },
      writeBytesField: function writeBytesField(t, e) {
        this.writeTag(t, xc.Bytes), this.writeBytes(e);
      },
      writeFixed32Field: function writeFixed32Field(t, e) {
        this.writeTag(t, xc.Fixed32), this.writeFixed32(e);
      },
      writeSFixed32Field: function writeSFixed32Field(t, e) {
        this.writeTag(t, xc.Fixed32), this.writeSFixed32(e);
      },
      writeFixed64Field: function writeFixed64Field(t, e) {
        this.writeTag(t, xc.Fixed64), this.writeFixed64(e);
      },
      writeSFixed64Field: function writeSFixed64Field(t, e) {
        this.writeTag(t, xc.Fixed64), this.writeSFixed64(e);
      },
      writeVarintField: function writeVarintField(t, e) {
        this.writeTag(t, xc.Varint), this.writeVarint(e);
      },
      writeSVarintField: function writeSVarintField(t, e) {
        this.writeTag(t, xc.Varint), this.writeSVarint(e);
      },
      writeStringField: function writeStringField(t, e) {
        this.writeTag(t, xc.Bytes), this.writeString(e);
      },
      writeFloatField: function writeFloatField(t, e) {
        this.writeTag(t, xc.Fixed32), this.writeFloat(e);
      },
      writeDoubleField: function writeDoubleField(t, e) {
        this.writeTag(t, xc.Fixed64), this.writeDouble(e);
      },
      writeBooleanField: function writeBooleanField(t, e) {
        this.writeVarintField(t, Boolean(e));
      }
    };

    var Oc = /*#__PURE__*/function () {
      function Oc(t, _ref151) {
        var e = _ref151.pixelRatio,
            r = _ref151.version,
            n = _ref151.stretchX,
            i = _ref151.stretchY,
            s = _ref151.content;

        _classCallCheck(this, Oc);

        this.paddedRect = t, this.pixelRatio = e, this.stretchX = n, this.stretchY = i, this.content = s, this.version = r;
      }

      _createClass(Oc, [{
        key: "tl",
        get: function get() {
          return [this.paddedRect.x + 1, this.paddedRect.y + 1];
        }
      }, {
        key: "br",
        get: function get() {
          return [this.paddedRect.x + this.paddedRect.w - 1, this.paddedRect.y + this.paddedRect.h - 1];
        }
      }, {
        key: "displaySize",
        get: function get() {
          return [(this.paddedRect.w - 2) / this.pixelRatio, (this.paddedRect.h - 2) / this.pixelRatio];
        }
      }]);

      return Oc;
    }();

    var jc = /*#__PURE__*/function () {
      function jc(t, e) {
        _classCallCheck(this, jc);

        var r = {},
            n = {};
        this.haveRenderCallbacks = [];
        var i = [];
        this.addImages(t, r, i), this.addImages(e, n, i);

        var _$c = $c(i),
            s = _$c.w,
            a = _$c.h,
            o = new Ml({
          width: s || 1,
          height: a || 1
        });

        for (var _e111 in t) {
          var _n72 = t[_e111],
              _i80 = r[_e111].paddedRect;
          Ml.copy(_n72.data, o, {
            x: 0,
            y: 0
          }, {
            x: _i80.x + 1,
            y: _i80.y + 1
          }, _n72.data);
        }

        for (var _t108 in e) {
          var _r111 = e[_t108],
              _i81 = n[_t108].paddedRect,
              _s53 = _i81.x + 1,
              _a48 = _i81.y + 1,
              _l24 = _r111.data.width,
              _u22 = _r111.data.height;

          Ml.copy(_r111.data, o, {
            x: 0,
            y: 0
          }, {
            x: _s53,
            y: _a48
          }, _r111.data), Ml.copy(_r111.data, o, {
            x: 0,
            y: _u22 - 1
          }, {
            x: _s53,
            y: _a48 - 1
          }, {
            width: _l24,
            height: 1
          }), Ml.copy(_r111.data, o, {
            x: 0,
            y: 0
          }, {
            x: _s53,
            y: _a48 + _u22
          }, {
            width: _l24,
            height: 1
          }), Ml.copy(_r111.data, o, {
            x: _l24 - 1,
            y: 0
          }, {
            x: _s53 - 1,
            y: _a48
          }, {
            width: 1,
            height: _u22
          }), Ml.copy(_r111.data, o, {
            x: 0,
            y: 0
          }, {
            x: _s53 + _l24,
            y: _a48
          }, {
            width: 1,
            height: _u22
          });
        }

        this.image = o, this.iconPositions = r, this.patternPositions = n;
      }

      _createClass(jc, [{
        key: "addImages",
        value: function addImages(t, e, r) {
          for (var _n73 in t) {
            var _i82 = t[_n73],
                _s54 = {
              x: 0,
              y: 0,
              w: _i82.data.width + 2,
              h: _i82.data.height + 2
            };
            r.push(_s54), e[_n73] = new Oc(_s54, _i82), _i82.hasRenderCallback && this.haveRenderCallbacks.push(_n73);
          }
        }
      }, {
        key: "patchUpdatedImages",
        value: function patchUpdatedImages(t, e) {
          t.dispatchRenderCallbacks(this.haveRenderCallbacks);

          for (var _r112 in t.updatedImages) {
            this.patchUpdatedImage(this.iconPositions[_r112], t.getImage(_r112), e), this.patchUpdatedImage(this.patternPositions[_r112], t.getImage(_r112), e);
          }
        }
      }, {
        key: "patchUpdatedImage",
        value: function patchUpdatedImage(t, e, r) {
          if (!t || !e) return;
          if (t.version === e.version) return;
          t.version = e.version;

          var _t$tl = _slicedToArray(t.tl, 2),
              n = _t$tl[0],
              i = _t$tl[1];

          r.update(e.data, void 0, {
            x: n,
            y: i
          });
        }
      }]);

      return jc;
    }();

    Zi("ImagePosition", Oc), Zi("ImageAtlas", jc);
    var qc = {
      horizontal: 1,
      vertical: 2,
      horizontalOnly: 3
    };

    var Nc = /*#__PURE__*/function () {
      function Nc() {
        _classCallCheck(this, Nc);

        this.scale = 1, this.fontStack = "", this.imageName = null;
      }

      _createClass(Nc, null, [{
        key: "forText",
        value: function forText(t, e) {
          var r = new Nc();
          return r.scale = t || 1, r.fontStack = e, r;
        }
      }, {
        key: "forImage",
        value: function forImage(t) {
          var e = new Nc();
          return e.imageName = t, e;
        }
      }]);

      return Nc;
    }();

    var Gc = /*#__PURE__*/function () {
      function Gc() {
        _classCallCheck(this, Gc);

        this.text = "", this.sectionIndex = [], this.sections = [], this.imageSectionID = null;
      }

      _createClass(Gc, [{
        key: "length",
        value: function length() {
          return this.text.length;
        }
      }, {
        key: "getSection",
        value: function getSection(t) {
          return this.sections[this.sectionIndex[t]];
        }
      }, {
        key: "getSections",
        value: function getSections() {
          return this.sections;
        }
      }, {
        key: "getSectionIndex",
        value: function getSectionIndex(t) {
          return this.sectionIndex[t];
        }
      }, {
        key: "getCharCode",
        value: function getCharCode(t) {
          return this.text.charCodeAt(t);
        }
      }, {
        key: "verticalizePunctuation",
        value: function verticalizePunctuation(t) {
          this.text = function (t, e) {
            var r = "";

            for (var _n74 = 0; _n74 < t.length; _n74++) {
              var _i83 = t.charCodeAt(_n74 + 1) || null,
                  _s55 = t.charCodeAt(_n74 - 1) || null;

              r += !e && (_i83 && Ts(_i83) && !pc[t[_n74 + 1]] || _s55 && Ts(_s55) && !pc[t[_n74 - 1]]) || !pc[t[_n74]] ? t[_n74] : pc[t[_n74]];
            }

            return r;
          }(this.text, t);
        }
      }, {
        key: "trim",
        value: function trim() {
          var t = 0;

          for (var _e112 = 0; _e112 < this.text.length && Xc[this.text.charCodeAt(_e112)]; _e112++) {
            t++;
          }

          var e = this.text.length;

          for (var _r113 = this.text.length - 1; _r113 >= 0 && _r113 >= t && Xc[this.text.charCodeAt(_r113)]; _r113--) {
            e--;
          }

          this.text = this.text.substring(t, e), this.sectionIndex = this.sectionIndex.slice(t, e);
        }
      }, {
        key: "substring",
        value: function substring(t, e) {
          var r = new Gc();
          return r.text = this.text.substring(t, e), r.sectionIndex = this.sectionIndex.slice(t, e), r.sections = this.sections, r;
        }
      }, {
        key: "toString",
        value: function toString() {
          return this.text;
        }
      }, {
        key: "getMaxScale",
        value: function getMaxScale() {
          var _this19 = this;

          return this.sectionIndex.reduce(function (t, e) {
            return Math.max(t, _this19.sections[e].scale);
          }, 0);
        }
      }, {
        key: "addTextSection",
        value: function addTextSection(t, e) {
          this.text += t.text, this.sections.push(Nc.forText(t.scale, t.fontStack || e));
          var r = this.sections.length - 1;

          for (var _e113 = 0; _e113 < t.text.length; ++_e113) {
            this.sectionIndex.push(r);
          }
        }
      }, {
        key: "addImageSection",
        value: function addImageSection(t) {
          var e = t.image ? t.image.name : "";
          if (0 === e.length) return void pt("Can't add FormattedSection with an empty image.");
          var r = this.getNextImageSectionCharCode();
          r ? (this.text += String.fromCharCode(r), this.sections.push(Nc.forImage(e)), this.sectionIndex.push(this.sections.length - 1)) : pt("Reached maximum number of images 6401");
        }
      }, {
        key: "getNextImageSectionCharCode",
        value: function getNextImageSectionCharCode() {
          return this.imageSectionID ? this.imageSectionID >= 63743 ? null : ++this.imageSectionID : (this.imageSectionID = 57344, this.imageSectionID);
        }
      }], [{
        key: "fromFeature",
        value: function fromFeature(t, e) {
          var r = new Gc();

          for (var _n75 = 0; _n75 < t.sections.length; _n75++) {
            var _i84 = t.sections[_n75];
            _i84.image ? r.addImageSection(_i84) : r.addTextSection(_i84, e);
          }

          return r;
        }
      }]);

      return Gc;
    }();

    function Zc(t, e, r, n, i, s, a, o, l, u, c, h, p, d, f, y) {
      var m = Gc.fromFeature(t, i);
      var g;
      h === qc.vertical && m.verticalizePunctuation(p);
      var x = Ns.processBidirectionalText,
          v = Ns.processStyledBidirectionalText;

      if (x && 1 === m.sections.length) {
        g = [];

        var _t109 = x(m.toString(), th(m, u, s, e, n, d, f));

        var _iterator87 = _createForOfIteratorHelper(_t109),
            _step87;

        try {
          for (_iterator87.s(); !(_step87 = _iterator87.n()).done;) {
            var _e114 = _step87.value;

            var _t110 = new Gc();

            _t110.text = _e114, _t110.sections = m.sections;

            for (var _r114 = 0; _r114 < _e114.length; _r114++) {
              _t110.sectionIndex.push(0);
            }

            g.push(_t110);
          }
        } catch (err) {
          _iterator87.e(err);
        } finally {
          _iterator87.f();
        }
      } else if (v) {
        g = [];

        var _t111 = v(m.text, m.sectionIndex, th(m, u, s, e, n, d, f));

        var _iterator88 = _createForOfIteratorHelper(_t111),
            _step88;

        try {
          for (_iterator88.s(); !(_step88 = _iterator88.n()).done;) {
            var _e115 = _step88.value;

            var _t112 = new Gc();

            _t112.text = _e115[0], _t112.sectionIndex = _e115[1], _t112.sections = m.sections, g.push(_t112);
          }
        } catch (err) {
          _iterator88.e(err);
        } finally {
          _iterator88.f();
        }
      } else g = function (t, e) {
        var r = [],
            n = t.text;
        var i = 0;

        var _iterator89 = _createForOfIteratorHelper(e),
            _step89;

        try {
          for (_iterator89.s(); !(_step89 = _iterator89.n()).done;) {
            var _n76 = _step89.value;
            r.push(t.substring(i, _n76)), i = _n76;
          }
        } catch (err) {
          _iterator89.e(err);
        } finally {
          _iterator89.f();
        }

        return i < n.length && r.push(t.substring(i, n.length)), r;
      }(m, th(m, u, s, e, n, d, f));

      var b = [],
          w = {
        positionedLines: b,
        text: m.toString(),
        top: c[1],
        bottom: c[1],
        left: c[0],
        right: c[0],
        writingMode: h,
        iconsInText: !1,
        verticalizable: !1,
        hasBaseline: !1
      };
      return function (t, e, r, n, i, s, a, o, l, u, c, h) {
        var p = 0,
            d = 0,
            f = 0;
        var y = "right" === o ? 1 : "left" === o ? 0 : .5;
        var m = !1;

        var _iterator90 = _createForOfIteratorHelper(i),
            _step90;

        try {
          for (_iterator90.s(); !(_step90 = _iterator90.n()).done;) {
            var _t114 = _step90.value;

            var _r115 = _t114.getSections();

            var _iterator94 = _createForOfIteratorHelper(_r115),
                _step94;

            try {
              for (_iterator94.s(); !(_step94 = _iterator94.n()).done;) {
                var _t115 = _step94.value;
                if (_t115.imageName) continue;
                var _r116 = e[_t115.fontStack];
                if (_r116 && (m = void 0 !== _r116.ascender && void 0 !== _r116.descender, !m)) break;
              }
            } catch (err) {
              _iterator94.e(err);
            } finally {
              _iterator94.f();
            }

            if (!m) break;
          }
        } catch (err) {
          _iterator90.e(err);
        } finally {
          _iterator90.f();
        }

        var g = 0;

        var _iterator91 = _createForOfIteratorHelper(i),
            _step91;

        try {
          for (_iterator91.s(); !(_step91 = _iterator91.n()).done;) {
            var _a49 = _step91.value;

            _a49.trim();

            var _i85 = _a49.getMaxScale(),
                _o25 = (_i85 - 1) * sc,
                _v2 = {
              positionedGlyphs: [],
              lineOffset: 0
            };

            t.positionedLines[g] = _v2;
            var _b2 = _v2.positionedGlyphs;
            var _w2 = 0;

            if (!_a49.length()) {
              d += s, ++g;
              continue;
            }

            var _3 = 0,
                _A2 = 0;

            for (var _s56 = 0; _s56 < _a49.length(); _s56++) {
              var _o26 = _a49.getSection(_s56),
                  _f3 = _a49.getSectionIndex(_s56),
                  _y2 = _a49.getCharCode(_s56);

              var _g3 = _o26.scale,
                  _v3 = null,
                  _k3 = null,
                  _S = null,
                  _I = sc,
                  _z = 0;

              var _M = !(l === qc.horizontal || !c && !Ms(_y2) || c && (Xc[_y2] || (x = _y2, Wi(x) || Qi(x) || ts(x) || vs(x) || As(x))));

              if (_o26.imageName) {
                var _e117 = n[_o26.imageName];
                if (!_e117) continue;
                _S = _o26.imageName, t.iconsInText = t.iconsInText || !0, _k3 = _e117.paddedRect;
                var _r117 = _e117.displaySize;
                _g3 = _g3 * sc / h, _v3 = {
                  width: _r117[0],
                  height: _r117[1],
                  left: 1,
                  top: -3,
                  advance: _M ? _r117[1] : _r117[0],
                  localGlyph: !1
                }, _z = m ? -_v3.height * _g3 : _i85 * sc - 17 - _r117[1] * _g3, _I = _v3.advance;

                var _s57 = (_M ? _r117[0] : _r117[1]) * _g3 - sc * _i85;

                _s57 > 0 && _s57 > _w2 && (_w2 = _s57);
              } else {
                var _t116 = r[_o26.fontStack];
                if (!_t116) continue;
                _t116[_y2] && (_k3 = _t116[_y2]);
                var _n77 = e[_o26.fontStack];
                if (!_n77) continue;
                var _s58 = _n77.glyphs[_y2];
                if (!_s58) continue;

                if (_v3 = _s58.metrics, _I = 8203 !== _y2 ? sc : 0, m) {
                  var _t117 = void 0 !== _n77.ascender ? Math.abs(_n77.ascender) : 0,
                      _e118 = void 0 !== _n77.descender ? Math.abs(_n77.descender) : 0,
                      _r118 = (_t117 + _e118) * _g3;

                  _3 < _r118 && (_3 = _r118, _A2 = (_t117 - _e118) / 2 * _g3), _z = -_t117 * _g3;
                } else _z = (_i85 - _g3) * sc - 17;
              }

              _M ? (t.verticalizable = !0, _b2.push({
                glyph: _y2,
                imageName: _S,
                x: p,
                y: d + _z,
                vertical: _M,
                scale: _g3,
                localGlyph: _v3.localGlyph,
                fontStack: _o26.fontStack,
                sectionIndex: _f3,
                metrics: _v3,
                rect: _k3
              }), p += _I * _g3 + u) : (_b2.push({
                glyph: _y2,
                imageName: _S,
                x: p,
                y: d + _z,
                vertical: _M,
                scale: _g3,
                localGlyph: _v3.localGlyph,
                fontStack: _o26.fontStack,
                sectionIndex: _f3,
                metrics: _v3,
                rect: _k3
              }), p += _v3.advance * _g3 + u);
            }

            0 !== _b2.length && (f = Math.max(p - u, f), m ? rh(_b2, y, _w2, _A2, s * _i85 / 2) : rh(_b2, y, _w2, 0, s / 2)), p = 0;

            var _k2 = s * _i85 + _w2;

            _v2.lineOffset = Math.max(_w2, _o25), d += _k2, ++g;
          }
        } catch (err) {
          _iterator91.e(err);
        } finally {
          _iterator91.f();
        }

        var x;

        var v = d,
            _eh = eh(a),
            b = _eh.horizontalAlign,
            w = _eh.verticalAlign;

        (function (t, e, r, n, i, s) {
          var a = (e - r) * i,
              o = -s * n;

          var _iterator92 = _createForOfIteratorHelper(t),
              _step92;

          try {
            for (_iterator92.s(); !(_step92 = _iterator92.n()).done;) {
              var _e116 = _step92.value;

              var _iterator93 = _createForOfIteratorHelper(_e116.positionedGlyphs),
                  _step93;

              try {
                for (_iterator93.s(); !(_step93 = _iterator93.n()).done;) {
                  var _t113 = _step93.value;
                  _t113.x += a, _t113.y += o;
                }
              } catch (err) {
                _iterator93.e(err);
              } finally {
                _iterator93.f();
              }
            }
          } catch (err) {
            _iterator92.e(err);
          } finally {
            _iterator92.f();
          }
        })(t.positionedLines, y, b, w, f, v), t.top += -w * v, t.bottom = t.top + v, t.left += -b * f, t.right = t.left + f, t.hasBaseline = m;
      }(w, e, r, n, g, a, o, l, h, u, p, y), !function (t) {
        var _iterator95 = _createForOfIteratorHelper(t),
            _step95;

        try {
          for (_iterator95.s(); !(_step95 = _iterator95.n()).done;) {
            var _e119 = _step95.value;
            if (0 !== _e119.positionedGlyphs.length) return !1;
          }
        } catch (err) {
          _iterator95.e(err);
        } finally {
          _iterator95.f();
        }

        return !0;
      }(b) && w;
    }

    var Xc = {
      9: !0,
      10: !0,
      11: !0,
      12: !0,
      13: !0,
      32: !0
    },
        Kc = {
      10: !0,
      32: !0,
      38: !0,
      40: !0,
      41: !0,
      43: !0,
      45: !0,
      47: !0,
      173: !0,
      183: !0,
      8203: !0,
      8208: !0,
      8211: !0,
      8231: !0
    };

    function Yc(t, e, r, n, i, s) {
      if (e.imageName) {
        var _t118 = n[e.imageName];
        return _t118 ? _t118.displaySize[0] * e.scale * sc / s + i : 0;
      }

      {
        var _n78 = r[e.fontStack],
            _s59 = _n78 && _n78.glyphs[t];

        return _s59 ? _s59.metrics.advance * e.scale + i : 0;
      }
    }

    function Hc(t, e, r, n) {
      var i = Math.pow(t - e, 2);
      return n ? t < e ? i / 2 : 2 * i : i + Math.abs(r) * r;
    }

    function Jc(t, e, r) {
      var n = 0;
      return 10 === t && (n -= 1e4), r && (n += 150), 40 !== t && 65288 !== t || (n += 50), 41 !== e && 65289 !== e || (n += 50), n;
    }

    function Wc(t, e, r, n, i, s) {
      var a = null,
          o = Hc(e, r, i, s);

      var _iterator96 = _createForOfIteratorHelper(n),
          _step96;

      try {
        for (_iterator96.s(); !(_step96 = _iterator96.n()).done;) {
          var _t119 = _step96.value;

          var _n79 = Hc(e - _t119.x, r, i, s) + _t119.badness;

          _n79 <= o && (a = _t119, o = _n79);
        }
      } catch (err) {
        _iterator96.e(err);
      } finally {
        _iterator96.f();
      }

      return {
        index: t,
        x: e,
        priorBreak: a,
        badness: o
      };
    }

    function Qc(t) {
      return t ? Qc(t.priorBreak).concat(t.index) : [];
    }

    function th(t, e, r, n, i, s, a) {
      if ("point" !== s) return [];
      if (!t) return [];

      var o = [],
          l = function (t, e, r, n, i, s) {
        var a = 0;

        for (var _r119 = 0; _r119 < t.length(); _r119++) {
          var _o27 = t.getSection(_r119);

          a += Yc(t.getCharCode(_r119), _o27, n, i, e, s);
        }

        return a / Math.max(1, Math.ceil(a / r));
      }(t, e, r, n, i, a),
          u = t.text.indexOf("​") >= 0;

      var c = 0;

      for (var _r120 = 0; _r120 < t.length(); _r120++) {
        var _s60 = t.getSection(_r120),
            _p6 = t.getCharCode(_r120);

        if (Xc[_p6] || (c += Yc(_p6, _s60, n, i, e, a)), _r120 < t.length() - 1) {
          var _e120 = !((h = _p6) < 11904 || !(ls(h) || os(h) || ws(h) || xs(h) || ps(h) || es(h) || us(h) || is(h) || ds(h) || fs(h) || hs(h) || ks(h) || ss(h) || ns(h) || rs(h) || cs(h) || as(h) || bs(h) || ms(h) || ys(h)));

          (Kc[_p6] || _e120 || _s60.imageName) && o.push(Wc(_r120 + 1, c, l, o, Jc(_p6, t.getCharCode(_r120 + 1), _e120 && u), !1));
        }
      }

      var h;
      return Qc(Wc(t.length(), c, l, o, 0, !0));
    }

    function eh(t) {
      var e = .5,
          r = .5;

      switch (t) {
        case "right":
        case "top-right":
        case "bottom-right":
          e = 1;
          break;

        case "left":
        case "top-left":
        case "bottom-left":
          e = 0;
      }

      switch (t) {
        case "bottom":
        case "bottom-right":
        case "bottom-left":
          r = 1;
          break;

        case "top":
        case "top-right":
        case "top-left":
          r = 0;
      }

      return {
        horizontalAlign: e,
        verticalAlign: r
      };
    }

    function rh(t, e, r, n, i) {
      if (!(e || r || n || i)) return;
      var s = t.length - 1,
          a = t[s],
          o = (a.x + a.metrics.advance * a.scale) * e;

      for (var _e121 = 0; _e121 <= s; _e121++) {
        t[_e121].x -= o, t[_e121].y += r + n + i;
      }
    }

    function nh(t, e, r) {
      var _eh2 = eh(r),
          n = _eh2.horizontalAlign,
          i = _eh2.verticalAlign,
          s = e[0] - t.displaySize[0] * n,
          a = e[1] - t.displaySize[1] * i;

      return {
        image: t,
        top: a,
        bottom: a + t.displaySize[1],
        left: s,
        right: s + t.displaySize[0]
      };
    }

    function ih(t, e, r, n, i, s) {
      var a = t.image;
      var o;

      if (a.content) {
        var _t120 = a.content,
            _e122 = a.pixelRatio || 1;

        o = [_t120[0] / _e122, _t120[1] / _e122, a.displaySize[0] - _t120[2] / _e122, a.displaySize[1] - _t120[3] / _e122];
      }

      var l = e.left * s,
          u = e.right * s;
      var c, h, p, d;
      "width" === r || "both" === r ? (d = i[0] + l - n[3], h = i[0] + u + n[1]) : (d = i[0] + (l + u - a.displaySize[0]) / 2, h = d + a.displaySize[0]);
      var f = e.top * s,
          y = e.bottom * s;
      return "height" === r || "both" === r ? (c = i[1] + f - n[0], p = i[1] + y + n[2]) : (c = i[1] + (f + y - a.displaySize[1]) / 2, p = c + a.displaySize[1]), {
        image: a,
        top: c,
        right: h,
        bottom: p,
        left: d,
        collisionPadding: o
      };
    }

    var sh = /*#__PURE__*/function (_i86) {
      _inherits(sh, _i86);

      var _super49 = _createSuper(sh);

      function sh(t, e, r, n, i) {
        var _this20;

        _classCallCheck(this, sh);

        _this20 = _super49.call(this, t, e), _this20.angle = n, _this20.z = r, void 0 !== i && (_this20.segment = i);
        return _this20;
      }

      _createClass(sh, [{
        key: "clone",
        value: function clone() {
          return new sh(this.x, this.y, this.z, this.angle, this.segment);
        }
      }]);

      return sh;
    }(i);

    function ah(t, e, r, n, i) {
      if (void 0 === e.segment) return !0;
      var s = e,
          a = e.segment + 1,
          o = 0;

      for (; o > -r / 2;) {
        if (a--, a < 0) return !1;
        o -= t[a].dist(s), s = t[a];
      }

      o += t[a].dist(t[a + 1]), a++;
      var l = [];
      var u = 0;

      for (; o < r / 2;) {
        var _e123 = t[a],
            _r121 = t[a + 1];
        if (!_r121) return !1;

        var _s61 = t[a - 1].angleTo(_e123) - _e123.angleTo(_r121);

        for (_s61 = Math.abs((_s61 + 3 * Math.PI) % (2 * Math.PI) - Math.PI), l.push({
          distance: o,
          angleDelta: _s61
        }), u += _s61; o - l[0].distance > n;) {
          u -= l.shift().angleDelta;
        }

        if (u > i) return !1;
        a++, o += _e123.dist(_r121);
      }

      return !0;
    }

    function oh(t) {
      var e = 0;

      for (var _r122 = 0; _r122 < t.length - 1; _r122++) {
        e += t[_r122].dist(t[_r122 + 1]);
      }

      return e;
    }

    function lh(t, e, r) {
      return t ? .6 * e * r : 0;
    }

    function uh(t, e) {
      return Math.max(t ? t.right - t.left : 0, e ? e.right - e.left : 0);
    }

    function ch(t, e, r, n, i, s) {
      var a = lh(r, i, s),
          o = uh(r, n) * s;
      var l = 0;
      var u = oh(t) / 2;

      for (var _r123 = 0; _r123 < t.length - 1; _r123++) {
        var _n80 = t[_r123],
            _i87 = t[_r123 + 1],
            _s62 = _n80.dist(_i87);

        if (l + _s62 > u) {
          var _c14 = (u - l) / _s62,
              _h8 = Lr(_n80.x, _i87.x, _c14),
              _p7 = Lr(_n80.y, _i87.y, _c14),
              _d4 = new sh(_h8, _p7, 0, _i87.angleTo(_n80), _r123);

          return !a || ah(t, _d4, o, a, e) ? _d4 : void 0;
        }

        l += _s62;
      }
    }

    function hh(t, e, r, n, i, s, a, o, l) {
      var u = lh(n, s, a),
          c = uh(n, i),
          h = c * a,
          p = 0 === t[0].x || t[0].x === l || 0 === t[0].y || t[0].y === l;
      return e - h < e / 4 && (e = h + e / 4), ph(t, p ? e / 2 * o % e : (c / 2 + 2 * s) * a * o % e, e, u, r, h, p, !1, l);
    }

    function ph(t, e, r, n, i, s, a, o, l) {
      var u = s / 2,
          c = oh(t);
      var h = 0,
          p = e - r,
          d = [];

      for (var _e124 = 0; _e124 < t.length - 1; _e124++) {
        var _a50 = t[_e124],
            _o28 = t[_e124 + 1],
            _f4 = _a50.dist(_o28),
            _y3 = _o28.angleTo(_a50);

        for (; p + r < h + _f4;) {
          p += r;

          var _m3 = (p - h) / _f4,
              _g4 = Lr(_a50.x, _o28.x, _m3),
              _x3 = Lr(_a50.y, _o28.y, _m3);

          if (_g4 >= 0 && _g4 < l && _x3 >= 0 && _x3 < l && p - u >= 0 && p + u <= c) {
            var _r124 = new sh(_g4, _x3, 0, _y3, _e124);

            _r124._round(), n && !ah(t, _r124, s, n, i) || d.push(_r124);
          }
        }

        h += _f4;
      }

      return o || d.length || a || (d = ph(t, h / 2, r, n, i, s, a, !0, l)), d;
    }

    function dh(t, e, r, n, s) {
      var a = [];

      for (var _o29 = 0; _o29 < t.length; _o29++) {
        var _l25 = t[_o29];

        var _u23 = void 0;

        for (var _t121 = 0; _t121 < _l25.length - 1; _t121++) {
          var _o30 = _l25[_t121],
              _c15 = _l25[_t121 + 1];
          _o30.x < e && _c15.x < e || (_o30.x < e ? _o30 = new i(e, _o30.y + (e - _o30.x) / (_c15.x - _o30.x) * (_c15.y - _o30.y))._round() : _c15.x < e && (_c15 = new i(e, _o30.y + (e - _o30.x) / (_c15.x - _o30.x) * (_c15.y - _o30.y))._round()), _o30.y < r && _c15.y < r || (_o30.y < r ? _o30 = new i(_o30.x + (r - _o30.y) / (_c15.y - _o30.y) * (_c15.x - _o30.x), r)._round() : _c15.y < r && (_c15 = new i(_o30.x + (r - _o30.y) / (_c15.y - _o30.y) * (_c15.x - _o30.x), r)._round()), _o30.x >= n && _c15.x >= n || (_o30.x >= n ? _o30 = new i(n, _o30.y + (n - _o30.x) / (_c15.x - _o30.x) * (_c15.y - _o30.y))._round() : _c15.x >= n && (_c15 = new i(n, _o30.y + (n - _o30.x) / (_c15.x - _o30.x) * (_c15.y - _o30.y))._round()), _o30.y >= s && _c15.y >= s || (_o30.y >= s ? _o30 = new i(_o30.x + (s - _o30.y) / (_c15.y - _o30.y) * (_c15.x - _o30.x), s)._round() : _c15.y >= s && (_c15 = new i(_o30.x + (s - _o30.y) / (_c15.y - _o30.y) * (_c15.x - _o30.x), s)._round()), _u23 && _o30.equals(_u23[_u23.length - 1]) || (_u23 = [_o30], a.push(_u23)), _u23.push(_c15)))));
        }
      }

      return a;
    }

    Zi("Anchor", sh);
    var fh = 1e20;

    function yh(t, e, r, n, i, s, a, o, l) {
      for (var _u24 = e; _u24 < e + n; _u24++) {
        mh(t, r * s + _u24, s, i, a, o, l);
      }

      for (var _u25 = r; _u25 < r + i; _u25++) {
        mh(t, _u25 * s + e, 1, n, a, o, l);
      }
    }

    function mh(t, e, r, n, i, s, a) {
      s[0] = 0, a[0] = -fh, a[1] = fh, i[0] = t[e];

      for (var _o31 = 1, _l26 = 0, _u26 = 0; _o31 < n; _o31++) {
        i[_o31] = t[e + _o31 * r];

        var _n81 = _o31 * _o31;

        do {
          var _t122 = s[_l26];
          _u26 = (i[_o31] - i[_t122] + _n81 - _t122 * _t122) / (_o31 - _t122) / 2;
        } while (_u26 <= a[_l26] && --_l26 > -1);

        _l26++, s[_l26] = _o31, a[_l26] = _u26, a[_l26 + 1] = fh;
      }

      for (var _o32 = 0, _l27 = 0; _o32 < n; _o32++) {
        for (; a[_l27 + 1] < _o32;) {
          _l27++;
        }

        var _n82 = s[_l27],
            _u27 = _o32 - _n82;

        t[e + _o32 * r] = i[_n82] + _u27 * _u27;
      }
    }

    var gh = {
      none: 0,
      ideographs: 1,
      all: 2
    };

    var xh = /*#__PURE__*/function () {
      function xh(t, e, r) {
        _classCallCheck(this, xh);

        this.requestManager = t, this.localGlyphMode = e, this.localFontFamily = r, this.entries = {}, this.localGlyphs = {
          200: {},
          400: {},
          500: {},
          900: {}
        };
      }

      _createClass(xh, [{
        key: "setURL",
        value: function setURL(t) {
          this.url = t;
        }
      }, {
        key: "getGlyphs",
        value: function getGlyphs(t, e) {
          var _this21 = this;

          var r = [];

          for (var _e125 in t) {
            var _iterator97 = _createForOfIteratorHelper(t[_e125]),
                _step97;

            try {
              for (_iterator97.s(); !(_step97 = _iterator97.n()).done;) {
                var _n83 = _step97.value;
                r.push({
                  stack: _e125,
                  id: _n83
                });
              }
            } catch (err) {
              _iterator97.e(err);
            } finally {
              _iterator97.f();
            }
          }

          W(r, function (_ref152, r) {
            var t = _ref152.stack,
                e = _ref152.id;
            var n = _this21.entries[t];
            n || (n = _this21.entries[t] = {
              glyphs: {},
              requests: {},
              ranges: {},
              ascender: void 0,
              descender: void 0
            });
            var i = n.glyphs[e];
            if (void 0 !== i) return void r(null, {
              stack: t,
              id: e,
              glyph: i
            });
            if (i = _this21._tinySDF(n, t, e), i) return n.glyphs[e] = i, void r(null, {
              stack: t,
              id: e,
              glyph: i
            });
            var s = Math.floor(e / 256);
            if (256 * s > 65535) return void r(new Error("glyphs > 65535 not supported"));
            if (n.ranges[s]) return void r(null, {
              stack: t,
              id: e,
              glyph: i
            });
            var a = n.requests[s];
            a || (a = n.requests[s] = [], xh.loadGlyphRange(t, s, _this21.url, _this21.requestManager, function (t, e) {
              if (e) {
                n.ascender = e.ascender, n.descender = e.descender;

                for (var _t123 in e.glyphs) {
                  _this21._doesCharSupportLocalGlyph(+_t123) || (n.glyphs[+_t123] = e.glyphs[+_t123]);
                }

                n.ranges[s] = !0;
              }

              var _iterator98 = _createForOfIteratorHelper(a),
                  _step98;

              try {
                for (_iterator98.s(); !(_step98 = _iterator98.n()).done;) {
                  var _r125 = _step98.value;

                  _r125(t, e);
                }
              } catch (err) {
                _iterator98.e(err);
              } finally {
                _iterator98.f();
              }

              delete n.requests[s];
            })), a.push(function (n, i) {
              n ? r(n) : i && r(null, {
                stack: t,
                id: e,
                glyph: i.glyphs[e] || null
              });
            });
          }, function (t, r) {
            if (t) e(t);else if (r) {
              var _t124 = {};

              var _iterator99 = _createForOfIteratorHelper(r),
                  _step99;

              try {
                for (_iterator99.s(); !(_step99 = _iterator99.n()).done;) {
                  var _ref154 = _step99.value;
                  var _e126 = _ref154.stack;
                  var _n84 = _ref154.id;
                  var _i88 = _ref154.glyph;
                  void 0 === _t124[_e126] && (_t124[_e126] = {}), void 0 === _t124[_e126].glyphs && (_t124[_e126].glyphs = {}), _t124[_e126].glyphs[_n84] = _i88 && {
                    id: _i88.id,
                    bitmap: _i88.bitmap.clone(),
                    metrics: _i88.metrics
                  }, _t124[_e126].ascender = _this21.entries[_e126].ascender, _t124[_e126].descender = _this21.entries[_e126].descender;
                }
              } catch (err) {
                _iterator99.e(err);
              } finally {
                _iterator99.f();
              }

              e(null, _t124);
            }
          });
        }
      }, {
        key: "_doesCharSupportLocalGlyph",
        value: function _doesCharSupportLocalGlyph(t) {
          return this.localGlyphMode !== gh.none && (this.localGlyphMode === gh.all ? !!this.localFontFamily : !!this.localFontFamily && (fs(t) || gs(t) || ss(t) || as(t)) || is(t));
        }
      }, {
        key: "_tinySDF",
        value: function _tinySDF(t, e, r) {
          var n = this.localFontFamily;
          if (!n || !this._doesCharSupportLocalGlyph(r)) return;
          var i = t.tinySDF;

          if (!i) {
            var _r126 = "400";
            /bold/i.test(e) ? _r126 = "900" : /medium/i.test(e) ? _r126 = "500" : /light/i.test(e) && (_r126 = "200"), i = t.tinySDF = new xh.TinySDF({
              fontFamily: n,
              fontWeight: _r126,
              fontSize: 48,
              buffer: 6,
              radius: 16
            }), i.fontWeight = _r126;
          }

          if (this.localGlyphs[i.fontWeight][r]) return this.localGlyphs[i.fontWeight][r];

          var s = String.fromCharCode(r),
              _i$draw = i.draw(s),
              a = _i$draw.data,
              o = _i$draw.width,
              l = _i$draw.height,
              u = _i$draw.glyphWidth,
              c = _i$draw.glyphHeight,
              h = _i$draw.glyphLeft,
              p = _i$draw.glyphTop,
              d = _i$draw.glyphAdvance;

          return this.localGlyphs[i.fontWeight][r] = {
            id: r,
            bitmap: new zl({
              width: o,
              height: l
            }, a),
            metrics: {
              width: u / 2,
              height: c / 2,
              left: h / 2,
              top: p / 2 - 27,
              advance: d / 2,
              localGlyph: !0
            }
          };
        }
      }]);

      return xh;
    }();

    function vh(t, e, r, n) {
      var s = [],
          a = t.image,
          o = a.pixelRatio,
          l = a.paddedRect.w - 2,
          u = a.paddedRect.h - 2,
          c = t.right - t.left,
          h = t.bottom - t.top,
          p = a.stretchX || [[0, l]],
          d = a.stretchY || [[0, u]],
          f = function f(t, e) {
        return t + e[1] - e[0];
      },
          y = p.reduce(f, 0),
          m = d.reduce(f, 0),
          g = l - y,
          x = u - m;

      var v = 0,
          b = y,
          w = 0,
          _ = m,
          A = 0,
          k = g,
          S = 0,
          I = x;

      if (a.content && n) {
        var _t125 = a.content;
        v = bh(p, 0, _t125[0]), w = bh(d, 0, _t125[1]), b = bh(p, _t125[0], _t125[2]), _ = bh(d, _t125[1], _t125[3]), A = _t125[0] - v, S = _t125[1] - w, k = _t125[2] - _t125[0] - b, I = _t125[3] - _t125[1] - _;
      }

      var z = function z(n, s, l, u) {
        var p = _h(n.stretch - v, b, c, t.left),
            d = Ah(n.fixed - A, k, n.stretch, y),
            f = _h(s.stretch - w, _, h, t.top),
            g = Ah(s.fixed - S, I, s.stretch, m),
            x = _h(l.stretch - v, b, c, t.left),
            z = Ah(l.fixed - A, k, l.stretch, y),
            M = _h(u.stretch - w, _, h, t.top),
            T = Ah(u.fixed - S, I, u.stretch, m),
            B = new i(p, f),
            C = new i(x, f),
            P = new i(x, M),
            E = new i(p, M),
            D = new i(d / o, g / o),
            V = new i(z / o, T / o),
            F = e * Math.PI / 180;

        if (F) {
          var _t126 = Math.sin(F),
              _e127 = Math.cos(F),
              _r127 = [_e127, -_t126, _t126, _e127];

          B._matMult(_r127), C._matMult(_r127), E._matMult(_r127), P._matMult(_r127);
        }

        var L = n.stretch + n.fixed,
            R = s.stretch + s.fixed;
        return {
          tl: B,
          tr: C,
          bl: E,
          br: P,
          tex: {
            x: a.paddedRect.x + 1 + L,
            y: a.paddedRect.y + 1 + R,
            w: l.stretch + l.fixed - L,
            h: u.stretch + u.fixed - R
          },
          writingMode: void 0,
          glyphOffset: [0, 0],
          sectionIndex: 0,
          pixelOffsetTL: D,
          pixelOffsetBR: V,
          minFontScaleX: k / o / c,
          minFontScaleY: I / o / h,
          isSDF: r
        };
      };

      if (n && (a.stretchX || a.stretchY)) {
        var _t127 = wh(p, g, y),
            _e128 = wh(d, x, m);

        for (var _r128 = 0; _r128 < _t127.length - 1; _r128++) {
          var _n85 = _t127[_r128],
              _i89 = _t127[_r128 + 1];

          for (var _t128 = 0; _t128 < _e128.length - 1; _t128++) {
            s.push(z(_n85, _e128[_t128], _i89, _e128[_t128 + 1]));
          }
        }
      } else s.push(z({
        fixed: 0,
        stretch: -1
      }, {
        fixed: 0,
        stretch: -1
      }, {
        fixed: 0,
        stretch: l + 1
      }, {
        fixed: 0,
        stretch: u + 1
      }));

      return s;
    }

    function bh(t, e, r) {
      var n = 0;

      var _iterator100 = _createForOfIteratorHelper(t),
          _step100;

      try {
        for (_iterator100.s(); !(_step100 = _iterator100.n()).done;) {
          var _i90 = _step100.value;
          n += Math.max(e, Math.min(r, _i90[1])) - Math.max(e, Math.min(r, _i90[0]));
        }
      } catch (err) {
        _iterator100.e(err);
      } finally {
        _iterator100.f();
      }

      return n;
    }

    function wh(t, e, r) {
      var n = [{
        fixed: -1,
        stretch: 0
      }];

      var _iterator101 = _createForOfIteratorHelper(t),
          _step101;

      try {
        for (_iterator101.s(); !(_step101 = _iterator101.n()).done;) {
          var _ref157 = _step101.value;

          var _ref156 = _slicedToArray(_ref157, 2);

          var _e129 = _ref156[0];
          var _r129 = _ref156[1];
          var _t129 = n[n.length - 1];
          n.push({
            fixed: _e129 - _t129.stretch,
            stretch: _t129.stretch
          }), n.push({
            fixed: _e129 - _t129.stretch,
            stretch: _t129.stretch + (_r129 - _e129)
          });
        }
      } catch (err) {
        _iterator101.e(err);
      } finally {
        _iterator101.f();
      }

      return n.push({
        fixed: e + 1,
        stretch: r
      }), n;
    }

    function _h(t, e, r, n) {
      return t / e * r + n;
    }

    function Ah(t, e, r, n) {
      return t - e * r / n;
    }

    function kh(t, e, r, n) {
      var i = e + t.positionedLines[n].lineOffset;
      return 0 === n ? r + i / 2 : r + (i + (e + t.positionedLines[n - 1].lineOffset)) / 2;
    }

    xh.loadGlyphRange = function (t, e, r, n, i) {
      var s = 256 * e,
          a = s + 255,
          o = n.transformRequest(n.normalizeGlyphsURL(r).replace("{fontstack}", t).replace("{range}", "".concat(s, "-").concat(a)), re.Glyphs);
      ae(o, function (t, e) {
        if (t) i(t);else if (e) {
          var _t130 = {},
              _r130 = function (t) {
            return new gc(t).readFields(Lc, {});
          }(e);

          var _iterator102 = _createForOfIteratorHelper(_r130.glyphs),
              _step102;

          try {
            for (_iterator102.s(); !(_step102 = _iterator102.n()).done;) {
              var _e130 = _step102.value;
              _t130[_e130.id] = _e130;
            }
          } catch (err) {
            _iterator102.e(err);
          } finally {
            _iterator102.f();
          }

          i(null, {
            glyphs: _t130,
            ascender: _r130.ascender,
            descender: _r130.descender
          });
        }
      });
    }, xh.TinySDF = /*#__PURE__*/function () {
      function _class5(_ref158) {
        var _ref158$fontSize = _ref158.fontSize,
            t = _ref158$fontSize === void 0 ? 24 : _ref158$fontSize,
            _ref158$buffer = _ref158.buffer,
            e = _ref158$buffer === void 0 ? 3 : _ref158$buffer,
            _ref158$radius = _ref158.radius,
            r = _ref158$radius === void 0 ? 8 : _ref158$radius,
            _ref158$cutoff = _ref158.cutoff,
            n = _ref158$cutoff === void 0 ? .25 : _ref158$cutoff,
            _ref158$fontFamily = _ref158.fontFamily,
            i = _ref158$fontFamily === void 0 ? "sans-serif" : _ref158$fontFamily,
            _ref158$fontWeight = _ref158.fontWeight,
            s = _ref158$fontWeight === void 0 ? "normal" : _ref158$fontWeight,
            _ref158$fontStyle = _ref158.fontStyle,
            a = _ref158$fontStyle === void 0 ? "normal" : _ref158$fontStyle;

        _classCallCheck(this, _class5);

        this.buffer = e, this.cutoff = n, this.radius = r;

        var o = this.size = t + 4 * e,
            l = this._createCanvas(o),
            u = this.ctx = l.getContext("2d", {
          willReadFrequently: !0
        });

        u.font = "".concat(a, " ").concat(s, " ").concat(t, "px ").concat(i), u.textBaseline = "alphabetic", u.textAlign = "left", u.fillStyle = "black", this.gridOuter = new Float64Array(o * o), this.gridInner = new Float64Array(o * o), this.f = new Float64Array(o), this.z = new Float64Array(o + 1), this.v = new Uint16Array(o);
      }

      _createClass(_class5, [{
        key: "_createCanvas",
        value: function _createCanvas(t) {
          var e = document.createElement("canvas");
          return e.width = e.height = t, e;
        }
      }, {
        key: "draw",
        value: function draw(t) {
          var _this$ctx$measureText = this.ctx.measureText(t),
              e = _this$ctx$measureText.width,
              r = _this$ctx$measureText.actualBoundingBoxAscent,
              n = _this$ctx$measureText.actualBoundingBoxDescent,
              i = _this$ctx$measureText.actualBoundingBoxLeft,
              s = _this$ctx$measureText.actualBoundingBoxRight,
              a = Math.floor(r),
              o = Math.min(this.size - this.buffer, Math.ceil(s - i)),
              l = Math.min(this.size - this.buffer, Math.ceil(r) + Math.ceil(n)),
              u = o + 2 * this.buffer,
              c = l + 2 * this.buffer,
              h = u * c,
              p = new Uint8ClampedArray(h),
              d = {
            data: p,
            width: u,
            height: c,
            glyphWidth: o,
            glyphHeight: l,
            glyphTop: a,
            glyphLeft: 0,
            glyphAdvance: e
          };

          if (0 === o || 0 === l) return d;
          var f = this.ctx,
              y = this.buffer,
              m = this.gridInner,
              g = this.gridOuter;
          f.clearRect(y, y, o, l), f.fillText(t, y, y + a + 1);
          var x = f.getImageData(y, y, o, l);
          g.fill(fh, 0, h), m.fill(0, 0, h);

          for (var _t131 = 0; _t131 < l; _t131++) {
            for (var _e131 = 0; _e131 < o; _e131++) {
              var _r131 = x.data[4 * (_t131 * o + _e131) + 3] / 255;

              if (0 === _r131) continue;

              var _n86 = (_t131 + y) * u + _e131 + y;

              if (1 === _r131) g[_n86] = 0, m[_n86] = fh;else {
                var _t132 = .5 - _r131;

                g[_n86] = _t132 > 0 ? _t132 * _t132 : 0, m[_n86] = _t132 < 0 ? _t132 * _t132 : 0;
              }
            }
          }

          yh(g, 0, 0, u, c, u, this.f, this.v, this.z), yh(m, y, y, o, l, u, this.f, this.v, this.z);

          for (var _t133 = 0; _t133 < h; _t133++) {
            var _e132 = Math.sqrt(g[_t133]) - Math.sqrt(m[_t133]);

            p[_t133] = Math.round(255 - 255 * (_e132 / this.radius + this.cutoff));
          }

          return d;
        }
      }]);

      return _class5;
    }();

    var Sh = /*#__PURE__*/function () {
      function Sh() {
        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
        var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Ih;

        _classCallCheck(this, Sh);

        if (this.data = t, this.length = this.data.length, this.compare = e, this.length > 0) for (var _t134 = (this.length >> 1) - 1; _t134 >= 0; _t134--) {
          this._down(_t134);
        }
      }

      _createClass(Sh, [{
        key: "push",
        value: function push(t) {
          this.data.push(t), this.length++, this._up(this.length - 1);
        }
      }, {
        key: "pop",
        value: function pop() {
          if (0 === this.length) return;
          var t = this.data[0],
              e = this.data.pop();
          return this.length--, this.length > 0 && (this.data[0] = e, this._down(0)), t;
        }
      }, {
        key: "peek",
        value: function peek() {
          return this.data[0];
        }
      }, {
        key: "_up",
        value: function _up(t) {
          var e = this.data,
              r = this.compare,
              n = e[t];

          for (; t > 0;) {
            var _i91 = t - 1 >> 1,
                _s63 = e[_i91];

            if (r(n, _s63) >= 0) break;
            e[t] = _s63, t = _i91;
          }

          e[t] = n;
        }
      }, {
        key: "_down",
        value: function _down(t) {
          var e = this.data,
              r = this.compare,
              n = this.length >> 1,
              i = e[t];

          for (; t < n;) {
            var _n87 = 1 + (t << 1),
                _s64 = e[_n87];

            var _a51 = _n87 + 1;

            if (_a51 < this.length && r(e[_a51], _s64) < 0 && (_n87 = _a51, _s64 = e[_a51]), r(_s64, i) >= 0) break;
            e[t] = _s64, t = _n87;
          }

          e[t] = i;
        }
      }]);

      return Sh;
    }();

    function Ih(t, e) {
      return t < e ? -1 : t > e ? 1 : 0;
    }

    function zh(t) {
      var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !1;
      var n = 1 / 0,
          s = 1 / 0,
          a = -1 / 0,
          o = -1 / 0;
      var l = t[0];

      for (var _t135 = 0; _t135 < l.length; _t135++) {
        var _e133 = l[_t135];
        (!_t135 || _e133.x < n) && (n = _e133.x), (!_t135 || _e133.y < s) && (s = _e133.y), (!_t135 || _e133.x > a) && (a = _e133.x), (!_t135 || _e133.y > o) && (o = _e133.y);
      }

      var u = Math.min(a - n, o - s);
      var c = u / 2;
      var h = new Sh([], Mh);
      if (0 === u) return new i(n, s);

      for (var _e134 = n; _e134 < a; _e134 += u) {
        for (var _r132 = s; _r132 < o; _r132 += u) {
          h.push(new Th(_e134 + c, _r132 + c, c, t));
        }
      }

      var p = function (t) {
        var e = 0,
            r = 0,
            n = 0;
        var i = t[0];

        for (var _t136 = 0, _s65 = i.length, _a52 = _s65 - 1; _t136 < _s65; _a52 = _t136++) {
          var _s66 = i[_t136],
              _o33 = i[_a52],
              _l28 = _s66.x * _o33.y - _o33.x * _s66.y;

          r += (_s66.x + _o33.x) * _l28, n += (_s66.y + _o33.y) * _l28, e += 3 * _l28;
        }

        return new Th(r / e, n / e, 0, t);
      }(t),
          d = h.length;

      for (; h.length;) {
        var _n88 = h.pop();

        (_n88.d > p.d || !p.d) && (p = _n88, r && console.log("found best %d after %d probes", Math.round(1e4 * _n88.d) / 1e4, d)), _n88.max - p.d <= e || (c = _n88.h / 2, h.push(new Th(_n88.p.x - c, _n88.p.y - c, c, t)), h.push(new Th(_n88.p.x + c, _n88.p.y - c, c, t)), h.push(new Th(_n88.p.x - c, _n88.p.y + c, c, t)), h.push(new Th(_n88.p.x + c, _n88.p.y + c, c, t)), d += 4);
      }

      return r && (console.log("num probes: ".concat(d)), console.log("best distance: ".concat(p.d))), p.p;
    }

    function Mh(t, e) {
      return e.max - t.max;
    }

    function Th(t, e, r, n) {
      this.p = new i(t, e), this.h = r, this.d = function (t, e) {
        var r = !1,
            n = 1 / 0;

        for (var _i92 = 0; _i92 < e.length; _i92++) {
          var _s67 = e[_i92];

          for (var _e135 = 0, _i93 = _s67.length, _a53 = _i93 - 1; _e135 < _i93; _a53 = _e135++) {
            var _i94 = _s67[_e135],
                _o34 = _s67[_a53];
            _i94.y > t.y != _o34.y > t.y && t.x < (_o34.x - _i94.x) * (t.y - _i94.y) / (_o34.y - _i94.y) + _i94.x && (r = !r), n = Math.min(n, sl(t, _i94, _o34));
          }
        }

        return (r ? 1 : -1) * Math.sqrt(n);
      }(this.p, n), this.max = this.d + this.h * Math.SQRT2;
    }

    var Bh = Number.POSITIVE_INFINITY,
        Ch = Math.sqrt(2);

    function Ph(t, e) {
      return e[1] !== Bh ? function (t, e, r) {
        var n = 0,
            i = 0;

        switch (e = Math.abs(e), r = Math.abs(r), t) {
          case "top-right":
          case "top-left":
          case "top":
            i = r - 7;
            break;

          case "bottom-right":
          case "bottom-left":
          case "bottom":
            i = 7 - r;
        }

        switch (t) {
          case "top-right":
          case "bottom-right":
          case "right":
            n = -e;
            break;

          case "top-left":
          case "bottom-left":
          case "left":
            n = e;
        }

        return [n, i];
      }(t, e[0], e[1]) : function (t, e) {
        var r = 0,
            n = 0;
        e < 0 && (e = 0);
        var i = e / Ch;

        switch (t) {
          case "top-right":
          case "top-left":
            n = i - 7;
            break;

          case "bottom-right":
          case "bottom-left":
            n = 7 - i;
            break;

          case "bottom":
            n = 7 - e;
            break;

          case "top":
            n = e - 7;
        }

        switch (t) {
          case "top-right":
          case "bottom-right":
            r = -i;
            break;

          case "top-left":
          case "bottom-left":
            r = i;
            break;

          case "left":
            r = e;
            break;

          case "right":
            r = -e;
        }

        return [r, n];
      }(t, e[0]);
    }

    function Eh(t, e, r, n, i, s, a, o, l, u) {
      t.createArrays(), t.tilePixelRatio = To / (512 * t.overscaling), t.compareText = {}, t.iconsNeedLinear = !1;
      var c = t.layers[0].layout,
          h = t.layers[0]._unevaluatedLayout._values,
          p = {};

      if ("composite" === t.textSizeData.kind) {
        var _t$textSizeData = t.textSizeData,
            _e136 = _t$textSizeData.minZoom,
            _r133 = _t$textSizeData.maxZoom;
        p.compositeTextSizes = [h["text-size"].possiblyEvaluate(new Gs(_e136), o), h["text-size"].possiblyEvaluate(new Gs(_r133), o)];
      }

      if ("composite" === t.iconSizeData.kind) {
        var _t$iconSizeData = t.iconSizeData,
            _e137 = _t$iconSizeData.minZoom,
            _r134 = _t$iconSizeData.maxZoom;
        p.compositeIconSizes = [h["icon-size"].possiblyEvaluate(new Gs(_e137), o), h["icon-size"].possiblyEvaluate(new Gs(_r134), o)];
      }

      p.layoutTextSize = h["text-size"].possiblyEvaluate(new Gs(l + 1), o), p.layoutIconSize = h["icon-size"].possiblyEvaluate(new Gs(l + 1), o), p.textMaxSize = h["text-size"].possiblyEvaluate(new Gs(18), o);
      var d = "map" === c.get("text-rotation-alignment") && "point" !== c.get("symbol-placement"),
          f = c.get("text-size");

      var _iterator103 = _createForOfIteratorHelper(t.features),
          _step103;

      try {
        var _loop3 = function _loop3() {
          var s = _step103.value;
          var l = c.get("text-font").evaluate(s, {}, o).join(","),
              h = f.evaluate(s, {}, o),
              y = p.layoutTextSize.evaluate(s, {}, o),
              m = (p.layoutIconSize.evaluate(s, {}, o), {
            horizontal: {},
            vertical: void 0
          }),
              g = s.text;
          var x = void 0,
              v = [0, 0];

          if (g) {
            var _n89 = g.toString(),
                _a54 = c.get("text-letter-spacing").evaluate(s, {}, o) * sc,
                _u28 = c.get("text-line-height").evaluate(s, {}, o) * sc,
                _p8 = Is(_n89) ? _a54 : 0,
                _f5 = c.get("text-anchor").evaluate(s, {}, o),
                _x4 = c.get("text-variable-anchor");

            if (!_x4) {
              var _t137 = c.get("text-radial-offset").evaluate(s, {}, o);

              v = _t137 ? Ph(_f5, [_t137 * sc, Bh]) : c.get("text-offset").evaluate(s, {}, o).map(function (t) {
                return t * sc;
              });
            }

            var _b3 = d ? "center" : c.get("text-justify").evaluate(s, {}, o);

            var _w3 = c.get("symbol-placement"),
                _4 = "point" === _w3,
                _A3 = "point" === _w3 ? c.get("text-max-width").evaluate(s, {}, o) * sc : 0,
                _k4 = function _k4(s) {
              t.allowVerticalPlacement && Ss(_n89) && (m.vertical = Zc(g, e, r, i, l, _A3, _u28, _f5, s, _p8, v, qc.vertical, !0, _w3, y, h));
            };

            if (!d && _x4) {
              var _t138 = "auto" === _b3 ? _x4.map(function (t) {
                return Dh(t);
              }) : [_b3];

              var _n90 = !1;

              for (var _s68 = 0; _s68 < _t138.length; _s68++) {
                var _a55 = _t138[_s68];
                if (!m.horizontal[_a55]) if (_n90) m.horizontal[_a55] = m.horizontal[0];else {
                  var _t139 = Zc(g, e, r, i, l, _A3, _u28, "center", _a55, _p8, v, qc.horizontal, !1, _w3, y, h);

                  _t139 && (m.horizontal[_a55] = _t139, _n90 = 1 === _t139.positionedLines.length);
                }
              }

              _k4("left");
            } else {
              if ("auto" === _b3 && (_b3 = Dh(_f5)), _4 || c.get("text-writing-mode").indexOf("horizontal") >= 0 || !Ss(_n89)) {
                var _t140 = Zc(g, e, r, i, l, _A3, _u28, _f5, _b3, _p8, v, qc.horizontal, !1, _w3, y, h);

                _t140 && (m.horizontal[_b3] = _t140);
              }

              _k4("point" === _w3 ? "left" : _b3);
            }
          }

          var b = !1;

          if (s.icon && s.icon.name) {
            var _e138 = n[s.icon.name];
            _e138 && (x = nh(i[s.icon.name], c.get("icon-offset").evaluate(s, {}, o), c.get("icon-anchor").evaluate(s, {}, o)), b = _e138.sdf, void 0 === t.sdfIcons ? t.sdfIcons = _e138.sdf : t.sdfIcons !== _e138.sdf && pt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"), (_e138.pixelRatio !== t.pixelRatio || 0 !== c.get("icon-rotate").constantOr(1)) && (t.iconsNeedLinear = !0));
          }

          var w = Rh(m.horizontal) || m.vertical;
          t.iconsInText || (t.iconsInText = !!w && w.iconsInText), (w || x) && Vh(t, s, m, x, n, p, y, 0, v, b, a, o, u);
        };

        for (_iterator103.s(); !(_step103 = _iterator103.n()).done;) {
          _loop3();
        }
      } catch (err) {
        _iterator103.e(err);
      } finally {
        _iterator103.f();
      }

      s && t.generateCollisionDebugBuffers(l, t.collisionBoxArray);
    }

    function Dh(t) {
      switch (t) {
        case "right":
        case "top-right":
        case "bottom-right":
          return "right";

        case "left":
        case "top-left":
        case "bottom-left":
          return "left";
      }

      return "center";
    }

    function Vh(t, e, r, n, i, s, a, o, l, u, c, h, p) {
      var d = s.textMaxSize.evaluate(e, {}, h);
      void 0 === d && (d = a);

      var f = t.layers[0].layout,
          y = f.get("icon-offset").evaluate(e, {}, h),
          m = Rh(r.horizontal) || r.vertical,
          g = a / 24,
          x = t.tilePixelRatio * d / 24,
          v = t.tilePixelRatio * f.get("symbol-spacing"),
          b = f.get("text-padding") * t.tilePixelRatio,
          w = f.get("icon-padding") * t.tilePixelRatio,
          _ = q(f.get("text-max-angle")),
          A = "map" === f.get("text-rotation-alignment") && "point" !== f.get("symbol-placement"),
          k = "map" === f.get("icon-rotation-alignment") && "point" !== f.get("symbol-placement"),
          S = f.get("symbol-placement"),
          I = v / 2,
          z = f.get("icon-text-fit");

      var M;
      n && "none" !== z && (t.allowVerticalPlacement && r.vertical && (M = ih(n, r.vertical, z, f.get("icon-text-fit-padding"), y, g)), m && (n = ih(n, m, z, f.get("icon-text-fit-padding"), y, g)));

      var T = function T(a, o, d) {
        if (o.x < 0 || o.x >= To || o.y < 0 || o.y >= To) return;

        var _p$projectTilePoint = p.projectTilePoint(o.x, o.y, d),
            f = _p$projectTilePoint.x,
            m = _p$projectTilePoint.y,
            g = _p$projectTilePoint.z,
            x = new sh(f, m, g, 0, void 0);

        !function (t, e, r, n, i, s, a, o, l, u, c, h, p, d, f, y, m, g, x, v, b, w, _, A, k) {
          var _l$layout$get$evaluat, _l$layout$get$evaluat2;

          var S = t.addToLineVertexArray(e, n);
          var I,
              z,
              M,
              T,
              B,
              C,
              P,
              E = 0,
              D = 0,
              V = 0,
              F = 0,
              L = -1,
              R = -1;
          var U = {};
          var $ = Ja(""),
              O = 0,
              j = 0;

          if (void 0 === l._unevaluatedLayout.getValue("text-radial-offset") ? (_l$layout$get$evaluat = l.layout.get("text-offset").evaluate(b, {}, k).map(function (t) {
            return t * sc;
          }), _l$layout$get$evaluat2 = _slicedToArray(_l$layout$get$evaluat, 2), O = _l$layout$get$evaluat2[0], j = _l$layout$get$evaluat2[1], _l$layout$get$evaluat) : (O = l.layout.get("text-radial-offset").evaluate(b, {}, k) * sc, j = Bh), t.allowVerticalPlacement && i.vertical) {
            var _t141 = i.vertical;
            if (f) C = $h(_t141), o && (P = $h(o));else {
              var _n91 = l.layout.get("text-rotate").evaluate(b, {}, k) + 90;

              M = Uh(u, r, e, c, h, p, _t141, d, _n91, y), o && (T = Uh(u, r, e, c, h, p, o, g, _n91));
            }
          }

          if (s) {
            var _n92 = l.layout.get("icon-rotate").evaluate(b, {}, k),
                _i95 = "none" !== l.layout.get("icon-text-fit"),
                _a56 = vh(s, _n92, _, _i95),
                _d5 = o ? vh(o, _n92, _, _i95) : void 0;

            z = Uh(u, r, e, c, h, p, s, g, _n92), E = 4 * _a56.length;
            var _f6 = t.iconSizeData;
            var _y4 = null;
            "source" === _f6.kind ? (_y4 = [ac * l.layout.get("icon-size").evaluate(b, {}, k)], _y4[0] > Fh && pt("".concat(t.layerIds[0], ": Value for \"icon-size\" is >= 255. Reduce your \"icon-size\"."))) : "composite" === _f6.kind && (_y4 = [ac * w.compositeIconSizes[0].evaluate(b, {}, k), ac * w.compositeIconSizes[1].evaluate(b, {}, k)], (_y4[0] > Fh || _y4[1] > Fh) && pt("".concat(t.layerIds[0], ": Value for \"icon-size\" is >= 255. Reduce your \"icon-size\"."))), t.addSymbols(t.icon, _a56, _y4, v, x, b, !1, r, e, S.lineStartIndex, S.lineLength, -1, A, k), L = t.icon.placedSymbolArray.length - 1, _d5 && (D = 4 * _d5.length, t.addSymbols(t.icon, _d5, _y4, v, x, b, qc.vertical, r, e, S.lineStartIndex, S.lineLength, -1, A, k), R = t.icon.placedSymbolArray.length - 1);
          }

          for (var _n93 in i.horizontal) {
            var _s69 = i.horizontal[_n93];
            I || ($ = Ja(_s69.text), f ? B = $h(_s69) : I = Uh(u, r, e, c, h, p, _s69, d, l.layout.get("text-rotate").evaluate(b, {}, k), y));

            var _o35 = 1 === _s69.positionedLines.length;

            if (V += Lh(t, r, e, _s69, a, l, f, b, y, S, i.vertical ? qc.horizontal : qc.horizontalOnly, _o35 ? Object.keys(i.horizontal) : [_n93], U, L, w, A, k), _o35) break;
          }

          i.vertical && (F += Lh(t, r, e, i.vertical, a, l, f, b, y, S, qc.vertical, ["vertical"], U, R, w, A, k));
          var q = -1;

          var N = function N(t, e) {
            return t ? Math.max(t, e) : e;
          };

          q = N(B, q), q = N(C, q), q = N(P, q);
          var G = q > -1 ? 1 : 0;
          t.glyphOffsetArray.length >= Yh.MAX_GLYPHS && pt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"), void 0 !== b.sortKey && t.addToSortKeyRanges(t.symbolInstances.length, b.sortKey), t.symbolInstances.emplaceBack(r.x, r.y, r.z, e.x, e.y, U.right >= 0 ? U.right : -1, U.center >= 0 ? U.center : -1, U.left >= 0 ? U.left : -1, U.vertical >= 0 ? U.vertical : -1, L, R, $, void 0 !== I ? I : t.collisionBoxArray.length, void 0 !== I ? I + 1 : t.collisionBoxArray.length, void 0 !== M ? M : t.collisionBoxArray.length, void 0 !== M ? M + 1 : t.collisionBoxArray.length, void 0 !== z ? z : t.collisionBoxArray.length, void 0 !== z ? z + 1 : t.collisionBoxArray.length, T || t.collisionBoxArray.length, T ? T + 1 : t.collisionBoxArray.length, c, V, F, E, D, G, 0, O, j, q);
        }(t, o, x, a, r, n, i, M, t.layers[0], t.collisionBoxArray, e.index, e.sourceLayerIndex, t.index, b, A, l, 0, w, k, y, e, s, u, c, h);
      };

      if ("line" === S) {
        var _iterator104 = _createForOfIteratorHelper(dh(e.geometry, 0, 0, To, To)),
            _step104;

        try {
          for (_iterator104.s(); !(_step104 = _iterator104.n()).done;) {
            var _i96 = _step104.value;

            var _e139 = hh(_i96, v, _, r.vertical || m, n, 24, x, t.overscaling, To);

            var _iterator105 = _createForOfIteratorHelper(_e139),
                _step105;

            try {
              for (_iterator105.s(); !(_step105 = _iterator105.n()).done;) {
                var _r135 = _step105.value;
                var _e140 = m;
                _e140 && Oh(t, _e140.text, I, _r135) || T(_i96, _r135, h);
              }
            } catch (err) {
              _iterator105.e(err);
            } finally {
              _iterator105.f();
            }
          }
        } catch (err) {
          _iterator104.e(err);
        } finally {
          _iterator104.f();
        }
      } else if ("line-center" === S) {
        var _iterator106 = _createForOfIteratorHelper(e.geometry),
            _step106;

        try {
          for (_iterator106.s(); !(_step106 = _iterator106.n()).done;) {
            var _t142 = _step106.value;

            if (_t142.length > 1) {
              var _e141 = ch(_t142, _, r.vertical || m, n, 24, x);

              _e141 && T(_t142, _e141, h);
            }
          }
        } catch (err) {
          _iterator106.e(err);
        } finally {
          _iterator106.f();
        }
      } else if ("Polygon" === e.type) {
        var _iterator107 = _createForOfIteratorHelper(pu(e.geometry, 0)),
            _step107;

        try {
          for (_iterator107.s(); !(_step107 = _iterator107.n()).done;) {
            var _t143 = _step107.value;

            var _e142 = zh(_t143, 16);

            T(_t143[0], new sh(_e142.x, _e142.y, 0, 0, void 0), h);
          }
        } catch (err) {
          _iterator107.e(err);
        } finally {
          _iterator107.f();
        }
      } else if ("LineString" === e.type) {
        var _iterator108 = _createForOfIteratorHelper(e.geometry),
            _step108;

        try {
          for (_iterator108.s(); !(_step108 = _iterator108.n()).done;) {
            var _t144 = _step108.value;
            T(_t144, new sh(_t144[0].x, _t144[0].y, 0, 0, void 0), h);
          }
        } catch (err) {
          _iterator108.e(err);
        } finally {
          _iterator108.f();
        }
      } else if ("Point" === e.type) {
        var _iterator109 = _createForOfIteratorHelper(e.geometry),
            _step109;

        try {
          for (_iterator109.s(); !(_step109 = _iterator109.n()).done;) {
            var _t145 = _step109.value;

            var _iterator110 = _createForOfIteratorHelper(_t145),
                _step110;

            try {
              for (_iterator110.s(); !(_step110 = _iterator110.n()).done;) {
                var _e143 = _step110.value;
                T([_e143], new sh(_e143.x, _e143.y, 0, 0, void 0), h);
              }
            } catch (err) {
              _iterator110.e(err);
            } finally {
              _iterator110.f();
            }
          }
        } catch (err) {
          _iterator109.e(err);
        } finally {
          _iterator109.f();
        }
      }
    }

    var Fh = 32640;

    function Lh(t, e, r, n, s, a, o, l, u, c, h, p, d, f, y, m, g) {
      var x = function (t, e, r, n, s, a, o, l) {
        var u = [];
        if (0 === e.positionedLines.length) return u;

        var c = n.layout.get("text-rotate").evaluate(a, {}) * Math.PI / 180,
            h = function (t) {
          var e = t[0],
              r = t[1],
              n = e * r;
          return n > 0 ? [e, -r] : n < 0 ? [-e, r] : 0 === e ? [r, e] : [r, -e];
        }(r);

        var p = Math.abs(e.top - e.bottom);

        var _iterator111 = _createForOfIteratorHelper(e.positionedLines),
            _step111;

        try {
          for (_iterator111.s(); !(_step111 = _iterator111.n()).done;) {
            var _t149 = _step111.value;
            p -= _t149.lineOffset;
          }
        } catch (err) {
          _iterator111.e(err);
        } finally {
          _iterator111.f();
        }

        var d = e.positionedLines.length,
            f = p / d;
        var y = e.top - r[1];

        for (var _t146 = 0; _t146 < d; ++_t146) {
          var _n94 = e.positionedLines[_t146];
          y = kh(e, f, y, _t146);

          var _iterator112 = _createForOfIteratorHelper(_n94.positionedGlyphs),
              _step112;

          try {
            for (_iterator112.s(); !(_step112 = _iterator112.n()).done;) {
              var _t147 = _step112.value;
              if (!_t147.rect) continue;

              var _n95 = _t147.rect || {};

              var _a57 = 4,
                  _p9 = !0,
                  _d6 = 1,
                  _f7 = 0;

              if (_t147.imageName) {
                var _e144 = o[_t147.imageName];
                if (!_e144) continue;

                if (_e144.sdf) {
                  pt("SDF images are not supported in formatted text and will be ignored.");
                  continue;
                }

                _p9 = !1, _d6 = _e144.pixelRatio, _a57 = 1 / _d6;
              }

              var _m4 = (s || l) && _t147.vertical,
                  _g5 = _t147.metrics.advance * _t147.scale / 2,
                  _x5 = _t147.metrics,
                  _v4 = _t147.rect;

              if (null === _v4) continue;
              l && e.verticalizable && (_f7 = _t147.imageName ? _g5 - _t147.metrics.width * _t147.scale / 2 : 0);

              var _b4 = s ? [_t147.x + _g5, _t147.y] : [0, 0];

              var _w4 = [0, 0],
                  _5 = [0, 0],
                  _A4 = !1;

              s || (_m4 ? (_5 = [_t147.x + _g5 + h[0], _t147.y + h[1] - _f7], _A4 = !0) : _w4 = [_t147.x + _g5 + r[0], _t147.y + r[1] - _f7]);

              var _k5 = _v4.w * _t147.scale / (_d6 * (_t147.localGlyph ? 2 : 1)),
                  _S2 = _v4.h * _t147.scale / (_d6 * (_t147.localGlyph ? 2 : 1));

              var _I2 = void 0,
                  _z2 = void 0,
                  _M2 = void 0,
                  _T = void 0;

              if (_m4) {
                var _e145 = _t147.y - y,
                    _r136 = new i(-_g5, _g5 - _e145),
                    _n96 = -Math.PI / 2,
                    _s70 = _construct(i, _toConsumableArray(_5));

                _I2 = new i(-_g5 + _w4[0], _w4[1]), _I2._rotateAround(_n96, _r136)._add(_s70), _I2.x += -_e145 + _g5, _I2.y -= (_x5.left - _a57) * _t147.scale;

                var _o36 = _t147.imageName ? _x5.advance * _t147.scale : sc * _t147.scale,
                    _l29 = String.fromCharCode(_t147.glyph);

                dc(_l29) ? _I2.x += (1 - _a57) * _t147.scale : fc(_l29) ? _I2.x += _o36 - _x5.height * _t147.scale + (-_a57 - 1) * _t147.scale : _I2.x += _t147.imageName || _x5.width + 2 * _a57 === _v4.w && _x5.height + 2 * _a57 === _v4.h ? (_o36 - _S2) / 2 : (_o36 - (_x5.height + 2 * _a57) * _t147.scale) / 2, _z2 = new i(_I2.x, _I2.y - _k5), _M2 = new i(_I2.x + _S2, _I2.y), _T = new i(_I2.x + _S2, _I2.y - _k5);
              } else {
                var _e146 = (_x5.left - _a57) * _t147.scale - _g5 + _w4[0],
                    _r137 = (-_x5.top - _a57) * _t147.scale + _w4[1],
                    _n97 = _e146 + _k5,
                    _s71 = _r137 + _S2;

                _I2 = new i(_e146, _r137), _z2 = new i(_n97, _r137), _M2 = new i(_e146, _s71), _T = new i(_n97, _s71);
              }

              if (c) {
                var _t148 = void 0;

                _t148 = s ? new i(0, 0) : _A4 ? new i(h[0], h[1]) : new i(r[0], r[1]), _I2._rotateAround(c, _t148), _z2._rotateAround(c, _t148), _M2._rotateAround(c, _t148), _T._rotateAround(c, _t148);
              }

              var _B = new i(0, 0),
                  _C = new i(0, 0);

              u.push({
                tl: _I2,
                tr: _z2,
                bl: _M2,
                br: _T,
                tex: _n95,
                writingMode: e.writingMode,
                glyphOffset: _b4,
                sectionIndex: _t147.sectionIndex,
                isSDF: _p9,
                pixelOffsetTL: _B,
                pixelOffsetBR: _C,
                minFontScaleX: 0,
                minFontScaleY: 0
              });
            }
          } catch (err) {
            _iterator112.e(err);
          } finally {
            _iterator112.f();
          }
        }

        return u;
      }(0, n, u, a, o, l, s, t.allowVerticalPlacement),
          v = t.textSizeData;

      var b = null;
      "source" === v.kind ? (b = [ac * a.layout.get("text-size").evaluate(l, {}, g)], b[0] > Fh && pt("".concat(t.layerIds[0], ": Value for \"text-size\" is >= 255. Reduce your \"text-size\"."))) : "composite" === v.kind && (b = [ac * y.compositeTextSizes[0].evaluate(l, {}, g), ac * y.compositeTextSizes[1].evaluate(l, {}, g)], (b[0] > Fh || b[1] > Fh) && pt("".concat(t.layerIds[0], ": Value for \"text-size\" is >= 255. Reduce your \"text-size\"."))), t.addSymbols(t.text, x, b, u, o, l, h, e, r, c.lineStartIndex, c.lineLength, f, m, g);

      var _iterator113 = _createForOfIteratorHelper(p),
          _step113;

      try {
        for (_iterator113.s(); !(_step113 = _iterator113.n()).done;) {
          var _e147 = _step113.value;
          d[_e147] = t.text.placedSymbolArray.length - 1;
        }
      } catch (err) {
        _iterator113.e(err);
      } finally {
        _iterator113.f();
      }

      return 4 * x.length;
    }

    function Rh(t) {
      for (var _e148 in t) {
        return t[_e148];
      }

      return null;
    }

    function Uh(t, e, r, n, s, a, o, l, u, c) {
      var h = o.top,
          p = o.bottom,
          d = o.left,
          f = o.right;
      var y = o.collisionPadding;

      if (y && (d -= y[0], h -= y[1], f += y[2], p += y[3]), u) {
        var _t150 = new i(d, h),
            _e149 = new i(f, h),
            _r138 = new i(d, p),
            _n98 = new i(f, p),
            _s72 = q(u);

        var _a58 = new i(0, 0);

        c && (_a58 = new i(c[0], c[1])), _t150._rotateAround(_s72, _a58), _e149._rotateAround(_s72, _a58), _r138._rotateAround(_s72, _a58), _n98._rotateAround(_s72, _a58), d = Math.min(_t150.x, _e149.x, _r138.x, _n98.x), f = Math.max(_t150.x, _e149.x, _r138.x, _n98.x), h = Math.min(_t150.y, _e149.y, _r138.y, _n98.y), p = Math.max(_t150.y, _e149.y, _r138.y, _n98.y);
      }

      return t.emplaceBack(e.x, e.y, e.z, r.x, r.y, d, h, f, p, l, n, s, a), t.length - 1;
    }

    function $h(t) {
      t.collisionPadding && (t.top -= t.collisionPadding[1], t.bottom += t.collisionPadding[3]);
      var e = t.bottom - t.top;
      return e > 0 ? Math.max(10, e) : null;
    }

    function Oh(t, e, r, n) {
      var i = t.compareText;

      if (e in i) {
        var _t151 = i[e];

        for (var _e150 = _t151.length - 1; _e150 >= 0; _e150--) {
          if (n.dist(_t151[_e150]) < r) return !0;
        }
      } else i[e] = [];

      return i[e].push(n), !1;
    }

    var jh = Bu.VectorTileFeature.types,
        qh = [{
      name: "a_fade_opacity",
      components: 1,
      type: "Uint8",
      offset: 0
    }];

    function Nh(t, e, r, n, i, s, a, o, l, u, c, h, p, d, f, y) {
      var m = c ? Math.min(Fh, Math.round(c[0])) : 0,
          g = c ? Math.min(Fh, Math.round(c[1])) : 0;
      t.emplaceBack(e, r, Math.round(32 * a), Math.round(32 * o), l, u, (m << 1) + (h ? 1 : 0), g, 16 * p, 16 * d, 256 * f, 256 * y, n, i, s, 0);
    }

    function Gh(t, e, r) {
      t.emplaceBack(e.x, e.y, r), t.emplaceBack(e.x, e.y, r), t.emplaceBack(e.x, e.y, r), t.emplaceBack(e.x, e.y, r);
    }

    function Zh(t) {
      var _iterator114 = _createForOfIteratorHelper(t.sections),
          _step114;

      try {
        for (_iterator114.s(); !(_step114 = _iterator114.n()).done;) {
          var _e151 = _step114.value;
          if (Ps(_e151.text)) return !0;
        }
      } catch (err) {
        _iterator114.e(err);
      } finally {
        _iterator114.f();
      }

      return !1;
    }

    var Xh = /*#__PURE__*/function () {
      function Xh(t) {
        _classCallCheck(this, Xh);

        this.layoutVertexArray = new xa(), this.indexArray = new ka(), this.programConfigurations = t, this.segments = new Mo(), this.dynamicLayoutVertexArray = new ya(), this.opacityVertexArray = new va(), this.placedSymbolArray = new Ra();
      }

      _createClass(Xh, [{
        key: "isEmpty",
        value: function isEmpty() {
          return 0 === this.layoutVertexArray.length && 0 === this.indexArray.length && 0 === this.dynamicLayoutVertexArray.length && 0 === this.opacityVertexArray.length;
        }
      }, {
        key: "upload",
        value: function upload(t, e, r, n) {
          this.isEmpty() || (r && (this.layoutVertexBuffer = t.createVertexBuffer(this.layoutVertexArray, Qu.members), this.indexBuffer = t.createIndexBuffer(this.indexArray, e), this.dynamicLayoutVertexBuffer = t.createVertexBuffer(this.dynamicLayoutVertexArray, tc.members, !0), this.opacityVertexBuffer = t.createVertexBuffer(this.opacityVertexArray, qh, !0), this.opacityVertexBuffer.itemSize = 1), (r || n) && this.programConfigurations.upload(t));
        }
      }, {
        key: "destroy",
        value: function destroy() {
          this.layoutVertexBuffer && (this.layoutVertexBuffer.destroy(), this.indexBuffer.destroy(), this.programConfigurations.destroy(), this.segments.destroy(), this.dynamicLayoutVertexBuffer.destroy(), this.opacityVertexBuffer.destroy());
        }
      }]);

      return Xh;
    }();

    Zi("SymbolBuffers", Xh);

    var Kh = /*#__PURE__*/function () {
      function Kh(t, e, r) {
        _classCallCheck(this, Kh);

        this.layoutVertexArray = new t(), this.layoutAttributes = e, this.indexArray = new r(), this.segments = new Mo(), this.collisionVertexArray = new Aa(), this.collisionVertexArrayExt = new ya();
      }

      _createClass(Kh, [{
        key: "upload",
        value: function upload(t) {
          this.layoutVertexBuffer = t.createVertexBuffer(this.layoutVertexArray, this.layoutAttributes), this.indexBuffer = t.createIndexBuffer(this.indexArray), this.collisionVertexBuffer = t.createVertexBuffer(this.collisionVertexArray, ec.members, !0), this.collisionVertexBufferExt = t.createVertexBuffer(this.collisionVertexArrayExt, rc.members, !0);
        }
      }, {
        key: "destroy",
        value: function destroy() {
          this.layoutVertexBuffer && (this.layoutVertexBuffer.destroy(), this.indexBuffer.destroy(), this.segments.destroy(), this.collisionVertexBuffer.destroy(), this.collisionVertexBufferExt.destroy());
        }
      }]);

      return Kh;
    }();

    Zi("CollisionBuffers", Kh);

    var Yh = /*#__PURE__*/function () {
      function Yh(t) {
        _classCallCheck(this, Yh);

        this.collisionBoxArray = t.collisionBoxArray, this.zoom = t.zoom, this.overscaling = t.overscaling, this.layers = t.layers, this.layerIds = this.layers.map(function (t) {
          return t.id;
        }), this.index = t.index, this.pixelRatio = t.pixelRatio, this.sourceLayerIndex = t.sourceLayerIndex, this.hasPattern = !1, this.hasRTLText = !1, this.fullyClipped = !1, this.sortKeyRanges = [], this.collisionCircleArray = [], this.placementInvProjMatrix = c([]), this.placementViewportMatrix = c([]);
        var e = this.layers[0]._unevaluatedLayout._values;
        this.textSizeData = oc(this.zoom, e["text-size"]), this.iconSizeData = oc(this.zoom, e["icon-size"]);
        var r = this.layers[0].layout,
            n = r.get("symbol-sort-key"),
            i = r.get("symbol-z-order");
        this.canOverlap = r.get("text-allow-overlap") || r.get("icon-allow-overlap") || r.get("text-ignore-placement") || r.get("icon-ignore-placement"), this.sortFeaturesByKey = "viewport-y" !== i && void 0 !== n.constantOr(1), this.sortFeaturesByY = ("viewport-y" === i || "auto" === i && !this.sortFeaturesByKey) && this.canOverlap, this.writingModes = r.get("text-writing-mode").map(function (t) {
          return qc[t];
        }), this.stateDependentLayerIds = this.layers.filter(function (t) {
          return t.isStateDependent();
        }).map(function (t) {
          return t.id;
        }), this.sourceID = t.sourceID;
      }

      _createClass(Yh, [{
        key: "createArrays",
        value: function createArrays() {
          this.text = new Xh(new xo(this.layers, this.zoom, function (t) {
            return /^text/.test(t);
          })), this.icon = new Xh(new xo(this.layers, this.zoom, function (t) {
            return /^icon/.test(t);
          })), this.glyphOffsetArray = new Oa(), this.lineVertexArray = new ja(), this.symbolInstances = new $a();
        }
      }, {
        key: "calculateGlyphDependencies",
        value: function calculateGlyphDependencies(t, e, r, n, i) {
          for (var _r139 = 0; _r139 < t.length; _r139++) {
            if (e[t.charCodeAt(_r139)] = !0, n && i) {
              var _n99 = pc[t.charAt(_r139)];
              _n99 && (e[_n99.charCodeAt(0)] = !0);
            }
          }
        }
      }, {
        key: "populate",
        value: function populate(t, e, r, n) {
          var i = this.layers[0],
              s = i.layout,
              a = s.get("text-font"),
              o = s.get("text-field"),
              l = s.get("icon-image"),
              u = ("constant" !== o.value.kind || o.value.value instanceof Ke && !o.value.value.isEmpty() || o.value.value.toString().length > 0) && ("constant" !== a.value.kind || a.value.value.length > 0),
              c = "constant" !== l.value.kind || !!l.value.value || Object.keys(l.parameters).length > 0,
              h = s.get("symbol-sort-key");
          if (this.features = [], !u && !c) return;
          var p = e.iconDependencies,
              d = e.glyphDependencies,
              f = e.availableImages,
              y = new Gs(this.zoom);

          var _iterator115 = _createForOfIteratorHelper(t),
              _step115;

          try {
            for (_iterator115.s(); !(_step115 = _iterator115.n()).done;) {
              var _ref160 = _step115.value;
              var _e152 = _ref160.feature;
              var _o37 = _ref160.id;
              var _l30 = _ref160.index;
              var _m5 = _ref160.sourceLayerIndex;

              var _t153 = i._featureFilter.needGeometry,
                  _g6 = Yo(_e152, _t153);

              if (!i._featureFilter.filter(y, _g6, r)) continue;

              var _x6 = void 0,
                  _v5 = void 0;

              if (_t153 || (_g6.geometry = Ko(_e152, r, n)), u) {
                var _t154 = i.getValueAndResolveTokens("text-field", _g6, r, f),
                    _e153 = Ke.factory(_t154);

                Zh(_e153) && (this.hasRTLText = !0), (!this.hasRTLText || "unavailable" === js() || this.hasRTLText && Ns.isParsed()) && (_x6 = hc(_e153, i, _g6));
              }

              if (c) {
                var _t155 = i.getValueAndResolveTokens("icon-image", _g6, r, f);

                _v5 = _t155 instanceof Ye ? _t155 : Ye.fromString(_t155);
              }

              if (!_x6 && !_v5) continue;

              var _b5 = this.sortFeaturesByKey ? h.evaluate(_g6, {}, r) : void 0;

              if (this.features.push({
                id: _o37,
                text: _x6,
                icon: _v5,
                index: _l30,
                sourceLayerIndex: _m5,
                geometry: _g6.geometry,
                properties: _e152.properties,
                type: jh[_e152.type],
                sortKey: _b5
              }), _v5 && (p[_v5.name] = !0), _x6) {
                var _t156 = a.evaluate(_g6, {}, r).join(","),
                    _e154 = "map" === s.get("text-rotation-alignment") && "point" !== s.get("symbol-placement");

                this.allowVerticalPlacement = this.writingModes && this.writingModes.indexOf(qc.vertical) >= 0;

                var _iterator116 = _createForOfIteratorHelper(_x6.sections),
                    _step116;

                try {
                  for (_iterator116.s(); !(_step116 = _iterator116.n()).done;) {
                    var _r140 = _step116.value;
                    if (_r140.image) p[_r140.image.name] = !0;else {
                      var _n100 = Ss(_x6.toString()),
                          _i98 = _r140.fontStack || _t156,
                          _s73 = d[_i98] = d[_i98] || {};

                      this.calculateGlyphDependencies(_r140.text, _s73, _e154, this.allowVerticalPlacement, _n100);
                    }
                  }
                } catch (err) {
                  _iterator116.e(err);
                } finally {
                  _iterator116.f();
                }
              }
            }
          } catch (err) {
            _iterator115.e(err);
          } finally {
            _iterator115.f();
          }

          "line" === s.get("symbol-placement") && (this.features = function (t) {
            var e = {},
                r = {},
                n = [];
            var i = 0;

            function s(e) {
              n.push(t[e]), i++;
            }

            function a(t, e, i) {
              var s = r[t];
              return delete r[t], r[e] = s, n[s].geometry[0].pop(), n[s].geometry[0] = n[s].geometry[0].concat(i[0]), s;
            }

            function o(t, r, i) {
              var s = e[r];
              return delete e[r], e[t] = s, n[s].geometry[0].shift(), n[s].geometry[0] = i[0].concat(n[s].geometry[0]), s;
            }

            function l(t, e, r) {
              var n = r ? e[0][e[0].length - 1] : e[0][0];
              return "".concat(t, ":").concat(n.x, ":").concat(n.y);
            }

            for (var _u29 = 0; _u29 < t.length; _u29++) {
              var _c16 = t[_u29],
                  _h9 = _c16.geometry,
                  _p10 = _c16.text ? _c16.text.toString() : null;

              if (!_p10) {
                s(_u29);
                continue;
              }

              var _d7 = l(_p10, _h9),
                  _f8 = l(_p10, _h9, !0);

              if (_d7 in r && _f8 in e && r[_d7] !== e[_f8]) {
                var _t152 = o(_d7, _f8, _h9),
                    _i97 = a(_d7, _f8, n[_t152].geometry);

                delete e[_d7], delete r[_f8], r[l(_p10, n[_i97].geometry, !0)] = _i97, n[_t152].geometry = null;
              } else _d7 in r ? a(_d7, _f8, _h9) : _f8 in e ? o(_d7, _f8, _h9) : (s(_u29), e[_d7] = i - 1, r[_f8] = i - 1);
            }

            return n.filter(function (t) {
              return t.geometry;
            });
          }(this.features)), this.sortFeaturesByKey && this.features.sort(function (t, e) {
            return t.sortKey - e.sortKey;
          });
        }
      }, {
        key: "update",
        value: function update(t, e, r, n) {
          this.stateDependentLayers.length && (this.text.programConfigurations.updatePaintArrays(t, e, this.layers, r, n), this.icon.programConfigurations.updatePaintArrays(t, e, this.layers, r, n));
        }
      }, {
        key: "isEmpty",
        value: function isEmpty() {
          return 0 === this.symbolInstances.length && !this.hasRTLText;
        }
      }, {
        key: "uploadPending",
        value: function uploadPending() {
          return !this.uploaded || this.text.programConfigurations.needsUpload || this.icon.programConfigurations.needsUpload;
        }
      }, {
        key: "upload",
        value: function upload(t) {
          !this.uploaded && this.hasDebugData() && (this.textCollisionBox.upload(t), this.iconCollisionBox.upload(t)), this.text.upload(t, this.sortFeaturesByY, !this.uploaded, this.text.programConfigurations.needsUpload), this.icon.upload(t, this.sortFeaturesByY, !this.uploaded, this.icon.programConfigurations.needsUpload), this.uploaded = !0;
        }
      }, {
        key: "destroyDebugData",
        value: function destroyDebugData() {
          this.textCollisionBox.destroy(), this.iconCollisionBox.destroy();
        }
      }, {
        key: "destroy",
        value: function destroy() {
          this.text.destroy(), this.icon.destroy(), this.hasDebugData() && this.destroyDebugData();
        }
      }, {
        key: "addToLineVertexArray",
        value: function addToLineVertexArray(t, e) {
          var r = this.lineVertexArray.length;

          if (void 0 !== t.segment) {
            var _r141 = t.dist(e[t.segment + 1]),
                _n101 = t.dist(e[t.segment]);

            var _i99 = {};

            for (var _n102 = t.segment + 1; _n102 < e.length; _n102++) {
              _i99[_n102] = {
                x: e[_n102].x,
                y: e[_n102].y,
                tileUnitDistanceFromAnchor: _r141
              }, _n102 < e.length - 1 && (_r141 += e[_n102 + 1].dist(e[_n102]));
            }

            for (var _r142 = t.segment || 0; _r142 >= 0; _r142--) {
              _i99[_r142] = {
                x: e[_r142].x,
                y: e[_r142].y,
                tileUnitDistanceFromAnchor: _n101
              }, _r142 > 0 && (_n101 += e[_r142 - 1].dist(e[_r142]));
            }

            for (var _t157 = 0; _t157 < e.length; _t157++) {
              var _e155 = _i99[_t157];
              this.lineVertexArray.emplaceBack(_e155.x, _e155.y, _e155.tileUnitDistanceFromAnchor);
            }
          }

          return {
            lineStartIndex: r,
            lineLength: this.lineVertexArray.length - r
          };
        }
      }, {
        key: "addSymbols",
        value: function addSymbols(t, e, r, n, i, s, a, o, l, u, c, h, p, d) {
          var f = t.indexArray,
              y = t.layoutVertexArray,
              m = t.segments.prepareSegment(4 * e.length, y, f, this.canOverlap ? s.sortKey : void 0),
              g = this.glyphOffsetArray.length,
              x = m.vertexLength,
              v = this.allowVerticalPlacement && a === qc.vertical ? Math.PI / 2 : 0,
              b = s.text && s.text.sections;

          for (var _n103 = 0; _n103 < e.length; _n103++) {
            var _e$_n = e[_n103],
                _i100 = _e$_n.tl,
                _a59 = _e$_n.tr,
                _u30 = _e$_n.bl,
                _c17 = _e$_n.br,
                _h10 = _e$_n.tex,
                _g7 = _e$_n.pixelOffsetTL,
                _x7 = _e$_n.pixelOffsetBR,
                _w5 = _e$_n.minFontScaleX,
                _6 = _e$_n.minFontScaleY,
                _A5 = _e$_n.glyphOffset,
                _k6 = _e$_n.isSDF,
                _S3 = _e$_n.sectionIndex,
                _I3 = m.vertexLength,
                _z3 = _A5[1];
            Nh(y, o.x, o.y, o.z, l.x, l.y, _i100.x, _z3 + _i100.y, _h10.x, _h10.y, r, _k6, _g7.x, _g7.y, _w5, _6), Nh(y, o.x, o.y, o.z, l.x, l.y, _a59.x, _z3 + _a59.y, _h10.x + _h10.w, _h10.y, r, _k6, _x7.x, _g7.y, _w5, _6), Nh(y, o.x, o.y, o.z, l.x, l.y, _u30.x, _z3 + _u30.y, _h10.x, _h10.y + _h10.h, r, _k6, _g7.x, _x7.y, _w5, _6), Nh(y, o.x, o.y, o.z, l.x, l.y, _c17.x, _z3 + _c17.y, _h10.x + _h10.w, _h10.y + _h10.h, r, _k6, _x7.x, _x7.y, _w5, _6), Gh(t.dynamicLayoutVertexArray, o, v), f.emplaceBack(_I3, _I3 + 1, _I3 + 2), f.emplaceBack(_I3 + 1, _I3 + 2, _I3 + 3), m.vertexLength += 4, m.primitiveLength += 2, this.glyphOffsetArray.emplaceBack(_A5[0]), _n103 !== e.length - 1 && _S3 === e[_n103 + 1].sectionIndex || t.programConfigurations.populatePaintArrays(y.length, s, s.index, {}, p, d, b && b[_S3]);
          }

          t.placedSymbolArray.emplaceBack(o.x, o.y, o.z, l.x, l.y, g, this.glyphOffsetArray.length - g, x, u, c, l.segment, r ? r[0] : 0, r ? r[1] : 0, n[0], n[1], a, 0, !1, 0, h, 0);
        }
      }, {
        key: "_commitLayoutVertex",
        value: function _commitLayoutVertex(t, e, r, n, i, s, a) {
          t.emplaceBack(e, r, n, i, s, Math.round(a.x), Math.round(a.y));
        }
      }, {
        key: "_addCollisionDebugVertices",
        value: function _addCollisionDebugVertices(t, e, r, n, s, a, o) {
          var l = r.segments.prepareSegment(4, r.layoutVertexArray, r.indexArray),
              u = l.vertexLength,
              c = o.tileAnchorX,
              h = o.tileAnchorY;

          for (var _t158 = 0; _t158 < 4; _t158++) {
            r.collisionVertexArray.emplaceBack(0, 0, 0, 0);
          }

          r.collisionVertexArrayExt.emplaceBack(e, -t.padding, -t.padding), r.collisionVertexArrayExt.emplaceBack(e, t.padding, -t.padding), r.collisionVertexArrayExt.emplaceBack(e, t.padding, t.padding), r.collisionVertexArrayExt.emplaceBack(e, -t.padding, t.padding), this._commitLayoutVertex(r.layoutVertexArray, n, s, a, c, h, new i(t.x1, t.y1)), this._commitLayoutVertex(r.layoutVertexArray, n, s, a, c, h, new i(t.x2, t.y1)), this._commitLayoutVertex(r.layoutVertexArray, n, s, a, c, h, new i(t.x2, t.y2)), this._commitLayoutVertex(r.layoutVertexArray, n, s, a, c, h, new i(t.x1, t.y2)), l.vertexLength += 4;
          var p = r.indexArray;
          p.emplaceBack(u, u + 1), p.emplaceBack(u + 1, u + 2), p.emplaceBack(u + 2, u + 3), p.emplaceBack(u + 3, u), l.primitiveLength += 4;
        }
      }, {
        key: "_addTextDebugCollisionBoxes",
        value: function _addTextDebugCollisionBoxes(t, e, r, n, i, s) {
          for (var _a60 = n; _a60 < i; _a60++) {
            var _n104 = r.get(_a60),
                _i101 = this.getSymbolInstanceTextSize(t, s, e, _a60);

            this._addCollisionDebugVertices(_n104, _i101, this.textCollisionBox, _n104.projectedAnchorX, _n104.projectedAnchorY, _n104.projectedAnchorZ, s);
          }
        }
      }, {
        key: "_addIconDebugCollisionBoxes",
        value: function _addIconDebugCollisionBoxes(t, e, r, n, i, s) {
          for (var _a61 = n; _a61 < i; _a61++) {
            var _n105 = r.get(_a61),
                _i102 = this.getSymbolInstanceIconSize(t, e, _a61);

            this._addCollisionDebugVertices(_n105, _i102, this.iconCollisionBox, _n105.projectedAnchorX, _n105.projectedAnchorY, _n105.projectedAnchorZ, s);
          }
        }
      }, {
        key: "generateCollisionDebugBuffers",
        value: function generateCollisionDebugBuffers(t, e) {
          this.hasDebugData() && this.destroyDebugData(), this.textCollisionBox = new Kh(wa, nc.members, Ca), this.iconCollisionBox = new Kh(wa, nc.members, Ca);
          var r = uc(this.iconSizeData, t),
              n = uc(this.textSizeData, t);

          for (var _i103 = 0; _i103 < this.symbolInstances.length; _i103++) {
            var _s74 = this.symbolInstances.get(_i103);

            this._addTextDebugCollisionBoxes(n, t, e, _s74.textBoxStartIndex, _s74.textBoxEndIndex, _s74), this._addTextDebugCollisionBoxes(n, t, e, _s74.verticalTextBoxStartIndex, _s74.verticalTextBoxEndIndex, _s74), this._addIconDebugCollisionBoxes(r, t, e, _s74.iconBoxStartIndex, _s74.iconBoxEndIndex, _s74), this._addIconDebugCollisionBoxes(r, t, e, _s74.verticalIconBoxStartIndex, _s74.verticalIconBoxEndIndex, _s74);
          }
        }
      }, {
        key: "getSymbolInstanceTextSize",
        value: function getSymbolInstanceTextSize(t, e, r, n) {
          var i = this.text.placedSymbolArray.get(e.rightJustifiedTextSymbolIndex >= 0 ? e.rightJustifiedTextSymbolIndex : e.centerJustifiedTextSymbolIndex >= 0 ? e.centerJustifiedTextSymbolIndex : e.leftJustifiedTextSymbolIndex >= 0 ? e.leftJustifiedTextSymbolIndex : e.verticalPlacedTextSymbolIndex >= 0 ? e.verticalPlacedTextSymbolIndex : n),
              s = lc(this.textSizeData, t, i) / sc;
          return this.tilePixelRatio * s;
        }
      }, {
        key: "getSymbolInstanceIconSize",
        value: function getSymbolInstanceIconSize(t, e, r) {
          var n = this.icon.placedSymbolArray.get(r),
              i = lc(this.iconSizeData, t, n);
          return this.tilePixelRatio * i;
        }
      }, {
        key: "_commitDebugCollisionVertexUpdate",
        value: function _commitDebugCollisionVertexUpdate(t, e, r) {
          t.emplaceBack(e, -r, -r), t.emplaceBack(e, r, -r), t.emplaceBack(e, r, r), t.emplaceBack(e, -r, r);
        }
      }, {
        key: "_updateTextDebugCollisionBoxes",
        value: function _updateTextDebugCollisionBoxes(t, e, r, n, i, s) {
          for (var _a62 = n; _a62 < i; _a62++) {
            var _n106 = r.get(_a62),
                _i104 = this.getSymbolInstanceTextSize(t, s, e, _a62);

            this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt, _i104, _n106.padding);
          }
        }
      }, {
        key: "_updateIconDebugCollisionBoxes",
        value: function _updateIconDebugCollisionBoxes(t, e, r, n, i) {
          for (var _s75 = n; _s75 < i; _s75++) {
            var _n107 = r.get(_s75),
                _i105 = this.getSymbolInstanceIconSize(t, e, _s75);

            this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt, _i105, _n107.padding);
          }
        }
      }, {
        key: "updateCollisionDebugBuffers",
        value: function updateCollisionDebugBuffers(t, e) {
          if (!this.hasDebugData()) return;
          this.hasTextCollisionBoxData() && this.textCollisionBox.collisionVertexArrayExt.clear(), this.hasIconCollisionBoxData() && this.iconCollisionBox.collisionVertexArrayExt.clear();
          var r = uc(this.iconSizeData, t),
              n = uc(this.textSizeData, t);

          for (var _i106 = 0; _i106 < this.symbolInstances.length; _i106++) {
            var _s76 = this.symbolInstances.get(_i106);

            this._updateTextDebugCollisionBoxes(n, t, e, _s76.textBoxStartIndex, _s76.textBoxEndIndex, _s76), this._updateTextDebugCollisionBoxes(n, t, e, _s76.verticalTextBoxStartIndex, _s76.verticalTextBoxEndIndex, _s76), this._updateIconDebugCollisionBoxes(r, t, e, _s76.iconBoxStartIndex, _s76.iconBoxEndIndex), this._updateIconDebugCollisionBoxes(r, t, e, _s76.verticalIconBoxStartIndex, _s76.verticalIconBoxEndIndex);
          }

          this.hasTextCollisionBoxData() && this.textCollisionBox.collisionVertexBufferExt && this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt), this.hasIconCollisionBoxData() && this.iconCollisionBox.collisionVertexBufferExt && this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt);
        }
      }, {
        key: "_deserializeCollisionBoxesForSymbol",
        value: function _deserializeCollisionBoxesForSymbol(t, e, r, n, i, s, a, o, l) {
          var u = {};

          for (var _n108 = e; _n108 < r; _n108++) {
            var _e156 = t.get(_n108);

            u.textBox = {
              x1: _e156.x1,
              y1: _e156.y1,
              x2: _e156.x2,
              y2: _e156.y2,
              padding: _e156.padding,
              projectedAnchorX: _e156.projectedAnchorX,
              projectedAnchorY: _e156.projectedAnchorY,
              projectedAnchorZ: _e156.projectedAnchorZ,
              tileAnchorX: _e156.tileAnchorX,
              tileAnchorY: _e156.tileAnchorY
            }, u.textFeatureIndex = _e156.featureIndex;
            break;
          }

          for (var _e157 = n; _e157 < i; _e157++) {
            var _r143 = t.get(_e157);

            u.verticalTextBox = {
              x1: _r143.x1,
              y1: _r143.y1,
              x2: _r143.x2,
              y2: _r143.y2,
              padding: _r143.padding,
              projectedAnchorX: _r143.projectedAnchorX,
              projectedAnchorY: _r143.projectedAnchorY,
              projectedAnchorZ: _r143.projectedAnchorZ,
              tileAnchorX: _r143.tileAnchorX,
              tileAnchorY: _r143.tileAnchorY
            }, u.verticalTextFeatureIndex = _r143.featureIndex;
            break;
          }

          for (var _e158 = s; _e158 < a; _e158++) {
            var _r144 = t.get(_e158);

            u.iconBox = {
              x1: _r144.x1,
              y1: _r144.y1,
              x2: _r144.x2,
              y2: _r144.y2,
              padding: _r144.padding,
              projectedAnchorX: _r144.projectedAnchorX,
              projectedAnchorY: _r144.projectedAnchorY,
              projectedAnchorZ: _r144.projectedAnchorZ,
              tileAnchorX: _r144.tileAnchorX,
              tileAnchorY: _r144.tileAnchorY
            }, u.iconFeatureIndex = _r144.featureIndex;
            break;
          }

          for (var _e159 = o; _e159 < l; _e159++) {
            var _r145 = t.get(_e159);

            u.verticalIconBox = {
              x1: _r145.x1,
              y1: _r145.y1,
              x2: _r145.x2,
              y2: _r145.y2,
              padding: _r145.padding,
              projectedAnchorX: _r145.projectedAnchorX,
              projectedAnchorY: _r145.projectedAnchorY,
              projectedAnchorZ: _r145.projectedAnchorZ,
              tileAnchorX: _r145.tileAnchorX,
              tileAnchorY: _r145.tileAnchorY
            }, u.verticalIconFeatureIndex = _r145.featureIndex;
            break;
          }

          return u;
        }
      }, {
        key: "deserializeCollisionBoxes",
        value: function deserializeCollisionBoxes(t) {
          this.collisionArrays = [];

          for (var _e160 = 0; _e160 < this.symbolInstances.length; _e160++) {
            var _r146 = this.symbolInstances.get(_e160);

            this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t, _r146.textBoxStartIndex, _r146.textBoxEndIndex, _r146.verticalTextBoxStartIndex, _r146.verticalTextBoxEndIndex, _r146.iconBoxStartIndex, _r146.iconBoxEndIndex, _r146.verticalIconBoxStartIndex, _r146.verticalIconBoxEndIndex));
          }
        }
      }, {
        key: "hasTextData",
        value: function hasTextData() {
          return this.text.segments.get().length > 0;
        }
      }, {
        key: "hasIconData",
        value: function hasIconData() {
          return this.icon.segments.get().length > 0;
        }
      }, {
        key: "hasDebugData",
        value: function hasDebugData() {
          return this.textCollisionBox && this.iconCollisionBox;
        }
      }, {
        key: "hasTextCollisionBoxData",
        value: function hasTextCollisionBoxData() {
          return this.hasDebugData() && this.textCollisionBox.segments.get().length > 0;
        }
      }, {
        key: "hasIconCollisionBoxData",
        value: function hasIconCollisionBoxData() {
          return this.hasDebugData() && this.iconCollisionBox.segments.get().length > 0;
        }
      }, {
        key: "addIndicesForPlacedSymbol",
        value: function addIndicesForPlacedSymbol(t, e) {
          var r = t.placedSymbolArray.get(e),
              n = r.vertexStartIndex + 4 * r.numGlyphs;

          for (var _e161 = r.vertexStartIndex; _e161 < n; _e161 += 4) {
            t.indexArray.emplaceBack(_e161, _e161 + 1, _e161 + 2), t.indexArray.emplaceBack(_e161 + 1, _e161 + 2, _e161 + 3);
          }
        }
      }, {
        key: "getSortedSymbolIndexes",
        value: function getSortedSymbolIndexes(t) {
          if (this.sortedAngle === t && void 0 !== this.symbolInstanceIndexes) return this.symbolInstanceIndexes;
          var e = Math.sin(t),
              r = Math.cos(t),
              n = [],
              i = [],
              s = [];

          for (var _t159 = 0; _t159 < this.symbolInstances.length; ++_t159) {
            s.push(_t159);

            var _a63 = this.symbolInstances.get(_t159);

            n.push(0 | Math.round(e * _a63.tileAnchorX + r * _a63.tileAnchorY)), i.push(_a63.featureIndex);
          }

          return s.sort(function (t, e) {
            return n[t] - n[e] || i[e] - i[t];
          }), s;
        }
      }, {
        key: "addToSortKeyRanges",
        value: function addToSortKeyRanges(t, e) {
          var r = this.sortKeyRanges[this.sortKeyRanges.length - 1];
          r && r.sortKey === e ? r.symbolInstanceEnd = t + 1 : this.sortKeyRanges.push({
            sortKey: e,
            symbolInstanceStart: t,
            symbolInstanceEnd: t + 1
          });
        }
      }, {
        key: "sortFeatures",
        value: function sortFeatures(t) {
          var _this22 = this;

          if (this.sortFeaturesByY && this.sortedAngle !== t && !(this.text.segments.get().length > 1 || this.icon.segments.get().length > 1)) {
            this.symbolInstanceIndexes = this.getSortedSymbolIndexes(t), this.sortedAngle = t, this.text.indexArray.clear(), this.icon.indexArray.clear(), this.featureSortOrder = [];

            var _iterator117 = _createForOfIteratorHelper(this.symbolInstanceIndexes),
                _step117;

            try {
              for (_iterator117.s(); !(_step117 = _iterator117.n()).done;) {
                var _t160 = _step117.value;

                var _e162 = this.symbolInstances.get(_t160);

                this.featureSortOrder.push(_e162.featureIndex), [_e162.rightJustifiedTextSymbolIndex, _e162.centerJustifiedTextSymbolIndex, _e162.leftJustifiedTextSymbolIndex].forEach(function (t, e, r) {
                  t >= 0 && r.indexOf(t) === e && _this22.addIndicesForPlacedSymbol(_this22.text, t);
                }), _e162.verticalPlacedTextSymbolIndex >= 0 && this.addIndicesForPlacedSymbol(this.text, _e162.verticalPlacedTextSymbolIndex), _e162.placedIconSymbolIndex >= 0 && this.addIndicesForPlacedSymbol(this.icon, _e162.placedIconSymbolIndex), _e162.verticalPlacedIconSymbolIndex >= 0 && this.addIndicesForPlacedSymbol(this.icon, _e162.verticalPlacedIconSymbolIndex);
              }
            } catch (err) {
              _iterator117.e(err);
            } finally {
              _iterator117.f();
            }

            this.text.indexBuffer && this.text.indexBuffer.updateData(this.text.indexArray), this.icon.indexBuffer && this.icon.indexBuffer.updateData(this.icon.indexArray);
          }
        }
      }]);

      return Yh;
    }();

    Zi("SymbolBucket", Yh, {
      omit: ["layers", "collisionBoxArray", "features", "compareText"]
    }), Yh.MAX_GLYPHS = 65535, Yh.addDynamicAttributes = Gh;
    var Hh = new sa({
      "symbol-placement": new ta(ve.layout_symbol["symbol-placement"]),
      "symbol-spacing": new ta(ve.layout_symbol["symbol-spacing"]),
      "symbol-avoid-edges": new ta(ve.layout_symbol["symbol-avoid-edges"]),
      "symbol-sort-key": new ea(ve.layout_symbol["symbol-sort-key"]),
      "symbol-z-order": new ta(ve.layout_symbol["symbol-z-order"]),
      "icon-allow-overlap": new ta(ve.layout_symbol["icon-allow-overlap"]),
      "icon-ignore-placement": new ta(ve.layout_symbol["icon-ignore-placement"]),
      "icon-optional": new ta(ve.layout_symbol["icon-optional"]),
      "icon-rotation-alignment": new ta(ve.layout_symbol["icon-rotation-alignment"]),
      "icon-size": new ea(ve.layout_symbol["icon-size"]),
      "icon-text-fit": new ta(ve.layout_symbol["icon-text-fit"]),
      "icon-text-fit-padding": new ta(ve.layout_symbol["icon-text-fit-padding"]),
      "icon-image": new ea(ve.layout_symbol["icon-image"]),
      "icon-rotate": new ea(ve.layout_symbol["icon-rotate"]),
      "icon-padding": new ta(ve.layout_symbol["icon-padding"]),
      "icon-keep-upright": new ta(ve.layout_symbol["icon-keep-upright"]),
      "icon-offset": new ea(ve.layout_symbol["icon-offset"]),
      "icon-anchor": new ea(ve.layout_symbol["icon-anchor"]),
      "icon-pitch-alignment": new ta(ve.layout_symbol["icon-pitch-alignment"]),
      "text-pitch-alignment": new ta(ve.layout_symbol["text-pitch-alignment"]),
      "text-rotation-alignment": new ta(ve.layout_symbol["text-rotation-alignment"]),
      "text-field": new ea(ve.layout_symbol["text-field"]),
      "text-font": new ea(ve.layout_symbol["text-font"]),
      "text-size": new ea(ve.layout_symbol["text-size"]),
      "text-max-width": new ea(ve.layout_symbol["text-max-width"]),
      "text-line-height": new ea(ve.layout_symbol["text-line-height"]),
      "text-letter-spacing": new ea(ve.layout_symbol["text-letter-spacing"]),
      "text-justify": new ea(ve.layout_symbol["text-justify"]),
      "text-radial-offset": new ea(ve.layout_symbol["text-radial-offset"]),
      "text-variable-anchor": new ta(ve.layout_symbol["text-variable-anchor"]),
      "text-anchor": new ea(ve.layout_symbol["text-anchor"]),
      "text-max-angle": new ta(ve.layout_symbol["text-max-angle"]),
      "text-writing-mode": new ta(ve.layout_symbol["text-writing-mode"]),
      "text-rotate": new ea(ve.layout_symbol["text-rotate"]),
      "text-padding": new ta(ve.layout_symbol["text-padding"]),
      "text-keep-upright": new ta(ve.layout_symbol["text-keep-upright"]),
      "text-transform": new ea(ve.layout_symbol["text-transform"]),
      "text-offset": new ea(ve.layout_symbol["text-offset"]),
      "text-allow-overlap": new ta(ve.layout_symbol["text-allow-overlap"]),
      "text-ignore-placement": new ta(ve.layout_symbol["text-ignore-placement"]),
      "text-optional": new ta(ve.layout_symbol["text-optional"])
    });
    var Jh = {
      paint: new sa({
        "icon-opacity": new ea(ve.paint_symbol["icon-opacity"]),
        "icon-color": new ea(ve.paint_symbol["icon-color"]),
        "icon-halo-color": new ea(ve.paint_symbol["icon-halo-color"]),
        "icon-halo-width": new ea(ve.paint_symbol["icon-halo-width"]),
        "icon-halo-blur": new ea(ve.paint_symbol["icon-halo-blur"]),
        "icon-translate": new ta(ve.paint_symbol["icon-translate"]),
        "icon-translate-anchor": new ta(ve.paint_symbol["icon-translate-anchor"]),
        "text-opacity": new ea(ve.paint_symbol["text-opacity"]),
        "text-color": new ea(ve.paint_symbol["text-color"], {
          runtimeType: Ce,
          getOverride: function getOverride(t) {
            return t.textColor;
          },
          hasOverride: function hasOverride(t) {
            return !!t.textColor;
          }
        }),
        "text-halo-color": new ea(ve.paint_symbol["text-halo-color"]),
        "text-halo-width": new ea(ve.paint_symbol["text-halo-width"]),
        "text-halo-blur": new ea(ve.paint_symbol["text-halo-blur"]),
        "text-translate": new ta(ve.paint_symbol["text-translate"]),
        "text-translate-anchor": new ta(ve.paint_symbol["text-translate-anchor"])
      }),
      layout: Hh
    };

    var Wh = /*#__PURE__*/function () {
      function Wh(t) {
        _classCallCheck(this, Wh);

        this.type = t.property.overrides ? t.property.overrides.runtimeType : ze, this.defaultValue = t;
      }

      _createClass(Wh, [{
        key: "evaluate",
        value: function evaluate(t) {
          if (t.formattedSection) {
            var _e163 = this.defaultValue.property.overrides;
            if (_e163 && _e163.hasOverride(t.formattedSection)) return _e163.getOverride(t.formattedSection);
          }

          return t.feature && t.featureState ? this.defaultValue.evaluate(t.feature, t.featureState) : this.defaultValue.property.specification["default"];
        }
      }, {
        key: "eachChild",
        value: function eachChild(t) {
          this.defaultValue.isConstant() || t(this.defaultValue.value._styleExpression.expression);
        }
      }, {
        key: "outputDefined",
        value: function outputDefined() {
          return !1;
        }
      }, {
        key: "serialize",
        value: function serialize() {
          return null;
        }
      }]);

      return Wh;
    }();

    Zi("FormatSectionOverride", Wh, {
      omit: ["defaultValue"]
    });

    var Qh = /*#__PURE__*/function (_So) {
      _inherits(Qh, _So);

      var _super50 = _createSuper(Qh);

      function Qh(t) {
        _classCallCheck(this, Qh);

        return _super50.call(this, t, Jh);
      }

      _createClass(Qh, [{
        key: "recalculate",
        value: function recalculate(t, e) {
          _get(_getPrototypeOf(Qh.prototype), "recalculate", this).call(this, t, e), "auto" === this.layout.get("icon-rotation-alignment") && (this.layout._values["icon-rotation-alignment"] = "point" !== this.layout.get("symbol-placement") ? "map" : "viewport"), "auto" === this.layout.get("text-rotation-alignment") && (this.layout._values["text-rotation-alignment"] = "point" !== this.layout.get("symbol-placement") ? "map" : "viewport"), "auto" === this.layout.get("text-pitch-alignment") && (this.layout._values["text-pitch-alignment"] = this.layout.get("text-rotation-alignment")), "auto" === this.layout.get("icon-pitch-alignment") && (this.layout._values["icon-pitch-alignment"] = this.layout.get("icon-rotation-alignment"));
          var r = this.layout.get("text-writing-mode");

          if (r) {
            var _t161 = [];

            var _iterator118 = _createForOfIteratorHelper(r),
                _step118;

            try {
              for (_iterator118.s(); !(_step118 = _iterator118.n()).done;) {
                var _e164 = _step118.value;
                _t161.indexOf(_e164) < 0 && _t161.push(_e164);
              }
            } catch (err) {
              _iterator118.e(err);
            } finally {
              _iterator118.f();
            }

            this.layout._values["text-writing-mode"] = _t161;
          } else this.layout._values["text-writing-mode"] = "point" === this.layout.get("symbol-placement") ? ["horizontal"] : ["horizontal", "vertical"];

          this._setPaintOverrides();
        }
      }, {
        key: "getValueAndResolveTokens",
        value: function getValueAndResolveTokens(t, e, r, n) {
          var i = this.layout.get(t).evaluate(e, {}, r, n),
              s = this._unevaluatedLayout._values[t];
          return s.isDataDriven() || Nn(s.value) || !i ? i : function (t, e) {
            return e.replace(/{([^{}]+)}/g, function (e, r) {
              return r in t ? String(t[r]) : "";
            });
          }(e.properties, i);
        }
      }, {
        key: "createBucket",
        value: function createBucket(t) {
          return new Yh(t);
        }
      }, {
        key: "queryRadius",
        value: function queryRadius() {
          return 0;
        }
      }, {
        key: "queryIntersectsFeature",
        value: function queryIntersectsFeature() {
          return !1;
        }
      }, {
        key: "_setPaintOverrides",
        value: function _setPaintOverrides() {
          var _iterator119 = _createForOfIteratorHelper(Jh.paint.overridableProperties),
              _step119;

          try {
            for (_iterator119.s(); !(_step119 = _iterator119.n()).done;) {
              var _t162 = _step119.value;
              if (!Qh.hasPaintOverride(this.layout, _t162)) continue;

              var _e165 = this.paint.get(_t162),
                  _r147 = new Wh(_e165),
                  _n109 = new qn(_r147, _e165.property.specification);

              var _i107 = null;
              _i107 = "constant" === _e165.value.kind || "source" === _e165.value.kind ? new Zn("source", _n109) : new Xn("composite", _n109, _e165.value.zoomStops, _e165.value._interpolationType), this.paint._values[_t162] = new Ws(_e165.property, _i107, _e165.parameters);
            }
          } catch (err) {
            _iterator119.e(err);
          } finally {
            _iterator119.f();
          }
        }
      }, {
        key: "_handleOverridablePaintPropertyUpdate",
        value: function _handleOverridablePaintPropertyUpdate(t, e, r) {
          return !(!this.layout || e.isDataDriven() || r.isDataDriven()) && Qh.hasPaintOverride(this.layout, t);
        }
      }, {
        key: "getProgramConfiguration",
        value: function getProgramConfiguration(t) {
          return new go(this, t);
        }
      }], [{
        key: "hasPaintOverride",
        value: function hasPaintOverride(t, e) {
          var r = t.get("text-field"),
              n = Jh.paint.properties[e];
          var i = !1;

          var s = function s(t) {
            var _iterator120 = _createForOfIteratorHelper(t),
                _step120;

            try {
              for (_iterator120.s(); !(_step120 = _iterator120.n()).done;) {
                var _e166 = _step120.value;
                if (n.overrides && n.overrides.hasOverride(_e166)) return void (i = !0);
              }
            } catch (err) {
              _iterator120.e(err);
            } finally {
              _iterator120.f();
            }
          };

          if ("constant" === r.value.kind && r.value.value instanceof Ke) s(r.value.value.sections);else if ("source" === r.value.kind) {
            var _t163 = function _t163(e) {
              i || (e instanceof tr && We(e.value) === Ve ? s(e.value.sections) : e instanceof ir ? s(e.sections) : e.eachChild(_t163));
            },
                _e167 = r.value;

            _e167._styleExpression && _t163(_e167._styleExpression.expression);
          }
          return i;
        }
      }]);

      return Qh;
    }(So);

    var tp = {
      paint: new sa({
        "background-color": new ta(ve.paint_background["background-color"]),
        "background-pattern": new na(ve.paint_background["background-pattern"]),
        "background-opacity": new ta(ve.paint_background["background-opacity"])
      })
    },
        ep = {
      paint: new sa({
        "raster-opacity": new ta(ve.paint_raster["raster-opacity"]),
        "raster-hue-rotate": new ta(ve.paint_raster["raster-hue-rotate"]),
        "raster-brightness-min": new ta(ve.paint_raster["raster-brightness-min"]),
        "raster-brightness-max": new ta(ve.paint_raster["raster-brightness-max"]),
        "raster-saturation": new ta(ve.paint_raster["raster-saturation"]),
        "raster-contrast": new ta(ve.paint_raster["raster-contrast"]),
        "raster-resampling": new ta(ve.paint_raster["raster-resampling"]),
        "raster-fade-duration": new ta(ve.paint_raster["raster-fade-duration"])
      })
    };

    var rp = /*#__PURE__*/function (_So2) {
      _inherits(rp, _So2);

      var _super51 = _createSuper(rp);

      function rp(t) {
        var _this23;

        _classCallCheck(this, rp);

        _this23 = _super51.call(this, t, {}), _this23.implementation = t;
        return _this23;
      }

      _createClass(rp, [{
        key: "is3D",
        value: function is3D() {
          return "3d" === this.implementation.renderingMode;
        }
      }, {
        key: "hasOffscreenPass",
        value: function hasOffscreenPass() {
          return void 0 !== this.implementation.prerender;
        }
      }, {
        key: "recalculate",
        value: function recalculate() {}
      }, {
        key: "updateTransitions",
        value: function updateTransitions() {}
      }, {
        key: "hasTransition",
        value: function hasTransition() {}
      }, {
        key: "serialize",
        value: function serialize() {}
      }, {
        key: "onAdd",
        value: function onAdd(t) {
          this.implementation.onAdd && this.implementation.onAdd(t, t.painter.context.gl);
        }
      }, {
        key: "onRemove",
        value: function onRemove(t) {
          this.implementation.onRemove && this.implementation.onRemove(t, t.painter.context.gl);
        }
      }]);

      return rp;
    }(So);

    var np = {
      paint: new sa({
        "sky-type": new ta(ve.paint_sky["sky-type"]),
        "sky-atmosphere-sun": new ta(ve.paint_sky["sky-atmosphere-sun"]),
        "sky-atmosphere-sun-intensity": new ta(ve.paint_sky["sky-atmosphere-sun-intensity"]),
        "sky-gradient-center": new ta(ve.paint_sky["sky-gradient-center"]),
        "sky-gradient-radius": new ta(ve.paint_sky["sky-gradient-radius"]),
        "sky-gradient": new ia(ve.paint_sky["sky-gradient"]),
        "sky-atmosphere-halo-color": new ta(ve.paint_sky["sky-atmosphere-halo-color"]),
        "sky-atmosphere-color": new ta(ve.paint_sky["sky-atmosphere-color"]),
        "sky-opacity": new ta(ve.paint_sky["sky-opacity"])
      })
    };

    function ip(t, e, r) {
      var n = b(0, 0, 1),
          i = R(L());
      return function (t, e, r) {
        r *= .5;
        var n = e[0],
            i = e[1],
            s = e[2],
            a = e[3],
            o = Math.sin(r),
            l = Math.cos(r);
        t[0] = n * l - s * o, t[1] = i * l + a * o, t[2] = s * l + n * o, t[3] = a * l - i * o;
      }(i, i, r ? -q(t) + Math.PI : q(t)), U(i, i, -q(e)), C(n, n, i), z(n, n);
    }

    var sp = {
      circle: /*#__PURE__*/function (_So3) {
        _inherits(circle, _So3);

        var _super52 = _createSuper(circle);

        function circle(t) {
          _classCallCheck(this, circle);

          return _super52.call(this, t, yl);
        }

        _createClass(circle, [{
          key: "createBucket",
          value: function createBucket(t) {
            return new Jo(t);
          }
        }, {
          key: "queryRadius",
          value: function queryRadius(t) {
            var e = t;
            return cl("circle-radius", this, e) + cl("circle-stroke-width", this, e) + hl(this.paint.get("circle-translate"));
          }
        }, {
          key: "queryIntersectsFeature",
          value: function queryIntersectsFeature(t, e, r, n, i, s, a, o) {
            var l = dl(this.paint.get("circle-translate"), this.paint.get("circle-translate-anchor"), s.angle, t.pixelToTileUnitsFactor),
                u = this.paint.get("circle-radius").evaluate(e, r) + this.paint.get("circle-stroke-width").evaluate(e, r);
            return xl(t, n, s, a, o, "map" === this.paint.get("circle-pitch-alignment"), "map" === this.paint.get("circle-pitch-scale"), l, u);
          }
        }, {
          key: "getProgramIds",
          value: function getProgramIds() {
            return ["circle"];
          }
        }, {
          key: "getProgramConfiguration",
          value: function getProgramConfiguration(t) {
            return new go(this, t);
          }
        }]);

        return circle;
      }(So),
      heatmap: /*#__PURE__*/function (_So4) {
        _inherits(heatmap, _So4);

        var _super53 = _createSuper(heatmap);

        function heatmap(t) {
          var _this24;

          _classCallCheck(this, heatmap);

          _this24 = _super53.call(this, t, Tl), _this24._updateColorRamp();
          return _this24;
        }

        _createClass(heatmap, [{
          key: "createBucket",
          value: function createBucket(t) {
            return new Al(t);
          }
        }, {
          key: "_handleSpecialPaintPropertyUpdate",
          value: function _handleSpecialPaintPropertyUpdate(t) {
            "heatmap-color" === t && this._updateColorRamp();
          }
        }, {
          key: "_updateColorRamp",
          value: function _updateColorRamp() {
            this.colorRamp = Bl({
              expression: this._transitionablePaint._values["heatmap-color"].value.expression,
              evaluationKey: "heatmapDensity",
              image: this.colorRamp
            }), this.colorRampTexture = null;
          }
        }, {
          key: "resize",
          value: function resize() {
            this.heatmapFbo && (this.heatmapFbo.destroy(), this.heatmapFbo = null);
          }
        }, {
          key: "queryRadius",
          value: function queryRadius(t) {
            return cl("heatmap-radius", this, t);
          }
        }, {
          key: "queryIntersectsFeature",
          value: function queryIntersectsFeature(t, e, r, n, s, a, o, l) {
            var u = this.paint.get("heatmap-radius").evaluate(e, r);
            return xl(t, n, a, o, l, !0, !0, new i(0, 0), u);
          }
        }, {
          key: "hasOffscreenPass",
          value: function hasOffscreenPass() {
            return 0 !== this.paint.get("heatmap-opacity") && "none" !== this.visibility;
          }
        }, {
          key: "getProgramIds",
          value: function getProgramIds() {
            return ["heatmap", "heatmapTexture"];
          }
        }, {
          key: "getProgramConfiguration",
          value: function getProgramConfiguration(t) {
            return new go(this, t);
          }
        }]);

        return heatmap;
      }(So),
      hillshade: /*#__PURE__*/function (_So5) {
        _inherits(hillshade, _So5);

        var _super54 = _createSuper(hillshade);

        function hillshade(t) {
          _classCallCheck(this, hillshade);

          return _super54.call(this, t, Cl);
        }

        _createClass(hillshade, [{
          key: "hasOffscreenPass",
          value: function hasOffscreenPass() {
            return 0 !== this.paint.get("hillshade-exaggeration") && "none" !== this.visibility;
          }
        }, {
          key: "getProgramIds",
          value: function getProgramIds() {
            return ["hillshade", "hillshadePrepare"];
          }
        }, {
          key: "getProgramConfiguration",
          value: function getProgramConfiguration(t) {
            return new go(this, t);
          }
        }]);

        return hillshade;
      }(So),
      fill: /*#__PURE__*/function (_So6) {
        _inherits(fill, _So6);

        var _super55 = _createSuper(fill);

        function fill(t) {
          _classCallCheck(this, fill);

          return _super55.call(this, t, xu);
        }

        _createClass(fill, [{
          key: "getProgramIds",
          value: function getProgramIds() {
            var t = this.paint.get("fill-pattern"),
                e = t && t.constantOr(1),
                r = [e ? "fillPattern" : "fill"];
            return this.paint.get("fill-antialias") && r.push(e && !this.getPaintProperty("fill-outline-color") ? "fillOutlinePattern" : "fillOutline"), r;
          }
        }, {
          key: "getProgramConfiguration",
          value: function getProgramConfiguration(t) {
            return new go(this, t);
          }
        }, {
          key: "recalculate",
          value: function recalculate(t, e) {
            _get(_getPrototypeOf(fill.prototype), "recalculate", this).call(this, t, e);

            var r = this.paint._values["fill-outline-color"];
            "constant" === r.value.kind && void 0 === r.value.value && (this.paint._values["fill-outline-color"] = this.paint._values["fill-color"]);
          }
        }, {
          key: "createBucket",
          value: function createBucket(t) {
            return new mu(t);
          }
        }, {
          key: "queryRadius",
          value: function queryRadius() {
            return hl(this.paint.get("fill-translate"));
          }
        }, {
          key: "queryIntersectsFeature",
          value: function queryIntersectsFeature(t, e, r, n, i, s) {
            return !t.queryGeometry.isAboveHorizon && tl(pl(t.tilespaceGeometry, this.paint.get("fill-translate"), this.paint.get("fill-translate-anchor"), s.angle, t.pixelToTileUnitsFactor), n);
          }
        }, {
          key: "isTileClipped",
          value: function isTileClipped() {
            return !0;
          }
        }]);

        return fill;
      }(So),
      "fill-extrusion": /*#__PURE__*/function (_So7) {
        _inherits(fillExtrusion, _So7);

        var _super56 = _createSuper(fillExtrusion);

        function fillExtrusion(t) {
          _classCallCheck(this, fillExtrusion);

          return _super56.call(this, t, Lu);
        }

        _createClass(fillExtrusion, [{
          key: "createBucket",
          value: function createBucket(t) {
            return new Vu(t);
          }
        }, {
          key: "queryRadius",
          value: function queryRadius() {
            return hl(this.paint.get("fill-extrusion-translate"));
          }
        }, {
          key: "is3D",
          value: function is3D() {
            return !0;
          }
        }, {
          key: "getProgramIds",
          value: function getProgramIds() {
            return [this.paint.get("fill-extrusion-pattern").constantOr(1) ? "fillExtrusionPattern" : "fillExtrusion"];
          }
        }, {
          key: "getProgramConfiguration",
          value: function getProgramConfiguration(t) {
            return new go(this, t);
          }
        }, {
          key: "queryIntersectsFeature",
          value: function queryIntersectsFeature(t, e, r, n, s, a, o, l, u) {
            var c = dl(this.paint.get("fill-extrusion-translate"), this.paint.get("fill-extrusion-translate-anchor"), a.angle, t.pixelToTileUnitsFactor),
                h = this.paint.get("fill-extrusion-height").evaluate(e, r),
                p = this.paint.get("fill-extrusion-base").evaluate(e, r),
                d = [0, 0],
                f = l && a.elevation,
                y = a.elevation ? a.elevation.exaggeration() : 1;

            if (f) {
              var _e168 = t.tile.getBucket(this).centroidVertexArray,
                  _r148 = u + 1;

              if (_r148 < _e168.length) {
                var _t164 = _e168.get(_r148);

                d[0] = _t164.a_centroid_pos0, d[1] = _t164.a_centroid_pos1;
              }
            }

            if (0 === d[0] && 1 === d[1]) return !1;

            var m = function (t, e, r, n, s, a, o, l, u) {
              return a ? function (t, e, r, n, i, s, a, o, l) {
                var u = [],
                    c = [],
                    h = [0, 0, 0, 1];

                var _iterator121 = _createForOfIteratorHelper(t),
                    _step121;

                try {
                  for (_iterator121.s(); !(_step121 = _iterator121.n()).done;) {
                    var _p11 = _step121.value;
                    var _t165 = [],
                        _d8 = [];

                    var _iterator122 = _createForOfIteratorHelper(_p11),
                        _step122;

                    try {
                      for (_iterator122.s(); !(_step122 = _iterator122.n()).done;) {
                        var _u31 = _step122.value;

                        var _c18 = _u31.x + n.x,
                            _p12 = _u31.y + n.y,
                            _f9 = Ou(_c18, _p12, e, r, s, a, o, l);

                        h[0] = _c18, h[1] = _p12, h[2] = _f9.base, h[3] = 1, F(h, h, i), h[3] = Math.max(h[3], 1e-5);

                        var _y5 = $u([h[0] / h[3], h[1] / h[3], h[2] / h[3]]);

                        h[0] = _c18, h[1] = _p12, h[2] = _f9.top, h[3] = 1, F(h, h, i), h[3] = Math.max(h[3], 1e-5);

                        var _m6 = $u([h[0] / h[3], h[1] / h[3], h[2] / h[3]]);

                        _t165.push(_y5), _d8.push(_m6);
                      }
                    } catch (err) {
                      _iterator122.e(err);
                    } finally {
                      _iterator122.f();
                    }

                    u.push(_t165), c.push(_d8);
                  }
                } catch (err) {
                  _iterator121.e(err);
                } finally {
                  _iterator121.f();
                }

                return [u, c];
              }(t, e, r, n, s, a, o, l, u) : function (t, e, r, n, s) {
                var a = [],
                    o = [],
                    l = s[8] * e,
                    u = s[9] * e,
                    c = s[10] * e,
                    h = s[11] * e,
                    p = s[8] * r,
                    d = s[9] * r,
                    f = s[10] * r,
                    y = s[11] * r;

                var _iterator123 = _createForOfIteratorHelper(t),
                    _step123;

                try {
                  for (_iterator123.s(); !(_step123 = _iterator123.n()).done;) {
                    var _e169 = _step123.value;
                    var _t166 = [],
                        _r149 = [];

                    var _iterator124 = _createForOfIteratorHelper(_e169),
                        _step124;

                    try {
                      for (_iterator124.s(); !(_step124 = _iterator124.n()).done;) {
                        var _a64 = _step124.value;

                        var _e170 = _a64.x + n.x,
                            _o38 = _a64.y + n.y,
                            _m7 = s[0] * _e170 + s[4] * _o38 + s[12],
                            _g8 = s[1] * _e170 + s[5] * _o38 + s[13],
                            _x8 = s[2] * _e170 + s[6] * _o38 + s[14],
                            _v6 = s[3] * _e170 + s[7] * _o38 + s[15],
                            _b6 = _m7 + l,
                            _w6 = _g8 + u,
                            _7 = _x8 + c,
                            _A6 = Math.max(_v6 + h, 1e-5),
                            _k7 = _m7 + p,
                            _S4 = _g8 + d,
                            _I4 = _x8 + f,
                            _z4 = Math.max(_v6 + y, 1e-5),
                            _M3 = new i(_b6 / _A6, _w6 / _A6);

                        _M3.z = _7 / _A6, _t166.push(_M3);

                        var _T2 = new i(_k7 / _z4, _S4 / _z4);

                        _T2.z = _I4 / _z4, _r149.push(_T2);
                      }
                    } catch (err) {
                      _iterator124.e(err);
                    } finally {
                      _iterator124.f();
                    }

                    a.push(_t166), o.push(_r149);
                  }
                } catch (err) {
                  _iterator123.e(err);
                } finally {
                  _iterator123.f();
                }

                return [a, o];
              }(t, e, r, n, s);
            }(n, p, h, c, o, f ? l : null, d, y, a.center.lat),
                g = t.queryGeometry;

            return function (t, e, r) {
              var n = 1 / 0;
              tl(r, e) && (n = Uu(r, e[0]));

              for (var _i108 = 0; _i108 < e.length; _i108++) {
                var _s77 = e[_i108],
                    _a65 = t[_i108];

                for (var _t167 = 0; _t167 < _s77.length - 1; _t167++) {
                  var _e171 = _s77[_t167],
                      _i109 = [_e171, _s77[_t167 + 1], _a65[_t167 + 1], _a65[_t167], _e171];
                  Wo(r, _i109) && (n = Math.min(n, Uu(r, _i109)));
                }
              }

              return n !== 1 / 0 && n;
            }(m[0], m[1], g.isPointQuery() ? g.screenBounds : g.screenGeometry);
          }
        }]);

        return fillExtrusion;
      }(So),
      line: /*#__PURE__*/function (_So8) {
        _inherits(line, _So8);

        var _super57 = _createSuper(line);

        function line(t) {
          var _this25;

          _classCallCheck(this, line);

          _this25 = _super57.call(this, t, Hu), _this25.gradientVersion = 0;
          return _this25;
        }

        _createClass(line, [{
          key: "_handleSpecialPaintPropertyUpdate",
          value: function _handleSpecialPaintPropertyUpdate(t) {
            if ("line-gradient" === t) {
              var _t168 = this._transitionablePaint._values["line-gradient"].value.expression;
              this.stepInterpolant = _t168._styleExpression && _t168._styleExpression.expression instanceof Fr, this.gradientVersion = (this.gradientVersion + 1) % Number.MAX_SAFE_INTEGER;
            }
          }
        }, {
          key: "gradientExpression",
          value: function gradientExpression() {
            return this._transitionablePaint._values["line-gradient"].value.expression;
          }
        }, {
          key: "recalculate",
          value: function recalculate(t, e) {
            _get(_getPrototypeOf(line.prototype), "recalculate", this).call(this, t, e), this.paint._values["line-floorwidth"] = Ju.possiblyEvaluate(this._transitioningPaint._values["line-width"].value, t);
          }
        }, {
          key: "createBucket",
          value: function createBucket(t) {
            return new Ku(t);
          }
        }, {
          key: "getProgramIds",
          value: function getProgramIds() {
            return [this.paint.get("line-pattern").constantOr(1) ? "linePattern" : "line"];
          }
        }, {
          key: "getProgramConfiguration",
          value: function getProgramConfiguration(t) {
            return new go(this, t);
          }
        }, {
          key: "queryRadius",
          value: function queryRadius(t) {
            var e = t,
                r = Wu(cl("line-width", this, e), cl("line-gap-width", this, e)),
                n = cl("line-offset", this, e);
            return r / 2 + Math.abs(n) + hl(this.paint.get("line-translate"));
          }
        }, {
          key: "queryIntersectsFeature",
          value: function queryIntersectsFeature(t, e, r, n, s, a) {
            if (t.queryGeometry.isAboveHorizon) return !1;
            var o = pl(t.tilespaceGeometry, this.paint.get("line-translate"), this.paint.get("line-translate-anchor"), a.angle, t.pixelToTileUnitsFactor),
                l = t.pixelToTileUnitsFactor / 2 * Wu(this.paint.get("line-width").evaluate(e, r), this.paint.get("line-gap-width").evaluate(e, r)),
                u = this.paint.get("line-offset").evaluate(e, r);
            return u && (n = function (t, e) {
              var r = [],
                  n = new i(0, 0);

              for (var _i110 = 0; _i110 < t.length; _i110++) {
                var _s78 = t[_i110],
                    _a66 = [];

                for (var _t169 = 0; _t169 < _s78.length; _t169++) {
                  var _r150 = _s78[_t169 - 1],
                      _i111 = _s78[_t169],
                      _o39 = _s78[_t169 + 1],
                      _l31 = 0 === _t169 ? n : _i111.sub(_r150)._unit()._perp(),
                      _u32 = _t169 === _s78.length - 1 ? n : _o39.sub(_i111)._unit()._perp(),
                      _c19 = _l31._add(_u32)._unit();

                  _c19._mult(1 / (_c19.x * _u32.x + _c19.y * _u32.y)), _a66.push(_c19._mult(e)._add(_i111));
                }

                r.push(_a66);
              }

              return r;
            }(n, u * t.pixelToTileUnitsFactor)), function (t, e, r) {
              for (var _n110 = 0; _n110 < e.length; _n110++) {
                var _i112 = e[_n110];
                if (t.length >= 3) for (var _e172 = 0; _e172 < _i112.length; _e172++) {
                  if (ol(t, _i112[_e172])) return !0;
                }
                if (el(t, _i112, r)) return !0;
              }

              return !1;
            }(o, n, l);
          }
        }, {
          key: "isTileClipped",
          value: function isTileClipped() {
            return !0;
          }
        }]);

        return line;
      }(So),
      symbol: Qh,
      background: /*#__PURE__*/function (_So9) {
        _inherits(background, _So9);

        var _super58 = _createSuper(background);

        function background(t) {
          _classCallCheck(this, background);

          return _super58.call(this, t, tp);
        }

        _createClass(background, [{
          key: "getProgramIds",
          value: function getProgramIds() {
            return [this.paint.get("background-pattern") ? "backgroundPattern" : "background"];
          }
        }]);

        return background;
      }(So),
      raster: /*#__PURE__*/function (_So10) {
        _inherits(raster, _So10);

        var _super59 = _createSuper(raster);

        function raster(t) {
          _classCallCheck(this, raster);

          return _super59.call(this, t, ep);
        }

        _createClass(raster, [{
          key: "getProgramIds",
          value: function getProgramIds() {
            return ["raster"];
          }
        }]);

        return raster;
      }(So),
      sky: /*#__PURE__*/function (_So11) {
        _inherits(sky, _So11);

        var _super60 = _createSuper(sky);

        function sky(t) {
          var _this26;

          _classCallCheck(this, sky);

          _this26 = _super60.call(this, t, np), _this26._updateColorRamp();
          return _this26;
        }

        _createClass(sky, [{
          key: "_handleSpecialPaintPropertyUpdate",
          value: function _handleSpecialPaintPropertyUpdate(t) {
            "sky-gradient" === t ? this._updateColorRamp() : "sky-atmosphere-sun" !== t && "sky-atmosphere-halo-color" !== t && "sky-atmosphere-color" !== t && "sky-atmosphere-sun-intensity" !== t || (this._skyboxInvalidated = !0);
          }
        }, {
          key: "_updateColorRamp",
          value: function _updateColorRamp() {
            this.colorRamp = Bl({
              expression: this._transitionablePaint._values["sky-gradient"].value.expression,
              evaluationKey: "skyRadialProgress"
            }), this.colorRampTexture && (this.colorRampTexture.destroy(), this.colorRampTexture = null);
          }
        }, {
          key: "needsSkyboxCapture",
          value: function needsSkyboxCapture(t) {
            if (this._skyboxInvalidated || !this.skyboxTexture || !this.skyboxGeometry) return !0;

            if (!this.paint.get("sky-atmosphere-sun")) {
              var _e173 = t.style.light.properties.get("position");

              return this._lightPosition.azimuthal !== _e173.azimuthal || this._lightPosition.polar !== _e173.polar;
            }
          }
        }, {
          key: "getCenter",
          value: function getCenter(t, e) {
            var r = this.paint.get("sky-type");

            if ("atmosphere" === r) {
              var _r151 = this.paint.get("sky-atmosphere-sun"),
                  _n111 = !_r151,
                  _i113 = t.style.light,
                  _s79 = _i113.properties.get("position");

              return _n111 && "viewport" === _i113.properties.get("anchor") && pt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."), _n111 ? ip(_s79.azimuthal, 90 - _s79.polar, e) : ip(_r151[0], 90 - _r151[1], e);
            }

            if ("gradient" === r) {
              var _t170 = this.paint.get("sky-gradient-center");

              return ip(_t170[0], 90 - _t170[1], e);
            }
          }
        }, {
          key: "is3D",
          value: function is3D() {
            return !1;
          }
        }, {
          key: "isSky",
          value: function isSky() {
            return !0;
          }
        }, {
          key: "markSkyboxValid",
          value: function markSkyboxValid(t) {
            this._skyboxInvalidated = !1, this._lightPosition = t.style.light.properties.get("position");
          }
        }, {
          key: "hasOffscreenPass",
          value: function hasOffscreenPass() {
            return !0;
          }
        }, {
          key: "getProgramIds",
          value: function getProgramIds() {
            var t = this.paint.get("sky-type");
            return "atmosphere" === t ? ["skyboxCapture", "skybox"] : "gradient" === t ? ["skyboxGradient"] : null;
          }
        }]);

        return sky;
      }(So)
    },
        ap = a.HTMLImageElement,
        op = a.HTMLCanvasElement,
        lp = a.HTMLVideoElement,
        up = a.ImageData,
        cp = a.ImageBitmap;

    var hp = /*#__PURE__*/function () {
      function hp(t, e, r, n) {
        _classCallCheck(this, hp);

        this.context = t, this.format = r, this.texture = t.gl.createTexture(), this.update(e, n);
      }

      _createClass(hp, [{
        key: "update",
        value: function update(t, e, r) {
          var n = t.width,
              i = t.height,
              s = this.context,
              a = s.gl;

          if (a.bindTexture(a.TEXTURE_2D, this.texture), s.pixelStoreUnpackFlipY.set(!1), s.pixelStoreUnpack.set(1), s.pixelStoreUnpackPremultiplyAlpha.set(this.format === a.RGBA && (!e || !1 !== e.premultiply)), r || this.size && this.size[0] === n && this.size[1] === i) {
            var _ref161 = r || {
              x: 0,
              y: 0
            },
                _e174 = _ref161.x,
                _s80 = _ref161.y;

            t instanceof ap || t instanceof op || t instanceof lp || t instanceof up || cp && t instanceof cp ? a.texSubImage2D(a.TEXTURE_2D, 0, _e174, _s80, a.RGBA, a.UNSIGNED_BYTE, t) : a.texSubImage2D(a.TEXTURE_2D, 0, _e174, _s80, n, i, a.RGBA, a.UNSIGNED_BYTE, t.data);
          } else this.size = [n, i], t instanceof ap || t instanceof op || t instanceof lp || t instanceof up || cp && t instanceof cp ? a.texImage2D(a.TEXTURE_2D, 0, this.format, this.format, a.UNSIGNED_BYTE, t) : a.texImage2D(a.TEXTURE_2D, 0, this.format, n, i, 0, this.format, a.UNSIGNED_BYTE, t.data);

          this.useMipmap = Boolean(e && e.useMipmap && this.isSizePowerOfTwo()), this.useMipmap && a.generateMipmap(a.TEXTURE_2D);
        }
      }, {
        key: "bind",
        value: function bind(t, e) {
          var r = this.context,
              n = r.gl;
          n.bindTexture(n.TEXTURE_2D, this.texture), t !== this.filter && (n.texParameteri(n.TEXTURE_2D, n.TEXTURE_MAG_FILTER, t), n.texParameteri(n.TEXTURE_2D, n.TEXTURE_MIN_FILTER, this.useMipmap ? t === n.NEAREST ? n.NEAREST_MIPMAP_NEAREST : n.LINEAR_MIPMAP_NEAREST : t), this.filter = t), e !== this.wrap && (n.texParameteri(n.TEXTURE_2D, n.TEXTURE_WRAP_S, e), n.texParameteri(n.TEXTURE_2D, n.TEXTURE_WRAP_T, e), this.wrap = e);
        }
      }, {
        key: "isSizePowerOfTwo",
        value: function isSizePowerOfTwo() {
          return this.size[0] === this.size[1] && Math.log(this.size[0]) / Math.LN2 % 1 == 0;
        }
      }, {
        key: "destroy",
        value: function destroy() {
          var t = this.context.gl;
          t.deleteTexture(this.texture), this.texture = null;
        }
      }]);

      return hp;
    }();

    var pp = /*#__PURE__*/function () {
      function pp(t, e) {
        _classCallCheck(this, pp);

        this.width = t, this.height = e, this.nextRow = 0, this.image = new zl({
          width: t,
          height: e
        }), this.positions = {}, this.uploaded = !1;
      }

      _createClass(pp, [{
        key: "getDash",
        value: function getDash(t, e) {
          var r = this.getKey(t, e);
          return this.positions[r];
        }
      }, {
        key: "trim",
        value: function trim() {
          var t = this.width,
              e = this.height = it(this.nextRow);
          this.image.resize({
            width: t,
            height: e
          });
        }
      }, {
        key: "getKey",
        value: function getKey(t, e) {
          return t.join(",") + e;
        }
      }, {
        key: "getDashRanges",
        value: function getDashRanges(t, e, r) {
          var n = [];
          var i = t.length % 2 == 1 ? -t[t.length - 1] * r : 0,
              s = t[0] * r,
              a = !0;
          n.push({
            left: i,
            right: s,
            isDash: a,
            zeroLength: 0 === t[0]
          });
          var o = t[0];

          for (var _e175 = 1; _e175 < t.length; _e175++) {
            a = !a;
            var _l32 = t[_e175];
            i = o * r, o += _l32, s = o * r, n.push({
              left: i,
              right: s,
              isDash: a,
              zeroLength: 0 === _l32
            });
          }

          return n;
        }
      }, {
        key: "addRoundDash",
        value: function addRoundDash(t, e, r) {
          var n = e / 2;

          for (var _e176 = -r; _e176 <= r; _e176++) {
            var _i114 = this.width * (this.nextRow + r + _e176);

            var _s81 = 0,
                _a67 = t[_s81];

            for (var _o40 = 0; _o40 < this.width; _o40++) {
              _o40 / _a67.right > 1 && (_a67 = t[++_s81]);

              var _l33 = Math.abs(_o40 - _a67.left),
                  _u33 = Math.abs(_o40 - _a67.right),
                  _c20 = Math.min(_l33, _u33);

              var _h11 = void 0;

              var _p13 = _e176 / r * (n + 1);

              if (_a67.isDash) {
                var _t171 = n - Math.abs(_p13);

                _h11 = Math.sqrt(_c20 * _c20 + _t171 * _t171);
              } else _h11 = n - Math.sqrt(_c20 * _c20 + _p13 * _p13);

              this.image.data[_i114 + _o40] = Math.max(0, Math.min(255, _h11 + 128));
            }
          }
        }
      }, {
        key: "addRegularDash",
        value: function addRegularDash(t, e) {
          for (var _e177 = t.length - 1; _e177 >= 0; --_e177) {
            var _r152 = t[_e177],
                _n112 = t[_e177 + 1];
            _r152.zeroLength ? t.splice(_e177, 1) : _n112 && _n112.isDash === _r152.isDash && (_n112.left = _r152.left, t.splice(_e177, 1));
          }

          var r = t[0],
              n = t[t.length - 1];
          r.isDash === n.isDash && (r.left = n.left - this.width, n.right = r.right + this.width);
          var i = this.width * this.nextRow;
          var s = 0,
              a = t[s];

          for (var _r153 = 0; _r153 < this.width; _r153++) {
            _r153 / a.right > 1 && (a = t[++s]);

            var _n113 = Math.abs(_r153 - a.left),
                _o41 = Math.abs(_r153 - a.right),
                _l34 = Math.min(_n113, _o41);

            this.image.data[i + _r153] = Math.max(0, Math.min(255, (a.isDash ? _l34 : -_l34) + e + 128));
          }
        }
      }, {
        key: "addDash",
        value: function addDash(t, e) {
          var r = this.getKey(t, e);
          if (this.positions[r]) return this.positions[r];
          var n = "round" === e,
              i = n ? 7 : 0,
              s = 2 * i + 1;
          if (this.nextRow + s > this.height) return pt("LineAtlas out of space"), null;
          0 === t.length && t.push(1);
          var a = 0;

          for (var _e178 = 0; _e178 < t.length; _e178++) {
            t[_e178] < 0 && (pt("Negative value is found in line dasharray, replacing values with 0"), t[_e178] = 0), a += t[_e178];
          }

          if (0 !== a) {
            var _r154 = this.width / a,
                _s82 = this.getDashRanges(t, this.width, _r154);

            n ? this.addRoundDash(_s82, _r154, i) : this.addRegularDash(_s82, "square" === e ? .5 * _r154 : 0);
          }

          var o = this.nextRow + i;
          this.nextRow += s;
          var l = {
            tl: [o, i],
            br: [a, 0]
          };
          return this.positions[r] = l, l;
        }
      }]);

      return pp;
    }();

    Zi("LineAtlas", pp);

    var dp = /*#__PURE__*/function () {
      function dp(t) {
        var _this27 = this;

        _classCallCheck(this, dp);

        this._callback = t, this._triggered = !1, "undefined" != typeof MessageChannel && (this._channel = new MessageChannel(), this._channel.port2.onmessage = function () {
          _this27._triggered = !1, _this27._callback();
        });
      }

      _createClass(dp, [{
        key: "trigger",
        value: function trigger() {
          var _this28 = this;

          this._triggered || (this._triggered = !0, this._channel ? this._channel.port1.postMessage(!0) : setTimeout(function () {
            _this28._triggered = !1, _this28._callback();
          }, 0));
        }
      }, {
        key: "remove",
        value: function remove() {
          delete this._channel, this._callback = function () {};
        }
      }]);

      return dp;
    }();

    var fp = a.performance;

    function yp(t) {
      var e = t ? t.url.toString() : void 0;
      return fp.getEntriesByName(e);
    }

    var mp = /*#__PURE__*/function () {
      function mp() {
        _classCallCheck(this, mp);

        this.tasks = {}, this.taskQueue = [], at(["process"], this), this.invoker = new dp(this.process), this.nextId = 0;
      }

      _createClass(mp, [{
        key: "add",
        value: function add(t, e) {
          var _this29 = this;

          var r = this.nextId++,
              n = function (_ref162) {
            var t = _ref162.type,
                e = _ref162.isSymbolTile,
                r = _ref162.zoom;
            return r = r || 0, "message" === t ? 0 : "maybePrepare" !== t || e ? "parseTile" !== t || e ? "parseTile" === t && e ? 300 - r : "maybePrepare" === t && e ? 400 - r : 500 : 200 - r : 100 - r;
          }(e);

          if (0 === n) {
            yt();

            try {
              t();
            } finally {}

            return {
              cancel: function cancel() {}
            };
          }

          return this.tasks[r] = {
            fn: t,
            metadata: e,
            priority: n,
            id: r
          }, this.taskQueue.push(r), this.invoker.trigger(), {
            cancel: function cancel() {
              delete _this29.tasks[r];
            }
          };
        }
      }, {
        key: "process",
        value: function process() {
          var _this30 = this;

          yt();

          try {
            if (this.taskQueue = this.taskQueue.filter(function (t) {
              return !!_this30.tasks[t];
            }), !this.taskQueue.length) return;

            var _t172 = this.pick();

            if (null === _t172) return;
            var _e179 = this.tasks[_t172];
            if (delete this.tasks[_t172], this.taskQueue.length && this.invoker.trigger(), !_e179) return;

            _e179.fn();
          } finally {}
        }
      }, {
        key: "pick",
        value: function pick() {
          var t = null,
              e = 1 / 0;

          for (var _r155 = 0; _r155 < this.taskQueue.length; _r155++) {
            var _n114 = this.tasks[this.taskQueue[_r155]];
            _n114.priority < e && (e = _n114.priority, t = _r155);
          }

          if (null === t) return null;
          var r = this.taskQueue[t];
          return this.taskQueue.splice(t, 1), r;
        }
      }, {
        key: "remove",
        value: function remove() {
          this.invoker.remove();
        }
      }]);

      return mp;
    }();

    function gp(t, e, r) {
      var n = 2 * Math.PI * 6378137 / 256 / Math.pow(2, r);
      return [t * n - 2 * Math.PI * 6378137 / 2, e * n - 2 * Math.PI * 6378137 / 2];
    }

    var xp = /*#__PURE__*/function () {
      function xp(t, e, r) {
        _classCallCheck(this, xp);

        this.z = t, this.x = e, this.y = r, this.key = wp(0, t, t, e, r);
      }

      _createClass(xp, [{
        key: "equals",
        value: function equals(t) {
          return this.z === t.z && this.x === t.x && this.y === t.y;
        }
      }, {
        key: "url",
        value: function url(t, e) {
          var r = function (t, e, r) {
            var n = gp(256 * t, 256 * (e = Math.pow(2, r) - e - 1), r),
                i = gp(256 * (t + 1), 256 * (e + 1), r);
            return n[0] + "," + n[1] + "," + i[0] + "," + i[1];
          }(this.x, this.y, this.z),
              n = function (t, e, r) {
            var n,
                i = "";

            for (var _s83 = t; _s83 > 0; _s83--) {
              n = 1 << _s83 - 1, i += (e & n ? 1 : 0) + (r & n ? 2 : 0);
            }

            return i;
          }(this.z, this.x, this.y);

          return t[(this.x + this.y) % t.length].replace("{prefix}", (this.x % 16).toString(16) + (this.y % 16).toString(16)).replace("{z}", String(this.z)).replace("{x}", String(this.x)).replace("{y}", String("tms" === e ? Math.pow(2, this.z) - this.y - 1 : this.y)).replace("{quadkey}", n).replace("{bbox-epsg-3857}", r);
        }
      }, {
        key: "toString",
        value: function toString() {
          return "".concat(this.z, "/").concat(this.x, "/").concat(this.y);
        }
      }]);

      return xp;
    }();

    var vp = /*#__PURE__*/_createClass(function vp(t, e) {
      _classCallCheck(this, vp);

      this.wrap = t, this.canonical = e, this.key = wp(t, e.z, e.z, e.x, e.y);
    });

    var bp = /*#__PURE__*/function () {
      function bp(t, e, r, n, i) {
        _classCallCheck(this, bp);

        this.overscaledZ = t, this.wrap = e, this.canonical = new xp(r, +n, +i), this.key = 0 === e && t === r ? this.canonical.key : wp(e, t, r, n, i);
      }

      _createClass(bp, [{
        key: "equals",
        value: function equals(t) {
          return this.overscaledZ === t.overscaledZ && this.wrap === t.wrap && this.canonical.equals(t.canonical);
        }
      }, {
        key: "scaledTo",
        value: function scaledTo(t) {
          var e = this.canonical.z - t;
          return t > this.canonical.z ? new bp(t, this.wrap, this.canonical.z, this.canonical.x, this.canonical.y) : new bp(t, this.wrap, t, this.canonical.x >> e, this.canonical.y >> e);
        }
      }, {
        key: "calculateScaledKey",
        value: function calculateScaledKey(t) {
          var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !0;
          if (this.overscaledZ === t && e) return this.key;
          if (t > this.canonical.z) return wp(this.wrap * +e, t, this.canonical.z, this.canonical.x, this.canonical.y);
          {
            var _r156 = this.canonical.z - t;

            return wp(this.wrap * +e, t, t, this.canonical.x >> _r156, this.canonical.y >> _r156);
          }
        }
      }, {
        key: "isChildOf",
        value: function isChildOf(t) {
          if (t.wrap !== this.wrap) return !1;
          var e = this.canonical.z - t.canonical.z;
          return 0 === t.overscaledZ || t.overscaledZ < this.overscaledZ && t.canonical.x === this.canonical.x >> e && t.canonical.y === this.canonical.y >> e;
        }
      }, {
        key: "children",
        value: function children(t) {
          if (this.overscaledZ >= t) return [new bp(this.overscaledZ + 1, this.wrap, this.canonical.z, this.canonical.x, this.canonical.y)];
          var e = this.canonical.z + 1,
              r = 2 * this.canonical.x,
              n = 2 * this.canonical.y;
          return [new bp(e, this.wrap, e, r, n), new bp(e, this.wrap, e, r + 1, n), new bp(e, this.wrap, e, r, n + 1), new bp(e, this.wrap, e, r + 1, n + 1)];
        }
      }, {
        key: "isLessThan",
        value: function isLessThan(t) {
          return this.wrap < t.wrap || !(this.wrap > t.wrap) && (this.overscaledZ < t.overscaledZ || !(this.overscaledZ > t.overscaledZ) && (this.canonical.x < t.canonical.x || !(this.canonical.x > t.canonical.x) && this.canonical.y < t.canonical.y));
        }
      }, {
        key: "wrapped",
        value: function wrapped() {
          return new bp(this.overscaledZ, 0, this.canonical.z, this.canonical.x, this.canonical.y);
        }
      }, {
        key: "unwrapTo",
        value: function unwrapTo(t) {
          return new bp(this.overscaledZ, t, this.canonical.z, this.canonical.x, this.canonical.y);
        }
      }, {
        key: "overscaleFactor",
        value: function overscaleFactor() {
          return Math.pow(2, this.overscaledZ - this.canonical.z);
        }
      }, {
        key: "toUnwrapped",
        value: function toUnwrapped() {
          return new vp(this.wrap, this.canonical);
        }
      }, {
        key: "toString",
        value: function toString() {
          return "".concat(this.overscaledZ, "/").concat(this.canonical.x, "/").concat(this.canonical.y);
        }
      }]);

      return bp;
    }();

    function wp(t, e, r, n, i) {
      var s = 1 << Math.min(r, 22);
      var a = s * (i % s) + n % s;
      return t && r < 22 && (a += s * s * ((t < 0 ? -2 * t - 1 : 2 * t) % (1 << 2 * (22 - r)))), 16 * (32 * a + r) + (e - r);
    }

    Zi("CanonicalTileID", xp), Zi("OverscaledTileID", bp, {
      omit: ["projMatrix"]
    });

    var _p = /*#__PURE__*/_createClass(function _p(t, e, r) {
      _classCallCheck(this, _p);

      this.func = t, this.mask = e, this.range = r;
    });

    _p.ReadOnly = !1, _p.ReadWrite = !0, _p.disabled = new _p(519, _p.ReadOnly, [0, 1]);
    var Ap = 7680;

    var kp = /*#__PURE__*/_createClass(function kp(t, e, r, n, i, s) {
      _classCallCheck(this, kp);

      this.test = t, this.ref = e, this.mask = r, this.fail = n, this.depthFail = i, this.pass = s;
    });

    kp.disabled = new kp({
      func: 519,
      mask: 0
    }, 0, 0, Ap, Ap, Ap);

    var Sp = /*#__PURE__*/_createClass(function Sp(t, e, r) {
      _classCallCheck(this, Sp);

      this.blendFunction = t, this.blendColor = e, this.mask = r;
    });

    Sp.Replace = [1, 0], Sp.disabled = new Sp(Sp.Replace, Ge.transparent, [!1, !1, !1, !1]), Sp.unblended = new Sp(Sp.Replace, Ge.transparent, [!0, !0, !0, !0]), Sp.alphaBlended = new Sp([1, 771], Ge.transparent, [!0, !0, !0, !0]);
    var Ip = 1029,
        zp = 2305;

    var Mp = /*#__PURE__*/_createClass(function Mp(t, e, r) {
      _classCallCheck(this, Mp);

      this.enable = t, this.mode = e, this.frontFace = r;
    });

    Mp.disabled = new Mp(!1, Ip, zp), Mp.backCCW = new Mp(!0, Ip, zp), Mp.backCW = new Mp(!0, Ip, 2304), Mp.frontCW = new Mp(!0, 1028, 2304), Mp.frontCCW = new Mp(!0, 1028, zp);

    var Tp = /*#__PURE__*/function () {
      function Tp(t) {
        _classCallCheck(this, Tp);

        this._stringToNumber = {}, this._numberToString = [];

        for (var _e180 = 0; _e180 < t.length; _e180++) {
          var _r157 = t[_e180];
          this._stringToNumber[_r157] = _e180, this._numberToString[_e180] = _r157;
        }
      }

      _createClass(Tp, [{
        key: "encode",
        value: function encode(t) {
          return this._stringToNumber[t];
        }
      }, {
        key: "decode",
        value: function decode(t) {
          return this._numberToString[t];
        }
      }]);

      return Tp;
    }();

    var Bp = /*#__PURE__*/function () {
      function Bp(t, e, r, n, i) {
        _classCallCheck(this, Bp);

        this.type = "Feature", this._vectorTileFeature = t, t._z = e, t._x = r, t._y = n, this.properties = t.properties, this.id = i;
      }

      _createClass(Bp, [{
        key: "geometry",
        get: function get() {
          return void 0 === this._geometry && (this._geometry = this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x, this._vectorTileFeature._y, this._vectorTileFeature._z).geometry), this._geometry;
        },
        set: function set(t) {
          this._geometry = t;
        }
      }, {
        key: "toJSON",
        value: function toJSON() {
          var t = {
            geometry: this.geometry
          };

          for (var _e181 in this) {
            "_geometry" !== _e181 && "_vectorTileFeature" !== _e181 && (t[_e181] = this[_e181]);
          }

          return t;
        }
      }]);

      return Bp;
    }();

    var Cp = /*#__PURE__*/function () {
      function Cp() {
        _classCallCheck(this, Cp);

        this.state = {}, this.stateChanges = {}, this.deletedStates = {};
      }

      _createClass(Cp, [{
        key: "updateState",
        value: function updateState(t, e, r) {
          var n = String(e);

          if (this.stateChanges[t] = this.stateChanges[t] || {}, this.stateChanges[t][n] = this.stateChanges[t][n] || {}, tt(this.stateChanges[t][n], r), null === this.deletedStates[t]) {
            this.deletedStates[t] = {};

            for (var _e182 in this.state[t]) {
              _e182 !== n && (this.deletedStates[t][_e182] = null);
            }
          } else if (this.deletedStates[t] && null === this.deletedStates[t][n]) {
            this.deletedStates[t][n] = {};

            for (var _e183 in this.state[t][n]) {
              r[_e183] || (this.deletedStates[t][n][_e183] = null);
            }
          } else for (var _e184 in r) {
            this.deletedStates[t] && this.deletedStates[t][n] && null === this.deletedStates[t][n][_e184] && delete this.deletedStates[t][n][_e184];
          }
        }
      }, {
        key: "removeFeatureState",
        value: function removeFeatureState(t, e, r) {
          if (null === this.deletedStates[t]) return;
          var n = String(e);
          if (this.deletedStates[t] = this.deletedStates[t] || {}, r && void 0 !== e) null !== this.deletedStates[t][n] && (this.deletedStates[t][n] = this.deletedStates[t][n] || {}, this.deletedStates[t][n][r] = null);else if (void 0 !== e) {
            if (this.stateChanges[t] && this.stateChanges[t][n]) for (r in this.deletedStates[t][n] = {}, this.stateChanges[t][n]) {
              this.deletedStates[t][n][r] = null;
            } else this.deletedStates[t][n] = null;
          } else this.deletedStates[t] = null;
        }
      }, {
        key: "getState",
        value: function getState(t, e) {
          var r = String(e),
              n = tt({}, (this.state[t] || {})[r], (this.stateChanges[t] || {})[r]);
          if (null === this.deletedStates[t]) return {};

          if (this.deletedStates[t]) {
            var _r158 = this.deletedStates[t][e];
            if (null === _r158) return {};

            for (var _t173 in _r158) {
              delete n[_t173];
            }
          }

          return n;
        }
      }, {
        key: "initializeTileState",
        value: function initializeTileState(t, e) {
          t.setFeatureState(this.state, e);
        }
      }, {
        key: "coalesceChanges",
        value: function coalesceChanges(t, e) {
          var r = {};

          for (var _t174 in this.stateChanges) {
            this.state[_t174] = this.state[_t174] || {};
            var _e185 = {};

            for (var _r159 in this.stateChanges[_t174]) {
              this.state[_t174][_r159] || (this.state[_t174][_r159] = {}), tt(this.state[_t174][_r159], this.stateChanges[_t174][_r159]), _e185[_r159] = this.state[_t174][_r159];
            }

            r[_t174] = _e185;
          }

          for (var _t175 in this.deletedStates) {
            this.state[_t175] = this.state[_t175] || {};
            var _e186 = {};
            if (null === this.deletedStates[_t175]) for (var _r160 in this.state[_t175]) {
              _e186[_r160] = {}, this.state[_t175][_r160] = {};
            } else for (var _r161 in this.deletedStates[_t175]) {
              if (null === this.deletedStates[_t175][_r161]) this.state[_t175][_r161] = {};else for (var _i115 = 0, _Object$keys9 = Object.keys(this.deletedStates[_t175][_r161]); _i115 < _Object$keys9.length; _i115++) {
                var _e187 = _Object$keys9[_i115];
                delete this.state[_t175][_r161][_e187];
              }
              _e186[_r161] = this.state[_t175][_r161];
            }
            r[_t175] = r[_t175] || {}, tt(r[_t175], _e186);
          }

          if (this.stateChanges = {}, this.deletedStates = {}, 0 !== Object.keys(r).length) for (var _n115 in t) {
            t[_n115].setFeatureState(r, e);
          }
        }
      }]);

      return Cp;
    }();

    var Pp = /*#__PURE__*/function () {
      function Pp(t) {
        _classCallCheck(this, Pp);

        this.size = t, this.minimums = [], this.maximums = [], this.leaves = [];
      }

      _createClass(Pp, [{
        key: "getElevation",
        value: function getElevation(t, e) {
          var r = this.toIdx(t, e);
          return {
            min: this.minimums[r],
            max: this.maximums[r]
          };
        }
      }, {
        key: "isLeaf",
        value: function isLeaf(t, e) {
          return this.leaves[this.toIdx(t, e)];
        }
      }, {
        key: "toIdx",
        value: function toIdx(t, e) {
          return e * this.size + t;
        }
      }]);

      return Pp;
    }();

    function Ep(t, e, r, n) {
      var i = 0,
          s = Number.MAX_VALUE;

      for (var _a68 = 0; _a68 < 3; _a68++) {
        if (Math.abs(n[_a68]) < 1e-15) {
          if (r[_a68] < t[_a68] || r[_a68] > e[_a68]) return null;
        } else {
          var _o42 = 1 / n[_a68];

          var _l35 = (t[_a68] - r[_a68]) * _o42,
              _u34 = (e[_a68] - r[_a68]) * _o42;

          if (_l35 > _u34) {
            var _t176 = _l35;
            _l35 = _u34, _u34 = _t176;
          }

          if (_l35 > i && (i = _l35), _u34 < s && (s = _u34), i > s) return null;
        }
      }

      return i;
    }

    function Dp(t, e, r, n, i, s, a, o, l, u, c) {
      var h = n - t,
          p = i - e,
          d = s - r,
          f = a - t,
          y = o - e,
          m = l - r,
          g = c[1] * m - c[2] * y,
          x = c[2] * f - c[0] * m,
          v = c[0] * y - c[1] * f,
          b = h * g + p * x + d * v;
      if (Math.abs(b) < 1e-15) return null;

      var w = 1 / b,
          _ = u[0] - t,
          A = u[1] - e,
          k = u[2] - r,
          S = (_ * g + A * x + k * v) * w;

      if (S < 0 || S > 1) return null;
      var I = A * d - k * p,
          z = k * h - _ * d,
          M = _ * p - A * h,
          T = (c[0] * I + c[1] * z + c[2] * M) * w;
      return T < 0 || S + T > 1 ? null : (f * I + y * z + m * M) * w;
    }

    function Vp(t, e, r) {
      return (t - e) / (r - e);
    }

    function Fp(t, e, r, n, i, s, a, o, l) {
      var u = 1 << r,
          c = s - n,
          h = a - i,
          p = (t + 1) / u * c + n,
          d = (e + 0) / u * h + i,
          f = (e + 1) / u * h + i;
      o[0] = (t + 0) / u * c + n, o[1] = d, l[0] = p, l[1] = f;
    }

    var Lp = /*#__PURE__*/function () {
      function Lp(t) {
        _classCallCheck(this, Lp);

        if (this.maximums = [], this.minimums = [], this.leaves = [], this.childOffsets = [], this.nodeCount = 0, this.dem = t, this._siblingOffset = [[0, 0], [1, 0], [0, 1], [1, 1]], !this.dem) return;

        var e = function (t) {
          var e = Math.ceil(Math.log2(t.dim / 8)),
              r = [];
          var n = Math.ceil(Math.pow(2, e));

          var i = 1 / n,
              s = function s(t, e, r, n, i) {
            var s = n ? 1 : 0,
                a = (t + 1) * r - s,
                o = e * r,
                l = (e + 1) * r - s;
            i[0] = t * r, i[1] = o, i[2] = a, i[3] = l;
          };

          var a = new Pp(n);
          var o = [];

          for (var _e188 = 0; _e188 < n * n; _e188++) {
            s(_e188 % n, Math.floor(_e188 / n), i, !1, o);

            var _r162 = Up(o[0], o[1], t),
                _l36 = Up(o[2], o[1], t),
                _u35 = Up(o[2], o[3], t),
                _c21 = Up(o[0], o[3], t);

            a.minimums.push(Math.min(_r162, _l36, _u35, _c21)), a.maximums.push(Math.max(_r162, _l36, _u35, _c21)), a.leaves.push(1);
          }

          for (r.push(a), n /= 2; n >= 1; n /= 2) {
            var _t177 = r[r.length - 1];
            a = new Pp(n);

            for (var _e189 = 0; _e189 < n * n; _e189++) {
              s(_e189 % n, Math.floor(_e189 / n), 2, !0, o);

              var _r163 = _t177.getElevation(o[0], o[1]),
                  _i116 = _t177.getElevation(o[2], o[1]),
                  _l37 = _t177.getElevation(o[2], o[3]),
                  _u36 = _t177.getElevation(o[0], o[3]),
                  _c22 = _t177.isLeaf(o[0], o[1]),
                  _h12 = _t177.isLeaf(o[2], o[1]),
                  _p14 = _t177.isLeaf(o[2], o[3]),
                  _d9 = _t177.isLeaf(o[0], o[3]),
                  _f10 = Math.min(_r163.min, _i116.min, _l37.min, _u36.min),
                  _y6 = Math.max(_r163.max, _i116.max, _l37.max, _u36.max),
                  _m8 = _c22 && _h12 && _p14 && _d9;

              a.maximums.push(_y6), a.minimums.push(_f10), a.leaves.push(_y6 - _f10 <= 5 && _m8 ? 1 : 0);
            }

            r.push(a);
          }

          return r;
        }(this.dem),
            r = e.length - 1,
            n = e[r];

        this._addNode(n.minimums[0], n.maximums[0], n.leaves[0]), this._construct(e, 0, 0, r, 0);
      }

      _createClass(Lp, [{
        key: "raycastRoot",
        value: function raycastRoot(t, e, r, n, i, s) {
          var a = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : 1;
          return Ep([t, e, -100], [r, n, this.maximums[0] * a], i, s);
        }
      }, {
        key: "raycast",
        value: function raycast(t, e, r, n, i, s) {
          var a = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : 1;
          if (!this.nodeCount) return null;
          var o = this.raycastRoot(t, e, r, n, i, s, a);
          if (null == o) return null;
          var l = [],
              u = [],
              c = [],
              h = [],
              p = [{
            idx: 0,
            t: o,
            nodex: 0,
            nodey: 0,
            depth: 0
          }];

          for (; p.length > 0;) {
            var _p$pop = p.pop(),
                _o43 = _p$pop.idx,
                _d10 = _p$pop.t,
                _f11 = _p$pop.nodex,
                _y7 = _p$pop.nodey,
                _m9 = _p$pop.depth;

            if (this.leaves[_o43]) {
              Fp(_f11, _y7, _m9, t, e, r, n, c, h);

              var _o44 = 1 << _m9,
                  _l38 = (_f11 + 0) / _o44,
                  _u37 = (_f11 + 1) / _o44,
                  _p15 = (_y7 + 0) / _o44,
                  _g10 = (_y7 + 1) / _o44,
                  _x9 = Up(_l38, _p15, this.dem) * a,
                  _v7 = Up(_u37, _p15, this.dem) * a,
                  _b7 = Up(_u37, _g10, this.dem) * a,
                  _w7 = Up(_l38, _g10, this.dem) * a,
                  _8 = Dp(c[0], c[1], _x9, h[0], c[1], _v7, h[0], h[1], _b7, i, s),
                  _A7 = Dp(h[0], h[1], _b7, c[0], h[1], _w7, c[0], c[1], _x9, i, s),
                  _k8 = Math.min(null !== _8 ? _8 : Number.MAX_VALUE, null !== _A7 ? _A7 : Number.MAX_VALUE);

              if (_k8 !== Number.MAX_VALUE) return _k8;
              {
                var _t178 = I([], i, s, _d10);

                if (Rp(_x9, _v7, _w7, _b7, Vp(_t178[0], c[0], h[0]), Vp(_t178[1], c[1], h[1])) >= _t178[2]) return _d10;
              }
              continue;
            }

            var _g9 = 0;

            for (var _p16 = 0; _p16 < this._siblingOffset.length; _p16++) {
              Fp((_f11 << 1) + this._siblingOffset[_p16][0], (_y7 << 1) + this._siblingOffset[_p16][1], _m9 + 1, t, e, r, n, c, h), c[2] = -100, h[2] = this.maximums[this.childOffsets[_o43] + _p16] * a;

              var _d11 = Ep(c, h, i, s);

              if (null != _d11) {
                var _t179 = _d11;
                l[_p16] = _t179;

                var _e190 = !1;

                for (var _r164 = 0; _r164 < _g9 && !_e190; _r164++) {
                  _t179 >= l[u[_r164]] && (u.splice(_r164, 0, _p16), _e190 = !0);
                }

                _e190 || (u[_g9] = _p16), _g9++;
              }
            }

            for (var _t180 = 0; _t180 < _g9; _t180++) {
              var _e191 = u[_t180];
              p.push({
                idx: this.childOffsets[_o43] + _e191,
                t: l[_e191],
                nodex: (_f11 << 1) + this._siblingOffset[_e191][0],
                nodey: (_y7 << 1) + this._siblingOffset[_e191][1],
                depth: _m9 + 1
              });
            }
          }

          return null;
        }
      }, {
        key: "_addNode",
        value: function _addNode(t, e, r) {
          return this.minimums.push(t), this.maximums.push(e), this.leaves.push(r), this.childOffsets.push(0), this.nodeCount++;
        }
      }, {
        key: "_construct",
        value: function _construct(t, e, r, n, i) {
          if (1 === t[n].isLeaf(e, r)) return;
          this.childOffsets[i] || (this.childOffsets[i] = this.nodeCount);
          var s = n - 1,
              a = t[s];
          var o,
              l = 0;

          for (var _t181 = 0; _t181 < this._siblingOffset.length; _t181++) {
            var _n116 = 2 * e + this._siblingOffset[_t181][0],
                _i117 = 2 * r + this._siblingOffset[_t181][1],
                _s84 = a.getElevation(_n116, _i117),
                _u38 = a.isLeaf(_n116, _i117),
                _c23 = this._addNode(_s84.min, _s84.max, _u38);

            _u38 && (l |= 1 << _t181), o || (o = _c23);
          }

          for (var _n117 = 0; _n117 < this._siblingOffset.length; _n117++) {
            l & 1 << _n117 || this._construct(t, 2 * e + this._siblingOffset[_n117][0], 2 * r + this._siblingOffset[_n117][1], s, o + _n117);
          }
        }
      }]);

      return Lp;
    }();

    function Rp(t, e, r, n, i, s) {
      return Lr(Lr(t, r, s), Lr(e, n, s), i);
    }

    function Up(t, e, r) {
      var n = r.dim,
          i = Y(t * n - .5, 0, n - 1),
          s = Y(e * n - .5, 0, n - 1),
          a = Math.floor(i),
          o = Math.floor(s),
          l = Math.min(a + 1, n - 1),
          u = Math.min(o + 1, n - 1);
      return Rp(r.get(a, o), r.get(l, o), r.get(a, u), r.get(l, u), i - a, s - o);
    }

    var $p = {
      mapbox: [6553.6, 25.6, .1, 1e4],
      terrarium: [256, 1, 1 / 256, 32768]
    };

    var Op = /*#__PURE__*/function () {
      function Op(t, e, r) {
        var n = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : !1;
        var i = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : !1;

        _classCallCheck(this, Op);

        if (this.uid = t, e.height !== e.width) throw new RangeError("DEM tiles must be square");
        if (r && "mapbox" !== r && "terrarium" !== r) return pt("\"".concat(r, "\" is not a valid encoding type. Valid types include \"mapbox\" and \"terrarium\"."));
        this.stride = e.height;
        var s = this.dim = e.height - 2;

        if (this.data = new Uint32Array(e.data.buffer), this.encoding = r || "mapbox", this.borderReady = n, !n) {
          for (var _t182 = 0; _t182 < s; _t182++) {
            this.data[this._idx(-1, _t182)] = this.data[this._idx(0, _t182)], this.data[this._idx(s, _t182)] = this.data[this._idx(s - 1, _t182)], this.data[this._idx(_t182, -1)] = this.data[this._idx(_t182, 0)], this.data[this._idx(_t182, s)] = this.data[this._idx(_t182, s - 1)];
          }

          this.data[this._idx(-1, -1)] = this.data[this._idx(0, 0)], this.data[this._idx(s, -1)] = this.data[this._idx(s - 1, 0)], this.data[this._idx(-1, s)] = this.data[this._idx(0, s - 1)], this.data[this._idx(s, s)] = this.data[this._idx(s - 1, s - 1)], i && this._buildQuadTree();
        }
      }

      _createClass(Op, [{
        key: "tree",
        get: function get() {
          return this._tree || this._buildQuadTree(), this._tree;
        }
      }, {
        key: "_buildQuadTree",
        value: function _buildQuadTree() {
          this._tree = new Lp(this);
        }
      }, {
        key: "get",
        value: function get(t, e) {
          var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !1;
          var n = new Uint8Array(this.data.buffer);
          r && (t = Y(t, -1, this.dim), e = Y(e, -1, this.dim));

          var i = 4 * this._idx(t, e);

          return ("terrarium" === this.encoding ? this._unpackTerrarium : this._unpackMapbox)(n[i], n[i + 1], n[i + 2]);
        }
      }, {
        key: "unpackVector",
        get: function get() {
          return $p[this.encoding];
        }
      }, {
        key: "_idx",
        value: function _idx(t, e) {
          if (t < -1 || t >= this.dim + 1 || e < -1 || e >= this.dim + 1) throw new RangeError("out of range source coordinates for DEM data");
          return (e + 1) * this.stride + (t + 1);
        }
      }, {
        key: "_unpackMapbox",
        value: function _unpackMapbox(t, e, r) {
          return (256 * t * 256 + 256 * e + r) / 10 - 1e4;
        }
      }, {
        key: "_unpackTerrarium",
        value: function _unpackTerrarium(t, e, r) {
          return 256 * t + e + r / 256 - 32768;
        }
      }, {
        key: "getPixels",
        value: function getPixels() {
          return new Ml({
            width: this.stride,
            height: this.stride
          }, new Uint8Array(this.data.buffer));
        }
      }, {
        key: "backfillBorder",
        value: function backfillBorder(t, e, r) {
          if (this.dim !== t.dim) throw new Error("dem dimension mismatch");
          var n = e * this.dim,
              i = e * this.dim + this.dim,
              s = r * this.dim,
              a = r * this.dim + this.dim;

          switch (e) {
            case -1:
              n = i - 1;
              break;

            case 1:
              i = n + 1;
          }

          switch (r) {
            case -1:
              s = a - 1;
              break;

            case 1:
              a = s + 1;
          }

          var o = -e * this.dim,
              l = -r * this.dim;

          for (var _e192 = s; _e192 < a; _e192++) {
            for (var _r165 = n; _r165 < i; _r165++) {
              this.data[this._idx(_r165, _e192)] = t.data[this._idx(_r165 + o, _e192 + l)];
            }
          }
        }
      }, {
        key: "onDeserialize",
        value: function onDeserialize() {
          this._tree && (this._tree.dem = this);
        }
      }], [{
        key: "getUnpackVector",
        value: function getUnpackVector(t) {
          return $p[t];
        }
      }, {
        key: "pack",
        value: function pack(t, e) {
          var r = [0, 0, 0, 0],
              n = Op.getUnpackVector(e);
          var i = Math.floor((t + n[3]) / n[2]);
          return r[2] = i % 256, i = Math.floor(i / 256), r[1] = i % 256, i = Math.floor(i / 256), r[0] = i, r;
        }
      }]);

      return Op;
    }();

    Zi("DEMData", Op), Zi("DemMinMaxQuadTree", Lp, {
      omit: ["dem"]
    });

    var jp = /*#__PURE__*/function () {
      function jp(t, e) {
        _classCallCheck(this, jp);

        this.max = t, this.onRemove = e, this.reset();
      }

      _createClass(jp, [{
        key: "reset",
        value: function reset() {
          for (var _t183 in this.data) {
            var _iterator125 = _createForOfIteratorHelper(this.data[_t183]),
                _step125;

            try {
              for (_iterator125.s(); !(_step125 = _iterator125.n()).done;) {
                var _e193 = _step125.value;
                _e193.timeout && clearTimeout(_e193.timeout), this.onRemove(_e193.value);
              }
            } catch (err) {
              _iterator125.e(err);
            } finally {
              _iterator125.f();
            }
          }

          return this.data = {}, this.order = [], this;
        }
      }, {
        key: "add",
        value: function add(t, e, r) {
          var _this31 = this;

          var n = t.wrapped().key;
          void 0 === this.data[n] && (this.data[n] = []);
          var i = {
            value: e,
            timeout: void 0
          };

          if (void 0 !== r && (i.timeout = setTimeout(function () {
            _this31.remove(t, i);
          }, r)), this.data[n].push(i), this.order.push(n), this.order.length > this.max) {
            var _t184 = this._getAndRemoveByKey(this.order[0]);

            _t184 && this.onRemove(_t184);
          }

          return this;
        }
      }, {
        key: "has",
        value: function has(t) {
          return t.wrapped().key in this.data;
        }
      }, {
        key: "getAndRemove",
        value: function getAndRemove(t) {
          return this.has(t) ? this._getAndRemoveByKey(t.wrapped().key) : null;
        }
      }, {
        key: "_getAndRemoveByKey",
        value: function _getAndRemoveByKey(t) {
          var e = this.data[t].shift();
          return e.timeout && clearTimeout(e.timeout), 0 === this.data[t].length && delete this.data[t], this.order.splice(this.order.indexOf(t), 1), e.value;
        }
      }, {
        key: "getByKey",
        value: function getByKey(t) {
          var e = this.data[t];
          return e ? e[0].value : null;
        }
      }, {
        key: "get",
        value: function get(t) {
          return this.has(t) ? this.data[t.wrapped().key][0].value : null;
        }
      }, {
        key: "remove",
        value: function remove(t, e) {
          if (!this.has(t)) return this;
          var r = t.wrapped().key,
              n = void 0 === e ? 0 : this.data[r].indexOf(e),
              i = this.data[r][n];
          return this.data[r].splice(n, 1), i.timeout && clearTimeout(i.timeout), 0 === this.data[r].length && delete this.data[r], this.onRemove(i.value), this.order.splice(this.order.indexOf(r), 1), this;
        }
      }, {
        key: "setMaxSize",
        value: function setMaxSize(t) {
          for (this.max = t; this.order.length > this.max;) {
            var _t185 = this._getAndRemoveByKey(this.order[0]);

            _t185 && this.onRemove(_t185);
          }

          return this;
        }
      }, {
        key: "filter",
        value: function filter(t) {
          var e = [];

          for (var _r166 in this.data) {
            var _iterator126 = _createForOfIteratorHelper(this.data[_r166]),
                _step126;

            try {
              for (_iterator126.s(); !(_step126 = _iterator126.n()).done;) {
                var _n118 = _step126.value;
                t(_n118.value) || e.push(_n118);
              }
            } catch (err) {
              _iterator126.e(err);
            } finally {
              _iterator126.f();
            }
          }

          for (var _i118 = 0, _e194 = e; _i118 < _e194.length; _i118++) {
            var _t186 = _e194[_i118];
            this.remove(_t186.value.tileID, _t186);
          }
        }
      }]);

      return jp;
    }();

    var qp = /*#__PURE__*/function (_xe2) {
      _inherits(qp, _xe2);

      var _super61 = _createSuper(qp);

      function qp(t, e, r) {
        var _this32;

        _classCallCheck(this, qp);

        _this32 = _super61.call(this), _this32.id = t, _this32._onlySymbols = r, e.on("data", function (t) {
          "source" === t.dataType && "metadata" === t.sourceDataType && (_this32._sourceLoaded = !0), _this32._sourceLoaded && !_this32._paused && "source" === t.dataType && "content" === t.sourceDataType && (_this32.reload(), _this32.transform && _this32.update(_this32.transform));
        }), e.on("error", function () {
          _this32._sourceErrored = !0;
        }), _this32._source = e, _this32._tiles = {}, _this32._cache = new jp(0, _this32._unloadTile.bind(_assertThisInitialized(_this32))), _this32._timers = {}, _this32._cacheTimers = {}, _this32._minTileCacheSize = null, _this32._maxTileCacheSize = null, _this32._loadedParentTiles = {}, _this32._coveredTiles = {}, _this32._state = new Cp();
        return _this32;
      }

      _createClass(qp, [{
        key: "onAdd",
        value: function onAdd(t) {
          this.map = t, this._minTileCacheSize = t ? t._minTileCacheSize : null, this._maxTileCacheSize = t ? t._maxTileCacheSize : null;
        }
      }, {
        key: "loaded",
        value: function loaded() {
          if (this._sourceErrored) return !0;
          if (!this._sourceLoaded) return !1;
          if (!this._source.loaded()) return !1;

          for (var _t187 in this._tiles) {
            var _e195 = this._tiles[_t187];
            if ("loaded" !== _e195.state && "errored" !== _e195.state) return !1;
          }

          return !0;
        }
      }, {
        key: "getSource",
        value: function getSource() {
          return this._source;
        }
      }, {
        key: "pause",
        value: function pause() {
          this._paused = !0;
        }
      }, {
        key: "resume",
        value: function resume() {
          if (!this._paused) return;
          var t = this._shouldReloadOnResume;
          this._paused = !1, this._shouldReloadOnResume = !1, t && this.reload(), this.transform && this.update(this.transform);
        }
      }, {
        key: "_loadTile",
        value: function _loadTile(t, e) {
          return t.isSymbolTile = this._onlySymbols, this._source.loadTile(t, e);
        }
      }, {
        key: "_unloadTile",
        value: function _unloadTile(t) {
          if (this._source.unloadTile) return this._source.unloadTile(t, function () {});
        }
      }, {
        key: "_abortTile",
        value: function _abortTile(t) {
          if (this._source.abortTile) return this._source.abortTile(t, function () {});
        }
      }, {
        key: "serialize",
        value: function serialize() {
          return this._source.serialize();
        }
      }, {
        key: "prepare",
        value: function prepare(t) {
          this._source.prepare && this._source.prepare(), this._state.coalesceChanges(this._tiles, this.map ? this.map.painter : null);

          for (var _e196 in this._tiles) {
            var _r167 = this._tiles[_e196];
            _r167.upload(t), _r167.prepare(this.map.style.imageManager);
          }
        }
      }, {
        key: "getIds",
        value: function getIds() {
          return Q(this._tiles).map(function (t) {
            return t.tileID;
          }).sort(Np).map(function (t) {
            return t.key;
          });
        }
      }, {
        key: "getRenderableIds",
        value: function getRenderableIds(t) {
          var _this33 = this;

          var e = [];

          for (var _r168 in this._tiles) {
            this._isIdRenderable(+_r168, t) && e.push(this._tiles[_r168]);
          }

          return t ? e.sort(function (t, e) {
            var r = t.tileID,
                n = e.tileID,
                s = new i(r.canonical.x, r.canonical.y)._rotate(_this33.transform.angle),
                a = new i(n.canonical.x, n.canonical.y)._rotate(_this33.transform.angle);

            return r.overscaledZ - n.overscaledZ || a.y - s.y || a.x - s.x;
          }).map(function (t) {
            return t.tileID.key;
          }) : e.map(function (t) {
            return t.tileID;
          }).sort(Np).map(function (t) {
            return t.key;
          });
        }
      }, {
        key: "hasRenderableParent",
        value: function hasRenderableParent(t) {
          var e = this.findLoadedParent(t, 0);
          return !!e && this._isIdRenderable(e.tileID.key);
        }
      }, {
        key: "_isIdRenderable",
        value: function _isIdRenderable(t, e) {
          return this._tiles[t] && this._tiles[t].hasData() && !this._coveredTiles[t] && (e || !this._tiles[t].holdingForFade());
        }
      }, {
        key: "reload",
        value: function reload() {
          if (this._paused) this._shouldReloadOnResume = !0;else {
            this._cache.reset();

            for (var _t188 in this._tiles) {
              "errored" !== this._tiles[_t188].state && this._reloadTile(+_t188, "reloading");
            }
          }
        }
      }, {
        key: "_reloadTile",
        value: function _reloadTile(t, e) {
          var r = this._tiles[t];
          r && ("loading" !== r.state && (r.state = e), this._loadTile(r, this._tileLoaded.bind(this, r, t, e)));
        }
      }, {
        key: "_tileLoaded",
        value: function _tileLoaded(t, e, r, n) {
          if (n) {
            if (t.state = "errored", 404 !== n.status) this._source.fire(new ge(n, {
              tile: t
            }));else if ("raster-dem" === this._source.type && this.usedForTerrain && this.map.painter.terrain) {
              var _t189 = this.map.painter.terrain;
              this.update(this.transform, _t189.getScaledDemTileSize(), !0), _t189.resetTileLookupCache(this.id);
            } else this.update(this.transform);
          } else t.timeAdded = At.now(), "expired" === r && (t.refreshedUponExpiration = !0), this._setTileReloadTimer(e, t), "raster-dem" === this._source.type && t.dem && this._backfillDEM(t), this._state.initializeTileState(t, this.map ? this.map.painter : null), this._source.fire(new me("data", {
            dataType: "source",
            tile: t,
            coord: t.tileID,
            sourceCacheId: this.id
          }));
        }
      }, {
        key: "_backfillDEM",
        value: function _backfillDEM(t) {
          var e = this.getRenderableIds();

          for (var _n119 = 0; _n119 < e.length; _n119++) {
            var _i119 = e[_n119];

            if (t.neighboringTiles && t.neighboringTiles[_i119]) {
              var _e197 = this.getTileByID(_i119);

              r(t, _e197), r(_e197, t);
            }
          }

          function r(t, e) {
            if (!t.dem || t.dem.borderReady) return;
            t.needsHillshadePrepare = !0, t.needsDEMTextureUpload = !0;
            var r = e.tileID.canonical.x - t.tileID.canonical.x;
            var n = e.tileID.canonical.y - t.tileID.canonical.y,
                i = Math.pow(2, t.tileID.canonical.z),
                s = e.tileID.key;
            0 === r && 0 === n || Math.abs(n) > 1 || (Math.abs(r) > 1 && (1 === Math.abs(r + i) ? r += i : 1 === Math.abs(r - i) && (r -= i)), e.dem && t.dem && (t.dem.backfillBorder(e.dem, r, n), t.neighboringTiles && t.neighboringTiles[s] && (t.neighboringTiles[s].backfilled = !0)));
          }
        }
      }, {
        key: "getTile",
        value: function getTile(t) {
          return this.getTileByID(t.key);
        }
      }, {
        key: "getTileByID",
        value: function getTileByID(t) {
          return this._tiles[t];
        }
      }, {
        key: "_retainLoadedChildren",
        value: function _retainLoadedChildren(t, e, r, n) {
          for (var _i120 in this._tiles) {
            var _s85 = this._tiles[_i120];
            if (n[_i120] || !_s85.hasData() || _s85.tileID.overscaledZ <= e || _s85.tileID.overscaledZ > r) continue;
            var _a69 = _s85.tileID;

            for (; _s85 && _s85.tileID.overscaledZ > e + 1;) {
              var _t190 = _s85.tileID.scaledTo(_s85.tileID.overscaledZ - 1);

              _s85 = this._tiles[_t190.key], _s85 && _s85.hasData() && (_a69 = _t190);
            }

            var _o45 = _a69;

            for (; _o45.overscaledZ > e;) {
              if (_o45 = _o45.scaledTo(_o45.overscaledZ - 1), t[_o45.key]) {
                n[_a69.key] = _a69;
                break;
              }
            }
          }
        }
      }, {
        key: "findLoadedParent",
        value: function findLoadedParent(t, e) {
          if (t.key in this._loadedParentTiles) {
            var _r169 = this._loadedParentTiles[t.key];
            return _r169 && _r169.tileID.overscaledZ >= e ? _r169 : null;
          }

          for (var _r170 = t.overscaledZ - 1; _r170 >= e; _r170--) {
            var _e198 = t.scaledTo(_r170),
                _n120 = this._getLoadedTile(_e198);

            if (_n120) return _n120;
          }
        }
      }, {
        key: "_getLoadedTile",
        value: function _getLoadedTile(t) {
          var e = this._tiles[t.key];
          return e && e.hasData() ? e : this._cache.getByKey(this._source.reparseOverscaled ? t.wrapped().key : t.canonical.key);
        }
      }, {
        key: "updateCacheSize",
        value: function updateCacheSize(t, e) {
          e = e || this._source.tileSize;
          var r = Math.ceil(t.width / e) + 1,
              n = Math.ceil(t.height / e) + 1,
              i = Math.floor(r * n * 5),
              s = "number" == typeof this._minTileCacheSize ? Math.max(this._minTileCacheSize, i) : i,
              a = "number" == typeof this._maxTileCacheSize ? Math.min(this._maxTileCacheSize, s) : s;

          this._cache.setMaxSize(a);
        }
      }, {
        key: "handleWrapJump",
        value: function handleWrapJump(t) {
          var e = Math.round((t - (void 0 === this._prevLng ? t : this._prevLng)) / 360);

          if (this._prevLng = t, e) {
            var _t191 = {};

            for (var _r171 in this._tiles) {
              var _n121 = this._tiles[_r171];
              _n121.tileID = _n121.tileID.unwrapTo(_n121.tileID.wrap + e), _t191[_n121.tileID.key] = _n121;
            }

            this._tiles = _t191;

            for (var _t192 in this._timers) {
              clearTimeout(this._timers[_t192]), delete this._timers[_t192];
            }

            for (var _t193 in this._tiles) {
              this._setTileReloadTimer(+_t193, this._tiles[_t193]);
            }
          }
        }
      }, {
        key: "update",
        value: function update(t, e, r) {
          var _this34 = this;

          if (this.transform = t, !this._sourceLoaded || this._paused || this.transform.freezeTileCoverage) return;
          if (this.usedForTerrain && !r) return;
          var n;
          this.updateCacheSize(t, e), "globe" !== this.transform.projection.name && this.handleWrapJump(this.transform.center.lng), this._coveredTiles = {}, this.used || this.usedForTerrain ? this._source.tileID ? n = t.getVisibleUnwrappedCoordinates(this._source.tileID).map(function (t) {
            return new bp(t.canonical.z, t.wrap, t.canonical.z, t.canonical.x, t.canonical.y);
          }) : (n = t.coveringTiles({
            tileSize: e || this._source.tileSize,
            minzoom: this._source.minzoom,
            maxzoom: this._source.maxzoom,
            roundZoom: this._source.roundZoom && !r,
            reparseOverscaled: this._source.reparseOverscaled,
            isTerrainDEM: this.usedForTerrain
          }), this._source.hasTile && (n = n.filter(function (t) {
            return _this34._source.hasTile(t);
          }))) : n = [];

          var i = this._updateRetainedTiles(n);

          if (Gp(this._source.type) && 0 !== n.length) {
            var _t194 = {},
                _e199 = {},
                _r172 = Object.keys(i);

            for (var _i121 = 0, _r173 = _r172; _i121 < _r173.length; _i121++) {
              var _n122 = _r173[_i121];
              var _r174 = i[_n122],
                  _s87 = this._tiles[_n122];
              if (!_s87 || _s87.fadeEndTime && _s87.fadeEndTime <= At.now()) continue;

              var _a70 = this.findLoadedParent(_r174, Math.max(_r174.overscaledZ - qp.maxOverzooming, this._source.minzoom));

              _a70 && (this._addTile(_a70.tileID), _t194[_a70.tileID.key] = _a70.tileID), _e199[_n122] = _r174;
            }

            var _s86 = n[n.length - 1].overscaledZ;

            for (var _t195 in this._tiles) {
              var _r175 = this._tiles[_t195];
              if (i[_t195] || !_r175.hasData()) continue;
              var _n123 = _r175.tileID;

              for (; _n123.overscaledZ > _s86;) {
                _n123 = _n123.scaledTo(_n123.overscaledZ - 1);
                var _s88 = this._tiles[_n123.key];

                if (_s88 && _s88.hasData() && _e199[_n123.key]) {
                  i[_t195] = _r175.tileID;
                  break;
                }
              }
            }

            for (var _e200 in _t194) {
              i[_e200] || (this._coveredTiles[_e200] = !0, i[_e200] = _t194[_e200]);
            }
          }

          for (var _t196 in i) {
            this._tiles[_t196].clearFadeHold();
          }

          var s = function (t, e) {
            var r = [];

            for (var _n124 in t) {
              _n124 in e || r.push(_n124);
            }

            return r;
          }(this._tiles, i);

          var _iterator127 = _createForOfIteratorHelper(s),
              _step127;

          try {
            for (_iterator127.s(); !(_step127 = _iterator127.n()).done;) {
              var _t197 = _step127.value;
              var _e201 = this._tiles[_t197];
              _e201.hasSymbolBuckets && !_e201.holdingForFade() ? _e201.setHoldDuration(this.map._fadeDuration) : _e201.hasSymbolBuckets && !_e201.symbolFadeFinished() || this._removeTile(+_t197);
            }
          } catch (err) {
            _iterator127.e(err);
          } finally {
            _iterator127.f();
          }

          this._updateLoadedParentTileCache(), this._onlySymbols && this._source.afterUpdate && this._source.afterUpdate();
        }
      }, {
        key: "releaseSymbolFadeTiles",
        value: function releaseSymbolFadeTiles() {
          for (var _t198 in this._tiles) {
            this._tiles[_t198].holdingForFade() && this._removeTile(+_t198);
          }
        }
      }, {
        key: "_updateRetainedTiles",
        value: function _updateRetainedTiles(t) {
          var e = {};
          if (0 === t.length) return e;
          var r = {},
              n = t.reduce(function (t, e) {
            return Math.min(t, e.overscaledZ);
          }, 1 / 0),
              i = t[0].overscaledZ,
              s = Math.max(i - qp.maxOverzooming, this._source.minzoom),
              a = Math.max(i + qp.maxUnderzooming, this._source.minzoom),
              o = {};

          var _iterator128 = _createForOfIteratorHelper(t),
              _step128;

          try {
            for (_iterator128.s(); !(_step128 = _iterator128.n()).done;) {
              var _r176 = _step128.value;

              var _t199 = this._addTile(_r176);

              e[_r176.key] = _r176, _t199.hasData() || n < this._source.maxzoom && (o[_r176.key] = _r176);
            }
          } catch (err) {
            _iterator128.e(err);
          } finally {
            _iterator128.f();
          }

          this._retainLoadedChildren(o, n, a, e);

          var _iterator129 = _createForOfIteratorHelper(t),
              _step129;

          try {
            for (_iterator129.s(); !(_step129 = _iterator129.n()).done;) {
              var _n125 = _step129.value;
              var _t200 = this._tiles[_n125.key];
              if (_t200.hasData()) continue;

              if (_n125.canonical.z >= this._source.maxzoom) {
                var _t201 = _n125.children(this._source.maxzoom)[0],
                    _r177 = this.getTile(_t201);

                if (_r177 && _r177.hasData()) {
                  e[_t201.key] = _t201;
                  continue;
                }
              } else {
                var _t202 = _n125.children(this._source.maxzoom);

                if (e[_t202[0].key] && e[_t202[1].key] && e[_t202[2].key] && e[_t202[3].key]) continue;
              }

              var _i122 = _t200.wasRequested();

              for (var _a71 = _n125.overscaledZ - 1; _a71 >= s; --_a71) {
                var _s89 = _n125.scaledTo(_a71);

                if (r[_s89.key]) break;
                if (r[_s89.key] = !0, _t200 = this.getTile(_s89), !_t200 && _i122 && (_t200 = this._addTile(_s89)), _t200 && (e[_s89.key] = _s89, _i122 = _t200.wasRequested(), _t200.hasData())) break;
              }
            }
          } catch (err) {
            _iterator129.e(err);
          } finally {
            _iterator129.f();
          }

          return e;
        }
      }, {
        key: "_updateLoadedParentTileCache",
        value: function _updateLoadedParentTileCache() {
          this._loadedParentTiles = {};

          for (var _t203 in this._tiles) {
            var _e202 = [];

            var _r178 = void 0,
                _n126 = this._tiles[_t203].tileID;

            for (; _n126.overscaledZ > 0;) {
              if (_n126.key in this._loadedParentTiles) {
                _r178 = this._loadedParentTiles[_n126.key];
                break;
              }

              _e202.push(_n126.key);

              var _t204 = _n126.scaledTo(_n126.overscaledZ - 1);

              if (_r178 = this._getLoadedTile(_t204), _r178) break;
              _n126 = _t204;
            }

            for (var _i123 = 0, _e203 = _e202; _i123 < _e203.length; _i123++) {
              var _t205 = _e203[_i123];
              this._loadedParentTiles[_t205] = _r178;
            }
          }
        }
      }, {
        key: "_addTile",
        value: function _addTile(t) {
          var e = this._tiles[t.key];
          if (e) return e;
          e = this._cache.getAndRemove(t), e && (this._setTileReloadTimer(t.key, e), e.tileID = t, this._state.initializeTileState(e, this.map ? this.map.painter : null), this._cacheTimers[t.key] && (clearTimeout(this._cacheTimers[t.key]), delete this._cacheTimers[t.key], this._setTileReloadTimer(t.key, e)));
          var r = Boolean(e);

          if (!r) {
            var _r179 = this.map ? this.map.painter : null,
                _n127 = "raster" === this._source.type || "raster-dem" === this._source.type;

            e = new ad(t, this._source.tileSize * t.overscaleFactor(), this.transform.tileZoom, _r179, _n127), this._loadTile(e, this._tileLoaded.bind(this, e, t.key, e.state));
          }

          return e ? (e.uses++, this._tiles[t.key] = e, r || this._source.fire(new me("dataloading", {
            tile: e,
            coord: e.tileID,
            dataType: "source"
          })), e) : null;
        }
      }, {
        key: "_setTileReloadTimer",
        value: function _setTileReloadTimer(t, e) {
          var _this35 = this;

          t in this._timers && (clearTimeout(this._timers[t]), delete this._timers[t]);
          var r = e.getExpiryTimeout();
          r && (this._timers[t] = setTimeout(function () {
            _this35._reloadTile(t, "expired"), delete _this35._timers[t];
          }, r));
        }
      }, {
        key: "_removeTile",
        value: function _removeTile(t) {
          var e = this._tiles[t];
          e && (e.uses--, delete this._tiles[t], this._timers[t] && (clearTimeout(this._timers[t]), delete this._timers[t]), e.uses > 0 || (e.hasData() && "reloading" !== e.state ? this._cache.add(e.tileID, e, e.getExpiryTimeout()) : (e.aborted = !0, this._abortTile(e), this._unloadTile(e))));
        }
      }, {
        key: "clearTiles",
        value: function clearTiles() {
          this._shouldReloadOnResume = !1, this._paused = !1;

          for (var _t206 in this._tiles) {
            this._removeTile(+_t206);
          }

          this._source._clear && this._source._clear(), this._cache.reset();
        }
      }, {
        key: "tilesIn",
        value: function tilesIn(t, e, r) {
          var n = [],
              i = this.transform;
          if (!i) return n;

          for (var _s90 in this._tiles) {
            var _a72 = this._tiles[_s90];
            if (r && _a72.clearQueryDebugViz(), _a72.holdingForFade()) continue;

            var _o46 = t.containsTile(_a72, i, e);

            _o46 && n.push(_o46);
          }

          return n;
        }
      }, {
        key: "getVisibleCoordinates",
        value: function getVisibleCoordinates(t) {
          var _this36 = this;

          var e = this.getRenderableIds(t).map(function (t) {
            return _this36._tiles[t].tileID;
          });

          var _iterator130 = _createForOfIteratorHelper(e),
              _step130;

          try {
            for (_iterator130.s(); !(_step130 = _iterator130.n()).done;) {
              var _t207 = _step130.value;
              _t207.projMatrix = this.transform.calculateProjMatrix(_t207.toUnwrapped());
            }
          } catch (err) {
            _iterator130.e(err);
          } finally {
            _iterator130.f();
          }

          return e;
        }
      }, {
        key: "hasTransition",
        value: function hasTransition() {
          if (this._source.hasTransition()) return !0;
          if (Gp(this._source.type)) for (var _t208 in this._tiles) {
            var _e204 = this._tiles[_t208];
            if (void 0 !== _e204.fadeEndTime && _e204.fadeEndTime >= At.now()) return !0;
          }
          return !1;
        }
      }, {
        key: "setFeatureState",
        value: function setFeatureState(t, e, r) {
          this._state.updateState(t = t || "_geojsonTileLayer", e, r);
        }
      }, {
        key: "removeFeatureState",
        value: function removeFeatureState(t, e, r) {
          this._state.removeFeatureState(t = t || "_geojsonTileLayer", e, r);
        }
      }, {
        key: "getFeatureState",
        value: function getFeatureState(t, e) {
          return this._state.getState(t = t || "_geojsonTileLayer", e);
        }
      }, {
        key: "setDependencies",
        value: function setDependencies(t, e, r) {
          var n = this._tiles[t];
          n && n.setDependencies(e, r);
        }
      }, {
        key: "reloadTilesForDependencies",
        value: function reloadTilesForDependencies(t, e) {
          for (var _r180 in this._tiles) {
            this._tiles[_r180].hasDependency(t, e) && this._reloadTile(+_r180, "reloading");
          }

          this._cache.filter(function (r) {
            return !r.hasDependency(t, e);
          });
        }
      }, {
        key: "_preloadTiles",
        value: function _preloadTiles(t, e) {
          var _this37 = this;

          var r = new Map(),
              n = Array.isArray(t) ? t : [t],
              i = this.map.painter.terrain,
              s = this.usedForTerrain && i ? i.getScaledDemTileSize() : this._source.tileSize;

          var _iterator131 = _createForOfIteratorHelper(n),
              _step131;

          try {
            for (_iterator131.s(); !(_step131 = _iterator131.n()).done;) {
              var _t209 = _step131.value;

              var _e205 = _t209.coveringTiles({
                tileSize: s,
                minzoom: this._source.minzoom,
                maxzoom: this._source.maxzoom,
                roundZoom: this._source.roundZoom && !this.usedForTerrain,
                reparseOverscaled: this._source.reparseOverscaled,
                isTerrainDEM: this.usedForTerrain
              });

              var _iterator132 = _createForOfIteratorHelper(_e205),
                  _step132;

              try {
                for (_iterator132.s(); !(_step132 = _iterator132.n()).done;) {
                  var _t210 = _step132.value;
                  r.set(_t210.key, _t210);
                }
              } catch (err) {
                _iterator132.e(err);
              } finally {
                _iterator132.f();
              }

              this.usedForTerrain && _t209.updateElevation(!1);
            }
          } catch (err) {
            _iterator131.e(err);
          } finally {
            _iterator131.f();
          }

          var a = Array.from(r.values()),
              o = "raster" === this._source.type || "raster-dem" === this._source.type;
          W(a, function (t, e) {
            var r = new ad(t, _this37._source.tileSize * t.overscaleFactor(), _this37.transform.tileZoom, _this37.map.painter, o);

            _this37._loadTile(r, function (t) {
              "raster-dem" === _this37._source.type && r.dem && _this37._backfillDEM(r), e(t, r);
            });
          }, e);
        }
      }]);

      return qp;
    }(xe);

    function Np(t, e) {
      var r = Math.abs(2 * t.wrap) - +(t.wrap < 0),
          n = Math.abs(2 * e.wrap) - +(e.wrap < 0);
      return t.overscaledZ - e.overscaledZ || n - r || e.canonical.y - t.canonical.y || e.canonical.x - t.canonical.x;
    }

    function Gp(t) {
      return "raster" === t || "image" === t || "video" === t;
    }

    qp.maxOverzooming = 10, qp.maxUnderzooming = 3;

    var Zp = /*#__PURE__*/function () {
      function Zp(t, e, r) {
        _classCallCheck(this, Zp);

        this._demTile = t, this._dem = this._demTile.dem, this._scale = e, this._offset = r;
      }

      _createClass(Zp, [{
        key: "tileCoordToPixel",
        value: function tileCoordToPixel(t, e) {
          var r = e * this._scale + this._offset[1],
              n = Math.floor(t * this._scale + this._offset[0]),
              s = Math.floor(r);
          return new i(n, s);
        }
      }, {
        key: "getElevationAt",
        value: function getElevationAt(t, e, r, n) {
          var i = t * this._scale + this._offset[0],
              s = e * this._scale + this._offset[1],
              a = Math.floor(i),
              o = Math.floor(s),
              l = this._dem;
          return n = !!n, r ? Lr(Lr(l.get(a, o, n), l.get(a, o + 1, n), s - o), Lr(l.get(a + 1, o, n), l.get(a + 1, o + 1, n), s - o), i - a) : l.get(a, o, n);
        }
      }, {
        key: "getElevationAtPixel",
        value: function getElevationAtPixel(t, e, r) {
          return this._dem.get(t, e, !!r);
        }
      }, {
        key: "getMeterToDEM",
        value: function getMeterToDEM(t) {
          return (1 << this._demTile.tileID.canonical.z) * Lo(1, t) * this._dem.stride;
        }
      }], [{
        key: "create",
        value: function create(t, e, r) {
          var n = r || t.findDEMTileFor(e);
          if (!n || !n.dem) return;
          var i = n.dem,
              s = n.tileID,
              a = 1 << e.canonical.z - s.canonical.z;
          return new Zp(n, n.tileSize / To / a, [(e.canonical.x / a - s.canonical.x) * i.dim, (e.canonical.y / a - s.canonical.y) * i.dim]);
        }
      }]);

      return Zp;
    }();

    var Xp = /*#__PURE__*/function () {
      function Xp(t, e) {
        _classCallCheck(this, Xp);

        this.tileID = t, this.x = t.canonical.x, this.y = t.canonical.y, this.z = t.canonical.z, this.grid = new Oi(To, 16, 0), this.featureIndexArray = new Na(), this.promoteId = e;
      }

      _createClass(Xp, [{
        key: "insert",
        value: function insert(t, e, r, n, i) {
          var s = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 0;
          var a = this.featureIndexArray.length;
          this.featureIndexArray.emplaceBack(r, n, i, s);
          var o = this.grid;

          for (var _t211 = 0; _t211 < e.length; _t211++) {
            var _r181 = e[_t211],
                _n128 = [1 / 0, 1 / 0, -1 / 0, -1 / 0];

            for (var _t212 = 0; _t212 < _r181.length; _t212++) {
              var _e206 = _r181[_t212];
              _n128[0] = Math.min(_n128[0], _e206.x), _n128[1] = Math.min(_n128[1], _e206.y), _n128[2] = Math.max(_n128[2], _e206.x), _n128[3] = Math.max(_n128[3], _e206.y);
            }

            _n128[0] < To && _n128[1] < To && _n128[2] >= 0 && _n128[3] >= 0 && o.insert(a, _n128[0], _n128[1], _n128[2], _n128[3]);
          }
        }
      }, {
        key: "loadVTLayers",
        value: function loadVTLayers() {
          if (!this.vtLayers) {
            this.vtLayers = new Bu.VectorTile(new gc(this.rawTileData)).layers, this.sourceLayerCoder = new Tp(this.vtLayers ? Object.keys(this.vtLayers).sort() : ["_geojsonTileLayer"]), this.vtFeatures = {};

            for (var _t213 in this.vtLayers) {
              this.vtFeatures[_t213] = [];
            }
          }

          return this.vtLayers;
        }
      }, {
        key: "query",
        value: function query(t, e, r, n) {
          var _this38 = this;

          this.loadVTLayers();
          var i = t.params || {},
              s = si(i.filter),
              a = t.tileResult,
              o = t.transform,
              l = a.bufferedTilespaceBounds,
              u = this.grid.query(l.min.x, l.min.y, l.max.x, l.max.y, function (t, e, r, n) {
            return ll(a.bufferedTilespaceGeometry, t, e, r, n);
          });
          u.sort(Yp);
          var c = null;
          o.elevation && u.length > 0 && (c = Zp.create(o.elevation, this.tileID));
          var h = {};
          var p;

          var _loop4 = function _loop4(_o47) {
            var l = u[_o47];
            if (l === p) return "continue";
            p = l;

            var d = _this38.featureIndexArray.get(l);

            var f = null;

            _this38.loadMatchingFeature(h, d, s, i.layers, i.availableImages, e, r, n, function (e, r, n) {
              var i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;
              return f || (f = Ko(e, _this38.tileID.canonical, t.tileTransform)), r.queryIntersectsFeature(a, e, n, f, _this38.z, t.transform, t.pixelPosMatrix, c, i);
            });
          };

          for (var _o47 = 0; _o47 < u.length; _o47++) {
            var _ret2 = _loop4(_o47);

            if (_ret2 === "continue") continue;
          }

          return h;
        }
      }, {
        key: "loadMatchingFeature",
        value: function loadMatchingFeature(t, e, r, n, i, s, a, o, l) {
          var u = e.featureIndex,
              c = e.bucketIndex,
              h = e.sourceLayerIndex,
              p = e.layoutVertexArrayOffset,
              d = this.bucketLayerIDs[c];
          if (n && !function (t, e) {
            for (var _r182 = 0; _r182 < t.length; _r182++) {
              if (e.indexOf(t[_r182]) >= 0) return !0;
            }

            return !1;
          }(n, d)) return;
          var f = this.sourceLayerCoder.decode(h),
              y = this.vtLayers[f].feature(u);

          if (r.needGeometry) {
            var _t214 = Yo(y, !0);

            if (!r.filter(new Gs(this.tileID.overscaledZ), _t214, this.tileID.canonical)) return;
          } else if (!r.filter(new Gs(this.tileID.overscaledZ), y)) return;

          var m = this.getId(y, f);

          for (var _e207 = 0; _e207 < d.length; _e207++) {
            var _r183 = d[_e207];
            if (n && n.indexOf(_r183) < 0) continue;
            var _c24 = s[_r183];
            if (!_c24) continue;
            var _h13 = {};
            void 0 !== m && o && (_h13 = o.getState(_c24.sourceLayer || "_geojsonTileLayer", m));

            var _f12 = tt({}, a[_r183]);

            _f12.paint = Kp(_f12.paint, _c24.paint, y, _h13, i), _f12.layout = Kp(_f12.layout, _c24.layout, y, _h13, i);

            var _g11 = !l || l(y, _c24, _h13, p);

            if (!_g11) continue;

            var _x10 = new Bp(y, this.z, this.x, this.y, m);

            _x10.layer = _f12;
            var _v8 = t[_r183];
            void 0 === _v8 && (_v8 = t[_r183] = []), _v8.push({
              featureIndex: u,
              feature: _x10,
              intersectionZ: _g11
            });
          }
        }
      }, {
        key: "lookupSymbolFeatures",
        value: function lookupSymbolFeatures(t, e, r, n, i, s, a, o) {
          var l = {};
          this.loadVTLayers();
          var u = si(i);

          var _iterator133 = _createForOfIteratorHelper(t),
              _step133;

          try {
            for (_iterator133.s(); !(_step133 = _iterator133.n()).done;) {
              var _i124 = _step133.value;
              this.loadMatchingFeature(l, {
                bucketIndex: r,
                sourceLayerIndex: n,
                featureIndex: _i124,
                layoutVertexArrayOffset: 0
              }, u, s, a, o, e);
            }
          } catch (err) {
            _iterator133.e(err);
          } finally {
            _iterator133.f();
          }

          return l;
        }
      }, {
        key: "loadFeature",
        value: function loadFeature(t) {
          var e = t.featureIndex,
              r = t.sourceLayerIndex;
          this.loadVTLayers();
          var n = this.sourceLayerCoder.decode(r),
              i = this.vtFeatures[n];
          if (i[e]) return i[e];
          var s = this.vtLayers[n].feature(e);
          return i[e] = s, s;
        }
      }, {
        key: "hasLayer",
        value: function hasLayer(t) {
          var _iterator134 = _createForOfIteratorHelper(this.bucketLayerIDs),
              _step134;

          try {
            for (_iterator134.s(); !(_step134 = _iterator134.n()).done;) {
              var _e208 = _step134.value;

              var _iterator135 = _createForOfIteratorHelper(_e208),
                  _step135;

              try {
                for (_iterator135.s(); !(_step135 = _iterator135.n()).done;) {
                  var _r184 = _step135.value;
                  if (t === _r184) return !0;
                }
              } catch (err) {
                _iterator135.e(err);
              } finally {
                _iterator135.f();
              }
            }
          } catch (err) {
            _iterator134.e(err);
          } finally {
            _iterator134.f();
          }

          return !1;
        }
      }, {
        key: "getId",
        value: function getId(t, e) {
          var r = t.id;
          return this.promoteId && (r = t.properties["string" == typeof this.promoteId ? this.promoteId : this.promoteId[e]], "boolean" == typeof r && (r = Number(r))), r;
        }
      }]);

      return Xp;
    }();

    function Kp(t, e, r, n, i) {
      return lt(t, function (t, s) {
        var a = e instanceof Qs ? e.get(s) : null;
        return a && a.evaluate ? a.evaluate(r, n, i) : a;
      });
    }

    function Yp(t, e) {
      return e - t;
    }

    Zi("FeatureIndex", Xp, {
      omit: ["rawTileData", "sourceLayerCoder"]
    });
    var Hp = ca([{
      name: "a_pos",
      type: "Int16",
      components: 2
    }]);
    var Jp = 32,
        Wp = 33,
        Qp = new Uint16Array(8184);

    for (var _t215 = 0; _t215 < 2046; _t215++) {
      var _e209 = _t215 + 2,
          _r185 = 0,
          _n129 = 0,
          _i125 = 0,
          _s91 = 0,
          _a73 = 0,
          _o48 = 0;

      for (1 & _e209 ? _i125 = _s91 = _a73 = Jp : _r185 = _n129 = _o48 = Jp; (_e209 >>= 1) > 1;) {
        var _t216 = _r185 + _i125 >> 1,
            _l40 = _n129 + _s91 >> 1;

        1 & _e209 ? (_i125 = _r185, _s91 = _n129, _r185 = _a73, _n129 = _o48) : (_r185 = _i125, _n129 = _s91, _i125 = _a73, _s91 = _o48), _a73 = _t216, _o48 = _l40;
      }

      var _l39 = 4 * _t215;

      Qp[_l39 + 0] = _r185, Qp[_l39 + 1] = _n129, Qp[_l39 + 2] = _i125, Qp[_l39 + 3] = _s91;
    }

    var td = new Uint16Array(2178),
        ed = new Uint8Array(1089),
        rd = new Uint16Array(1089);

    function nd(t) {
      return 0 === t ? -.03125 : 32 === t ? .03125 : 0;
    }

    var id = ca([{
      name: "a_pos",
      type: "Int16",
      components: 2
    }, {
      name: "a_texture_pos",
      type: "Int16",
      components: 2
    }]);
    var sd = {
      type: 2,
      extent: To,
      loadGeometry: function loadGeometry() {
        return [[new i(0, 0), new i(8193, 0), new i(8193, 8193), new i(0, 8193), new i(0, 0)]];
      }
    };

    var ad = /*#__PURE__*/function () {
      function ad(t, e, r, n, i) {
        _classCallCheck(this, ad);

        this.tileID = t, this.uid = rt(), this.uses = 0, this.tileSize = e, this.tileZoom = r, this.buckets = {}, this.expirationTime = null, this.queryPadding = 0, this.hasSymbolBuckets = !1, this.hasRTLText = !1, this.dependencies = {}, this.isRaster = i, this.expiredRequestCount = 0, this.state = "loading", n && n.transform && (this.projection = n.transform.projection);
      }

      _createClass(ad, [{
        key: "registerFadeDuration",
        value: function registerFadeDuration(t) {
          var e = t + this.timeAdded;
          e < At.now() || this.fadeEndTime && e < this.fadeEndTime || (this.fadeEndTime = e);
        }
      }, {
        key: "wasRequested",
        value: function wasRequested() {
          return "errored" === this.state || "loaded" === this.state || "reloading" === this.state;
        }
      }, {
        key: "tileTransform",
        get: function get() {
          return this._tileTransform || (this._tileTransform = Ad(this.tileID.canonical, this.projection)), this._tileTransform;
        }
      }, {
        key: "loadVectorData",
        value: function loadVectorData(t, e, r) {
          if (this.unloadVectorData(), this.state = "loaded", t) {
            t.featureIndex && (this.latestFeatureIndex = t.featureIndex, t.rawTileData ? (this.latestRawTileData = t.rawTileData, this.latestFeatureIndex.rawTileData = t.rawTileData) : this.latestRawTileData && (this.latestFeatureIndex.rawTileData = this.latestRawTileData)), this.collisionBoxArray = t.collisionBoxArray, this.buckets = function (t, e) {
              var r = {};
              if (!e) return r;

              var _iterator136 = _createForOfIteratorHelper(t),
                  _step136;

              try {
                var _loop5 = function _loop5() {
                  var n = _step136.value;
                  var t = n.layerIds.map(function (t) {
                    return e.getLayer(t);
                  }).filter(Boolean);

                  if (0 !== t.length) {
                    n.layers = t, n.stateDependentLayerIds && (n.stateDependentLayers = n.stateDependentLayerIds.map(function (e) {
                      return t.filter(function (t) {
                        return t.id === e;
                      })[0];
                    }));

                    var _iterator137 = _createForOfIteratorHelper(t),
                        _step137;

                    try {
                      for (_iterator137.s(); !(_step137 = _iterator137.n()).done;) {
                        var _e210 = _step137.value;
                        r[_e210.id] = n;
                      }
                    } catch (err) {
                      _iterator137.e(err);
                    } finally {
                      _iterator137.f();
                    }
                  }
                };

                for (_iterator136.s(); !(_step136 = _iterator136.n()).done;) {
                  _loop5();
                }
              } catch (err) {
                _iterator136.e(err);
              } finally {
                _iterator136.f();
              }

              return r;
            }(t.buckets, e.style), this.hasSymbolBuckets = !1;

            for (var _t217 in this.buckets) {
              var _e211 = this.buckets[_t217];

              if (_e211 instanceof Yh) {
                if (this.hasSymbolBuckets = !0, !r) break;
                _e211.justReloaded = !0;
              }
            }

            if (this.hasRTLText = !1, this.hasSymbolBuckets) for (var _t218 in this.buckets) {
              var _e212 = this.buckets[_t218];

              if (_e212 instanceof Yh && _e212.hasRTLText) {
                this.hasRTLText = !0, Ns.isLoading() || Ns.isLoaded() || "deferred" !== js() || qs();
                break;
              }
            }
            this.queryPadding = 0;

            for (var _t219 in this.buckets) {
              var _r186 = this.buckets[_t219];
              this.queryPadding = Math.max(this.queryPadding, e.style.getLayer(_t219).queryRadius(_r186));
            }

            t.imageAtlas && (this.imageAtlas = t.imageAtlas), t.glyphAtlasImage && (this.glyphAtlasImage = t.glyphAtlasImage), t.lineAtlas && (this.lineAtlas = t.lineAtlas);
          } else this.collisionBoxArray = new Fa();
        }
      }, {
        key: "unloadVectorData",
        value: function unloadVectorData() {
          if (this.hasData()) {
            for (var _t220 in this.buckets) {
              this.buckets[_t220].destroy();
            }

            this.buckets = {}, this.imageAtlas && (this.imageAtlas = null), this.lineAtlas && (this.lineAtlas = null), this.imageAtlasTexture && this.imageAtlasTexture.destroy(), this.glyphAtlasTexture && this.glyphAtlasTexture.destroy(), this.lineAtlasTexture && this.lineAtlasTexture.destroy(), this._tileBoundsBuffer && (this._tileBoundsBuffer.destroy(), this._tileBoundsIndexBuffer.destroy(), this._tileBoundsSegments.destroy(), this._tileBoundsBuffer = null), this._tileDebugBuffer && (this._tileDebugBuffer.destroy(), this._tileDebugIndexBuffer.destroy(), this._tileDebugSegments.destroy(), this._tileDebugBuffer = null), this.globeGridBuffer && (this.globeGridBuffer.destroy(), this.globeGridBuffer = null), this.globePoleBuffer && (this.globePoleBuffer.destroy(), this.globePoleBuffer = null), this.latestFeatureIndex = null, this.state = "unloaded";
          }
        }
      }, {
        key: "getBucket",
        value: function getBucket(t) {
          return this.buckets[t.id];
        }
      }, {
        key: "upload",
        value: function upload(t) {
          for (var _e213 in this.buckets) {
            var _r187 = this.buckets[_e213];
            _r187.uploadPending() && _r187.upload(t);
          }

          var e = t.gl;
          this.imageAtlas && !this.imageAtlas.uploaded && (this.imageAtlasTexture = new hp(t, this.imageAtlas.image, e.RGBA), this.imageAtlas.uploaded = !0), this.glyphAtlasImage && (this.glyphAtlasTexture = new hp(t, this.glyphAtlasImage, e.ALPHA), this.glyphAtlasImage = null), this.lineAtlas && !this.lineAtlas.uploaded && (this.lineAtlasTexture = new hp(t, this.lineAtlas.image, e.ALPHA), this.lineAtlas.uploaded = !0);
        }
      }, {
        key: "prepare",
        value: function prepare(t) {
          this.imageAtlas && this.imageAtlas.patchUpdatedImages(t, this.imageAtlasTexture);
        }
      }, {
        key: "queryRenderedFeatures",
        value: function queryRenderedFeatures(t, e, r, n, i, s, a, o) {
          return this.latestFeatureIndex && this.latestFeatureIndex.rawTileData ? this.latestFeatureIndex.query({
            tileResult: n,
            pixelPosMatrix: a,
            transform: s,
            params: i,
            tileTransform: this.tileTransform
          }, t, e, r) : {};
        }
      }, {
        key: "querySourceFeatures",
        value: function querySourceFeatures(t, e) {
          var r = this.latestFeatureIndex;
          if (!r || !r.rawTileData) return;
          var n = r.loadVTLayers(),
              i = e ? e.sourceLayer : "",
              s = n._geojsonTileLayer || n[i];
          if (!s) return;
          var a = si(e && e.filter),
              _this$tileID$canonica = this.tileID.canonical,
              o = _this$tileID$canonica.z,
              l = _this$tileID$canonica.x,
              u = _this$tileID$canonica.y,
              c = {
            z: o,
            x: l,
            y: u
          };

          for (var _e214 = 0; _e214 < s.length; _e214++) {
            var _n130 = s.feature(_e214);

            if (a.needGeometry) {
              var _t221 = Yo(_n130, !0);

              if (!a.filter(new Gs(this.tileID.overscaledZ), _t221, this.tileID.canonical)) continue;
            } else if (!a.filter(new Gs(this.tileID.overscaledZ), _n130)) continue;

            var _h14 = r.getId(_n130, i),
                _p17 = new Bp(_n130, o, l, u, _h14);

            _p17.tile = c, t.push(_p17);
          }
        }
      }, {
        key: "hasData",
        value: function hasData() {
          return "loaded" === this.state || "reloading" === this.state || "expired" === this.state;
        }
      }, {
        key: "patternsLoaded",
        value: function patternsLoaded() {
          return this.imageAtlas && !!Object.keys(this.imageAtlas.patternPositions).length;
        }
      }, {
        key: "setExpiryData",
        value: function setExpiryData(t) {
          var e = this.expirationTime;

          if (t.cacheControl) {
            var _e215 = mt(t.cacheControl);

            _e215["max-age"] && (this.expirationTime = Date.now() + 1e3 * _e215["max-age"]);
          } else t.expires && (this.expirationTime = new Date(t.expires).getTime());

          if (this.expirationTime) {
            var _t222 = Date.now();

            var _r188 = !1;

            if (this.expirationTime > _t222) _r188 = !1;else if (e) {
              if (this.expirationTime < e) _r188 = !0;else {
                var _n131 = this.expirationTime - e;

                _n131 ? this.expirationTime = _t222 + Math.max(_n131, 3e4) : _r188 = !0;
              }
            } else _r188 = !0;
            _r188 ? (this.expiredRequestCount++, this.state = "expired") : this.expiredRequestCount = 0;
          }
        }
      }, {
        key: "getExpiryTimeout",
        value: function getExpiryTimeout() {
          if (this.expirationTime) return this.expiredRequestCount ? 1e3 * (1 << Math.min(this.expiredRequestCount - 1, 31)) : Math.min(this.expirationTime - new Date().getTime(), Math.pow(2, 31) - 1);
        }
      }, {
        key: "setFeatureState",
        value: function setFeatureState(t, e) {
          if (!this.latestFeatureIndex || !this.latestFeatureIndex.rawTileData || 0 === Object.keys(t).length || !e) return;
          var r = this.latestFeatureIndex.loadVTLayers(),
              n = e.style.listImages();

          for (var _i126 in this.buckets) {
            if (!e.style.hasLayer(_i126)) continue;

            var _s92 = this.buckets[_i126],
                _a74 = _s92.layers[0].sourceLayer || "_geojsonTileLayer",
                _o49 = r[_a74],
                _l41 = t[_a74];

            if (!_o49 || !_l41 || 0 === Object.keys(_l41).length) continue;

            if (_s92.update(_l41, _o49, n, this.imageAtlas && this.imageAtlas.patternPositions || {}), _s92 instanceof Ku || _s92 instanceof mu) {
              var _t223 = e.style._getSourceCache(_s92.layers[0].source);

              e._terrain && e._terrain.enabled && _t223 && _s92.programConfigurations.needsUpload && e._terrain._clearRenderCacheForTile(_t223.id, this.tileID);
            }

            var _u39 = e && e.style && e.style.getLayer(_i126);

            _u39 && (this.queryPadding = Math.max(this.queryPadding, _u39.queryRadius(_s92)));
          }
        }
      }, {
        key: "holdingForFade",
        value: function holdingForFade() {
          return void 0 !== this.symbolFadeHoldUntil;
        }
      }, {
        key: "symbolFadeFinished",
        value: function symbolFadeFinished() {
          return !this.symbolFadeHoldUntil || this.symbolFadeHoldUntil < At.now();
        }
      }, {
        key: "clearFadeHold",
        value: function clearFadeHold() {
          this.symbolFadeHoldUntil = void 0;
        }
      }, {
        key: "setHoldDuration",
        value: function setHoldDuration(t) {
          this.symbolFadeHoldUntil = At.now() + t;
        }
      }, {
        key: "setDependencies",
        value: function setDependencies(t, e) {
          var r = {};

          var _iterator138 = _createForOfIteratorHelper(e),
              _step138;

          try {
            for (_iterator138.s(); !(_step138 = _iterator138.n()).done;) {
              var _t224 = _step138.value;
              r[_t224] = !0;
            }
          } catch (err) {
            _iterator138.e(err);
          } finally {
            _iterator138.f();
          }

          this.dependencies[t] = r;
        }
      }, {
        key: "hasDependency",
        value: function hasDependency(t, e) {
          var _iterator139 = _createForOfIteratorHelper(t),
              _step139;

          try {
            for (_iterator139.s(); !(_step139 = _iterator139.n()).done;) {
              var _r189 = _step139.value;
              var _t225 = this.dependencies[_r189];

              if (_t225) {
                var _iterator140 = _createForOfIteratorHelper(e),
                    _step140;

                try {
                  for (_iterator140.s(); !(_step140 = _iterator140.n()).done;) {
                    var _r190 = _step140.value;
                    if (_t225[_r190]) return !0;
                  }
                } catch (err) {
                  _iterator140.e(err);
                } finally {
                  _iterator140.f();
                }
              }
            }
          } catch (err) {
            _iterator139.e(err);
          } finally {
            _iterator139.f();
          }

          return !1;
        }
      }, {
        key: "clearQueryDebugViz",
        value: function clearQueryDebugViz() {}
      }, {
        key: "_makeDebugTileBoundsBuffers",
        value: function _makeDebugTileBoundsBuffers(t, e) {
          if (!e || "mercator" === e.name || this._tileDebugBuffer) return;
          var r = Ko(sd, this.tileID.canonical, this.tileTransform)[0],
              n = new pa(),
              i = new Pa();

          for (var _t226 = 0; _t226 < r.length; _t226++) {
            var _r$_t = r[_t226],
                _e216 = _r$_t.x,
                _s93 = _r$_t.y;
            n.emplaceBack(_e216, _s93), i.emplaceBack(_t226);
          }

          i.emplaceBack(0), this._tileDebugIndexBuffer = t.createIndexBuffer(i), this._tileDebugBuffer = t.createVertexBuffer(n, id.members), this._tileDebugSegments = Mo.simpleSegment(0, 0, n.length, i.length);
        }
      }, {
        key: "_makeTileBoundsBuffers",
        value: function _makeTileBoundsBuffers(t, e) {
          if (this._tileBoundsBuffer || !e || "mercator" === e.name) return;
          var r = Ko(sd, this.tileID.canonical, this.tileTransform)[0];
          var n, i;

          if (this.isRaster) {
            var _t227 = function (t, e) {
              var r = Ad(t, e),
                  n = Math.pow(2, t.z);

              for (var _i127 = 0; _i127 < Wp; _i127++) {
                for (var _s94 = 0; _s94 < Wp; _s94++) {
                  var _a75 = Ro((t.x + (_s94 + nd(_s94)) / Jp) / n),
                      _o50 = Uo((t.y + (_i127 + nd(_i127)) / Jp) / n),
                      _l42 = e.project(_a75, _o50),
                      _u40 = _i127 * Wp + _s94;

                  td[2 * _u40 + 0] = Math.round((_l42.x * r.scale - r.x) * To), td[2 * _u40 + 1] = Math.round((_l42.y * r.scale - r.y) * To);
                }
              }

              ed.fill(0), rd.fill(0);

              for (var _t228 = 2045; _t228 >= 0; _t228--) {
                var _e217 = 4 * _t228,
                    _r191 = Qp[_e217 + 0],
                    _n132 = Qp[_e217 + 1],
                    _i128 = Qp[_e217 + 2],
                    _s95 = Qp[_e217 + 3],
                    _a76 = _r191 + _i128 >> 1,
                    _o51 = _n132 + _s95 >> 1,
                    _l43 = _a76 + _o51 - _n132,
                    _u41 = _o51 + _r191 - _a76,
                    _c25 = _n132 * Wp + _r191,
                    _h15 = _s95 * Wp + _i128,
                    _p18 = _o51 * Wp + _a76,
                    _d12 = Math.hypot((td[2 * _c25 + 0] + td[2 * _h15 + 0]) / 2 - td[2 * _p18 + 0], (td[2 * _c25 + 1] + td[2 * _h15 + 1]) / 2 - td[2 * _p18 + 1]) >= 16;

                if (ed[_p18] = ed[_p18] || (_d12 ? 1 : 0), _t228 < 1022) {
                  var _t229 = (_n132 + _u41 >> 1) * Wp + (_r191 + _l43 >> 1),
                      _e218 = (_s95 + _u41 >> 1) * Wp + (_i128 + _l43 >> 1);

                  ed[_p18] = ed[_p18] || ed[_t229] || ed[_e218];
                }
              }

              var i = new da(),
                  s = new ka();
              var a = 0;

              function o(t, e) {
                var r = e * Wp + t;
                return 0 === rd[r] && (i.emplaceBack(td[2 * r + 0], td[2 * r + 1], t * To / Jp, e * To / Jp), rd[r] = ++a), rd[r] - 1;
              }

              function l(t, e, r, n, i, a) {
                var u = t + r >> 1,
                    c = e + n >> 1;
                if (Math.abs(t - i) + Math.abs(e - a) > 1 && ed[c * Wp + u]) l(i, a, t, e, u, c), l(r, n, i, a, u, c);else {
                  var _l44 = o(t, e),
                      _u42 = o(r, n),
                      _c26 = o(i, a);

                  s.emplaceBack(_l44, _u42, _c26);
                }
              }

              return l(0, 0, Jp, Jp, Jp, 0), l(Jp, Jp, 0, 0, 0, Jp), {
                vertices: i,
                indices: s
              };
            }(this.tileID.canonical, e);

            n = _t227.vertices, i = _t227.indices;
          } else {
            n = new da(), i = new ka();

            var _iterator141 = _createForOfIteratorHelper(r),
                _step141;

            try {
              for (_iterator141.s(); !(_step141 = _iterator141.n()).done;) {
                var _ref164 = _step141.value;
                var _t231 = _ref164.x;
                var _e220 = _ref164.y;
                n.emplaceBack(_t231, _e220, 0, 0);
              }
            } catch (err) {
              _iterator141.e(err);
            } finally {
              _iterator141.f();
            }

            var _t230 = Dl(n.int16, void 0, 4);

            for (var _e219 = 0; _e219 < _t230.length; _e219 += 3) {
              i.emplaceBack(_t230[_e219], _t230[_e219 + 1], _t230[_e219 + 2]);
            }
          }

          this._tileBoundsBuffer = t.createVertexBuffer(n, id.members), this._tileBoundsIndexBuffer = t.createIndexBuffer(i), this._tileBoundsSegments = Mo.simpleSegment(0, 0, n.length, i.length);
        }
      }]);

      return ad;
    }();

    var od = ca([{
      type: "Float32",
      name: "a_globe_pos",
      components: 3
    }, {
      type: "Float32",
      name: "a_merc_pos",
      components: 2
    }, {
      type: "Float32",
      name: "a_uv",
      components: 2
    }]),
        ld = ca([{
      type: "Float32",
      name: "a_pos",
      components: 3
    }, {
      type: "Float32",
      name: "a_uv",
      components: 2
    }]),
        ud = od.members;

    function cd(t, e) {
      var r = t.fovAboveCenter,
          n = t.elevation ? t.elevation.getMinElevationBelowMSL() * e : 0,
          i = (t._camera.position[2] * t.worldSize - n) / Math.cos(t._pitch),
          s = Math.sin(r) * i / Math.sin(Math.max(Math.PI / 2 - t._pitch - r, .01)),
          a = Math.sin(t._pitch) * s + i;
      return Math.min(1.01 * a, i * (1 / t._horizonShift));
    }

    var hd = To / Math.PI / 2,
        pd = -hd,
        dd = hd,
        fd = [new gl([pd, pd, pd], [dd, dd, dd]), new gl([pd, pd, pd], [0, 0, dd]), new gl([0, pd, pd], [dd, 0, dd]), new gl([pd, 0, pd], [0, dd, dd]), new gl([0, 0, pd], [dd, dd, dd])];

    function yd(t) {
      if (t.z <= 1) return fd[t.z + 2 * t.y + t.x];

      var _md = md(t),
          _md2 = _slicedToArray(_md, 2),
          e = _md2[0],
          r = _md2[1],
          n = [xd(e[0], e[1]), xd(e[0], r[1]), xd(r[0], e[1]), xd(r[0], r[1])],
          i = [dd, dd, dd],
          s = [pd, pd, pd];

      for (var _i129 = 0, _n133 = n; _i129 < _n133.length; _i129++) {
        var _t232 = _n133[_i129];
        i[0] = Math.min(i[0], _t232[0]), i[1] = Math.min(i[1], _t232[1]), i[2] = Math.min(i[2], _t232[2]), s[0] = Math.max(s[0], _t232[0]), s[1] = Math.max(s[1], _t232[1]), s[2] = Math.max(s[2], _t232[2]);
      }

      return new gl(i, s);
    }

    function md(t) {
      var e = Math.pow(2, t.z),
          r = t.x / e,
          n = (t.x + 1) / e,
          i = (t.y + 1) / e;
      return [[Uo(t.y / e), Ro(r)], [Uo(i), Ro(n)]];
    }

    function gd(t, e, r, n) {
      return r = q(r), n || (n = hd), [t * Math.sin(r) * n, -e * n, t * Math.cos(r) * n];
    }

    function xd(t, e, r) {
      return gd(Math.cos(q(t)), Math.sin(q(t)), e, r);
    }

    function vd(t) {
      return 16383 / Math.max.apply(Math, _toConsumableArray(E([], t.max, t.min)));
    }

    function bd(t) {
      var e = c(new Float64Array(16)),
          r = 1 / vd(t);
      return p(e, e, t.min), d(e, e, [r, r, r]), e;
    }

    function wd(t, e, r) {
      var n = e / (2 * Math.PI),
          i = function (t) {
        var e = To / (2 * Math.PI);
        return t / (2 * Math.PI) / e;
      }(e);

      if (!r) {
        var _n134 = Y(t.center.lat, -85.051129, Oo);

        r = [Vo(t.center.lng) * e, Fo(_n134) * e];
      }

      var s = c(new Float64Array(16));
      return p(s, s, [r[0], r[1], -n]), d(s, s, [i, i, i]), f(s, s, q(-t._center.lat)), y(s, s, q(-t._center.lng)), s;
    }

    var _d = /*#__PURE__*/function () {
      function _d(t) {
        _classCallCheck(this, _d);

        var e = this._createGridIndices();

        this.gridIndexBuffer = t.createIndexBuffer(e, !0), this.gridSegments = Mo.simpleSegment(0, 0, 4225, 8192);

        var r = this._createPoleTriangleIndices();

        this.poleIndexBuffer = t.createIndexBuffer(r, !0), this.poleSegments = Mo.simpleSegment(0, 0, 66, 64);
        var n = new Ta();
        n.emplaceBack(-1, 1, 1, 0, 0, 0, 0), n.emplaceBack(1, 1, 1, 0, 0, 1, 0), n.emplaceBack(1, -1, 1, 0, 0, 1, 1), n.emplaceBack(-1, -1, 1, 0, 0, 0, 1);
        var i = new ka();
        i.emplaceBack(0, 1, 2), i.emplaceBack(2, 3, 0), this.atmosphereVertexBuffer = t.createVertexBuffer(n, ld.members), this.atmosphereIndexBuffer = t.createIndexBuffer(i), this.atmosphereSegments = Mo.simpleSegment(0, 0, 4, 2);
      }

      _createClass(_d, [{
        key: "destroy",
        value: function destroy() {
          this.poleIndexBuffer.destroy(), this.gridIndexBuffer.destroy(), this.poleSegments.destroy(), this.gridSegments.destroy(), this.atmosphereVertexBuffer.destroy(), this.atmosphereIndexBuffer.destroy(), this.atmosphereSegments.destroy(), this.wireframeIndexBuffer && (this.wireframeIndexBuffer.destroy(), this.wireframeSegments.destroy());
        }
      }, {
        key: "_createPoleTriangleIndices",
        value: function _createPoleTriangleIndices() {
          var t = new ka();

          for (var _e221 = 0; _e221 <= 64; _e221++) {
            t.emplaceBack(0, _e221 + 1, _e221 + 2);
          }

          return t;
        }
      }, {
        key: "_createGridIndices",
        value: function _createGridIndices() {
          var t = new ka(),
              e = function e(_e222, r) {
            var n = 65 * r + _e222;
            t.emplaceBack(n + 1, n, n + 65), t.emplaceBack(n + 65, n + 65 + 1, n + 1);
          };

          for (var _t233 = 0; _t233 < 64; _t233++) {
            for (var _r192 = 0; _r192 < 64; _r192++) {
              e(_r192, _t233);
            }
          }

          return t;
        }
      }, {
        key: "getWirefameBuffer",
        value: function getWirefameBuffer(t) {
          if (!this.wireframeSegments) {
            var _e223 = this._createWireframeGrid();

            this.wireframeIndexBuffer = t.createIndexBuffer(_e223), this.wireframeSegments = Mo.simpleSegment(0, 0, 4096, _e223.length);
          }

          return [this.wireframeIndexBuffer, this.wireframeSegments];
        }
      }, {
        key: "_createWireframeGrid",
        value: function _createWireframeGrid() {
          var t = new Ca(),
              e = function e(_e224, r) {
            var n = 65 * r + _e224;
            t.emplaceBack(n, n + 1), t.emplaceBack(n, n + 65), t.emplaceBack(n, n + 65 + 1);
          };

          for (var _t234 = 0; _t234 < 64; _t234++) {
            for (var _r193 = 0; _r193 < 64; _r193++) {
              e(_r193, _t234);
            }
          }

          return t;
        }
      }], [{
        key: "createPoleTriangleVertices",
        value: function createPoleTriangleVertices(t, e, r) {
          var n = new Ta(),
              i = e / Math.PI / 2;
          n.emplaceBack(0, -i, 0, 0, 0, .5, r ? 0 : 1);
          var s = 360 / t,
              a = Math.cos(q(85)),
              o = Math.sin(q(85));

          for (var _t235 = 0; _t235 <= 64; _t235++) {
            var _e225 = _t235 / 64,
                _u43 = gd(a, o, 0 * (1 - (l = _e225)) + s * l, i);

            n.emplaceBack(_u43[0], _u43[1], _u43[2], 0, 0, _e225, r ? 0 : 1);
          }

          var l;
          return n;
        }
      }, {
        key: "createGridVertices",
        value: function createGridVertices(t) {
          var e = Math.pow(2, t.z),
              r = function r(t, e, _r194) {
            return t * (1 - _r194) + e * _r194;
          },
              _md3 = md(t),
              _md4 = _slicedToArray(_md3, 2),
              n = _md4[0],
              i = _md4[1],
              s = new Ta(),
              a = function (t) {
            var e = c(new Float64Array(16)),
                r = vd(t);
            var n, i;
            return d(e, e, [r, r, r]), p(e, e, ((n = [])[0] = -(i = t.min)[0], n[1] = -i[1], n[2] = -i[2], n)), e;
          }(yd(t));

          s.reserve(4096);

          for (var _o52 = 0; _o52 < 65; _o52++) {
            var _l45 = r(n[0], i[0], _o52 / 64),
                _u44 = Fo(_l45),
                _c27 = _u44 * e - t.y,
                _h16 = Math.sin(q(_l45)),
                _p19 = Math.cos(q(_l45));

            for (var _t236 = 0; _t236 < 65; _t236++) {
              var _e226 = _t236 / 64,
                  _o53 = r(n[1], i[1], _e226),
                  _l46 = gd(_p19, _h16, _o53);

              B(_l46, _l46, a);

              var _d13 = Vo(_o53);

              s.emplaceBack(_l46[0], _l46[1], _l46[2], _d13, _u44, _e226, _c27);
            }
          }

          return s;
        }
      }]);

      return _d;
    }();

    function Ad(t, e) {
      if (!e.isReprojectedInTileSpace) return {
        scale: 1 << t.z,
        x: t.x,
        y: t.y,
        x2: t.x + 1,
        y2: t.y + 1,
        projection: e
      };
      var r = Math.pow(2, -t.z),
          n = t.x * r,
          i = (t.x + 1) * r,
          s = t.y * r,
          a = (t.y + 1) * r,
          o = Ro(n),
          l = Ro(i),
          u = Uo(s),
          c = Uo(a),
          h = e.project(o, u),
          p = e.project(l, u),
          d = e.project(l, c),
          f = e.project(o, c);
      var y = Math.min(h.x, p.x, d.x, f.x),
          m = Math.min(h.y, p.y, d.y, f.y),
          g = Math.max(h.x, p.x, d.x, f.x),
          x = Math.max(h.y, p.y, d.y, f.y);
      var v = r / 16;

      function b(t, r, n, i, s, a) {
        var o = (n + s) / 2,
            l = (i + a) / 2,
            u = e.project(Ro(o), Uo(l)),
            c = Math.max(0, y - u.x, m - u.y, u.x - g, u.y - x);
        y = Math.min(y, u.x), g = Math.max(g, u.x), m = Math.min(m, u.y), x = Math.max(x, u.y), c > v && (b(t, u, n, i, o, l), b(u, r, o, l, s, a));
      }

      b(h, p, n, s, i, s), b(p, d, i, s, i, a), b(d, f, i, a, n, a), b(f, h, n, a, n, s), y -= v, m -= v, g += v, x += v;
      var w = 1 / Math.max(g - y, x - m);
      return {
        scale: w,
        x: y * w,
        y: m * w,
        x2: g * w,
        y2: x * w,
        projection: e
      };
    }

    var kd = /*#__PURE__*/_createClass(function kd(t) {
      _classCallCheck(this, kd);

      var e = {},
          r = [];

      for (var _n135 in t) {
        var _i130 = t[_n135],
            _s96 = e[_n135] = {};

        for (var _t237 in _i130.glyphs) {
          var _e227 = _i130.glyphs[+_t237];
          if (!_e227 || 0 === _e227.bitmap.width || 0 === _e227.bitmap.height) continue;

          var _n136 = _e227.metrics.localGlyph ? 2 : 1,
              _a77 = {
            x: 0,
            y: 0,
            w: _e227.bitmap.width + 2 * _n136,
            h: _e227.bitmap.height + 2 * _n136
          };

          r.push(_a77), _s96[_t237] = _a77;
        }
      }

      var _$c2 = $c(r),
          n = _$c2.w,
          i = _$c2.h,
          s = new zl({
        width: n || 1,
        height: i || 1
      });

      for (var _r195 in t) {
        var _n137 = t[_r195];

        for (var _t238 in _n137.glyphs) {
          var _i131 = _n137.glyphs[+_t238];
          if (!_i131 || 0 === _i131.bitmap.width || 0 === _i131.bitmap.height) continue;

          var _a78 = e[_r195][_t238],
              _o54 = _i131.metrics.localGlyph ? 2 : 1;

          zl.copy(_i131.bitmap, s, {
            x: 0,
            y: 0
          }, {
            x: _a78.x + _o54,
            y: _a78.y + _o54
          }, _i131.bitmap);
        }
      }

      this.image = s, this.positions = e;
    });

    Zi("GlyphAtlas", kd);

    var Sd = /*#__PURE__*/function () {
      function Sd(t) {
        _classCallCheck(this, Sd);

        this.tileID = new bp(t.tileID.overscaledZ, t.tileID.wrap, t.tileID.canonical.z, t.tileID.canonical.x, t.tileID.canonical.y), this.tileZoom = t.tileZoom, this.uid = t.uid, this.zoom = t.zoom, this.canonical = t.tileID.canonical, this.pixelRatio = t.pixelRatio, this.tileSize = t.tileSize, this.source = t.source, this.overscaling = this.tileID.overscaleFactor(), this.showCollisionBoxes = t.showCollisionBoxes, this.collectResourceTiming = !!t.collectResourceTiming, this.returnDependencies = !!t.returnDependencies, this.promoteId = t.promoteId, this.enableTerrain = !!t.enableTerrain, this.isSymbolTile = t.isSymbolTile, this.tileTransform = Ad(t.tileID.canonical, t.projection), this.projection = t.projection;
      }

      _createClass(Sd, [{
        key: "parse",
        value: function parse(t, e, r, n, i) {
          var _this39 = this;

          this.status = "parsing", this.data = t, this.collisionBoxArray = new Fa();
          var s = new Tp(Object.keys(t.layers).sort()),
              a = new Xp(this.tileID, this.promoteId);
          a.bucketLayerIDs = [];
          var o = {},
              l = new pp(256, 256),
              u = {
            featureIndex: a,
            iconDependencies: {},
            patternDependencies: {},
            glyphDependencies: {},
            lineAtlas: l,
            availableImages: r
          },
              c = e.familiesBySource[this.source];

          for (var _e228 in c) {
            var _n138 = t.layers[_e228];
            if (!_n138) continue;

            var _i132 = !1,
                _l47 = !1;

            var _iterator142 = _createForOfIteratorHelper(c[_e228]),
                _step142;

            try {
              for (_iterator142.s(); !(_step142 = _iterator142.n()).done;) {
                var _t240 = _step142.value;
                "symbol" === _t240[0].type ? _i132 = !0 : _l47 = !0;
              }
            } catch (err) {
              _iterator142.e(err);
            } finally {
              _iterator142.f();
            }

            if (!0 === this.isSymbolTile && !_i132) continue;
            if (!1 === this.isSymbolTile && !_l47) continue;
            1 === _n138.version && pt("Vector tile source \"".concat(this.source, "\" layer \"").concat(_e228, "\" does not use vector tile spec v2 and therefore may have some rendering errors."));

            var _h17 = s.encode(_e228),
                _p20 = [];

            for (var _t239 = 0; _t239 < _n138.length; _t239++) {
              var _r196 = _n138.feature(_t239),
                  _i133 = a.getId(_r196, _e228);

              _p20.push({
                feature: _r196,
                id: _i133,
                index: _t239,
                sourceLayerIndex: _h17
              });
            }

            var _iterator143 = _createForOfIteratorHelper(c[_e228]),
                _step143;

            try {
              for (_iterator143.s(); !(_step143 = _iterator143.n()).done;) {
                var _t241 = _step143.value;
                var _e229 = _t241[0];
                void 0 !== this.isSymbolTile && "symbol" === _e229.type !== this.isSymbolTile || _e229.minzoom && this.zoom < Math.floor(_e229.minzoom) || _e229.maxzoom && this.zoom >= _e229.maxzoom || "none" !== _e229.visibility && (Id(_t241, this.zoom, r), (o[_e229.id] = _e229.createBucket({
                  index: a.bucketLayerIDs.length,
                  layers: _t241,
                  zoom: this.zoom,
                  canonical: this.canonical,
                  pixelRatio: this.pixelRatio,
                  overscaling: this.overscaling,
                  collisionBoxArray: this.collisionBoxArray,
                  sourceLayerIndex: _h17,
                  sourceID: this.source,
                  enableTerrain: this.enableTerrain,
                  availableImages: r
                })).populate(_p20, u, this.tileID.canonical, this.tileTransform), a.bucketLayerIDs.push(_t241.map(function (t) {
                  return t.id;
                })));
              }
            } catch (err) {
              _iterator143.e(err);
            } finally {
              _iterator143.f();
            }
          }

          var h, p, d, f;
          l.trim();
          var y = {
            type: "maybePrepare",
            isSymbolTile: this.isSymbolTile,
            zoom: this.zoom
          },
              m = lt(u.glyphDependencies, function (t) {
            return Object.keys(t).map(Number);
          });
          Object.keys(m).length ? n.send("getGlyphs", {
            uid: this.uid,
            stacks: m
          }, function (t, e) {
            h || (h = t, p = e, v.call(_this39));
          }, void 0, !1, y) : p = {};
          var g = Object.keys(u.iconDependencies);
          g.length ? n.send("getImages", {
            icons: g,
            source: this.source,
            tileID: this.tileID,
            type: "icons"
          }, function (t, e) {
            h || (h = t, d = e, v.call(_this39));
          }, void 0, !1, y) : d = {};
          var x = Object.keys(u.patternDependencies);

          function v() {
            if (h) return i(h);

            if (p && d && f) {
              var _t242 = new kd(p),
                  _e230 = new jc(d, f);

              for (var _n139 in o) {
                var _i134 = o[_n139];
                _i134 instanceof Yh ? (Id(_i134.layers, this.zoom, r), Eh(_i134, p, _t242.positions, d, _e230.iconPositions, this.showCollisionBoxes, r, this.tileID.canonical, this.tileZoom, this.projection), _i134.projection = this.projection.name) : _i134.hasPattern && (_i134 instanceof Ku || _i134 instanceof mu || _i134 instanceof Vu) && (Id(_i134.layers, this.zoom, r), _i134.addFeatures(u, this.tileID.canonical, _e230.patternPositions, r));
              }

              this.status = "done", i(null, {
                buckets: Q(o).filter(function (t) {
                  return !t.isEmpty();
                }),
                featureIndex: a,
                collisionBoxArray: this.collisionBoxArray,
                glyphAtlasImage: _t242.image,
                lineAtlas: l,
                imageAtlas: _e230,
                glyphMap: this.returnDependencies ? p : null,
                iconMap: this.returnDependencies ? d : null,
                glyphPositions: this.returnDependencies ? _t242.positions : null
              });
            }
          }

          x.length ? n.send("getImages", {
            icons: x,
            source: this.source,
            tileID: this.tileID,
            type: "patterns"
          }, function (t, e) {
            h || (h = t, f = e, v.call(_this39));
          }, void 0, !1, y) : f = {}, v.call(this);
        }
      }]);

      return Sd;
    }();

    function Id(t, e, r) {
      var n = new Gs(e);

      var _iterator144 = _createForOfIteratorHelper(t),
          _step144;

      try {
        for (_iterator144.s(); !(_step144 = _iterator144.n()).done;) {
          var _e231 = _step144.value;

          _e231.recalculate(n, r);
        }
      } catch (err) {
        _iterator144.e(err);
      } finally {
        _iterator144.f();
      }
    }

    var zd = /*#__PURE__*/function () {
      function zd(t) {
        _classCallCheck(this, zd);

        this.entries = {}, this.scheduler = t;
      }

      _createClass(zd, [{
        key: "request",
        value: function request(t, e, r, n) {
          var _this40 = this;

          var i = this.entries[t] = this.entries[t] || {
            callbacks: []
          };

          if (i.result) {
            var _i$result = _slicedToArray(i.result, 2),
                _t243 = _i$result[0],
                _r197 = _i$result[1];

            return this.scheduler ? this.scheduler.add(function () {
              n(_t243, _r197);
            }, e) : n(_t243, _r197), function () {};
          }

          return i.callbacks.push(n), i.cancel || (i.cancel = r(function (r, n) {
            i.result = [r, n];

            var _iterator145 = _createForOfIteratorHelper(i.callbacks),
                _step145;

            try {
              var _loop6 = function _loop6() {
                var t = _step145.value;
                _this40.scheduler ? _this40.scheduler.add(function () {
                  t(r, n);
                }, e) : t(r, n);
              };

              for (_iterator145.s(); !(_step145 = _iterator145.n()).done;) {
                _loop6();
              }
            } catch (err) {
              _iterator145.e(err);
            } finally {
              _iterator145.f();
            }

            setTimeout(function () {
              return delete _this40.entries[t];
            }, 3e3);
          })), function () {
            i.result || (i.callbacks = i.callbacks.filter(function (t) {
              return t !== n;
            }), i.callbacks.length || (i.cancel(), delete _this40.entries[t]));
          };
        }
      }]);

      return zd;
    }();

    function Md(t, e, r) {
      var n = JSON.stringify(t.request);
      return t.data && (this.deduped.entries[n] = {
        result: [null, t.data]
      }), this.deduped.request(n, {
        type: "parseTile",
        isSymbolTile: t.isSymbolTile,
        zoom: t.tileZoom
      }, function (e) {
        var n = ae(t.request, function (t, n, i, s) {
          t ? e(t) : n && e(null, {
            vectorTile: r ? void 0 : new Bu.VectorTile(new gc(n)),
            rawData: n,
            cacheControl: i,
            expires: s
          });
        });
        return function () {
          n.cancel(), e();
        };
      }, e);
    }

    var Td = c(new Float64Array(16));

    var Bd = /*#__PURE__*/function () {
      function Bd(t, e) {
        _classCallCheck(this, Bd);

        this._tr = t, this._worldSize = e;
      }

      _createClass(Bd, [{
        key: "createInversionMatrix",
        value: function createInversionMatrix() {
          return Td;
        }
      }, {
        key: "createTileMatrix",
        value: function createTileMatrix(t) {
          var e, r, n;
          var i = t.canonical,
              s = c(new Float64Array(16)),
              a = this._tr.projection;

          if (a.isReprojectedInTileSpace) {
            var _o55 = Ad(i, a);

            e = 1, r = _o55.x + t.wrap * _o55.scale, n = _o55.y, d(s, s, [e / _o55.scale, e / _o55.scale, this._tr.pixelsPerMeter / this._worldSize]);
          } else e = this._worldSize / this._tr.zoomScale(i.z), r = (i.x + Math.pow(2, i.z) * t.wrap) * e, n = i.y * e;

          return p(s, s, [r, n, 0]), d(s, s, [e / To, e / To, 1]), s;
        }
      }, {
        key: "pointCoordinate",
        value: function pointCoordinate(t, e, r) {
          var n = this._tr.horizonLineFromTop(!1),
              s = new i(t, Math.max(n, e));

          return this._tr.rayIntersectionCoordinate(this._tr.pointRayIntersection(s, r));
        }
      }, {
        key: "upVector",
        value: function upVector() {
          return [0, 0, 1];
        }
      }, {
        key: "upVectorScale",
        value: function upVectorScale() {
          return 1;
        }
      }]);

      return Bd;
    }();

    var Cd = {
      name: "albers",
      range: [4, 7],
      center: [-96, 37.5],
      parallels: [29.5, 45.5],
      zAxisUnit: "meters",
      conic: !0,
      isReprojectedInTileSpace: !0,
      unsupportedLayers: ["custom"],
      initializeConstants: function initializeConstants() {
        if (this.constants && $(this.parallels, this.constants.parallels)) return;
        var t = Math.sin(q(this.parallels[0])),
            e = (t + Math.sin(q(this.parallels[1]))) / 2,
            r = 1 + t * (2 * e - t),
            n = Math.sqrt(r) / e;
        this.constants = {
          n: e,
          c: r,
          r0: n,
          parallels: this.parallels
        };
      },
      project: function project(t, e) {
        this.initializeConstants();
        var r = q(t - this.center[0]),
            n = q(e),
            _this$constants = this.constants,
            i = _this$constants.n,
            s = _this$constants.c,
            a = _this$constants.r0,
            o = Math.sqrt(s - 2 * i * Math.sin(n)) / i;
        return {
          x: o * Math.sin(r * i),
          y: o * Math.cos(r * i) - a,
          z: 0
        };
      },
      unproject: function unproject(t, e) {
        this.initializeConstants();
        var _this$constants2 = this.constants,
            r = _this$constants2.n,
            n = _this$constants2.c,
            i = _this$constants2.r0,
            s = i + e;
        var a = Math.atan2(t, Math.abs(s)) * Math.sign(s);
        s * r < 0 && (a -= Math.PI * Math.sign(t) * Math.sign(s));
        var o = q(this.center[0]) * r;
        a = J(a, -Math.PI - o, Math.PI - o);
        var l = N(a / r) + this.center[0],
            u = Math.asin(Y((n - (t * t + s * s) * r * r) / (2 * r), -1, 1)),
            c = Y(N(u), -85.051129, Oo);
        return new Po(l, c);
      },
      projectTilePoint: function projectTilePoint(t, e) {
        return {
          x: t,
          y: e,
          z: 0
        };
      },
      locationPoint: function locationPoint(t, e) {
        return t._coordinatePoint(t.locationCoordinate(e), !1);
      },
      pixelsPerMeter: function pixelsPerMeter(t, e) {
        return Lo(1, t) * e;
      },
      farthestPixelDistance: function farthestPixelDistance(t) {
        return cd(t, this.pixelsPerMeter(t.center.lat, t.worldSize));
      },
      createTileTransform: function createTileTransform(t, e) {
        return new Bd(t, e);
      }
    };
    var Pd = 1.340264,
        Ed = -.081106,
        Dd = 893e-6,
        Vd = .003796,
        Fd = Math.sqrt(3) / 2;
    var Ld = {
      name: "equalEarth",
      center: [0, 0],
      range: [3.5, 7],
      zAxisUnit: "meters",
      isReprojectedInTileSpace: !0,
      unsupportedLayers: ["custom"],
      project: function project(t, e) {
        e = e / 180 * Math.PI, t = t / 180 * Math.PI;
        var r = Math.asin(Fd * Math.sin(e)),
            n = r * r,
            i = n * n * n;
        return {
          x: .5 * (t * Math.cos(r) / (Fd * (Pd + 3 * Ed * n + i * (7 * Dd + 9 * Vd * n))) / Math.PI + .5),
          y: 1 - .5 * (r * (Pd + Ed * n + i * (Dd + Vd * n)) / Math.PI + 1),
          z: 0
        };
      },
      unproject: function unproject(t, e) {
        t = (2 * t - .5) * Math.PI;
        var r = e = (2 * (1 - e) - 1) * Math.PI,
            n = r * r,
            i = n * n * n;

        for (var _t244, _s97, _a79, _o56 = 0; _o56 < 12 && (_s97 = r * (Pd + Ed * n + i * (Dd + Vd * n)) - e, _a79 = Pd + 3 * Ed * n + i * (7 * Dd + 9 * Vd * n), _t244 = _s97 / _a79, r = Y(r - _t244, -Math.PI / 3, Math.PI / 3), n = r * r, i = n * n * n, !(Math.abs(_t244) < 1e-12)); ++_o56) {
          ;
        }

        var s = Fd * t * (Pd + 3 * Ed * n + i * (7 * Dd + 9 * Vd * n)) / Math.cos(r),
            a = Math.asin(Math.sin(r) / Fd),
            o = Y(180 * s / Math.PI, -180, 180),
            l = Y(180 * a / Math.PI, -85.051129, Oo);
        return new Po(o, l);
      },
      projectTilePoint: function projectTilePoint(t, e) {
        return {
          x: t,
          y: e,
          z: 0
        };
      },
      locationPoint: function locationPoint(t, e) {
        return t._coordinatePoint(t.locationCoordinate(e), !1);
      },
      pixelsPerMeter: function pixelsPerMeter(t, e) {
        return Lo(1, t) * e;
      },
      farthestPixelDistance: function farthestPixelDistance(t) {
        return cd(t, this.pixelsPerMeter(t.center.lat, t.worldSize));
      },
      createTileTransform: function createTileTransform(t, e) {
        return new Bd(t, e);
      }
    },
        Rd = {
      name: "equirectangular",
      supportsWorldCopies: !0,
      center: [0, 0],
      range: [3.5, 7],
      zAxisUnit: "meters",
      wrap: !0,
      isReprojectedInTileSpace: !0,
      unsupportedLayers: ["custom"],
      project: function project(t, e) {
        return {
          x: .5 + t / 360,
          y: .5 - e / 360,
          z: 0
        };
      },
      unproject: function unproject(t, e) {
        var r = 360 * (t - .5),
            n = Y(360 * (.5 - e), -85.051129, Oo);
        return new Po(r, n);
      },
      projectTilePoint: function projectTilePoint(t, e) {
        return {
          x: t,
          y: e,
          z: 0
        };
      },
      locationPoint: function locationPoint(t, e) {
        return t._coordinatePoint(t.locationCoordinate(e), !1);
      },
      pixelsPerMeter: function pixelsPerMeter(t, e) {
        return Lo(1, t) * e;
      },
      farthestPixelDistance: function farthestPixelDistance(t) {
        return cd(t, this.pixelsPerMeter(t.center.lat, t.worldSize));
      },
      createTileTransform: function createTileTransform(t, e) {
        return new Bd(t, e);
      }
    };
    var Ud = Math.PI / 2;

    function $d(t) {
      return Math.tan((Ud + t) / 2);
    }

    var Od = {
      name: "lambertConformalConic",
      range: [3.5, 7],
      zAxisUnit: "meters",
      center: [0, 30],
      parallels: [30, 30],
      conic: !0,
      isReprojectedInTileSpace: !0,
      unsupportedLayers: ["custom"],
      initializeConstants: function initializeConstants() {
        if (this.constants && $(this.parallels, this.constants.parallels)) return;
        var t = q(this.parallels[0]),
            e = q(this.parallels[1]),
            r = Math.cos(t),
            n = t === e ? Math.sin(t) : Math.log(r / Math.cos(e)) / Math.log($d(e) / $d(t)),
            i = r * Math.pow($d(t), n) / n;
        this.constants = {
          n: n,
          f: i,
          parallels: this.parallels
        };
      },
      project: function project(t, e) {
        this.initializeConstants(), e = q(e), t = q(t - this.center[0]);
        var r = 1e-6,
            _this$constants3 = this.constants,
            n = _this$constants3.n,
            i = _this$constants3.f;
        i > 0 ? e < -Ud + r && (e = -Ud + r) : e > Ud - r && (e = Ud - r);
        var s = i / Math.pow($d(e), n),
            a = s * Math.sin(n * t),
            o = i - s * Math.cos(n * t);
        return {
          x: .5 * (a / Math.PI + .5),
          y: 1 - .5 * (o / Math.PI + .5),
          z: 0
        };
      },
      unproject: function unproject(t, e) {
        this.initializeConstants(), t = (2 * t - .5) * Math.PI, e = (2 * (1 - e) - .5) * Math.PI;
        var _this$constants4 = this.constants,
            r = _this$constants4.n,
            n = _this$constants4.f,
            i = n - e,
            s = Math.sign(i),
            a = Math.sign(r) * Math.sqrt(t * t + i * i);
        var o = Math.atan2(t, Math.abs(i)) * s;
        i * r < 0 && (o -= Math.PI * Math.sign(t) * s);
        var l = Y(N(o / r) + this.center[0], -180, 180),
            u = Y(N(2 * Math.atan(Math.pow(n / a, 1 / r)) - Ud), -85.051129, Oo);
        return new Po(l, u);
      },
      projectTilePoint: function projectTilePoint(t, e) {
        return {
          x: t,
          y: e,
          z: 0
        };
      },
      locationPoint: function locationPoint(t, e) {
        return t._coordinatePoint(t.locationCoordinate(e), !1);
      },
      pixelsPerMeter: function pixelsPerMeter(t, e) {
        return Lo(1, t) * e;
      },
      farthestPixelDistance: function farthestPixelDistance(t) {
        return cd(t, this.pixelsPerMeter(t.center.lat, t.worldSize));
      },
      createTileTransform: function createTileTransform(t, e) {
        return new Bd(t, e);
      }
    },
        jd = {
      name: "mercator",
      wrap: !0,
      requiresDraping: !1,
      supportsWorldCopies: !0,
      supportsTerrain: !0,
      supportsFog: !0,
      supportsFreeCamera: !0,
      zAxisUnit: "meters",
      center: [0, 0],
      project: function project(t, e) {
        return {
          x: Vo(t),
          y: Fo(e),
          z: 0
        };
      },
      unproject: function unproject(t, e) {
        var r = Ro(t),
            n = Uo(e);
        return new Po(r, n);
      },
      projectTilePoint: function projectTilePoint(t, e) {
        return {
          x: t,
          y: e,
          z: 0
        };
      },
      locationPoint: function locationPoint(t, e) {
        return t._coordinatePoint(t.locationCoordinate(e), !1);
      },
      pixelsPerMeter: function pixelsPerMeter(t, e) {
        return Lo(1, t) * e;
      },
      farthestPixelDistance: function farthestPixelDistance(t) {
        return cd(t, this.pixelsPerMeter(t.center.lat, t.worldSize));
      },
      createTileTransform: function createTileTransform(t, e) {
        return new Bd(t, e);
      }
    };
    var qd = q(Oo);
    var Nd = {
      name: "naturalEarth",
      center: [0, 0],
      range: [3.5, 7],
      isReprojectedInTileSpace: !0,
      zAxisUnit: "meters",
      unsupportedLayers: ["custom"],
      project: function project(t, e) {
        var r = (e = q(e)) * e,
            n = r * r;
        return {
          x: .5 * ((t = q(t)) * (.8707 - .131979 * r + n * (n * (.003971 * r - .001529 * n) - .013791)) / Math.PI + .5),
          y: 1 - .5 * (e * (1.007226 + r * (.015085 + n * (.028874 * r - .044475 - .005916 * n))) / Math.PI + 1),
          z: 0
        };
      },
      unproject: function unproject(t, e) {
        t = (2 * t - .5) * Math.PI;
        var r = e = (2 * (1 - e) - 1) * Math.PI,
            n = 25,
            i = 0,
            s = r * r;

        do {
          s = r * r;

          var _t245 = s * s;

          i = (r * (1.007226 + s * (.015085 + _t245 * (.028874 * s - .044475 - .005916 * _t245))) - e) / (1.007226 + s * (.045255 + _t245 * (.259866 * s - .311325 - .005916 * 11 * _t245))), r = Y(r - i, -qd, qd);
        } while (Math.abs(i) > 1e-6 && --n > 0);

        s = r * r;
        var a = Y(N(t / (.8707 + s * (s * (s * s * s * (.003971 - .001529 * s) - .013791) - .131979))), -180, 180),
            o = N(r);
        return new Po(a, o);
      },
      projectTilePoint: function projectTilePoint(t, e) {
        return {
          x: t,
          y: e,
          z: 0
        };
      },
      locationPoint: function locationPoint(t, e) {
        return t._coordinatePoint(t.locationCoordinate(e), !1);
      },
      pixelsPerMeter: function pixelsPerMeter(t, e) {
        return Lo(1, t) * e;
      },
      farthestPixelDistance: function farthestPixelDistance(t) {
        return cd(t, this.pixelsPerMeter(t.center.lat, t.worldSize));
      },
      createTileTransform: function createTileTransform(t, e) {
        return new Bd(t, e);
      }
    };
    var Gd = q(Oo),
        Zd = {
      albers: Cd,
      equalEarth: Ld,
      equirectangular: Rd,
      lambertConformalConic: Od,
      mercator: jd,
      naturalEarth: Nd,
      winkelTripel: {
        name: "winkelTripel",
        center: [0, 0],
        range: [3.5, 7],
        zAxisUnit: "meters",
        isReprojectedInTileSpace: !0,
        unsupportedLayers: ["custom"],
        project: function project(t, e) {
          e = q(e), t = q(t);
          var r = Math.cos(e),
              n = 2 / Math.PI,
              i = Math.acos(r * Math.cos(t / 2)),
              s = Math.sin(i) / i,
              a = .5 * (t * n + 2 * r * Math.sin(t / 2) / s) || 0,
              o = .5 * (e + Math.sin(e) / s) || 0;
          return {
            x: .5 * (a / Math.PI + .5),
            y: 1 - .5 * (o / Math.PI + 1),
            z: 0
          };
        },
        unproject: function unproject(t, e) {
          var r = t = (2 * t - .5) * Math.PI,
              n = e = (2 * (1 - e) - 1) * Math.PI,
              i = 25;
          var s = 1e-6;
          var a = 0,
              o = 0;

          do {
            var _i135 = Math.cos(n),
                _s98 = Math.sin(n),
                _l48 = 2 * _s98 * _i135,
                _u45 = _s98 * _s98,
                _c28 = _i135 * _i135,
                _h18 = Math.cos(r / 2),
                _p21 = Math.sin(r / 2),
                _d14 = 2 * _h18 * _p21,
                _f13 = _p21 * _p21,
                _y8 = 1 - _c28 * _h18 * _h18,
                _m10 = _y8 ? 1 / _y8 : 0,
                _g12 = _y8 ? Math.acos(_i135 * _h18) * Math.sqrt(1 / _y8) : 0,
                _x11 = .5 * (2 * _g12 * _i135 * _p21 + 2 * r / Math.PI) - t,
                _v9 = .5 * (_g12 * _s98 + n) - e,
                _b8 = .5 * _m10 * (_c28 * _f13 + _g12 * _i135 * _h18 * _u45) + 1 / Math.PI,
                _w8 = _m10 * (_d14 * _l48 / 4 - _g12 * _s98 * _p21),
                _9 = .125 * _m10 * (_l48 * _p21 - _g12 * _s98 * _c28 * _d14),
                _A8 = .5 * _m10 * (_u45 * _h18 + _g12 * _f13 * _i135) + .5,
                _k9 = _w8 * _9 - _A8 * _b8;

            a = (_v9 * _w8 - _x11 * _A8) / _k9, o = (_x11 * _9 - _v9 * _b8) / _k9, r = Y(r - a, -Math.PI, Math.PI), n = Y(n - o, -Gd, Gd);
          } while ((Math.abs(a) > s || Math.abs(o) > s) && --i > 0);

          return new Po(N(r), N(n));
        },
        projectTilePoint: function projectTilePoint(t, e) {
          return {
            x: t,
            y: e,
            z: 0
          };
        },
        locationPoint: function locationPoint(t, e) {
          return t._coordinatePoint(t.locationCoordinate(e), !1);
        },
        pixelsPerMeter: function pixelsPerMeter(t, e) {
          return Lo(1, t) * e;
        },
        farthestPixelDistance: function farthestPixelDistance(t) {
          return cd(t, this.pixelsPerMeter(t.center.lat, t.worldSize));
        },
        createTileTransform: function createTileTransform(t, e) {
          return new Bd(t, e);
        }
      }
    };
    t.ARRAY_TYPE = l, t.AUTH_ERR_MSG = Et, t.Aabb = gl, t.Actor = /*#__PURE__*/function () {
      function _class6(t, e, r) {
        _classCallCheck(this, _class6);

        this.target = t, this.parent = e, this.mapId = r, this.callbacks = {}, this.cancelCallbacks = {}, at(["receive"], this), this.target.addEventListener("message", this.receive, !1), this.globalScope = yt() ? t : a, this.scheduler = new mp();
      }

      _createClass(_class6, [{
        key: "send",
        value: function send(t, e, r, n) {
          var _this41 = this;

          var i = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : !1;
          var s = arguments.length > 5 ? arguments[5] : undefined;
          var a = Math.round(1e18 * Math.random()).toString(36).substring(0, 10);
          r && (r.metadata = s, this.callbacks[a] = r);
          var o = wt(this.globalScope) ? void 0 : [];
          return this.target.postMessage({
            id: a,
            type: t,
            hasCallback: !!r,
            targetMapId: n,
            mustQueue: i,
            sourceMapId: this.mapId,
            data: Yi(e, o)
          }, o), {
            cancel: function cancel() {
              r && delete _this41.callbacks[a], _this41.target.postMessage({
                id: a,
                type: "<cancel>",
                targetMapId: n,
                sourceMapId: _this41.mapId
              });
            }
          };
        }
      }, {
        key: "receive",
        value: function receive(t) {
          var _this42 = this;

          var e = t.data,
              r = e.id;
          if (r && (!e.targetMapId || this.mapId === e.targetMapId)) if ("<cancel>" === e.type) {
            var _t246 = this.cancelCallbacks[r];
            delete this.cancelCallbacks[r], _t246 && _t246.cancel();
          } else if (e.mustQueue || yt()) {
            var _t247 = this.callbacks[r];
            this.cancelCallbacks[r] = this.scheduler.add(function () {
              return _this42.processTask(r, e);
            }, _t247 && _t247.metadata || {
              type: "message"
            });
          } else this.processTask(r, e);
        }
      }, {
        key: "processTask",
        value: function processTask(t, e) {
          var _this43 = this;

          if ("<response>" === e.type) {
            var _r198 = this.callbacks[t];
            delete this.callbacks[t], _r198 && (e.error ? _r198(Hi(e.error)) : _r198(null, Hi(e.data)));
          } else {
            var _r199 = wt(this.globalScope) ? void 0 : [],
                _n140 = e.hasCallback ? function (e, n) {
              delete _this43.cancelCallbacks[t], _this43.target.postMessage({
                id: t,
                type: "<response>",
                sourceMapId: _this43.mapId,
                error: e ? Yi(e) : null,
                data: Yi(n, _r199)
              }, _r199);
            } : function (t) {},
                _i136 = Hi(e.data);

            if (this.parent[e.type]) this.parent[e.type](e.sourceMapId, _i136, _n140);else if (this.parent.getWorkerSource) {
              var _t248 = e.type.split(".");

              this.parent.getWorkerSource(e.sourceMapId, _t248[0], _i136.source)[_t248[1]](_i136, _n140);
            } else _n140(new Error("Could not find function ".concat(e.type)));
          }
        }
      }, {
        key: "remove",
        value: function remove() {
          this.scheduler.remove(), this.target.removeEventListener("message", this.receive, !1);
        }
      }]);

      return _class6;
    }(), t.CanonicalTileID = xp, t.Color = Ge, t.ColorMode = Sp, t.CullFaceMode = Mp, t.DEMData = Op, t.DataConstantProperty = ta, t.DedupedRequest = zd, t.DepthMode = _p, t.EXTENT = To, t.Elevation = /*#__PURE__*/function () {
      function _class7() {
        _classCallCheck(this, _class7);
      }

      _createClass(_class7, [{
        key: "getAtPointOrZero",
        value: function getAtPointOrZero(t) {
          var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
          return this.getAtPoint(t, e) || 0;
        }
      }, {
        key: "getAtPoint",
        value: function getAtPoint(t, e) {
          var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !0;
          null == e && (e = null);

          var n = this._source();

          if (!n) return e;
          if (t.y < 0 || t.y > 1) return e;
          var i = n.getSource().maxzoom,
              s = 1 << i,
              a = Math.floor(t.x),
              o = t.x - a,
              l = new bp(i, a, i, Math.floor(o * s), Math.floor(t.y * s)),
              u = this.findDEMTileFor(l);
          if (!u || !u.dem) return e;
          var c = u.dem,
              h = 1 << u.tileID.canonical.z,
              p = (o * h - u.tileID.canonical.x) * c.dim,
              d = (t.y * h - u.tileID.canonical.y) * c.dim,
              f = Math.floor(p),
              y = Math.floor(d);
          return (r ? this.exaggeration() : 1) * Lr(Lr(c.get(f, y), c.get(f, y + 1), d - y), Lr(c.get(f + 1, y), c.get(f + 1, y + 1), d - y), p - f);
        }
      }, {
        key: "getAtTileOffset",
        value: function getAtTileOffset(t, e, r) {
          var n = 1 << t.canonical.z;
          return this.getAtPointOrZero(new jo(t.wrap + (t.canonical.x + e / To) / n, (t.canonical.y + r / To) / n));
        }
      }, {
        key: "getAtTileOffsetFunc",
        value: function getAtTileOffsetFunc(t, e) {
          var _this44 = this;

          return function (r) {
            var n = _this44.getAtTileOffset(t, r.x, r.y),
                i = e.upVector(t.canonical, r.x, r.y);

            return S(i, i, n * e.upVectorScale(t.canonical)), i;
          };
        }
      }, {
        key: "getForTilePoints",
        value: function getForTilePoints(t, e, r, n) {
          var _this45 = this;

          var i = Zp.create(this, t, n);
          return !!i && (e.forEach(function (t) {
            t[2] = _this45.exaggeration() * i.getElevationAt(t[0], t[1], r);
          }), !0);
        }
      }, {
        key: "getMinMaxForTile",
        value: function getMinMaxForTile(t) {
          var e = this.findDEMTileFor(t);
          if (!e || !e.dem) return null;
          var r = e.dem.tree,
              n = e.tileID,
              i = 1 << t.canonical.z - n.canonical.z;
          var s = t.canonical.x / i - n.canonical.x,
              a = t.canonical.y / i - n.canonical.y,
              o = 0;

          for (var _e232 = 0; _e232 < t.canonical.z - n.canonical.z && !r.leaves[o]; _e232++) {
            s *= 2, a *= 2;

            var _t249 = 2 * Math.floor(a) + Math.floor(s);

            o = r.childOffsets[o] + _t249, s %= 1, a %= 1;
          }

          return {
            min: this.exaggeration() * r.minimums[o],
            max: this.exaggeration() * r.maximums[o]
          };
        }
      }, {
        key: "getMinElevationBelowMSL",
        value: function getMinElevationBelowMSL() {
          throw new Error("Pure virtual method called.");
        }
      }, {
        key: "raycast",
        value: function raycast(t, e, r) {
          throw new Error("Pure virtual method called.");
        }
      }, {
        key: "pointCoordinate",
        value: function pointCoordinate(t) {
          throw new Error("Pure virtual method called.");
        }
      }, {
        key: "_source",
        value: function _source() {
          throw new Error("Pure virtual method called.");
        }
      }, {
        key: "exaggeration",
        value: function exaggeration() {
          throw new Error("Pure virtual method called.");
        }
      }, {
        key: "findDEMTileFor",
        value: function findDEMTileFor(t) {
          throw new Error("Pure virtual method called.");
        }
      }, {
        key: "visibleDemTiles",
        get: function get() {
          throw new Error("Getter must be implemented in subclass.");
        }
      }]);

      return _class7;
    }(), t.ErrorEvent = ge, t.EvaluationParameters = Gs, t.Event = me, t.Evented = xe, t.Frustum = ml, t.GLOBE_ZOOM_THRESHOLD_MAX = 6, t.GlobeSharedBuffers = _d, t.GlyphManager = xh, t.ImagePosition = Oc, t.LineAtlas = pp, t.LngLat = Po, t.LngLatBounds = Bo, t.LocalGlyphMode = gh, t.MAX_MERCATOR_LATITUDE = Oo, t.MercatorCoordinate = jo, t.ONE_EM = sc, t.OverscaledTileID = bp, t.Properties = sa, t.RGBAImage = Ml, t.Ray = /*#__PURE__*/function () {
      function _class8(t, e) {
        _classCallCheck(this, _class8);

        this.pos = t, this.dir = e;
      }

      _createClass(_class8, [{
        key: "intersectsPlane",
        value: function intersectsPlane(t, e, r) {
          var n = M(e, this.dir);
          if (Math.abs(n) < 1e-6) return !1;
          var i = ((t[0] - this.pos[0]) * e[0] + (t[1] - this.pos[1]) * e[1] + (t[2] - this.pos[2]) * e[2]) / n;
          return r[0] = this.pos[0] + this.dir[0] * i, r[1] = this.pos[1] + this.dir[1] * i, r[2] = this.pos[2] + this.dir[2] * i, !0;
        }
      }, {
        key: "closestPointOnSphere",
        value: function closestPointOnSphere(t, e, r) {
          if (function (t, e) {
            var r = t[0],
                n = t[1],
                i = t[2],
                s = e[0],
                a = e[1],
                l = e[2];
            return Math.abs(r - s) <= o * Math.max(1, Math.abs(r), Math.abs(s)) && Math.abs(n - a) <= o * Math.max(1, Math.abs(n), Math.abs(a)) && Math.abs(i - l) <= o * Math.max(1, Math.abs(i), Math.abs(l));
          }(this.pos, t) || 0 === e) return r[0] = r[1] = r[2] = 0, !1;

          var _this$dir = _slicedToArray(this.dir, 3),
              n = _this$dir[0],
              i = _this$dir[1],
              s = _this$dir[2],
              a = this.pos[0] - t[0],
              l = this.pos[1] - t[1],
              u = this.pos[2] - t[2],
              c = n * n + i * i + s * s,
              h = 2 * (a * n + l * i + u * s),
              p = h * h - 4 * c * (a * a + l * l + u * u - e * e);

          if (p < 0) {
            var _t250 = Math.max(-h / 2, 0),
                _o57 = a + n * _t250,
                _c29 = l + i * _t250,
                _p22 = u + s * _t250,
                _d15 = Math.hypot(_o57, _c29, _p22);

            return r[0] = _o57 * e / _d15, r[1] = _c29 * e / _d15, r[2] = _p22 * e / _d15, !1;
          }

          {
            var _t251 = (-h - Math.sqrt(p)) / (2 * c);

            if (_t251 < 0) {
              var _t252 = Math.hypot(a, l, u);

              return r[0] = a * e / _t252, r[1] = l * e / _t252, r[2] = u * e / _t252, !1;
            }

            return r[0] = a + n * _t251, r[1] = l + i * _t251, r[2] = u + s * _t251, !0;
          }
        }
      }]);

      return _class8;
    }(), t.RequestManager = /*#__PURE__*/function () {
      function _class9(t, e, r) {
        _classCallCheck(this, _class9);

        this._transformRequestFn = t, this._customAccessToken = e, this._silenceAuthErrors = !!r, this._createSkuToken();
      }

      _createClass(_class9, [{
        key: "_createSkuToken",
        value: function _createSkuToken() {
          var t = function () {
            var t = "";

            for (var _e233 = 0; _e233 < 10; _e233++) {
              t += "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62 * Math.random())];
            }

            return {
              token: ["1", Pt, t].join(""),
              tokenExpiresAt: Date.now() + 432e5
            };
          }();

          this._skuToken = t.token, this._skuTokenExpiresAt = t.tokenExpiresAt;
        }
      }, {
        key: "_isSkuTokenExpired",
        value: function _isSkuTokenExpired() {
          return Date.now() > this._skuTokenExpiresAt;
        }
      }, {
        key: "transformRequest",
        value: function transformRequest(t, e) {
          return this._transformRequestFn && this._transformRequestFn(t, e) || {
            url: t
          };
        }
      }, {
        key: "normalizeStyleURL",
        value: function normalizeStyleURL(t, e) {
          if (!Dt(t)) return t;
          var r = Lt(t);
          return r.path = "/styles/v1".concat(r.path), this._makeAPIURL(r, this._customAccessToken || e);
        }
      }, {
        key: "normalizeGlyphsURL",
        value: function normalizeGlyphsURL(t, e) {
          if (!Dt(t)) return t;
          var r = Lt(t);
          return r.path = "/fonts/v1".concat(r.path), this._makeAPIURL(r, this._customAccessToken || e);
        }
      }, {
        key: "normalizeSourceURL",
        value: function normalizeSourceURL(t, e) {
          if (!Dt(t)) return t;
          var r = Lt(t);
          return r.path = "/v4/".concat(r.authority, ".json"), r.params.push("secure"), this._makeAPIURL(r, this._customAccessToken || e);
        }
      }, {
        key: "normalizeSpriteURL",
        value: function normalizeSpriteURL(t, e, r, n) {
          var i = Lt(t);
          return Dt(t) ? (i.path = "/styles/v1".concat(i.path, "/sprite").concat(e).concat(r), this._makeAPIURL(i, this._customAccessToken || n)) : (i.path += "".concat(e).concat(r), Rt(i));
        }
      }, {
        key: "normalizeTileURL",
        value: function normalizeTileURL(t, e, r) {
          if (this._isSkuTokenExpired() && this._createSkuToken(), t && !Dt(t)) return t;
          var n = Lt(t);
          n.path = n.path.replace(/(\.(png|jpg)\d*)(?=$)/, "".concat(e || r && "raster" !== n.authority && 512 === r ? "@2x" : "").concat(It.supported ? ".webp" : "$1")), "raster" === n.authority ? n.path = "/".concat(St.RASTER_URL_PREFIX).concat(n.path) : (n.path = n.path.replace(/^.+\/v4\//, "/"), n.path = "/".concat(St.TILE_URL_VERSION).concat(n.path));

          var i = this._customAccessToken || function (t) {
            var _iterator146 = _createForOfIteratorHelper(t),
                _step146;

            try {
              for (_iterator146.s(); !(_step146 = _iterator146.n()).done;) {
                var _e234 = _step146.value;

                var _t253 = _e234.match(/^access_token=(.*)$/);

                if (_t253) return _t253[1];
              }
            } catch (err) {
              _iterator146.e(err);
            } finally {
              _iterator146.f();
            }

            return null;
          }(n.params) || St.ACCESS_TOKEN;

          return St.REQUIRE_ACCESS_TOKEN && i && this._skuToken && n.params.push("sku=".concat(this._skuToken)), this._makeAPIURL(n, i);
        }
      }, {
        key: "canonicalizeTileURL",
        value: function canonicalizeTileURL(t, e) {
          var r = Lt(t);
          if (!r.path.match(/^(\/v4\/|\/raster\/v1\/)/) || !r.path.match(/\.[\w]+$/)) return t;
          var n = "mapbox://";
          r.path.match(/^\/raster\/v1\//) ? n += "raster/".concat(r.path.replace("/".concat(St.RASTER_URL_PREFIX, "/"), "")) : n += "tiles/".concat(r.path.replace("/".concat(St.TILE_URL_VERSION, "/"), ""));
          var i = r.params;
          return e && (i = i.filter(function (t) {
            return !t.match(/^access_token=/);
          })), i.length && (n += "?".concat(i.join("&"))), n;
        }
      }, {
        key: "canonicalizeTileset",
        value: function canonicalizeTileset(t, e) {
          var r = !!e && Dt(e),
              n = [];

          var _iterator147 = _createForOfIteratorHelper(t.tiles || []),
              _step147;

          try {
            for (_iterator147.s(); !(_step147 = _iterator147.n()).done;) {
              var _e235 = _step147.value;
              Vt(_e235) ? n.push(this.canonicalizeTileURL(_e235, r)) : n.push(_e235);
            }
          } catch (err) {
            _iterator147.e(err);
          } finally {
            _iterator147.f();
          }

          return n;
        }
      }, {
        key: "_makeAPIURL",
        value: function _makeAPIURL(t, e) {
          var r = "See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",
              n = Lt(St.API_URL);

          if (t.protocol = n.protocol, t.authority = n.authority, "http" === t.protocol) {
            var _e236 = t.params.indexOf("secure");

            _e236 >= 0 && t.params.splice(_e236, 1);
          }

          if ("/" !== n.path && (t.path = "".concat(n.path).concat(t.path)), !St.REQUIRE_ACCESS_TOKEN) return Rt(t);

          if (e = e || St.ACCESS_TOKEN, !this._silenceAuthErrors) {
            if (!e) throw new Error("An API access token is required to use Mapbox GL. ".concat(r));
            if ("s" === e[0]) throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ".concat(r));
          }

          return t.params = t.params.filter(function (t) {
            return -1 === t.indexOf("access_token");
          }), t.params.push("access_token=".concat(e || "")), Rt(t);
        }
      }]);

      return _class9;
    }(), t.ResourceType = re, t.SegmentVector = Mo, t.SourceCache = qp, t.StencilMode = kp, t.StructArrayLayout1ui2 = Pa, t.StructArrayLayout2f1f2i16 = _a, t.StructArrayLayout2i4 = pa, t.StructArrayLayout2ui4 = Ca, t.StructArrayLayout3f12 = ya, t.StructArrayLayout3ui6 = ka, t.StructArrayLayout4i8 = da, t.Texture = hp, t.Tile = ad, t.Transitionable = Ks, t.Uniform1f = io, t.Uniform1i = /*#__PURE__*/function (_no4) {
      _inherits(_class10, _no4);

      var _super62 = _createSuper(_class10);

      function _class10(t, e) {
        var _this46;

        _classCallCheck(this, _class10);

        _this46 = _super62.call(this, t, e), _this46.current = 0;
        return _this46;
      }

      _createClass(_class10, [{
        key: "set",
        value: function set(t) {
          this.current !== t && (this.current = t, this.gl.uniform1i(this.location, t));
        }
      }]);

      return _class10;
    }(no), t.Uniform2f = /*#__PURE__*/function (_no5) {
      _inherits(_class11, _no5);

      var _super63 = _createSuper(_class11);

      function _class11(t, e) {
        var _this47;

        _classCallCheck(this, _class11);

        _this47 = _super63.call(this, t, e), _this47.current = [0, 0];
        return _this47;
      }

      _createClass(_class11, [{
        key: "set",
        value: function set(t) {
          t[0] === this.current[0] && t[1] === this.current[1] || (this.current = t, this.gl.uniform2f(this.location, t[0], t[1]));
        }
      }]);

      return _class11;
    }(no), t.Uniform3f = /*#__PURE__*/function (_no6) {
      _inherits(_class12, _no6);

      var _super64 = _createSuper(_class12);

      function _class12(t, e) {
        var _this48;

        _classCallCheck(this, _class12);

        _this48 = _super64.call(this, t, e), _this48.current = [0, 0, 0];
        return _this48;
      }

      _createClass(_class12, [{
        key: "set",
        value: function set(t) {
          t[0] === this.current[0] && t[1] === this.current[1] && t[2] === this.current[2] || (this.current = t, this.gl.uniform3f(this.location, t[0], t[1], t[2]));
        }
      }]);

      return _class12;
    }(no), t.Uniform4f = so, t.UniformColor = ao, t.UniformMatrix2f = /*#__PURE__*/function (_no7) {
      _inherits(_class13, _no7);

      var _super65 = _createSuper(_class13);

      function _class13(t, e) {
        var _this49;

        _classCallCheck(this, _class13);

        _this49 = _super65.call(this, t, e), _this49.current = uo;
        return _this49;
      }

      _createClass(_class13, [{
        key: "set",
        value: function set(t) {
          for (var _e237 = 0; _e237 < 4; _e237++) {
            if (t[_e237] !== this.current[_e237]) {
              this.current = t, this.gl.uniformMatrix2fv(this.location, !1, t);
              break;
            }
          }
        }
      }]);

      return _class13;
    }(no), t.UniformMatrix3f = /*#__PURE__*/function (_no8) {
      _inherits(_class14, _no8);

      var _super66 = _createSuper(_class14);

      function _class14(t, e) {
        var _this50;

        _classCallCheck(this, _class14);

        _this50 = _super66.call(this, t, e), _this50.current = lo;
        return _this50;
      }

      _createClass(_class14, [{
        key: "set",
        value: function set(t) {
          for (var _e238 = 0; _e238 < 9; _e238++) {
            if (t[_e238] !== this.current[_e238]) {
              this.current = t, this.gl.uniformMatrix3fv(this.location, !1, t);
              break;
            }
          }
        }
      }]);

      return _class14;
    }(no), t.UniformMatrix4f = /*#__PURE__*/function (_no9) {
      _inherits(_class15, _no9);

      var _super67 = _createSuper(_class15);

      function _class15(t, e) {
        var _this51;

        _classCallCheck(this, _class15);

        _this51 = _super67.call(this, t, e), _this51.current = oo;
        return _this51;
      }

      _createClass(_class15, [{
        key: "set",
        value: function set(t) {
          if (t[12] !== this.current[12] || t[0] !== this.current[0]) return this.current = t, void this.gl.uniformMatrix4fv(this.location, !1, t);

          for (var _e239 = 1; _e239 < 16; _e239++) {
            if (t[_e239] !== this.current[_e239]) {
              this.current = t, this.gl.uniformMatrix4fv(this.location, !1, t);
              break;
            }
          }
        }
      }]);

      return _class15;
    }(no), t.UnwrappedTileID = vp, t.ValidationError = be, t.VectorTileWorkerSource = /*#__PURE__*/function (_xe3) {
      _inherits(_class16, _xe3);

      var _super68 = _createSuper(_class16);

      function _class16(t, e, r, n, i) {
        var _this52;

        _classCallCheck(this, _class16);

        _this52 = _super68.call(this), _this52.actor = t, _this52.layerIndex = e, _this52.availableImages = r, _this52.loadVectorData = i || Md, _this52.loading = {}, _this52.loaded = {}, _this52.deduped = new zd(t.scheduler), _this52.isSpriteLoaded = n, _this52.scheduler = t.scheduler;
        return _this52;
      }

      _createClass(_class16, [{
        key: "loadTile",
        value: function loadTile(t, e) {
          var _this53 = this;

          var r = t.uid,
              n = t && t.request,
              i = n && n.collectResourceTiming,
              s = this.loading[r] = new Sd(t);
          s.abort = this.loadVectorData(t, function (a, o) {
            var l = !_this53.loading[r];
            if (delete _this53.loading[r], l || a || !o) return s.status = "done", l || (_this53.loaded[r] = s), e(a);
            var u = o.rawData,
                c = {};
            o.expires && (c.expires = o.expires), o.cacheControl && (c.cacheControl = o.cacheControl), s.vectorTile = o.vectorTile || new Bu.VectorTile(new gc(u));

            var h = function h() {
              s.parse(s.vectorTile, _this53.layerIndex, _this53.availableImages, _this53.actor, function (t, r) {
                if (t || !r) return e(t);
                var s = {};

                if (i) {
                  var _t254 = yp(n);

                  _t254.length > 0 && (s.resourceTiming = JSON.parse(JSON.stringify(_t254)));
                }

                e(null, tt({
                  rawTileData: u.slice(0)
                }, r, c, s));
              });
            };

            _this53.isSpriteLoaded ? h() : _this53.once("isSpriteLoaded", function () {
              _this53.scheduler ? _this53.scheduler.add(h, {
                type: "parseTile",
                isSymbolTile: t.isSymbolTile,
                zoom: t.tileZoom
              }) : h();
            }), _this53.loaded = _this53.loaded || {}, _this53.loaded[r] = s;
          });
        }
      }, {
        key: "reloadTile",
        value: function reloadTile(t, e) {
          var _this54 = this;

          var r = this.loaded,
              n = t.uid,
              i = this;

          if (r && r[n]) {
            var _s99 = r[n];
            _s99.showCollisionBoxes = t.showCollisionBoxes, _s99.enableTerrain = !!t.enableTerrain, _s99.projection = t.projection;

            var _a80 = function _a80(t, r) {
              var n = _s99.reloadCallback;
              n && (delete _s99.reloadCallback, _s99.parse(_s99.vectorTile, i.layerIndex, _this54.availableImages, i.actor, n)), e(t, r);
            };

            "parsing" === _s99.status ? _s99.reloadCallback = _a80 : "done" === _s99.status && (_s99.vectorTile ? _s99.parse(_s99.vectorTile, this.layerIndex, this.availableImages, this.actor, _a80) : _a80());
          }
        }
      }, {
        key: "abortTile",
        value: function abortTile(t, e) {
          var r = t.uid,
              n = this.loading[r];
          n && (n.abort && n.abort(), delete this.loading[r]), e();
        }
      }, {
        key: "removeTile",
        value: function removeTile(t, e) {
          var r = this.loaded,
              n = t.uid;
          r && r[n] && delete r[n], e();
        }
      }]);

      return _class16;
    }(xe), t.WritingMode = qc, t.ZoomHistory = Ji, t.add = w, t.addDynamicAttributes = Gh, t.adjoint = function (t, e) {
      var r = e[0],
          n = e[1],
          i = e[2],
          s = e[3],
          a = e[4],
          o = e[5],
          l = e[6],
          u = e[7],
          c = e[8];
      return t[0] = a * c - o * u, t[1] = i * u - n * c, t[2] = n * o - i * a, t[3] = o * l - s * c, t[4] = r * c - i * l, t[5] = i * s - r * o, t[6] = s * u - a * l, t[7] = n * l - r * u, t[8] = r * a - n * s, t;
    }, t.asyncAll = W, t.bezier = X, t.bindAll = at, t.boundsAttributes = id, t.bufferConvexPolygon = function (t, e) {
      var r = [];

      for (var _n141 = 0; _n141 < t.length; _n141++) {
        var _i137 = J(_n141 - 1, -1, t.length - 1),
            _s100 = J(_n141 + 1, -1, t.length - 1),
            _a81 = t[_n141],
            _o58 = t[_s100],
            _l49 = t[_i137].sub(_a81).unit(),
            _u46 = _o58.sub(_a81).unit(),
            _c30 = _u46.angleWithSep(_l49.x, _l49.y),
            _h19 = _l49.add(_u46).unit().mult(-1 * e / Math.sin(_c30 / 2));

        r.push(_a81.add(_h19));
      }

      return r;
    }, t.cacheEntryPossiblyAdded = function (t) {
      ee++, ee > Wt && (t.getActor().send("enforceCacheSizeLimit", Jt), ee = 0);
    }, t.calculateGlobeMatrix = wd, t.calculateGlobeMercatorMatrix = function (t) {
      var e = t.worldSize,
          r = Y(t.center.lat, -85.051129, Oo),
          n = new i(Vo(t.center.lng) * e, Fo(r) * e),
          s = Lo(1, t.center.lat) * e,
          a = t.pixelsPerMeter,
          o = e / (s / t.pixelsPerMeter),
          l = c(new Float64Array(16));
      return p(l, l, [n.x, n.y, 0]), d(l, l, [o, o, a]), l;
    }, t.clamp = Y, t.clearTileCache = function (t) {
      var e = a.caches["delete"](Kt);
      t && e["catch"](t).then(function () {
        return t();
      });
    }, t.clipLine = dh, t.clone = function (t) {
      var e = new l(16);
      return e[0] = t[0], e[1] = t[1], e[2] = t[2], e[3] = t[3], e[4] = t[4], e[5] = t[5], e[6] = t[6], e[7] = t[7], e[8] = t[8], e[9] = t[9], e[10] = t[10], e[11] = t[11], e[12] = t[12], e[13] = t[13], e[14] = t[14], e[15] = t[15], e;
    }, t.clone$1 = ct, t.collisionCircleLayout = ic, t.config = St, t.conjugate = function (t, e) {
      return t[0] = -e[0], t[1] = -e[1], t[2] = -e[2], t[3] = e[3], t;
    }, t.create = function () {
      var t = new l(16);
      return l != Float32Array && (t[1] = 0, t[2] = 0, t[3] = 0, t[4] = 0, t[6] = 0, t[7] = 0, t[8] = 0, t[9] = 0, t[11] = 0, t[12] = 0, t[13] = 0, t[14] = 0), t[0] = 1, t[5] = 1, t[10] = 1, t[15] = 1, t;
    }, t.create$1 = u, t.createExpression = Gn, t.createLayout = ca, t.createStyleLayer = function (t) {
      return "custom" === t.type ? new rp(t) : new sp[t.type](t);
    }, t.cross = T, t.degToRad = q, t.div = function (t, e, r) {
      return t[0] = e[0] / r[0], t[1] = e[1] / r[1], t[2] = e[2] / r[2], t;
    }, t.dot = M, t.ease = K, t.easeCubicInOut = Z, t.emitValidationErrors = $i, t.endsWith = ot, t.enforceCacheSizeLimit = function (t) {
      Qt(), Yt && Yt.then(function (e) {
        e.keys().then(function (r) {
          for (var _n142 = 0; _n142 < r.length - t; _n142++) {
            e["delete"](r[_n142]);
          }
        });
      });
    }, t.evaluateSizeForFeature = lc, t.evaluateSizeForZoom = uc, t.evaluateVariableOffset = Ph, t.evented = Os, t.exactEquals = function (t, e) {
      return t[0] === e[0] && t[1] === e[1] && t[2] === e[2] && t[3] === e[3];
    }, t.exactEquals$1 = function (t, e) {
      return t[0] === e[0] && t[1] === e[1] && t[2] === e[2];
    }, t.exported = At, t.exported$1 = It, t.extend = tt, t.extend$1 = _e, t.filterObject = ut, t.fromMat4 = function (t, e) {
      return t[0] = e[0], t[1] = e[1], t[2] = e[2], t[3] = e[4], t[4] = e[5], t[5] = e[6], t[6] = e[8], t[7] = e[9], t[8] = e[10], t;
    }, t.fromQuat = function (t, e) {
      var r = e[0],
          n = e[1],
          i = e[2],
          s = e[3],
          a = r + r,
          o = n + n,
          l = i + i,
          u = r * a,
          c = n * a,
          h = n * o,
          p = i * a,
          d = i * o,
          f = i * l,
          y = s * a,
          m = s * o,
          g = s * l;
      return t[0] = 1 - h - f, t[1] = c + g, t[2] = p - m, t[3] = 0, t[4] = c - g, t[5] = 1 - u - f, t[6] = d + y, t[7] = 0, t[8] = p + m, t[9] = d - y, t[10] = 1 - u - h, t[11] = 0, t[12] = 0, t[13] = 0, t[14] = 0, t[15] = 1, t;
    }, t.fromRotation = function (t, e) {
      var r = Math.sin(e),
          n = Math.cos(e);
      return t[0] = n, t[1] = r, t[2] = 0, t[3] = -r, t[4] = n, t[5] = 0, t[6] = 0, t[7] = 0, t[8] = 1, t;
    }, t.fromScaling = function (t, e) {
      return t[0] = e[0], t[1] = 0, t[2] = 0, t[3] = 0, t[4] = 0, t[5] = e[1], t[6] = 0, t[7] = 0, t[8] = 0, t[9] = 0, t[10] = e[2], t[11] = 0, t[12] = 0, t[13] = 0, t[14] = 0, t[15] = 1, t;
    }, t.furthestTileCorner = function (t) {
      var e = Math.round((t + 45 + 360) % 360 / 90) % 4;
      return G[e];
    }, t.getAABBPointSquareDist = function (t, e, r) {
      var n = 0;

      for (var _i138 = 0; _i138 < 2; ++_i138) {
        var _s101 = r ? r[_i138] : 0;

        t[_i138] > _s101 && (n += (t[_i138] - _s101) * (t[_i138] - _s101)), e[_i138] < _s101 && (n += (_s101 - e[_i138]) * (_s101 - e[_i138]));
      }

      return n;
    }, t.getAnchorAlignment = eh, t.getAnchorJustification = Dh, t.getBounds = function (t) {
      var e = 1 / 0,
          r = 1 / 0,
          n = -1 / 0,
          s = -1 / 0;

      var _iterator148 = _createForOfIteratorHelper(t),
          _step148;

      try {
        for (_iterator148.s(); !(_step148 = _iterator148.n()).done;) {
          var _i139 = _step148.value;
          e = Math.min(e, _i139.x), r = Math.min(r, _i139.y), n = Math.max(n, _i139.x), s = Math.max(s, _i139.y);
        }
      } catch (err) {
        _iterator148.e(err);
      } finally {
        _iterator148.f();
      }

      return {
        min: new i(e, r),
        max: new i(n, s)
      };
    }, t.getColumn = function (t, e) {
      return [t[4 * e], t[4 * e + 1], t[4 * e + 2], t[4 * e + 3]];
    }, t.getImage = de, t.getJSON = function (t, e) {
      return se(tt(t, {
        type: "json"
      }), e);
    }, t.getMapSessionAPI = Zt, t.getPerformanceMeasurement = yp, t.getProjection = function (t) {
      var e = Zd[t.name];
      if (!e) throw new Error("Invalid projection name: ".concat(t.name));
      return e.conic ? function (t, e) {
        if (e.parallels && Math.abs(e.parallels[0] + e.parallels[1]) < .01) {
          var _r200 = function (t) {
            var e = Math.max(.01, Math.cos(q(t))),
                r = 1 / (2 * Math.max(Math.PI * e, 1 / e));
            return {
              wrap: !0,
              supportsWorldCopies: !0,
              unsupportedLayers: ["custom"],
              project: function project(t, n) {
                var i = q(t) * e,
                    s = Math.sin(q(n)) / e;
                return {
                  x: i * r + .5,
                  y: -s * r + .5,
                  z: 0
                };
              },
              unproject: function unproject(t, n) {
                var i = -(n - .5) / r,
                    s = Y(N((t - .5) / r) / e, -180, 180),
                    a = Math.asin(Y(i * e, -1, 1)),
                    o = Y(N(a), -85.051129, Oo);
                return new Po(s, o);
              }
            };
          }(e.parallels[0]);

          if ("lambertConformalConic" === e.name) {
            var _Zd$mercator = Zd.mercator,
                _t255 = _Zd$mercator.project,
                _e240 = _Zd$mercator.unproject;
            _r200 = {
              wrap: !0,
              supportsWorldCopies: !0,
              project: _t255,
              unproject: _e240
            };
          }

          return tt({}, t, e, _r200);
        }

        return tt({}, t, e);
      }(e, t) : e;
    }, t.getRTLTextPluginStatus = js, t.getReferrer = ie, t.getTilePoint = function (t, _ref165) {
      var e = _ref165.x,
          r = _ref165.y;
      var n = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
      return new i(((e - n) * t.scale - t.x) * To, (r * t.scale - t.y) * To);
    }, t.getTileVec3 = function (t, e) {
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
      return b(((e.x - r) * t.scale - t.x) * To, (e.y * t.scale - t.y) * To, $o(e.z, e.y));
    }, t.getVideo = function (t, e) {
      var r = a.document.createElement("video");
      r.muted = !0, r.onloadstart = function () {
        e(null, r);
      };

      for (var _e241 = 0; _e241 < t.length; _e241++) {
        var _n143 = a.document.createElement("source");

        ue(t[_e241]) || (r.crossOrigin = "Anonymous"), _n143.src = t[_e241], r.appendChild(_n143);
      }

      return {
        cancel: function cancel() {}
      };
    }, t.globeBuffersForTileMesh = function (t, e, r, n) {
      var i = t.context,
          s = t.transform;
      var a = e.globeGridBuffer,
          o = e.globePoleBuffer;

      if (!a) {
        var _t256 = _d.createGridVertices(r.canonical);

        a = e.globeGridBuffer = i.createVertexBuffer(_t256, ud, !1);
      }

      if (!o) {
        var _t257 = _d.createPoleTriangleVertices(n, s.tileSize * n, 0 === r.canonical.y);

        o = e.globePoleBuffer = i.createVertexBuffer(_t257, ud, !1);
      }

      return [a, o];
    }, t.globeDenormalizeECEF = bd, t.globeMatrixForTile = function (t, e) {
      var r = bd(yd(t)),
          n = ((i = new Float64Array(16))[0] = (s = e)[0], i[1] = s[1], i[2] = s[2], i[3] = s[3], i[4] = s[4], i[5] = s[5], i[6] = s[6], i[7] = s[7], i[8] = s[8], i[9] = s[9], i[10] = s[10], i[11] = s[11], i[12] = s[12], i[13] = s[13], i[14] = s[14], i[15] = s[15], i);
      var i, s;
      return m(n, n, r), n;
    }, t.globePoleMatrixForTile = function (t, e, r) {
      var n = c(new Float64Array(16)),
          i = Math.pow(2, t.z),
          s = (t.x - i / 2) / i * Math.PI * 2,
          a = r.point,
          o = r.worldSize / (r.tileSize * i);
      return p(n, n, [a.x, a.y, -r.worldSize / Math.PI / 2]), d(n, n, [o, o, o]), f(n, n, q(-r._center.lat)), y(n, n, q(-r._center.lng)), y(n, n, s), e && d(n, n, [1, -1, 1]), n;
    }, t.globeTileBounds = yd, t.globeToMercatorTransition = function (t) {
      return H(5, 6, t);
    }, t.identity = c, t.identity$1 = R, t.invert = function (t, e) {
      var r = e[0],
          n = e[1],
          i = e[2],
          s = e[3],
          a = e[4],
          o = e[5],
          l = e[6],
          u = e[7],
          c = e[8],
          h = e[9],
          p = e[10],
          d = e[11],
          f = e[12],
          y = e[13],
          m = e[14],
          g = e[15],
          x = r * o - n * a,
          v = r * l - i * a,
          b = r * u - s * a,
          w = n * l - i * o,
          _ = n * u - s * o,
          A = i * u - s * l,
          k = c * y - h * f,
          S = c * m - p * f,
          I = c * g - d * f,
          z = h * m - p * y,
          M = h * g - d * y,
          T = p * g - d * m,
          B = x * T - v * M + b * z + w * I - _ * S + A * k;

      return B ? (t[0] = (o * T - l * M + u * z) * (B = 1 / B), t[1] = (i * M - n * T - s * z) * B, t[2] = (y * A - m * _ + g * w) * B, t[3] = (p * _ - h * A - d * w) * B, t[4] = (l * I - a * T - u * S) * B, t[5] = (r * T - i * I + s * S) * B, t[6] = (m * b - f * A - g * v) * B, t[7] = (c * A - p * b + d * v) * B, t[8] = (a * M - o * I + u * k) * B, t[9] = (n * I - r * M - s * k) * B, t[10] = (f * _ - y * b + g * x) * B, t[11] = (h * b - c * _ - d * x) * B, t[12] = (o * S - a * z - l * k) * B, t[13] = (r * z - n * S + i * k) * B, t[14] = (y * v - f * w - m * x) * B, t[15] = (c * w - h * v + p * x) * B, t) : null;
    }, t.isMapAuthenticated = function (t) {
      return Xt.has(t);
    }, t.isMapboxURL = Dt, t.isSafariWithAntialiasingBug = function (t) {
      var e = t.navigator ? t.navigator.userAgent : null;
      return !!wt(t) && e && (e.match("Version/15.4") || e.match("Version/15.5") || e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/));
    }, t.latFromMercatorY = Uo, t.len = V, t.length = v, t.length$1 = function (t) {
      return Math.hypot(t[0], t[1], t[2], t[3]);
    }, t.loadVectorTile = Md, t.makeRequest = se, t.mercatorXfromLng = Vo, t.mercatorYfromLat = Fo, t.mercatorZfromAltitude = Lo, t.mul = m, t.mul$1 = D, t.multiply = function (t, e, r) {
      var n = e[0],
          i = e[1],
          s = e[2],
          a = e[3],
          o = e[4],
          l = e[5],
          u = e[6],
          c = e[7],
          h = e[8],
          p = r[0],
          d = r[1],
          f = r[2],
          y = r[3],
          m = r[4],
          g = r[5],
          x = r[6],
          v = r[7],
          b = r[8];
      return t[0] = p * n + d * a + f * u, t[1] = p * i + d * o + f * c, t[2] = p * s + d * l + f * h, t[3] = y * n + m * a + g * u, t[4] = y * i + m * o + g * c, t[5] = y * s + m * l + g * h, t[6] = x * n + v * a + b * u, t[7] = x * i + v * o + b * c, t[8] = x * s + v * l + b * h, t;
    }, t.multiply$1 = h, t.multiply$2 = A, t.nextPowerOfTwo = it, t.normalize = z, t.normalize$1 = function (t, e) {
      var r = e[0],
          n = e[1],
          i = e[2],
          s = e[3],
          a = r * r + n * n + i * i + s * s;
      return a > 0 && (a = 1 / Math.sqrt(a)), t[0] = r * a, t[1] = n * a, t[2] = i * a, t[3] = s * a, t;
    }, t.number = Lr, t.ortho = function (t, e, r, n, i, s, a) {
      var o = 1 / (e - r),
          l = 1 / (n - i),
          u = 1 / (s - a);
      return t[0] = -2 * o, t[1] = 0, t[2] = 0, t[3] = 0, t[4] = 0, t[5] = -2 * l, t[6] = 0, t[7] = 0, t[8] = 0, t[9] = 0, t[10] = 2 * u, t[11] = 0, t[12] = (e + r) * o, t[13] = (i + n) * l, t[14] = (a + s) * u, t[15] = 1, t;
    }, t.pbf = gc, t.perspective = function (t, e, r, n, i) {
      var s,
          a = 1 / Math.tan(e / 2);
      return t[0] = a / r, t[1] = 0, t[2] = 0, t[3] = 0, t[4] = 0, t[5] = a, t[6] = 0, t[7] = 0, t[8] = 0, t[9] = 0, t[11] = -1, t[12] = 0, t[13] = 0, t[15] = 0, null != i && i !== 1 / 0 ? (t[10] = (i + n) * (s = 1 / (n - i)), t[14] = 2 * i * n * s) : (t[10] = -1, t[14] = -2 * n), t;
    }, t.pick = function (t, e) {
      var r = {};

      for (var _n144 = 0; _n144 < e.length; _n144++) {
        var _i140 = e[_n144];
        _i140 in t && (r[_i140] = t[_i140]);
      }

      return r;
    }, t.plugin = Ns, t.pointGeometry = i, t.polygonIntersectsBox = ll, t.polygonIntersectsPolygon = Wo, t.polygonizeBounds = function (t, e) {
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
      var n = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : !0;
      var s = new i(r, r),
          a = t.sub(s),
          o = e.add(s),
          l = [a, new i(o.x, a.y), o, new i(a.x, o.y)];
      return n && l.push(a), l;
    }, t.posAttributes = Hp, t.postMapLoadEvent = Nt, t.postTurnstileEvent = jt, t.potpack = $c, t.prevPowerOfTwo = function (t) {
      return t <= 1 ? 1 : Math.pow(2, Math.floor(Math.log(t) / Math.LN2));
    }, t.radToDeg = N, t.refProperties = ["type", "source", "source-layer", "minzoom", "maxzoom", "filter", "layout"], t.registerForPluginStateChange = function (t) {
      return t({
        pluginStatus: Ls,
        pluginURL: Rs
      }), Os.on("pluginStateChange", t), t;
    }, t.removeAuthState = function (t) {
      Xt["delete"](t);
    }, t.renderColorRamp = Bl, t.rotateX = f, t.rotateX$1 = U, t.rotateY = y, t.rotateZ = function (t, e, r) {
      var n = Math.sin(r),
          i = Math.cos(r),
          s = e[0],
          a = e[1],
          o = e[2],
          l = e[3],
          u = e[4],
          c = e[5],
          h = e[6],
          p = e[7];
      return e !== t && (t[8] = e[8], t[9] = e[9], t[10] = e[10], t[11] = e[11], t[12] = e[12], t[13] = e[13], t[14] = e[14], t[15] = e[15]), t[0] = s * i + u * n, t[1] = a * i + c * n, t[2] = o * i + h * n, t[3] = l * i + p * n, t[4] = u * i - s * n, t[5] = c * i - a * n, t[6] = h * i - o * n, t[7] = p * i - l * n, t;
    }, t.rotateZ$1 = function (t, e, r) {
      r *= .5;
      var n = e[0],
          i = e[1],
          s = e[2],
          a = e[3],
          o = Math.sin(r),
          l = Math.cos(r);
      return t[0] = n * l + i * o, t[1] = i * l - n * o, t[2] = s * l + a * o, t[3] = a * l - s * o, t;
    }, t.scale = d, t.scale$1 = function (t, e, r) {
      return t[0] = e[0] * r, t[1] = e[1] * r, t[2] = e[2] * r, t[3] = e[3] * r, t;
    }, t.scale$2 = S, t.scaleAndAdd = I, t.setCacheLimits = function (t, e) {
      Jt = t, Wt = e;
    }, t.setColumn = function (t, e, r) {
      t[4 * e + 0] = r[0], t[4 * e + 1] = r[1], t[4 * e + 2] = r[2], t[4 * e + 3] = r[3];
    }, t.setRTLTextPlugin = function (t, e) {
      var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !1;
      if (Ls === Es || Ls === Ds || Ls === Vs) throw new Error("setRTLTextPlugin cannot be called multiple times.");
      Rs = At.resolveURL(t), Ls = Es, Fs = e, $s(), r || qs();
    }, t.smoothstep = H, t.spec = ve, t.storeAuthState = function (t, e) {
      e ? Xt.add(t) : Xt["delete"](t);
    }, t.sub = E, t.subtract = _, t.symbolSize = cc, t.tileAABB = function (t, e, r, n, i, s, a, o, l) {
      if ("globe" === l.name) {
        var _a82 = yd(new vp(s, new xp(r, n, i)).canonical).getCorners(),
            _o59 = Number.MAX_VALUE,
            _l50 = [-_o59, -_o59, -_o59],
            _p23 = [_o59, _o59, _o59],
            _d16 = wd(t, e);

        for (var _t258 = 0; _t258 < _a82.length; _t258++) {
          B(_a82[_t258], _a82[_t258], _d16), c = _p23, h = _a82[_t258], (u = _p23)[0] = Math.min(c[0], h[0]), u[1] = Math.min(c[1], h[1]), u[2] = Math.min(c[2], h[2]), k(_l50, _l50, _a82[_t258]);
        }

        return new gl(_p23, _l50);
      }

      var u, c, h;
      var p = Ad({
        z: r,
        x: n,
        y: i
      }, l);
      return new gl([(s + p.x / p.scale) * e, e * (p.y / p.scale), a], [(s + p.x2 / p.scale) * e, e * (p.y2 / p.scale), o]);
    }, t.tileTransform = Ad, t.transformMat3 = function (t, e, r) {
      var n = e[0],
          i = e[1],
          s = e[2];
      return t[0] = n * r[0] + i * r[3] + s * r[6], t[1] = n * r[1] + i * r[4] + s * r[7], t[2] = n * r[2] + i * r[5] + s * r[8], t;
    }, t.transformMat4 = B, t.transformMat4$1 = F, t.transformQuat = C, t.translate = p, t.transpose = function (t, e) {
      if (t === e) {
        var r = e[1],
            n = e[2],
            i = e[5];
        t[1] = e[3], t[2] = e[6], t[3] = r, t[5] = e[7], t[6] = n, t[7] = i;
      } else t[0] = e[0], t[1] = e[3], t[2] = e[6], t[3] = e[1], t[4] = e[4], t[5] = e[7], t[6] = e[2], t[7] = e[5], t[8] = e[8];

      return t;
    }, t.triggerPluginCompletionEvent = Us, t.uniqueId = rt, t.validateCustomStyleLayer = function (t) {
      var e = [],
          r = t.id;
      return void 0 === r && e.push({
        message: "layers.".concat(r, ": missing required property \"id\"")
      }), void 0 === t.render && e.push({
        message: "layers.".concat(r, ": missing required method \"render\"")
      }), t.renderingMode && "2d" !== t.renderingMode && "3d" !== t.renderingMode && e.push({
        message: "layers.".concat(r, ": property \"renderingMode\" must be either \"2d\" or \"3d\"")
      }), e;
    }, t.validateFog = Li, t.validateLight = Fi, t.validateStyle = Vi, t.values = Q, t.vectorTile = Bu, t.version = e, t.warnOnce = pt, t.window = a, t.wrap = J;
  });
  define(["./shared"], function (e) {
    "use strict";

    function t(e) {
      var r = _typeof(e);

      if ("number" === r || "boolean" === r || "string" === r || null == e) return JSON.stringify(e);

      if (Array.isArray(e)) {
        var _r201 = "[";

        var _iterator149 = _createForOfIteratorHelper(e),
            _step149;

        try {
          for (_iterator149.s(); !(_step149 = _iterator149.n()).done;) {
            var _o60 = _step149.value;
            _r201 += "".concat(t(_o60), ",");
          }
        } catch (err) {
          _iterator149.e(err);
        } finally {
          _iterator149.f();
        }

        return "".concat(_r201, "]");
      }

      var o = Object.keys(e).sort();
      var n = "{";

      for (var _r202 = 0; _r202 < o.length; _r202++) {
        n += "".concat(JSON.stringify(o[_r202]), ":").concat(t(e[o[_r202]]), ",");
      }

      return "".concat(n, "}");
    }

    function r(r) {
      var o = "";

      var _iterator150 = _createForOfIteratorHelper(e.refProperties),
          _step150;

      try {
        for (_iterator150.s(); !(_step150 = _iterator150.n()).done;) {
          var _n145 = _step150.value;
          o += "/".concat(t(r[_n145]));
        }
      } catch (err) {
        _iterator150.e(err);
      } finally {
        _iterator150.f();
      }

      return o;
    }

    var o = /*#__PURE__*/function () {
      function o(e) {
        _classCallCheck(this, o);

        this.keyCache = {}, e && this.replace(e);
      }

      _createClass(o, [{
        key: "replace",
        value: function replace(e) {
          this._layerConfigs = {}, this._layers = {}, this.update(e, []);
        }
      }, {
        key: "update",
        value: function update(t, _o61) {
          var _this55 = this;

          var _iterator151 = _createForOfIteratorHelper(t),
              _step151;

          try {
            for (_iterator151.s(); !(_step151 = _iterator151.n()).done;) {
              var _r203 = _step151.value;
              this._layerConfigs[_r203.id] = _r203, (this._layers[_r203.id] = e.createStyleLayer(_r203)).compileFilter(), this.keyCache[_r203.id] && delete this.keyCache[_r203.id];
            }
          } catch (err) {
            _iterator151.e(err);
          } finally {
            _iterator151.f();
          }

          var _iterator152 = _createForOfIteratorHelper(_o61),
              _step152;

          try {
            for (_iterator152.s(); !(_step152 = _iterator152.n()).done;) {
              var _e243 = _step152.value;
              delete this.keyCache[_e243], delete this._layerConfigs[_e243], delete this._layers[_e243];
            }
          } catch (err) {
            _iterator152.e(err);
          } finally {
            _iterator152.f();
          }

          this.familiesBySource = {};

          var n = function (e, t) {
            var o = {};

            for (var _n146 = 0; _n146 < e.length; _n146++) {
              var _i141 = t && t[e[_n146].id] || r(e[_n146]);

              t && (t[e[_n146].id] = _i141);
              var _s102 = o[_i141];
              _s102 || (_s102 = o[_i141] = []), _s102.push(e[_n146]);
            }

            var n = [];

            for (var _e242 in o) {
              n.push(o[_e242]);
            }

            return n;
          }(e.values(this._layerConfigs), this.keyCache);

          var _iterator153 = _createForOfIteratorHelper(n),
              _step153;

          try {
            for (_iterator153.s(); !(_step153 = _iterator153.n()).done;) {
              var _e244 = _step153.value;

              var _t259 = _e244.map(function (e) {
                return _this55._layers[e.id];
              }),
                  _r204 = _t259[0];

              if ("none" === _r204.visibility) continue;

              var _o63 = _r204.source || "";

              var _n147 = this.familiesBySource[_o63];
              _n147 || (_n147 = this.familiesBySource[_o63] = {});

              var _i142 = _r204.sourceLayer || "_geojsonTileLayer";

              var _s103 = _n147[_i142];
              _s103 || (_s103 = _n147[_i142] = []), _s103.push(_t259);
            }
          } catch (err) {
            _iterator153.e(err);
          } finally {
            _iterator153.f();
          }
        }
      }]);

      return o;
    }();

    var n = e.window.ImageBitmap;

    var i = /*#__PURE__*/function () {
      function i() {
        _classCallCheck(this, i);
      }

      _createClass(i, [{
        key: "loadTile",
        value: function loadTile(t, r) {
          var o = t.uid,
              _i143 = t.encoding,
              s = t.rawImageData,
              a = t.padding,
              l = t.buildQuadTree,
              u = n && s instanceof n ? this.getImageData(s, a) : s;
          r(null, new e.DEMData(o, u, _i143, a < 1, l));
        }
      }, {
        key: "getImageData",
        value: function getImageData(t, r) {
          this.offscreenCanvas && this.offscreenCanvasContext || (this.offscreenCanvas = new OffscreenCanvas(t.width, t.height), this.offscreenCanvasContext = this.offscreenCanvas.getContext("2d")), this.offscreenCanvas.width = t.width, this.offscreenCanvas.height = t.height, this.offscreenCanvasContext.drawImage(t, 0, 0, t.width, t.height);
          var o = this.offscreenCanvasContext.getImageData(-r, -r, t.width + 2 * r, t.height + 2 * r);
          return this.offscreenCanvasContext.clearRect(0, 0, this.offscreenCanvas.width, this.offscreenCanvas.height), new e.RGBAImage({
            width: o.width,
            height: o.height
          }, o.data);
        }
      }]);

      return i;
    }();

    var s = function e(t, r) {
      var o,
          n = t && t.type;
      if ("FeatureCollection" === n) for (o = 0; o < t.features.length; o++) {
        e(t.features[o], r);
      } else if ("GeometryCollection" === n) for (o = 0; o < t.geometries.length; o++) {
        e(t.geometries[o], r);
      } else if ("Feature" === n) e(t.geometry, r);else if ("Polygon" === n) a(t.coordinates, r);else if ("MultiPolygon" === n) for (o = 0; o < t.coordinates.length; o++) {
        a(t.coordinates[o], r);
      }
      return t;
    };

    function a(e, t) {
      if (0 !== e.length) {
        l(e[0], t);

        for (var r = 1; r < e.length; r++) {
          l(e[r], !t);
        }
      }
    }

    function l(e, t) {
      for (var r = 0, o = 0, n = 0, i = e.length, s = i - 1; n < i; s = n++) {
        var a = (e[n][0] - e[s][0]) * (e[s][1] + e[n][1]),
            l = r + a;
        o += Math.abs(r) >= Math.abs(a) ? r - l + a : a - l + r, r = l;
      }

      r + o >= 0 != !!t && e.reverse();
    }

    var u = e.vectorTile.VectorTileFeature.prototype.toGeoJSON;

    var h = /*#__PURE__*/function () {
      function h(t) {
        _classCallCheck(this, h);

        this._feature = t, this.extent = e.EXTENT, this.type = t.type, this.properties = t.tags, "id" in t && !isNaN(t.id) && (this.id = parseInt(t.id, 10));
      }

      _createClass(h, [{
        key: "loadGeometry",
        value: function loadGeometry() {
          if (1 === this._feature.type) {
            var _t260 = [];

            var _iterator154 = _createForOfIteratorHelper(this._feature.geometry),
                _step154;

            try {
              for (_iterator154.s(); !(_step154 = _iterator154.n()).done;) {
                var _r205 = _step154.value;

                _t260.push([new e.pointGeometry(_r205[0], _r205[1])]);
              }
            } catch (err) {
              _iterator154.e(err);
            } finally {
              _iterator154.f();
            }

            return _t260;
          }

          {
            var _t261 = [];

            var _iterator155 = _createForOfIteratorHelper(this._feature.geometry),
                _step155;

            try {
              for (_iterator155.s(); !(_step155 = _iterator155.n()).done;) {
                var _r206 = _step155.value;
                var _o64 = [];

                var _iterator156 = _createForOfIteratorHelper(_r206),
                    _step156;

                try {
                  for (_iterator156.s(); !(_step156 = _iterator156.n()).done;) {
                    var _t262 = _step156.value;

                    _o64.push(new e.pointGeometry(_t262[0], _t262[1]));
                  }
                } catch (err) {
                  _iterator156.e(err);
                } finally {
                  _iterator156.f();
                }

                _t261.push(_o64);
              }
            } catch (err) {
              _iterator155.e(err);
            } finally {
              _iterator155.f();
            }

            return _t261;
          }
        }
      }, {
        key: "toGeoJSON",
        value: function toGeoJSON(e, t, r) {
          return u.call(this, e, t, r);
        }
      }]);

      return h;
    }();

    var c = /*#__PURE__*/function () {
      function c(t) {
        _classCallCheck(this, c);

        this.layers = {
          _geojsonTileLayer: this
        }, this.name = "_geojsonTileLayer", this.extent = e.EXTENT, this.length = t.length, this._features = t;
      }

      _createClass(c, [{
        key: "feature",
        value: function feature(e) {
          return new h(this._features[e]);
        }
      }]);

      return c;
    }();

    var f = e.vectorTile.VectorTileFeature,
        p = g;

    function g(e, t) {
      this.options = t || {}, this.features = e, this.length = e.length;
    }

    function d(e, t) {
      this.id = "number" == typeof e.id ? e.id : void 0, this.type = e.type, this.rawGeometry = 1 === e.type ? [e.geometry] : e.geometry, this.properties = e.tags, this.extent = t || 4096;
    }

    g.prototype.feature = function (e) {
      return new d(this.features[e], this.options.extent);
    }, d.prototype.loadGeometry = function () {
      var t = this.rawGeometry;
      this.geometry = [];

      for (var r = 0; r < t.length; r++) {
        for (var o = t[r], n = [], i = 0; i < o.length; i++) {
          n.push(new e.pointGeometry(o[i][0], o[i][1]));
        }

        this.geometry.push(n);
      }

      return this.geometry;
    }, d.prototype.bbox = function () {
      this.geometry || this.loadGeometry();

      for (var e = this.geometry, t = 1 / 0, r = -1 / 0, o = 1 / 0, n = -1 / 0, i = 0; i < e.length; i++) {
        for (var s = e[i], a = 0; a < s.length; a++) {
          var l = s[a];
          t = Math.min(t, l.x), r = Math.max(r, l.x), o = Math.min(o, l.y), n = Math.max(n, l.y);
        }
      }

      return [t, o, r, n];
    }, d.prototype.toGeoJSON = f.prototype.toGeoJSON;
    var m = v,
        y = p;

    function v(t) {
      var r = new e.pbf();
      return function (e, t) {
        for (var r in e.layers) {
          t.writeMessage(3, x, e.layers[r]);
        }
      }(t, r), r.finish();
    }

    function x(e, t) {
      var r;
      t.writeVarintField(15, e.version || 1), t.writeStringField(1, e.name || ""), t.writeVarintField(5, e.extent || 4096);
      var o = {
        keys: [],
        values: [],
        keycache: {},
        valuecache: {}
      };

      for (r = 0; r < e.length; r++) {
        o.feature = e.feature(r), t.writeMessage(2, w, o);
      }

      var n = o.keys;

      for (r = 0; r < n.length; r++) {
        t.writeStringField(3, n[r]);
      }

      var i = o.values;

      for (r = 0; r < i.length; r++) {
        t.writeMessage(4, T, i[r]);
      }
    }

    function w(e, t) {
      var r = e.feature;
      void 0 !== r.id && t.writeVarintField(1, r.id), t.writeMessage(2, S, e), t.writeVarintField(3, r.type), t.writeMessage(4, b, r);
    }

    function S(e, t) {
      var r = e.feature,
          o = e.keys,
          n = e.values,
          i = e.keycache,
          s = e.valuecache;

      for (var a in r.properties) {
        var l = r.properties[a],
            u = i[a];

        if (null !== l) {
          void 0 === u && (o.push(a), i[a] = u = o.length - 1), t.writeVarint(u);

          var h = _typeof(l);

          "string" !== h && "boolean" !== h && "number" !== h && (l = JSON.stringify(l));
          var c = h + ":" + l,
              f = s[c];
          void 0 === f && (n.push(l), s[c] = f = n.length - 1), t.writeVarint(f);
        }
      }
    }

    function M(e, t) {
      return (t << 3) + (7 & e);
    }

    function P(e) {
      return e << 1 ^ e >> 31;
    }

    function b(e, t) {
      for (var r = e.loadGeometry(), o = e.type, n = 0, i = 0, s = r.length, a = 0; a < s; a++) {
        var l = r[a],
            u = 1;
        1 === o && (u = l.length), t.writeVarint(M(1, u));

        for (var h = 3 === o ? l.length - 1 : l.length, c = 0; c < h; c++) {
          1 === c && 1 !== o && t.writeVarint(M(2, h - 1));
          var f = l[c].x - n,
              p = l[c].y - i;
          t.writeVarint(P(f)), t.writeVarint(P(p)), n += f, i += p;
        }

        3 === o && t.writeVarint(M(7, 1));
      }
    }

    function T(e, t) {
      var r = _typeof(e);

      "string" === r ? t.writeStringField(1, e) : "boolean" === r ? t.writeBooleanField(7, e) : "number" === r && (e % 1 != 0 ? t.writeDoubleField(3, e) : e < 0 ? t.writeSVarintField(6, e) : t.writeVarintField(5, e));
    }

    function k(e, t, r, o, n, i) {
      if (n - o <= r) return;
      var s = o + n >> 1;
      I(e, t, s, o, n, i % 2), k(e, t, r, o, s - 1, i + 1), k(e, t, r, s + 1, n, i + 1);
    }

    function I(e, t, r, o, n, i) {
      for (; n > o;) {
        if (n - o > 600) {
          var _s105 = n - o + 1,
              _a84 = r - o + 1,
              _l52 = Math.log(_s105),
              _u47 = .5 * Math.exp(2 * _l52 / 3),
              _h20 = .5 * Math.sqrt(_l52 * _u47 * (_s105 - _u47) / _s105) * (_a84 - _s105 / 2 < 0 ? -1 : 1);

          I(e, t, r, Math.max(o, Math.floor(r - _a84 * _u47 / _s105 + _h20)), Math.min(n, Math.floor(r + (_s105 - _a84) * _u47 / _s105 + _h20)), i);
        }

        var _s104 = t[2 * r + i];
        var _a83 = o,
            _l51 = n;

        for (_(e, t, o, r), t[2 * n + i] > _s104 && _(e, t, o, n); _a83 < _l51;) {
          for (_(e, t, _a83, _l51), _a83++, _l51--; t[2 * _a83 + i] < _s104;) {
            _a83++;
          }

          for (; t[2 * _l51 + i] > _s104;) {
            _l51--;
          }
        }

        t[2 * o + i] === _s104 ? _(e, t, o, _l51) : (_l51++, _(e, t, _l51, n)), _l51 <= r && (o = _l51 + 1), r <= _l51 && (n = _l51 - 1);
      }
    }

    function _(e, t, r, o) {
      L(e, r, o), L(t, 2 * r, 2 * o), L(t, 2 * r + 1, 2 * o + 1);
    }

    function L(e, t, r) {
      var o = e[t];
      e[t] = e[r], e[r] = o;
    }

    function C(e, t, r, o) {
      var n = e - r,
          i = t - o;
      return n * n + i * i;
    }

    m.fromVectorTileJs = v, m.fromGeojsonVt = function (e, t) {
      t = t || {};
      var r = {};

      for (var o in e) {
        r[o] = new p(e[o].features, t), r[o].name = o, r[o].version = t.version, r[o].extent = t.extent;
      }

      return v({
        layers: r
      });
    }, m.GeoJSONWrapper = y;

    var O = function O(e) {
      return e[0];
    },
        z = function z(e) {
      return e[1];
    };

    var E = /*#__PURE__*/function () {
      function E(e) {
        var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : O;
        var r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : z;
        var o = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 64;
        var n = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : Float64Array;

        _classCallCheck(this, E);

        this.nodeSize = o, this.points = e;
        var i = e.length < 65536 ? Uint16Array : Uint32Array,
            s = this.ids = new i(e.length),
            a = this.coords = new n(2 * e.length);

        for (var _o65 = 0; _o65 < e.length; _o65++) {
          s[_o65] = _o65, a[2 * _o65] = t(e[_o65]), a[2 * _o65 + 1] = r(e[_o65]);
        }

        k(s, a, o, 0, s.length - 1, 0);
      }

      _createClass(E, [{
        key: "range",
        value: function range(e, t, r, o) {
          return function (e, t, r, o, n, i, s) {
            var a = [0, e.length - 1, 0],
                l = [];
            var u, h;

            for (; a.length;) {
              var _c31 = a.pop(),
                  _f14 = a.pop(),
                  _p24 = a.pop();

              if (_f14 - _p24 <= s) {
                for (var _s106 = _p24; _s106 <= _f14; _s106++) {
                  u = t[2 * _s106], h = t[2 * _s106 + 1], u >= r && u <= n && h >= o && h <= i && l.push(e[_s106]);
                }

                continue;
              }

              var _g13 = Math.floor((_p24 + _f14) / 2);

              u = t[2 * _g13], h = t[2 * _g13 + 1], u >= r && u <= n && h >= o && h <= i && l.push(e[_g13]);

              var _d17 = (_c31 + 1) % 2;

              (0 === _c31 ? r <= u : o <= h) && (a.push(_p24), a.push(_g13 - 1), a.push(_d17)), (0 === _c31 ? n >= u : i >= h) && (a.push(_g13 + 1), a.push(_f14), a.push(_d17));
            }

            return l;
          }(this.ids, this.coords, e, t, r, o, this.nodeSize);
        }
      }, {
        key: "within",
        value: function within(e, t, r) {
          return function (e, t, r, o, n, i) {
            var s = [0, e.length - 1, 0],
                a = [],
                l = n * n;

            for (; s.length;) {
              var _u48 = s.pop(),
                  _h21 = s.pop(),
                  _c32 = s.pop();

              if (_h21 - _c32 <= i) {
                for (var _n148 = _c32; _n148 <= _h21; _n148++) {
                  C(t[2 * _n148], t[2 * _n148 + 1], r, o) <= l && a.push(e[_n148]);
                }

                continue;
              }

              var _f15 = Math.floor((_c32 + _h21) / 2),
                  _p25 = t[2 * _f15],
                  _g14 = t[2 * _f15 + 1];

              C(_p25, _g14, r, o) <= l && a.push(e[_f15]);

              var _d18 = (_u48 + 1) % 2;

              (0 === _u48 ? r - n <= _p25 : o - n <= _g14) && (s.push(_c32), s.push(_f15 - 1), s.push(_d18)), (0 === _u48 ? r + n >= _p25 : o + n >= _g14) && (s.push(_f15 + 1), s.push(_h21), s.push(_d18));
            }

            return a;
          }(this.ids, this.coords, e, t, r, this.nodeSize);
        }
      }]);

      return E;
    }();

    var F = {
      minZoom: 0,
      maxZoom: 16,
      minPoints: 2,
      radius: 40,
      extent: 512,
      nodeSize: 64,
      log: !1,
      generateId: !1,
      reduce: null,
      map: function map(e) {
        return e;
      }
    },
        N = Math.fround || (j = new Float32Array(1), function (e) {
      return j[0] = +e, j[0];
    });
    var j;

    var Z = /*#__PURE__*/function () {
      function Z(e) {
        _classCallCheck(this, Z);

        this.options = D(Object.create(F), e), this.trees = new Array(this.options.maxZoom + 1);
      }

      _createClass(Z, [{
        key: "load",
        value: function load(e) {
          var _this$options = this.options,
              t = _this$options.log,
              r = _this$options.minZoom,
              o = _this$options.maxZoom,
              n = _this$options.nodeSize;
          t && console.time("total time");
          var i = "prepare ".concat(e.length, " points");
          t && console.time(i), this.points = e;
          var s = [];

          for (var _t263 = 0; _t263 < e.length; _t263++) {
            e[_t263].geometry && s.push(J(e[_t263], _t263));
          }

          this.trees[o + 1] = new E(s, $, B, n, Float32Array), t && console.timeEnd(i);

          for (var _e245 = o; _e245 >= r; _e245--) {
            var _r207 = +Date.now();

            s = this._cluster(s, _e245), this.trees[_e245] = new E(s, $, B, n, Float32Array), t && console.log("z%d: %d clusters in %dms", _e245, s.length, +Date.now() - _r207);
          }

          return t && console.timeEnd("total time"), this;
        }
      }, {
        key: "getClusters",
        value: function getClusters(e, t) {
          var r = ((e[0] + 180) % 360 + 360) % 360 - 180;
          var o = Math.max(-90, Math.min(90, e[1]));
          var n = 180 === e[2] ? 180 : ((e[2] + 180) % 360 + 360) % 360 - 180;
          var i = Math.max(-90, Math.min(90, e[3]));
          if (e[2] - e[0] >= 360) r = -180, n = 180;else if (r > n) {
            var _e246 = this.getClusters([r, o, 180, i], t),
                _s107 = this.getClusters([-180, o, n, i], t);

            return _e246.concat(_s107);
          }

          var s = this.trees[this._limitZoom(t)],
              a = s.range(X(r), V(i), X(n), V(o)),
              l = [];

          var _iterator157 = _createForOfIteratorHelper(a),
              _step157;

          try {
            for (_iterator157.s(); !(_step157 = _iterator157.n()).done;) {
              var _e247 = _step157.value;
              var _t264 = s.points[_e247];
              l.push(_t264.numPoints ? W(_t264) : this.points[_t264.index]);
            }
          } catch (err) {
            _iterator157.e(err);
          } finally {
            _iterator157.f();
          }

          return l;
        }
      }, {
        key: "getChildren",
        value: function getChildren(e) {
          var t = this._getOriginId(e),
              r = this._getOriginZoom(e),
              o = "No cluster with the specified id.",
              n = this.trees[r];

          if (!n) throw new Error(o);
          var i = n.points[t];
          if (!i) throw new Error(o);
          var s = this.options.radius / (this.options.extent * Math.pow(2, r - 1)),
              a = n.within(i.x, i.y, s),
              l = [];

          var _iterator158 = _createForOfIteratorHelper(a),
              _step158;

          try {
            for (_iterator158.s(); !(_step158 = _iterator158.n()).done;) {
              var _t265 = _step158.value;
              var _r208 = n.points[_t265];
              _r208.parentId === e && l.push(_r208.numPoints ? W(_r208) : this.points[_r208.index]);
            }
          } catch (err) {
            _iterator158.e(err);
          } finally {
            _iterator158.f();
          }

          if (0 === l.length) throw new Error(o);
          return l;
        }
      }, {
        key: "getLeaves",
        value: function getLeaves(e, t, r) {
          var o = [];
          return this._appendLeaves(o, e, t = t || 10, r = r || 0, 0), o;
        }
      }, {
        key: "getTile",
        value: function getTile(e, t, r) {
          var o = this.trees[this._limitZoom(e)],
              n = Math.pow(2, e),
              _this$options2 = this.options,
              i = _this$options2.extent,
              s = _this$options2.radius,
              a = s / i,
              l = (r - a) / n,
              u = (r + 1 + a) / n,
              h = {
            features: []
          };

          return this._addTileFeatures(o.range((t - a) / n, l, (t + 1 + a) / n, u), o.points, t, r, n, h), 0 === t && this._addTileFeatures(o.range(1 - a / n, l, 1, u), o.points, n, r, n, h), t === n - 1 && this._addTileFeatures(o.range(0, l, a / n, u), o.points, -1, r, n, h), h.features.length ? h : null;
        }
      }, {
        key: "getClusterExpansionZoom",
        value: function getClusterExpansionZoom(e) {
          var t = this._getOriginZoom(e) - 1;

          for (; t <= this.options.maxZoom;) {
            var _r209 = this.getChildren(e);

            if (t++, 1 !== _r209.length) break;
            e = _r209[0].properties.cluster_id;
          }

          return t;
        }
      }, {
        key: "_appendLeaves",
        value: function _appendLeaves(e, t, r, o, n) {
          var i = this.getChildren(t);

          var _iterator159 = _createForOfIteratorHelper(i),
              _step159;

          try {
            for (_iterator159.s(); !(_step159 = _iterator159.n()).done;) {
              var _t266 = _step159.value;
              var _i144 = _t266.properties;
              if (_i144 && _i144.cluster ? n + _i144.point_count <= o ? n += _i144.point_count : n = this._appendLeaves(e, _i144.cluster_id, r, o, n) : n < o ? n++ : e.push(_t266), e.length === r) break;
            }
          } catch (err) {
            _iterator159.e(err);
          } finally {
            _iterator159.f();
          }

          return n;
        }
      }, {
        key: "_addTileFeatures",
        value: function _addTileFeatures(e, t, r, o, n, i) {
          var _iterator160 = _createForOfIteratorHelper(e),
              _step160;

          try {
            for (_iterator160.s(); !(_step160 = _iterator160.n()).done;) {
              var _s108 = _step160.value;
              var _e248 = t[_s108],
                  _a85 = _e248.numPoints;

              var _l53 = void 0,
                  _u49 = void 0,
                  _h22 = void 0;

              if (_a85) _l53 = Y(_e248), _u49 = _e248.x, _h22 = _e248.y;else {
                var _t267 = this.points[_e248.index];
                _l53 = _t267.properties, _u49 = X(_t267.geometry.coordinates[0]), _h22 = V(_t267.geometry.coordinates[1]);
              }
              var _c33 = {
                type: 1,
                geometry: [[Math.round(this.options.extent * (_u49 * n - r)), Math.round(this.options.extent * (_h22 * n - o))]],
                tags: _l53
              };

              var _f16 = void 0;

              _a85 ? _f16 = _e248.id : this.options.generateId ? _f16 = _e248.index : this.points[_e248.index].id && (_f16 = this.points[_e248.index].id), void 0 !== _f16 && (_c33.id = _f16), i.features.push(_c33);
            }
          } catch (err) {
            _iterator160.e(err);
          } finally {
            _iterator160.f();
          }
        }
      }, {
        key: "_limitZoom",
        value: function _limitZoom(e) {
          return Math.max(this.options.minZoom, Math.min(+e, this.options.maxZoom + 1));
        }
      }, {
        key: "_cluster",
        value: function _cluster(e, t) {
          var r = [],
              _this$options3 = this.options,
              o = _this$options3.radius,
              n = _this$options3.extent,
              i = _this$options3.reduce,
              s = _this$options3.minPoints,
              a = o / (n * Math.pow(2, t));

          for (var _o66 = 0; _o66 < e.length; _o66++) {
            var _n149 = e[_o66];
            if (_n149.zoom <= t) continue;
            _n149.zoom = t;

            var _l54 = this.trees[t + 1],
                _u50 = _l54.within(_n149.x, _n149.y, a),
                _h23 = _n149.numPoints || 1;

            var _c34 = _h23;

            var _iterator161 = _createForOfIteratorHelper(_u50),
                _step161;

            try {
              for (_iterator161.s(); !(_step161 = _iterator161.n()).done;) {
                var _e251 = _step161.value;
                var _r211 = _l54.points[_e251];
                _r211.zoom > t && (_c34 += _r211.numPoints || 1);
              }
            } catch (err) {
              _iterator161.e(err);
            } finally {
              _iterator161.f();
            }

            if (_c34 > _h23 && _c34 >= s) {
              var _e249 = _n149.x * _h23,
                  _s109 = _n149.y * _h23,
                  _a86 = i && _h23 > 1 ? this._map(_n149, !0) : null;

              var _f17 = (_o66 << 5) + (t + 1) + this.points.length;

              var _iterator162 = _createForOfIteratorHelper(_u50),
                  _step162;

              try {
                for (_iterator162.s(); !(_step162 = _iterator162.n()).done;) {
                  var _r210 = _step162.value;
                  var _o67 = _l54.points[_r210];
                  if (_o67.zoom <= t) continue;
                  _o67.zoom = t;

                  var _u51 = _o67.numPoints || 1;

                  _e249 += _o67.x * _u51, _s109 += _o67.y * _u51, _o67.parentId = _f17, i && (_a86 || (_a86 = this._map(_n149, !0)), i(_a86, this._map(_o67)));
                }
              } catch (err) {
                _iterator162.e(err);
              } finally {
                _iterator162.f();
              }

              _n149.parentId = _f17, r.push(G(_e249 / _c34, _s109 / _c34, _f17, _c34, _a86));
            } else if (r.push(_n149), _c34 > 1) {
              var _iterator163 = _createForOfIteratorHelper(_u50),
                  _step163;

              try {
                for (_iterator163.s(); !(_step163 = _iterator163.n()).done;) {
                  var _e250 = _step163.value;
                  var _o68 = _l54.points[_e250];
                  _o68.zoom <= t || (_o68.zoom = t, r.push(_o68));
                }
              } catch (err) {
                _iterator163.e(err);
              } finally {
                _iterator163.f();
              }
            }
          }

          return r;
        }
      }, {
        key: "_getOriginId",
        value: function _getOriginId(e) {
          return e - this.points.length >> 5;
        }
      }, {
        key: "_getOriginZoom",
        value: function _getOriginZoom(e) {
          return (e - this.points.length) % 32;
        }
      }, {
        key: "_map",
        value: function _map(e, t) {
          if (e.numPoints) return t ? D({}, e.properties) : e.properties;
          var r = this.points[e.index].properties,
              o = this.options.map(r);
          return t && o === r ? D({}, o) : o;
        }
      }]);

      return Z;
    }();

    function G(e, t, r, o, n) {
      return {
        x: N(e),
        y: N(t),
        zoom: 1 / 0,
        id: r,
        parentId: -1,
        numPoints: o,
        properties: n
      };
    }

    function J(e, t) {
      var _e$geometry$coordinat = _slicedToArray(e.geometry.coordinates, 2),
          r = _e$geometry$coordinat[0],
          o = _e$geometry$coordinat[1];

      return {
        x: N(X(r)),
        y: N(V(o)),
        zoom: 1 / 0,
        index: t,
        parentId: -1
      };
    }

    function W(e) {
      return {
        type: "Feature",
        id: e.id,
        properties: Y(e),
        geometry: {
          type: "Point",
          coordinates: [(t = e.x, 360 * (t - .5)), A(e.y)]
        }
      };
      var t;
    }

    function Y(e) {
      var t = e.numPoints,
          r = t >= 1e4 ? "".concat(Math.round(t / 1e3), "k") : t >= 1e3 ? Math.round(t / 100) / 10 + "k" : t;
      return D(D({}, e.properties), {
        cluster: !0,
        cluster_id: e.id,
        point_count: t,
        point_count_abbreviated: r
      });
    }

    function X(e) {
      return e / 360 + .5;
    }

    function V(e) {
      var t = Math.sin(e * Math.PI / 180),
          r = .5 - .25 * Math.log((1 + t) / (1 - t)) / Math.PI;
      return r < 0 ? 0 : r > 1 ? 1 : r;
    }

    function A(e) {
      var t = (180 - 360 * e) * Math.PI / 180;
      return 360 * Math.atan(Math.exp(t)) / Math.PI - 90;
    }

    function D(e, t) {
      for (var _r212 in t) {
        e[_r212] = t[_r212];
      }

      return e;
    }

    function $(e) {
      return e.x;
    }

    function B(e) {
      return e.y;
    }

    function R(e, t, r, o) {
      for (var n, i = o, s = r - t >> 1, a = r - t, l = e[t], u = e[t + 1], h = e[r], c = e[r + 1], f = t + 3; f < r; f += 3) {
        var p = q(e[f], e[f + 1], l, u, h, c);
        if (p > i) n = f, i = p;else if (p === i) {
          var g = Math.abs(f - s);
          g < a && (n = f, a = g);
        }
      }

      i > o && (n - t > 3 && R(e, t, n, o), e[n + 2] = i, r - n > 3 && R(e, n, r, o));
    }

    function q(e, t, r, o, n, i) {
      var s = n - r,
          a = i - o;

      if (0 !== s || 0 !== a) {
        var l = ((e - r) * s + (t - o) * a) / (s * s + a * a);
        l > 1 ? (r = n, o = i) : l > 0 && (r += s * l, o += a * l);
      }

      return (s = e - r) * s + (a = t - o) * a;
    }

    function U(e, t, r, o) {
      var n = {
        id: void 0 === e ? null : e,
        type: t,
        geometry: r,
        tags: o,
        minX: 1 / 0,
        minY: 1 / 0,
        maxX: -1 / 0,
        maxY: -1 / 0
      };
      return function (e) {
        var t = e.geometry,
            r = e.type;
        if ("Point" === r || "MultiPoint" === r || "LineString" === r) Q(e, t);else if ("Polygon" === r || "MultiLineString" === r) for (var o = 0; o < t.length; o++) {
          Q(e, t[o]);
        } else if ("MultiPolygon" === r) for (o = 0; o < t.length; o++) {
          for (var n = 0; n < t[o].length; n++) {
            Q(e, t[o][n]);
          }
        }
      }(n), n;
    }

    function Q(e, t) {
      for (var r = 0; r < t.length; r += 3) {
        e.minX = Math.min(e.minX, t[r]), e.minY = Math.min(e.minY, t[r + 1]), e.maxX = Math.max(e.maxX, t[r]), e.maxY = Math.max(e.maxY, t[r + 1]);
      }
    }

    function H(e, t, r, o) {
      if (t.geometry) {
        var n = t.geometry.coordinates,
            i = t.geometry.type,
            s = Math.pow(r.tolerance / ((1 << r.maxZoom) * r.extent), 2),
            a = [],
            l = t.id;
        if (r.promoteId ? l = t.properties[r.promoteId] : r.generateId && (l = o || 0), "Point" === i) K(n, a);else if ("MultiPoint" === i) for (var u = 0; u < n.length; u++) {
          K(n[u], a);
        } else if ("LineString" === i) ee(n, a, s, !1);else if ("MultiLineString" === i) {
          if (r.lineMetrics) {
            for (u = 0; u < n.length; u++) {
              ee(n[u], a = [], s, !1), e.push(U(l, "LineString", a, t.properties));
            }

            return;
          }

          te(n, a, s, !1);
        } else if ("Polygon" === i) te(n, a, s, !0);else {
          if ("MultiPolygon" !== i) {
            if ("GeometryCollection" === i) {
              for (u = 0; u < t.geometry.geometries.length; u++) {
                H(e, {
                  id: l,
                  geometry: t.geometry.geometries[u],
                  properties: t.properties
                }, r, o);
              }

              return;
            }

            throw new Error("Input data is not a valid GeoJSON object.");
          }

          for (u = 0; u < n.length; u++) {
            var h = [];
            te(n[u], h, s, !0), a.push(h);
          }
        }
        e.push(U(l, i, a, t.properties));
      }
    }

    function K(e, t) {
      t.push(re(e[0])), t.push(oe(e[1])), t.push(0);
    }

    function ee(e, t, r, o) {
      for (var n, i, s = 0, a = 0; a < e.length; a++) {
        var l = re(e[a][0]),
            u = oe(e[a][1]);
        t.push(l), t.push(u), t.push(0), a > 0 && (s += o ? (n * u - l * i) / 2 : Math.sqrt(Math.pow(l - n, 2) + Math.pow(u - i, 2))), n = l, i = u;
      }

      var h = t.length - 3;
      t[2] = 1, R(t, 0, h, r), t[h + 2] = 1, t.size = Math.abs(s), t.start = 0, t.end = t.size;
    }

    function te(e, t, r, o) {
      for (var n = 0; n < e.length; n++) {
        var i = [];
        ee(e[n], i, r, o), t.push(i);
      }
    }

    function re(e) {
      return e / 360 + .5;
    }

    function oe(e) {
      var t = Math.sin(e * Math.PI / 180),
          r = .5 - .25 * Math.log((1 + t) / (1 - t)) / Math.PI;
      return r < 0 ? 0 : r > 1 ? 1 : r;
    }

    function ne(e, t, r, o, n, i, s, a) {
      if (o /= t, i >= (r /= t) && s < o) return e;
      if (s < r || i >= o) return null;

      for (var l = [], u = 0; u < e.length; u++) {
        var h = e[u],
            c = h.geometry,
            f = h.type,
            p = 0 === n ? h.minX : h.minY,
            g = 0 === n ? h.maxX : h.maxY;
        if (p >= r && g < o) l.push(h);else if (!(g < r || p >= o)) {
          var d = [];
          if ("Point" === f || "MultiPoint" === f) ie(c, d, r, o, n);else if ("LineString" === f) se(c, d, r, o, n, !1, a.lineMetrics);else if ("MultiLineString" === f) le(c, d, r, o, n, !1);else if ("Polygon" === f) le(c, d, r, o, n, !0);else if ("MultiPolygon" === f) for (var m = 0; m < c.length; m++) {
            var y = [];
            le(c[m], y, r, o, n, !0), y.length && d.push(y);
          }

          if (d.length) {
            if (a.lineMetrics && "LineString" === f) {
              for (m = 0; m < d.length; m++) {
                l.push(U(h.id, f, d[m], h.tags));
              }

              continue;
            }

            "LineString" !== f && "MultiLineString" !== f || (1 === d.length ? (f = "LineString", d = d[0]) : f = "MultiLineString"), "Point" !== f && "MultiPoint" !== f || (f = 3 === d.length ? "Point" : "MultiPoint"), l.push(U(h.id, f, d, h.tags));
          }
        }
      }

      return l.length ? l : null;
    }

    function ie(e, t, r, o, n) {
      for (var i = 0; i < e.length; i += 3) {
        var s = e[i + n];
        s >= r && s <= o && (t.push(e[i]), t.push(e[i + 1]), t.push(e[i + 2]));
      }
    }

    function se(e, t, r, o, n, i, s) {
      for (var a, l, u = ae(e), h = 0 === n ? he : ce, c = e.start, f = 0; f < e.length - 3; f += 3) {
        var p = e[f],
            g = e[f + 1],
            d = e[f + 2],
            m = e[f + 3],
            y = e[f + 4],
            v = 0 === n ? p : g,
            x = 0 === n ? m : y,
            w = !1;
        s && (a = Math.sqrt(Math.pow(p - m, 2) + Math.pow(g - y, 2))), v < r ? x > r && (l = h(u, p, g, m, y, r), s && (u.start = c + a * l)) : v > o ? x < o && (l = h(u, p, g, m, y, o), s && (u.start = c + a * l)) : ue(u, p, g, d), x < r && v >= r && (l = h(u, p, g, m, y, r), w = !0), x > o && v <= o && (l = h(u, p, g, m, y, o), w = !0), !i && w && (s && (u.end = c + a * l), t.push(u), u = ae(e)), s && (c += a);
      }

      var S = e.length - 3;
      p = e[S], g = e[S + 1], d = e[S + 2], (v = 0 === n ? p : g) >= r && v <= o && ue(u, p, g, d), S = u.length - 3, i && S >= 3 && (u[S] !== u[0] || u[S + 1] !== u[1]) && ue(u, u[0], u[1], u[2]), u.length && t.push(u);
    }

    function ae(e) {
      var t = [];
      return t.size = e.size, t.start = e.start, t.end = e.end, t;
    }

    function le(e, t, r, o, n, i) {
      for (var s = 0; s < e.length; s++) {
        se(e[s], t, r, o, n, i, !1);
      }
    }

    function ue(e, t, r, o) {
      e.push(t), e.push(r), e.push(o);
    }

    function he(e, t, r, o, n, i) {
      var s = (i - t) / (o - t);
      return e.push(i), e.push(r + (n - r) * s), e.push(1), s;
    }

    function ce(e, t, r, o, n, i) {
      var s = (i - r) / (n - r);
      return e.push(t + (o - t) * s), e.push(i), e.push(1), s;
    }

    function fe(e, t) {
      for (var r = [], o = 0; o < e.length; o++) {
        var n,
            i = e[o],
            s = i.type;
        if ("Point" === s || "MultiPoint" === s || "LineString" === s) n = pe(i.geometry, t);else if ("MultiLineString" === s || "Polygon" === s) {
          n = [];

          for (var a = 0; a < i.geometry.length; a++) {
            n.push(pe(i.geometry[a], t));
          }
        } else if ("MultiPolygon" === s) for (n = [], a = 0; a < i.geometry.length; a++) {
          for (var l = [], u = 0; u < i.geometry[a].length; u++) {
            l.push(pe(i.geometry[a][u], t));
          }

          n.push(l);
        }
        r.push(U(i.id, s, n, i.tags));
      }

      return r;
    }

    function pe(e, t) {
      var r = [];
      r.size = e.size, void 0 !== e.start && (r.start = e.start, r.end = e.end);

      for (var o = 0; o < e.length; o += 3) {
        r.push(e[o] + t, e[o + 1], e[o + 2]);
      }

      return r;
    }

    function ge(e, t) {
      if (e.transformed) return e;
      var r,
          o,
          n,
          i = 1 << e.z,
          s = e.x,
          a = e.y;

      for (r = 0; r < e.features.length; r++) {
        var l = e.features[r],
            u = l.geometry,
            h = l.type;
        if (l.geometry = [], 1 === h) for (o = 0; o < u.length; o += 2) {
          l.geometry.push(de(u[o], u[o + 1], t, i, s, a));
        } else for (o = 0; o < u.length; o++) {
          var c = [];

          for (n = 0; n < u[o].length; n += 2) {
            c.push(de(u[o][n], u[o][n + 1], t, i, s, a));
          }

          l.geometry.push(c);
        }
      }

      return e.transformed = !0, e;
    }

    function de(e, t, r, o, n, i) {
      return [Math.round(r * (e * o - n)), Math.round(r * (t * o - i))];
    }

    function me(e, t, r, o, n) {
      for (var i = t === n.maxZoom ? 0 : n.tolerance / ((1 << t) * n.extent), s = {
        features: [],
        numPoints: 0,
        numSimplified: 0,
        numFeatures: 0,
        source: null,
        x: r,
        y: o,
        z: t,
        transformed: !1,
        minX: 2,
        minY: 1,
        maxX: -1,
        maxY: 0
      }, a = 0; a < e.length; a++) {
        s.numFeatures++, ye(s, e[a], i, n);
        var l = e[a].minX,
            u = e[a].minY,
            h = e[a].maxX,
            c = e[a].maxY;
        l < s.minX && (s.minX = l), u < s.minY && (s.minY = u), h > s.maxX && (s.maxX = h), c > s.maxY && (s.maxY = c);
      }

      return s;
    }

    function ye(e, t, r, o) {
      var n = t.geometry,
          i = t.type,
          s = [];
      if ("Point" === i || "MultiPoint" === i) for (var a = 0; a < n.length; a += 3) {
        s.push(n[a]), s.push(n[a + 1]), e.numPoints++, e.numSimplified++;
      } else if ("LineString" === i) ve(s, n, e, r, !1, !1);else if ("MultiLineString" === i || "Polygon" === i) for (a = 0; a < n.length; a++) {
        ve(s, n[a], e, r, "Polygon" === i, 0 === a);
      } else if ("MultiPolygon" === i) for (var l = 0; l < n.length; l++) {
        var u = n[l];

        for (a = 0; a < u.length; a++) {
          ve(s, u[a], e, r, !0, 0 === a);
        }
      }

      if (s.length) {
        var h = t.tags || null;

        if ("LineString" === i && o.lineMetrics) {
          for (var c in h = {}, t.tags) {
            h[c] = t.tags[c];
          }

          h.mapbox_clip_start = n.start / n.size, h.mapbox_clip_end = n.end / n.size;
        }

        var f = {
          geometry: s,
          type: "Polygon" === i || "MultiPolygon" === i ? 3 : "LineString" === i || "MultiLineString" === i ? 2 : 1,
          tags: h
        };
        null !== t.id && (f.id = t.id), e.features.push(f);
      }
    }

    function ve(e, t, r, o, n, i) {
      var s = o * o;
      if (o > 0 && t.size < (n ? s : o)) r.numPoints += t.length / 3;else {
        for (var a = [], l = 0; l < t.length; l += 3) {
          (0 === o || t[l + 2] > s) && (r.numSimplified++, a.push(t[l]), a.push(t[l + 1])), r.numPoints++;
        }

        n && function (e, t) {
          for (var r = 0, o = 0, n = e.length, i = n - 2; o < n; i = o, o += 2) {
            r += (e[o] - e[i]) * (e[o + 1] + e[i + 1]);
          }

          if (r > 0 === t) for (o = 0, n = e.length; o < n / 2; o += 2) {
            var s = e[o],
                a = e[o + 1];
            e[o] = e[n - 2 - o], e[o + 1] = e[n - 1 - o], e[n - 2 - o] = s, e[n - 1 - o] = a;
          }
        }(a, i), e.push(a);
      }
    }

    function xe(e, t) {
      var r = (t = this.options = function (e, t) {
        for (var r in t) {
          e[r] = t[r];
        }

        return e;
      }(Object.create(this.options), t)).debug;

      if (r && console.time("preprocess data"), t.maxZoom < 0 || t.maxZoom > 24) throw new Error("maxZoom should be in the 0-24 range");
      if (t.promoteId && t.generateId) throw new Error("promoteId and generateId cannot be used together.");

      var o = function (e, t) {
        var r = [];
        if ("FeatureCollection" === e.type) for (var o = 0; o < e.features.length; o++) {
          H(r, e.features[o], t, o);
        } else H(r, "Feature" === e.type ? e : {
          geometry: e
        }, t);
        return r;
      }(e, t);

      this.tiles = {}, this.tileCoords = [], r && (console.timeEnd("preprocess data"), console.log("index: maxZoom: %d, maxPoints: %d", t.indexMaxZoom, t.indexMaxPoints), console.time("generate tiles"), this.stats = {}, this.total = 0), (o = function (e, t) {
        var r = t.buffer / t.extent,
            o = e,
            n = ne(e, 1, -1 - r, r, 0, -1, 2, t),
            i = ne(e, 1, 1 - r, 2 + r, 0, -1, 2, t);
        return (n || i) && (o = ne(e, 1, -r, 1 + r, 0, -1, 2, t) || [], n && (o = fe(n, 1).concat(o)), i && (o = o.concat(fe(i, -1)))), o;
      }(o, t)).length && this.splitTile(o, 0, 0, 0), r && (o.length && console.log("features: %d, points: %d", this.tiles[0].numFeatures, this.tiles[0].numPoints), console.timeEnd("generate tiles"), console.log("tiles generated:", this.total, JSON.stringify(this.stats)));
    }

    function we(e, t, r) {
      return 32 * ((1 << e) * r + t) + e;
    }

    function Se(e, t) {
      var r = e.tileID.canonical;
      if (!this._geoJSONIndex) return t(null, null);

      var o = this._geoJSONIndex.getTile(r.z, r.x, r.y);

      if (!o) return t(null, null);
      var n = new c(o.features);
      var i = m(n);
      0 === i.byteOffset && i.byteLength === i.buffer.byteLength || (i = new Uint8Array(i)), t(null, {
        vectorTile: n,
        rawData: i.buffer
      });
    }

    xe.prototype.options = {
      maxZoom: 14,
      indexMaxZoom: 5,
      indexMaxPoints: 1e5,
      tolerance: 3,
      extent: 4096,
      buffer: 64,
      lineMetrics: !1,
      promoteId: null,
      generateId: !1,
      debug: 0
    }, xe.prototype.splitTile = function (e, t, r, o, n, i, s) {
      for (var a = [e, t, r, o], l = this.options, u = l.debug; a.length;) {
        o = a.pop(), r = a.pop(), t = a.pop(), e = a.pop();
        var h = 1 << t,
            c = we(t, r, o),
            f = this.tiles[c];

        if (!f && (u > 1 && console.time("creation"), f = this.tiles[c] = me(e, t, r, o, l), this.tileCoords.push({
          z: t,
          x: r,
          y: o
        }), u)) {
          u > 1 && (console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)", t, r, o, f.numFeatures, f.numPoints, f.numSimplified), console.timeEnd("creation"));
          var p = "z" + t;
          this.stats[p] = (this.stats[p] || 0) + 1, this.total++;
        }

        if (f.source = e, n) {
          if (t === l.maxZoom || t === n) continue;
          var g = 1 << n - t;
          if (r !== Math.floor(i / g) || o !== Math.floor(s / g)) continue;
        } else if (t === l.indexMaxZoom || f.numPoints <= l.indexMaxPoints) continue;

        if (f.source = null, 0 !== e.length) {
          u > 1 && console.time("clipping");
          var d,
              m,
              y,
              v,
              x,
              w,
              S = .5 * l.buffer / l.extent,
              M = .5 - S,
              P = .5 + S,
              b = 1 + S;
          d = m = y = v = null, x = ne(e, h, r - S, r + P, 0, f.minX, f.maxX, l), w = ne(e, h, r + M, r + b, 0, f.minX, f.maxX, l), e = null, x && (d = ne(x, h, o - S, o + P, 1, f.minY, f.maxY, l), m = ne(x, h, o + M, o + b, 1, f.minY, f.maxY, l), x = null), w && (y = ne(w, h, o - S, o + P, 1, f.minY, f.maxY, l), v = ne(w, h, o + M, o + b, 1, f.minY, f.maxY, l), w = null), u > 1 && console.timeEnd("clipping"), a.push(d || [], t + 1, 2 * r, 2 * o), a.push(m || [], t + 1, 2 * r, 2 * o + 1), a.push(y || [], t + 1, 2 * r + 1, 2 * o), a.push(v || [], t + 1, 2 * r + 1, 2 * o + 1);
        }
      }
    }, xe.prototype.getTile = function (e, t, r) {
      var o = this.options,
          n = o.extent,
          i = o.debug;
      if (e < 0 || e > 24) return null;
      var s = 1 << e,
          a = we(e, t = (t % s + s) % s, r);
      if (this.tiles[a]) return ge(this.tiles[a], n);
      i > 1 && console.log("drilling down to z%d-%d-%d", e, t, r);

      for (var l, u = e, h = t, c = r; !l && u > 0;) {
        u--, h = Math.floor(h / 2), c = Math.floor(c / 2), l = this.tiles[we(u, h, c)];
      }

      return l && l.source ? (i > 1 && console.log("found parent tile z%d-%d-%d", u, h, c), i > 1 && console.time("drilling down"), this.splitTile(l.source, u, h, c, e, t, r), i > 1 && console.timeEnd("drilling down"), this.tiles[a] ? ge(this.tiles[a], n) : null) : null;
    };

    var Me = /*#__PURE__*/function (_e$VectorTileWorkerSo) {
      _inherits(Me, _e$VectorTileWorkerSo);

      var _super69 = _createSuper(Me);

      function Me(e, t, r, o, n) {
        var _this56;

        _classCallCheck(this, Me);

        _this56 = _super69.call(this, e, t, r, o, Se), n && (_this56.loadGeoJSON = n);
        return _this56;
      }

      _createClass(Me, [{
        key: "loadData",
        value: function loadData(t, r) {
          var _this57 = this;

          var o = t && t.request,
              n = o && o.collectResourceTiming;
          this.loadGeoJSON(t, function (i, a) {
            if (i || !a) return r(i);
            if ("object" != _typeof(a)) return r(new Error("Input data given to '".concat(t.source, "' is not a valid GeoJSON object.")));
            {
              s(a, !0);

              try {
                if (t.filter) {
                  var _r213 = e.createExpression(t.filter, {
                    type: "boolean",
                    "property-type": "data-driven",
                    overridable: !1,
                    transition: !1
                  });

                  if ("error" === _r213.result) throw new Error(_r213.value.map(function (e) {
                    return "".concat(e.key, ": ").concat(e.message);
                  }).join(", "));

                  var _o69 = a.features.filter(function (e) {
                    return _r213.value.evaluate({
                      zoom: 0
                    }, e);
                  });

                  a = {
                    type: "FeatureCollection",
                    features: _o69
                  };
                }

                _this57._geoJSONIndex = t.cluster ? new Z(function (_ref166) {
                  var t = _ref166.superclusterOptions,
                      r = _ref166.clusterProperties;
                  if (!r || !t) return t;
                  var o = {},
                      n = {},
                      i = {
                    accumulated: null,
                    zoom: 0
                  },
                      s = {
                    properties: null
                  },
                      a = Object.keys(r);

                  for (var _i145 = 0, _a87 = a; _i145 < _a87.length; _i145++) {
                    var _t268 = _a87[_i145];

                    var _r$_t2 = _slicedToArray(r[_t268], 2),
                        _i146 = _r$_t2[0],
                        _s110 = _r$_t2[1],
                        _a88 = e.createExpression(_s110),
                        _l56 = e.createExpression("string" == typeof _i146 ? [_i146, ["accumulated"], ["get", _t268]] : _i146);

                    o[_t268] = _a88.value, n[_t268] = _l56.value;
                  }

                  return t.map = function (e) {
                    s.properties = e;
                    var t = {};

                    var _iterator164 = _createForOfIteratorHelper(a),
                        _step164;

                    try {
                      for (_iterator164.s(); !(_step164 = _iterator164.n()).done;) {
                        var _e252 = _step164.value;
                        t[_e252] = o[_e252].evaluate(i, s);
                      }
                    } catch (err) {
                      _iterator164.e(err);
                    } finally {
                      _iterator164.f();
                    }

                    return t;
                  }, t.reduce = function (e, t) {
                    s.properties = t;

                    var _iterator165 = _createForOfIteratorHelper(a),
                        _step165;

                    try {
                      for (_iterator165.s(); !(_step165 = _iterator165.n()).done;) {
                        var _t269 = _step165.value;
                        i.accumulated = e[_t269], e[_t269] = n[_t269].evaluate(i, s);
                      }
                    } catch (err) {
                      _iterator165.e(err);
                    } finally {
                      _iterator165.f();
                    }
                  }, t;
                }(t)).load(a.features) : function (e, t) {
                  return new xe(e, t);
                }(a, t.geojsonVtOptions);
              } catch (i) {
                return r(i);
              }

              _this57.loaded = {};
              var _l55 = {};

              if (n) {
                var _r214 = e.getPerformanceMeasurement(o);

                _r214 && (_l55.resourceTiming = {}, _l55.resourceTiming[t.source] = JSON.parse(JSON.stringify(_r214)));
              }

              r(null, _l55);
            }
          });
        }
      }, {
        key: "reloadTile",
        value: function reloadTile(e, t) {
          var r = this.loaded;
          return r && r[e.uid] ? _get(_getPrototypeOf(Me.prototype), "reloadTile", this).call(this, e, t) : this.loadTile(e, t);
        }
      }, {
        key: "loadGeoJSON",
        value: function loadGeoJSON(t, r) {
          if (t.request) e.getJSON(t.request, r);else {
            if ("string" != typeof t.data) return r(new Error("Input data given to '".concat(t.source, "' is not a valid GeoJSON object.")));

            try {
              return r(null, JSON.parse(t.data));
            } catch (e) {
              return r(new Error("Input data given to '".concat(t.source, "' is not a valid GeoJSON object.")));
            }
          }
        }
      }, {
        key: "getClusterExpansionZoom",
        value: function getClusterExpansionZoom(e, t) {
          try {
            t(null, this._geoJSONIndex.getClusterExpansionZoom(e.clusterId));
          } catch (e) {
            t(e);
          }
        }
      }, {
        key: "getClusterChildren",
        value: function getClusterChildren(e, t) {
          try {
            t(null, this._geoJSONIndex.getChildren(e.clusterId));
          } catch (e) {
            t(e);
          }
        }
      }, {
        key: "getClusterLeaves",
        value: function getClusterLeaves(e, t) {
          try {
            t(null, this._geoJSONIndex.getLeaves(e.clusterId, e.limit, e.offset));
          } catch (e) {
            t(e);
          }
        }
      }]);

      return Me;
    }(e.VectorTileWorkerSource);

    var Pe = /*#__PURE__*/function () {
      function Pe(t) {
        var _this58 = this;

        _classCallCheck(this, Pe);

        this.self = t, this.actor = new e.Actor(t, this), this.layerIndexes = {}, this.availableImages = {}, this.isSpriteLoaded = {}, this.projections = {}, this.defaultProjection = e.getProjection({
          name: "mercator"
        }), this.workerSourceTypes = {
          vector: e.VectorTileWorkerSource,
          geojson: Me
        }, this.workerSources = {}, this.demWorkerSources = {}, this.self.registerWorkerSource = function (e, t) {
          if (_this58.workerSourceTypes[e]) throw new Error("Worker source with name \"".concat(e, "\" already registered."));
          _this58.workerSourceTypes[e] = t;
        }, this.self.registerRTLTextPlugin = function (t) {
          if (e.plugin.isParsed()) throw new Error("RTL text plugin already registered.");
          e.plugin.applyArabicShaping = t.applyArabicShaping, e.plugin.processBidirectionalText = t.processBidirectionalText, e.plugin.processStyledBidirectionalText = t.processStyledBidirectionalText;
        };
      }

      _createClass(Pe, [{
        key: "clearCaches",
        value: function clearCaches(e, t, r) {
          delete this.layerIndexes[e], delete this.availableImages[e], delete this.workerSources[e], delete this.demWorkerSources[e], r();
        }
      }, {
        key: "checkIfReady",
        value: function checkIfReady(e, t, r) {
          r();
        }
      }, {
        key: "setReferrer",
        value: function setReferrer(e, t) {
          this.referrer = t;
        }
      }, {
        key: "spriteLoaded",
        value: function spriteLoaded(t, r) {
          this.isSpriteLoaded[t] = r;

          for (var _o70 in this.workerSources[t]) {
            var _n150 = this.workerSources[t][_o70];

            for (var _t270 in _n150) {
              _n150[_t270] instanceof e.VectorTileWorkerSource && (_n150[_t270].isSpriteLoaded = r, _n150[_t270].fire(new e.Event("isSpriteLoaded")));
            }
          }
        }
      }, {
        key: "setImages",
        value: function setImages(e, t, r) {
          this.availableImages[e] = t;

          for (var _r215 in this.workerSources[e]) {
            var _o71 = this.workerSources[e][_r215];

            for (var _e253 in _o71) {
              _o71[_e253].availableImages = t;
            }
          }

          r();
        }
      }, {
        key: "enableTerrain",
        value: function enableTerrain(e, t, r) {
          this.terrain = t, r();
        }
      }, {
        key: "setProjection",
        value: function setProjection(t, r) {
          this.projections[t] = e.getProjection(r);
        }
      }, {
        key: "setLayers",
        value: function setLayers(e, t, r) {
          this.getLayerIndex(e).replace(t), r();
        }
      }, {
        key: "updateLayers",
        value: function updateLayers(e, t, r) {
          this.getLayerIndex(e).update(t.layers, t.removedIds), r();
        }
      }, {
        key: "loadTile",
        value: function loadTile(t, r, o) {
          var n = this.enableTerrain ? e.extend({
            enableTerrain: this.terrain
          }, r) : r;
          n.projection = this.projections[t] || this.defaultProjection, this.getWorkerSource(t, r.type, r.source).loadTile(n, o);
        }
      }, {
        key: "loadDEMTile",
        value: function loadDEMTile(t, r, o) {
          var n = this.enableTerrain ? e.extend({
            buildQuadTree: this.terrain
          }, r) : r;
          this.getDEMWorkerSource(t, r.source).loadTile(n, o);
        }
      }, {
        key: "reloadTile",
        value: function reloadTile(t, r, o) {
          var n = this.enableTerrain ? e.extend({
            enableTerrain: this.terrain
          }, r) : r;
          n.projection = this.projections[t] || this.defaultProjection, this.getWorkerSource(t, r.type, r.source).reloadTile(n, o);
        }
      }, {
        key: "abortTile",
        value: function abortTile(e, t, r) {
          this.getWorkerSource(e, t.type, t.source).abortTile(t, r);
        }
      }, {
        key: "removeTile",
        value: function removeTile(e, t, r) {
          this.getWorkerSource(e, t.type, t.source).removeTile(t, r);
        }
      }, {
        key: "removeSource",
        value: function removeSource(e, t, r) {
          if (!this.workerSources[e] || !this.workerSources[e][t.type] || !this.workerSources[e][t.type][t.source]) return;
          var o = this.workerSources[e][t.type][t.source];
          delete this.workerSources[e][t.type][t.source], void 0 !== o.removeSource ? o.removeSource(t, r) : r();
        }
      }, {
        key: "loadWorkerSource",
        value: function loadWorkerSource(e, t, r) {
          try {
            this.self.importScripts(t.url), r();
          } catch (e) {
            r(e.toString());
          }
        }
      }, {
        key: "syncRTLPluginState",
        value: function syncRTLPluginState(t, r, o) {
          try {
            e.plugin.setState(r);

            var _t271 = e.plugin.getPluginURL();

            if (e.plugin.isLoaded() && !e.plugin.isParsed() && null != _t271) {
              this.self.importScripts(_t271);

              var _r216 = e.plugin.isParsed();

              o(_r216 ? void 0 : new Error("RTL Text Plugin failed to import scripts from ".concat(_t271)), _r216);
            }
          } catch (e) {
            o(e.toString());
          }
        }
      }, {
        key: "getAvailableImages",
        value: function getAvailableImages(e) {
          var t = this.availableImages[e];
          return t || (t = []), t;
        }
      }, {
        key: "getLayerIndex",
        value: function getLayerIndex(e) {
          var t = this.layerIndexes[e];
          return t || (t = this.layerIndexes[e] = new o()), t;
        }
      }, {
        key: "getWorkerSource",
        value: function getWorkerSource(e, t, r) {
          var _this59 = this;

          return this.workerSources[e] || (this.workerSources[e] = {}), this.workerSources[e][t] || (this.workerSources[e][t] = {}), this.workerSources[e][t][r] || (this.workerSources[e][t][r] = new this.workerSourceTypes[t]({
            send: function send(t, r, o, n, i, s) {
              _this59.actor.send(t, r, o, e, i, s);
            },
            scheduler: this.actor.scheduler
          }, this.getLayerIndex(e), this.getAvailableImages(e), this.isSpriteLoaded[e])), this.workerSources[e][t][r];
        }
      }, {
        key: "getDEMWorkerSource",
        value: function getDEMWorkerSource(e, t) {
          return this.demWorkerSources[e] || (this.demWorkerSources[e] = {}), this.demWorkerSources[e][t] || (this.demWorkerSources[e][t] = new i()), this.demWorkerSources[e][t];
        }
      }, {
        key: "enforceCacheSizeLimit",
        value: function enforceCacheSizeLimit(t, r) {
          e.enforceCacheSizeLimit(r);
        }
      }, {
        key: "getWorkerPerformanceMetrics",
        value: function getWorkerPerformanceMetrics(e, t, r) {
          r(void 0, void 0);
        }
      }]);

      return Pe;
    }();

    return "undefined" != typeof WorkerGlobalScope && "undefined" != typeof self && self instanceof WorkerGlobalScope && (self.worker = new Pe(self)), Pe;
  });
  define(["./shared"], function (e) {
    "use strict";

    var t = i;

    function i(e) {
      return !function (e) {
        return "undefined" == typeof window || "undefined" == typeof document ? "not a browser" : Array.prototype && Array.prototype.every && Array.prototype.filter && Array.prototype.forEach && Array.prototype.indexOf && Array.prototype.lastIndexOf && Array.prototype.map && Array.prototype.some && Array.prototype.reduce && Array.prototype.reduceRight && Array.isArray ? Function.prototype && Function.prototype.bind ? Object.keys && Object.create && Object.getPrototypeOf && Object.getOwnPropertyNames && Object.isSealed && Object.isFrozen && Object.isExtensible && Object.getOwnPropertyDescriptor && Object.defineProperty && Object.defineProperties && Object.seal && Object.freeze && Object.preventExtensions ? "JSON" in window && "parse" in JSON && "stringify" in JSON ? function () {
          if (!("Worker" in window && "Blob" in window && "URL" in window)) return !1;
          var e,
              t,
              i = new Blob([""], {
            type: "text/javascript"
          }),
              o = URL.createObjectURL(i);

          try {
            t = new Worker(o), e = !0;
          } catch (t) {
            e = !1;
          }

          return t && t.terminate(), URL.revokeObjectURL(o), e;
        }() ? "Uint8ClampedArray" in window ? ArrayBuffer.isView ? function () {
          var e = document.createElement("canvas");
          e.width = e.height = 1;
          var t = e.getContext("2d");
          if (!t) return !1;
          var i = t.getImageData(0, 0, 1, 1);
          return i && i.width === e.width;
        }() ? (void 0 === o[t = e && e.failIfMajorPerformanceCaveat] && (o[t] = function (e) {
          var t,
              o = function (e) {
            var t = document.createElement("canvas"),
                o = Object.create(i.webGLContextAttributes);
            return o.failIfMajorPerformanceCaveat = e, t.getContext("webgl", o) || t.getContext("experimental-webgl", o);
          }(e);

          if (!o) return !1;

          try {
            t = o.createShader(o.VERTEX_SHADER);
          } catch (e) {
            return !1;
          }

          return !(!t || o.isContextLost()) && (o.shaderSource(t, "void main() {}"), o.compileShader(t), !0 === o.getShaderParameter(t, o.COMPILE_STATUS));
        }(t)), o[t] ? document.documentMode ? "insufficient ECMAScript 6 support" : void 0 : "insufficient WebGL support") : "insufficient Canvas/getImageData support" : "insufficient ArrayBuffer support" : "insufficient Uint8ClampedArray support" : "insufficient worker support" : "insufficient JSON support" : "insufficient Object support" : "insufficient Function support" : "insufficent Array support";
        var t;
      }(e);
    }

    var o = {};

    function r(e, t) {
      var i = t[0],
          o = t[1],
          r = t[2],
          n = t[3],
          a = i * n - r * o;
      return a ? (e[0] = n * (a = 1 / a), e[1] = -o * a, e[2] = -r * a, e[3] = i * a, e) : null;
    }

    function n(e, t) {
      if (Array.isArray(e)) {
        if (!Array.isArray(t) || e.length !== t.length) return !1;

        for (var _i147 = 0; _i147 < e.length; _i147++) {
          if (!n(e[_i147], t[_i147])) return !1;
        }

        return !0;
      }

      if ("object" == _typeof(e) && null !== e && null !== t) {
        if ("object" != _typeof(t)) return !1;
        if (Object.keys(e).length !== Object.keys(t).length) return !1;

        for (var _i148 in e) {
          if (!n(e[_i148], t[_i148])) return !1;
        }

        return !0;
      }

      return e === t;
    }

    i.webGLContextAttributes = {
      antialias: !1,
      alpha: !0,
      stencil: !0,
      depth: !0
    };
    var a = {
      create: function create(t, i, o) {
        var r = e.window.document.createElement(t);
        return void 0 !== i && (r.className = i), o && o.appendChild(r), r;
      },
      createSVG: function createSVG(t, i, o) {
        var r = e.window.document.createElementNS("http://www.w3.org/2000/svg", t);

        for (var _i149 = 0, _Object$keys10 = Object.keys(i); _i149 < _Object$keys10.length; _i149++) {
          var _e254 = _Object$keys10[_i149];
          r.setAttributeNS(null, _e254, i[_e254]);
        }

        return o && o.appendChild(r), r;
      }
    },
        s = e.window.document && e.window.document.documentElement.style,
        l = s && void 0 !== s.userSelect ? "userSelect" : "WebkitUserSelect";
    var c;
    a.disableDrag = function () {
      s && l && (c = s[l], s[l] = "none");
    }, a.enableDrag = function () {
      s && l && (s[l] = c);
    };

    var h = function h(t) {
      t.preventDefault(), t.stopPropagation(), e.window.removeEventListener("click", h, !0);
    };

    function u(t, i, o) {
      var r = t.offsetWidth === i.width ? 1 : t.offsetWidth / i.width;
      return new e.pointGeometry((o.clientX - i.left) * r, (o.clientY - i.top) * r);
    }

    function _(e) {
      var t = e.userImage;
      return !!(t && t.render && t.render()) && (e.data.replace(new Uint8Array(t.data.buffer)), !0);
    }

    a.suppressClick = function () {
      e.window.addEventListener("click", h, !0), e.window.setTimeout(function () {
        e.window.removeEventListener("click", h, !0);
      }, 0);
    }, a.mousePos = function (e, t) {
      var i = e.getBoundingClientRect();
      return u(e, i, t);
    }, a.touchPos = function (e, t) {
      var i = e.getBoundingClientRect(),
          o = [];

      for (var _r217 = 0; _r217 < t.length; _r217++) {
        o.push(u(e, i, t[_r217]));
      }

      return o;
    }, a.mouseButton = function (t) {
      return void 0 !== e.window.InstallTrigger && 2 === t.button && t.ctrlKey && e.window.navigator.platform.toUpperCase().indexOf("MAC") >= 0 ? 0 : t.button;
    };

    var d = /*#__PURE__*/function (_e$Evented) {
      _inherits(d, _e$Evented);

      var _super70 = _createSuper(d);

      function d() {
        var _this60;

        _classCallCheck(this, d);

        _this60 = _super70.call(this), _this60.images = {}, _this60.updatedImages = {}, _this60.callbackDispatchedThisFrame = {}, _this60.loaded = !1, _this60.requestors = [], _this60.patterns = {}, _this60.atlasImage = new e.RGBAImage({
          width: 1,
          height: 1
        }), _this60.dirty = !0;
        return _this60;
      }

      _createClass(d, [{
        key: "isLoaded",
        value: function isLoaded() {
          return this.loaded;
        }
      }, {
        key: "setLoaded",
        value: function setLoaded(e) {
          if (this.loaded !== e && (this.loaded = e, e)) {
            var _iterator166 = _createForOfIteratorHelper(this.requestors),
                _step166;

            try {
              for (_iterator166.s(); !(_step166 = _iterator166.n()).done;) {
                var _ref168 = _step166.value;
                var _e255 = _ref168.ids;
                var _t272 = _ref168.callback;

                this._notify(_e255, _t272);
              }
            } catch (err) {
              _iterator166.e(err);
            } finally {
              _iterator166.f();
            }

            this.requestors = [];
          }
        }
      }, {
        key: "getImage",
        value: function getImage(e) {
          return this.images[e];
        }
      }, {
        key: "addImage",
        value: function addImage(e, t) {
          this._validate(e, t) && (this.images[e] = t);
        }
      }, {
        key: "_validate",
        value: function _validate(t, i) {
          var o = !0;
          return this._validateStretch(i.stretchX, i.data && i.data.width) || (this.fire(new e.ErrorEvent(new Error("Image \"".concat(t, "\" has invalid \"stretchX\" value")))), o = !1), this._validateStretch(i.stretchY, i.data && i.data.height) || (this.fire(new e.ErrorEvent(new Error("Image \"".concat(t, "\" has invalid \"stretchY\" value")))), o = !1), this._validateContent(i.content, i) || (this.fire(new e.ErrorEvent(new Error("Image \"".concat(t, "\" has invalid \"content\" value")))), o = !1), o;
        }
      }, {
        key: "_validateStretch",
        value: function _validateStretch(e, t) {
          if (!e) return !0;
          var i = 0;

          var _iterator167 = _createForOfIteratorHelper(e),
              _step167;

          try {
            for (_iterator167.s(); !(_step167 = _iterator167.n()).done;) {
              var _o72 = _step167.value;
              if (_o72[0] < i || _o72[1] < _o72[0] || t < _o72[1]) return !1;
              i = _o72[1];
            }
          } catch (err) {
            _iterator167.e(err);
          } finally {
            _iterator167.f();
          }

          return !0;
        }
      }, {
        key: "_validateContent",
        value: function _validateContent(e, t) {
          return !(e && (4 !== e.length || e[0] < 0 || t.data.width < e[0] || e[1] < 0 || t.data.height < e[1] || e[2] < 0 || t.data.width < e[2] || e[3] < 0 || t.data.height < e[3] || e[2] < e[0] || e[3] < e[1]));
        }
      }, {
        key: "updateImage",
        value: function updateImage(e, t) {
          t.version = this.images[e].version + 1, this.images[e] = t, this.updatedImages[e] = !0;
        }
      }, {
        key: "removeImage",
        value: function removeImage(e) {
          var t = this.images[e];
          delete this.images[e], delete this.patterns[e], t.userImage && t.userImage.onRemove && t.userImage.onRemove();
        }
      }, {
        key: "listImages",
        value: function listImages() {
          return Object.keys(this.images);
        }
      }, {
        key: "getImages",
        value: function getImages(e, t) {
          var i = !0;

          if (!this.isLoaded()) {
            var _iterator168 = _createForOfIteratorHelper(e),
                _step168;

            try {
              for (_iterator168.s(); !(_step168 = _iterator168.n()).done;) {
                var _t273 = _step168.value;
                this.images[_t273] || (i = !1);
              }
            } catch (err) {
              _iterator168.e(err);
            } finally {
              _iterator168.f();
            }
          }

          this.isLoaded() || i ? this._notify(e, t) : this.requestors.push({
            ids: e,
            callback: t
          });
        }
      }, {
        key: "_notify",
        value: function _notify(t, i) {
          var o = {};

          var _iterator169 = _createForOfIteratorHelper(t),
              _step169;

          try {
            for (_iterator169.s(); !(_step169 = _iterator169.n()).done;) {
              var _i150 = _step169.value;
              this.images[_i150] || this.fire(new e.Event("styleimagemissing", {
                id: _i150
              }));
              var _t274 = this.images[_i150];
              _t274 ? o[_i150] = {
                data: _t274.data.clone(),
                pixelRatio: _t274.pixelRatio,
                sdf: _t274.sdf,
                version: _t274.version,
                stretchX: _t274.stretchX,
                stretchY: _t274.stretchY,
                content: _t274.content,
                hasRenderCallback: Boolean(_t274.userImage && _t274.userImage.render)
              } : e.warnOnce("Image \"".concat(_i150, "\" could not be loaded. Please make sure you have added the image with map.addImage() or a \"sprite\" property in your style. You can provide missing images by listening for the \"styleimagemissing\" map event."));
            }
          } catch (err) {
            _iterator169.e(err);
          } finally {
            _iterator169.f();
          }

          i(null, o);
        }
      }, {
        key: "getPixelSize",
        value: function getPixelSize() {
          var _this$atlasImage = this.atlasImage,
              e = _this$atlasImage.width,
              t = _this$atlasImage.height;
          return {
            width: e,
            height: t
          };
        }
      }, {
        key: "getPattern",
        value: function getPattern(t) {
          var i = this.patterns[t],
              o = this.getImage(t);
          if (!o) return null;
          if (i && i.position.version === o.version) return i.position;
          if (i) i.position.version = o.version;else {
            var _i151 = {
              w: o.data.width + 2,
              h: o.data.height + 2,
              x: 0,
              y: 0
            },
                _r218 = new e.ImagePosition(_i151, o);

            this.patterns[t] = {
              bin: _i151,
              position: _r218
            };
          }
          return this._updatePatternAtlas(), this.patterns[t].position;
        }
      }, {
        key: "bind",
        value: function bind(t) {
          var i = t.gl;
          this.atlasTexture ? this.dirty && (this.atlasTexture.update(this.atlasImage), this.dirty = !1) : this.atlasTexture = new e.Texture(t, this.atlasImage, i.RGBA), this.atlasTexture.bind(i.LINEAR, i.CLAMP_TO_EDGE);
        }
      }, {
        key: "_updatePatternAtlas",
        value: function _updatePatternAtlas() {
          var t = [];

          for (var _e256 in this.patterns) {
            t.push(this.patterns[_e256].bin);
          }

          var _e$potpack = e.potpack(t),
              i = _e$potpack.w,
              o = _e$potpack.h,
              r = this.atlasImage;

          r.resize({
            width: i || 1,
            height: o || 1
          });

          for (var _t275 in this.patterns) {
            var _i152 = this.patterns[_t275].bin,
                _o73 = _i152.x + 1,
                _n151 = _i152.y + 1,
                _a89 = this.images[_t275].data,
                _s111 = _a89.width,
                _l57 = _a89.height;

            e.RGBAImage.copy(_a89, r, {
              x: 0,
              y: 0
            }, {
              x: _o73,
              y: _n151
            }, {
              width: _s111,
              height: _l57
            }), e.RGBAImage.copy(_a89, r, {
              x: 0,
              y: _l57 - 1
            }, {
              x: _o73,
              y: _n151 - 1
            }, {
              width: _s111,
              height: 1
            }), e.RGBAImage.copy(_a89, r, {
              x: 0,
              y: 0
            }, {
              x: _o73,
              y: _n151 + _l57
            }, {
              width: _s111,
              height: 1
            }), e.RGBAImage.copy(_a89, r, {
              x: _s111 - 1,
              y: 0
            }, {
              x: _o73 - 1,
              y: _n151
            }, {
              width: 1,
              height: _l57
            }), e.RGBAImage.copy(_a89, r, {
              x: 0,
              y: 0
            }, {
              x: _o73 + _s111,
              y: _n151
            }, {
              width: 1,
              height: _l57
            });
          }

          this.dirty = !0;
        }
      }, {
        key: "beginFrame",
        value: function beginFrame() {
          this.callbackDispatchedThisFrame = {};
        }
      }, {
        key: "dispatchRenderCallbacks",
        value: function dispatchRenderCallbacks(e) {
          var _iterator170 = _createForOfIteratorHelper(e),
              _step170;

          try {
            for (_iterator170.s(); !(_step170 = _iterator170.n()).done;) {
              var _t276 = _step170.value;
              if (this.callbackDispatchedThisFrame[_t276]) continue;
              this.callbackDispatchedThisFrame[_t276] = !0;
              var _e257 = this.images[_t276];
              _(_e257) && this.updateImage(_t276, _e257);
            }
          } catch (err) {
            _iterator170.e(err);
          } finally {
            _iterator170.f();
          }
        }
      }]);

      return d;
    }(e.Evented);

    var p = new e.Properties({
      anchor: new e.DataConstantProperty(e.spec.light.anchor),
      position: new ( /*#__PURE__*/function () {
        function _class17() {
          _classCallCheck(this, _class17);

          this.specification = e.spec.light.position;
        }

        _createClass(_class17, [{
          key: "possiblyEvaluate",
          value: function possiblyEvaluate(t, i) {
            return function (_ref169) {
              var _ref170 = _slicedToArray(_ref169, 3),
                  t = _ref170[0],
                  i = _ref170[1],
                  o = _ref170[2];

              var r = e.degToRad(i + 90),
                  n = e.degToRad(o);
              return {
                x: t * Math.cos(r) * Math.sin(n),
                y: t * Math.sin(r) * Math.sin(n),
                z: t * Math.cos(n),
                azimuthal: i,
                polar: o
              };
            }(t.expression.evaluate(i));
          }
        }, {
          key: "interpolate",
          value: function interpolate(t, i, o) {
            return {
              x: e.number(t.x, i.x, o),
              y: e.number(t.y, i.y, o),
              z: e.number(t.z, i.z, o),
              azimuthal: e.number(t.azimuthal, i.azimuthal, o),
              polar: e.number(t.polar, i.polar, o)
            };
          }
        }]);

        return _class17;
      }())(),
      color: new e.DataConstantProperty(e.spec.light.color),
      intensity: new e.DataConstantProperty(e.spec.light.intensity)
    }),
        m = "-transition";

    var f = /*#__PURE__*/function (_e$Evented2) {
      _inherits(f, _e$Evented2);

      var _super71 = _createSuper(f);

      function f(t) {
        var _this61;

        _classCallCheck(this, f);

        _this61 = _super71.call(this), _this61._transitionable = new e.Transitionable(p), _this61.setLight(t), _this61._transitioning = _this61._transitionable.untransitioned();
        return _this61;
      }

      _createClass(f, [{
        key: "getLight",
        value: function getLight() {
          return this._transitionable.serialize();
        }
      }, {
        key: "setLight",
        value: function setLight(t) {
          var i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
          if (!this._validate(e.validateLight, t, i)) for (var _i153 in t) {
            var _o74 = t[_i153];
            e.endsWith(_i153, m) ? this._transitionable.setTransition(_i153.slice(0, -m.length), _o74) : this._transitionable.setValue(_i153, _o74);
          }
        }
      }, {
        key: "updateTransitions",
        value: function updateTransitions(e) {
          this._transitioning = this._transitionable.transitioned(e, this._transitioning);
        }
      }, {
        key: "hasTransition",
        value: function hasTransition() {
          return this._transitioning.hasTransition();
        }
      }, {
        key: "recalculate",
        value: function recalculate(e) {
          this.properties = this._transitioning.possiblyEvaluate(e);
        }
      }, {
        key: "_validate",
        value: function _validate(t, i, o) {
          return (!o || !1 !== o.validate) && e.emitValidationErrors(this, t.call(e.validateStyle, e.extend({
            value: i,
            style: {
              glyphs: !0,
              sprite: !0
            },
            styleSpec: e.spec
          })));
        }
      }]);

      return f;
    }(e.Evented);

    var g = new e.Properties({
      source: new e.DataConstantProperty(e.spec.terrain.source),
      exaggeration: new e.DataConstantProperty(e.spec.terrain.exaggeration)
    }),
        v = "-transition";

    var x = /*#__PURE__*/function (_e$Evented3) {
      _inherits(x, _e$Evented3);

      var _super72 = _createSuper(x);

      function x(t, i) {
        var _this62;

        _classCallCheck(this, x);

        _this62 = _super72.call(this), _this62._transitionable = new e.Transitionable(g), _this62.set(t), _this62._transitioning = _this62._transitionable.untransitioned(), _this62.drapeRenderMode = i;
        return _this62;
      }

      _createClass(x, [{
        key: "get",
        value: function get() {
          return this._transitionable.serialize();
        }
      }, {
        key: "set",
        value: function set(t) {
          for (var _i154 in t) {
            var _o75 = t[_i154];
            e.endsWith(_i154, v) ? this._transitionable.setTransition(_i154.slice(0, -v.length), _o75) : this._transitionable.setValue(_i154, _o75);
          }
        }
      }, {
        key: "updateTransitions",
        value: function updateTransitions(e) {
          this._transitioning = this._transitionable.transitioned(e, this._transitioning);
        }
      }, {
        key: "hasTransition",
        value: function hasTransition() {
          return this._transitioning.hasTransition();
        }
      }, {
        key: "recalculate",
        value: function recalculate(e) {
          this.properties = this._transitioning.possiblyEvaluate(e);
        }
      }]);

      return x;
    }(e.Evented);

    function y(t, i, o, r) {
      var n = e.smoothstep(45, 65, o),
          _b9 = b(t, r),
          _b10 = _slicedToArray(_b9, 2),
          a = _b10[0],
          s = _b10[1],
          l = e.length(i);

      var c = 1 - Math.min(1, Math.exp((l - a) / (s - a) * -6));
      return c *= c * c, c = Math.min(1, 1.00747 * c), c * n * t.alpha;
    }

    function b(e, t) {
      var i = .5 / Math.tan(.5 * t);
      return [e.range[0] + i, e.range[1] + i];
    }

    var w = new e.Properties({
      range: new e.DataConstantProperty(e.spec.fog.range),
      color: new e.DataConstantProperty(e.spec.fog.color),
      "horizon-blend": new e.DataConstantProperty(e.spec.fog["horizon-blend"])
    }),
        T = "-transition";

    var E = /*#__PURE__*/function (_e$Evented4) {
      _inherits(E, _e$Evented4);

      var _super73 = _createSuper(E);

      function E(t, i) {
        var _this63;

        _classCallCheck(this, E);

        _this63 = _super73.call(this), _this63._transitionable = new e.Transitionable(w), _this63.set(t), _this63._transitioning = _this63._transitionable.untransitioned(), _this63._transform = i;
        return _this63;
      }

      _createClass(E, [{
        key: "state",
        get: function get() {
          return {
            range: this.properties.get("range"),
            horizonBlend: this.properties.get("horizon-blend"),
            alpha: this.properties.get("color").a
          };
        }
      }, {
        key: "get",
        value: function get() {
          return this._transitionable.serialize();
        }
      }, {
        key: "set",
        value: function set(t) {
          var i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
          if (!this._validate(e.validateFog, t, i)) for (var _i155 in t) {
            var _o76 = t[_i155];
            e.endsWith(_i155, T) ? this._transitionable.setTransition(_i155.slice(0, -T.length), _o76) : this._transitionable.setValue(_i155, _o76);
          }
        }
      }, {
        key: "getOpacity",
        value: function getOpacity(t) {
          if (!this._transform.projection.supportsFog) return 0;
          var i = this.properties && this.properties.get("color") || 1;
          return e.smoothstep(45, 65, t) * i.a;
        }
      }, {
        key: "getOpacityAtLatLng",
        value: function getOpacityAtLatLng(t, i) {
          return this._transform.projection.supportsFog ? function (t, i, o) {
            var r = e.MercatorCoordinate.fromLngLat(i),
                n = o.elevation ? o.elevation.getAtPointOrZero(r) : 0,
                a = [r.x, r.y, n];
            return e.transformMat4(a, a, o.mercatorFogMatrix), y(t, a, o.pitch, o._fov);
          }(this.state, t, i) : 0;
        }
      }, {
        key: "getFovAdjustedRange",
        value: function getFovAdjustedRange(e) {
          return this._transform.projection.supportsFog ? b(this.state, e) : [0, 1];
        }
      }, {
        key: "updateTransitions",
        value: function updateTransitions(e) {
          this._transitioning = this._transitionable.transitioned(e, this._transitioning);
        }
      }, {
        key: "hasTransition",
        value: function hasTransition() {
          return this._transitioning.hasTransition();
        }
      }, {
        key: "recalculate",
        value: function recalculate(e) {
          this.properties = this._transitioning.possiblyEvaluate(e);
        }
      }, {
        key: "_validate",
        value: function _validate(t, i, o) {
          return (!o || !1 !== o.validate) && e.emitValidationErrors(this, t.call(e.validateStyle, e.extend({
            value: i,
            style: {
              glyphs: !0,
              sprite: !0
            },
            styleSpec: e.spec
          })));
        }
      }]);

      return E;
    }(e.Evented);

    var C = /*#__PURE__*/function () {
      function C(t, i) {
        var _this64 = this;

        _classCallCheck(this, C);

        this.workerPool = t, this.actors = [], this.currentActor = 0, this.id = e.uniqueId();
        var o = this.workerPool.acquire(this.id);

        for (var _e258 = 0; _e258 < o.length; _e258++) {
          var _t277 = new C.Actor(o[_e258], i, this.id);

          _t277.name = "Worker ".concat(_e258), this.actors.push(_t277);
        }

        this.ready = !1, this.broadcast("checkIfReady", null, function () {
          _this64.ready = !0;
        });
      }

      _createClass(C, [{
        key: "broadcast",
        value: function broadcast(t, i, o) {
          e.asyncAll(this.actors, function (e, o) {
            e.send(t, i, o);
          }, o = o || function () {});
        }
      }, {
        key: "getActor",
        value: function getActor() {
          return this.currentActor = (this.currentActor + 1) % this.actors.length, this.actors[this.currentActor];
        }
      }, {
        key: "remove",
        value: function remove() {
          this.actors.forEach(function (e) {
            e.remove();
          }), this.actors = [], this.workerPool.release(this.id);
        }
      }]);

      return C;
    }();

    function M(t, i, o) {
      return i * (e.EXTENT / (t.tileSize * Math.pow(2, o - t.tileID.overscaledZ)));
    }

    C.Actor = e.Actor;

    var S = /*#__PURE__*/function () {
      function S(e, t, i) {
        _classCallCheck(this, S);

        this.context = e;
        var o = e.gl;
        this.buffer = o.createBuffer(), this.dynamicDraw = Boolean(i), this.context.unbindVAO(), e.bindElementBuffer.set(this.buffer), o.bufferData(o.ELEMENT_ARRAY_BUFFER, t.arrayBuffer, this.dynamicDraw ? o.DYNAMIC_DRAW : o.STATIC_DRAW), this.dynamicDraw || delete t.arrayBuffer;
      }

      _createClass(S, [{
        key: "bind",
        value: function bind() {
          this.context.bindElementBuffer.set(this.buffer);
        }
      }, {
        key: "updateData",
        value: function updateData(e) {
          var t = this.context.gl;
          this.context.unbindVAO(), this.bind(), t.bufferSubData(t.ELEMENT_ARRAY_BUFFER, 0, e.arrayBuffer);
        }
      }, {
        key: "destroy",
        value: function destroy() {
          this.buffer && (this.context.gl.deleteBuffer(this.buffer), delete this.buffer);
        }
      }]);

      return S;
    }();

    var I = {
      Int8: "BYTE",
      Uint8: "UNSIGNED_BYTE",
      Int16: "SHORT",
      Uint16: "UNSIGNED_SHORT",
      Int32: "INT",
      Uint32: "UNSIGNED_INT",
      Float32: "FLOAT"
    };

    var z = /*#__PURE__*/function () {
      function z(e, t, i, o) {
        _classCallCheck(this, z);

        this.length = t.length, this.attributes = i, this.itemSize = t.bytesPerElement, this.dynamicDraw = o, this.context = e;
        var r = e.gl;
        this.buffer = r.createBuffer(), e.bindVertexBuffer.set(this.buffer), r.bufferData(r.ARRAY_BUFFER, t.arrayBuffer, this.dynamicDraw ? r.DYNAMIC_DRAW : r.STATIC_DRAW), this.dynamicDraw || delete t.arrayBuffer;
      }

      _createClass(z, [{
        key: "bind",
        value: function bind() {
          this.context.bindVertexBuffer.set(this.buffer);
        }
      }, {
        key: "updateData",
        value: function updateData(e) {
          var t = this.context.gl;
          this.bind(), t.bufferSubData(t.ARRAY_BUFFER, 0, e.arrayBuffer);
        }
      }, {
        key: "enableAttributes",
        value: function enableAttributes(e, t) {
          for (var _i156 = 0; _i156 < this.attributes.length; _i156++) {
            var _o77 = t.attributes[this.attributes[_i156].name];
            void 0 !== _o77 && e.enableVertexAttribArray(_o77);
          }
        }
      }, {
        key: "setVertexAttribPointers",
        value: function setVertexAttribPointers(e, t, i) {
          for (var _o78 = 0; _o78 < this.attributes.length; _o78++) {
            var _r219 = this.attributes[_o78],
                _n152 = t.attributes[_r219.name];
            void 0 !== _n152 && e.vertexAttribPointer(_n152, _r219.components, e[I[_r219.type]], !1, this.itemSize, _r219.offset + this.itemSize * (i || 0));
          }
        }
      }, {
        key: "destroy",
        value: function destroy() {
          this.buffer && (this.context.gl.deleteBuffer(this.buffer), delete this.buffer);
        }
      }]);

      return z;
    }();

    var D = /*#__PURE__*/function () {
      function D(e) {
        _classCallCheck(this, D);

        this.gl = e.gl, this["default"] = this.getDefault(), this.current = this["default"], this.dirty = !1;
      }

      _createClass(D, [{
        key: "get",
        value: function get() {
          return this.current;
        }
      }, {
        key: "set",
        value: function set(e) {}
      }, {
        key: "getDefault",
        value: function getDefault() {
          return this["default"];
        }
      }, {
        key: "setDefault",
        value: function setDefault() {
          this.set(this["default"]);
        }
      }]);

      return D;
    }();

    var P = /*#__PURE__*/function (_D) {
      _inherits(P, _D);

      var _super74 = _createSuper(P);

      function P() {
        _classCallCheck(this, P);

        return _super74.apply(this, arguments);
      }

      _createClass(P, [{
        key: "getDefault",
        value: function getDefault() {
          return e.Color.transparent;
        }
      }, {
        key: "set",
        value: function set(e) {
          var t = this.current;
          (e.r !== t.r || e.g !== t.g || e.b !== t.b || e.a !== t.a || this.dirty) && (this.gl.clearColor(e.r, e.g, e.b, e.a), this.current = e, this.dirty = !1);
        }
      }]);

      return P;
    }(D);

    var A = /*#__PURE__*/function (_D2) {
      _inherits(A, _D2);

      var _super75 = _createSuper(A);

      function A() {
        _classCallCheck(this, A);

        return _super75.apply(this, arguments);
      }

      _createClass(A, [{
        key: "getDefault",
        value: function getDefault() {
          return 1;
        }
      }, {
        key: "set",
        value: function set(e) {
          (e !== this.current || this.dirty) && (this.gl.clearDepth(e), this.current = e, this.dirty = !1);
        }
      }]);

      return A;
    }(D);

    var L = /*#__PURE__*/function (_D3) {
      _inherits(L, _D3);

      var _super76 = _createSuper(L);

      function L() {
        _classCallCheck(this, L);

        return _super76.apply(this, arguments);
      }

      _createClass(L, [{
        key: "getDefault",
        value: function getDefault() {
          return 0;
        }
      }, {
        key: "set",
        value: function set(e) {
          (e !== this.current || this.dirty) && (this.gl.clearStencil(e), this.current = e, this.dirty = !1);
        }
      }]);

      return L;
    }(D);

    var R = /*#__PURE__*/function (_D4) {
      _inherits(R, _D4);

      var _super77 = _createSuper(R);

      function R() {
        _classCallCheck(this, R);

        return _super77.apply(this, arguments);
      }

      _createClass(R, [{
        key: "getDefault",
        value: function getDefault() {
          return [!0, !0, !0, !0];
        }
      }, {
        key: "set",
        value: function set(e) {
          var t = this.current;
          (e[0] !== t[0] || e[1] !== t[1] || e[2] !== t[2] || e[3] !== t[3] || this.dirty) && (this.gl.colorMask(e[0], e[1], e[2], e[3]), this.current = e, this.dirty = !1);
        }
      }]);

      return R;
    }(D);

    var k = /*#__PURE__*/function (_D5) {
      _inherits(k, _D5);

      var _super78 = _createSuper(k);

      function k() {
        _classCallCheck(this, k);

        return _super78.apply(this, arguments);
      }

      _createClass(k, [{
        key: "getDefault",
        value: function getDefault() {
          return !0;
        }
      }, {
        key: "set",
        value: function set(e) {
          (e !== this.current || this.dirty) && (this.gl.depthMask(e), this.current = e, this.dirty = !1);
        }
      }]);

      return k;
    }(D);

    var O = /*#__PURE__*/function (_D6) {
      _inherits(O, _D6);

      var _super79 = _createSuper(O);

      function O() {
        _classCallCheck(this, O);

        return _super79.apply(this, arguments);
      }

      _createClass(O, [{
        key: "getDefault",
        value: function getDefault() {
          return 255;
        }
      }, {
        key: "set",
        value: function set(e) {
          (e !== this.current || this.dirty) && (this.gl.stencilMask(e), this.current = e, this.dirty = !1);
        }
      }]);

      return O;
    }(D);

    var B = /*#__PURE__*/function (_D7) {
      _inherits(B, _D7);

      var _super80 = _createSuper(B);

      function B() {
        _classCallCheck(this, B);

        return _super80.apply(this, arguments);
      }

      _createClass(B, [{
        key: "getDefault",
        value: function getDefault() {
          return {
            func: this.gl.ALWAYS,
            ref: 0,
            mask: 255
          };
        }
      }, {
        key: "set",
        value: function set(e) {
          var t = this.current;
          (e.func !== t.func || e.ref !== t.ref || e.mask !== t.mask || this.dirty) && (this.gl.stencilFunc(e.func, e.ref, e.mask), this.current = e, this.dirty = !1);
        }
      }]);

      return B;
    }(D);

    var F = /*#__PURE__*/function (_D8) {
      _inherits(F, _D8);

      var _super81 = _createSuper(F);

      function F() {
        _classCallCheck(this, F);

        return _super81.apply(this, arguments);
      }

      _createClass(F, [{
        key: "getDefault",
        value: function getDefault() {
          var e = this.gl;
          return [e.KEEP, e.KEEP, e.KEEP];
        }
      }, {
        key: "set",
        value: function set(e) {
          var t = this.current;
          (e[0] !== t[0] || e[1] !== t[1] || e[2] !== t[2] || this.dirty) && (this.gl.stencilOp(e[0], e[1], e[2]), this.current = e, this.dirty = !1);
        }
      }]);

      return F;
    }(D);

    var U = /*#__PURE__*/function (_D9) {
      _inherits(U, _D9);

      var _super82 = _createSuper(U);

      function U() {
        _classCallCheck(this, U);

        return _super82.apply(this, arguments);
      }

      _createClass(U, [{
        key: "getDefault",
        value: function getDefault() {
          return !1;
        }
      }, {
        key: "set",
        value: function set(e) {
          if (e === this.current && !this.dirty) return;
          var t = this.gl;
          e ? t.enable(t.STENCIL_TEST) : t.disable(t.STENCIL_TEST), this.current = e, this.dirty = !1;
        }
      }]);

      return U;
    }(D);

    var N = /*#__PURE__*/function (_D10) {
      _inherits(N, _D10);

      var _super83 = _createSuper(N);

      function N() {
        _classCallCheck(this, N);

        return _super83.apply(this, arguments);
      }

      _createClass(N, [{
        key: "getDefault",
        value: function getDefault() {
          return [0, 1];
        }
      }, {
        key: "set",
        value: function set(e) {
          var t = this.current;
          (e[0] !== t[0] || e[1] !== t[1] || this.dirty) && (this.gl.depthRange(e[0], e[1]), this.current = e, this.dirty = !1);
        }
      }]);

      return N;
    }(D);

    var G = /*#__PURE__*/function (_D11) {
      _inherits(G, _D11);

      var _super84 = _createSuper(G);

      function G() {
        _classCallCheck(this, G);

        return _super84.apply(this, arguments);
      }

      _createClass(G, [{
        key: "getDefault",
        value: function getDefault() {
          return !1;
        }
      }, {
        key: "set",
        value: function set(e) {
          if (e === this.current && !this.dirty) return;
          var t = this.gl;
          e ? t.enable(t.DEPTH_TEST) : t.disable(t.DEPTH_TEST), this.current = e, this.dirty = !1;
        }
      }]);

      return G;
    }(D);

    var j = /*#__PURE__*/function (_D12) {
      _inherits(j, _D12);

      var _super85 = _createSuper(j);

      function j() {
        _classCallCheck(this, j);

        return _super85.apply(this, arguments);
      }

      _createClass(j, [{
        key: "getDefault",
        value: function getDefault() {
          return this.gl.LESS;
        }
      }, {
        key: "set",
        value: function set(e) {
          (e !== this.current || this.dirty) && (this.gl.depthFunc(e), this.current = e, this.dirty = !1);
        }
      }]);

      return j;
    }(D);

    var Z = /*#__PURE__*/function (_D13) {
      _inherits(Z, _D13);

      var _super86 = _createSuper(Z);

      function Z() {
        _classCallCheck(this, Z);

        return _super86.apply(this, arguments);
      }

      _createClass(Z, [{
        key: "getDefault",
        value: function getDefault() {
          return !1;
        }
      }, {
        key: "set",
        value: function set(e) {
          if (e === this.current && !this.dirty) return;
          var t = this.gl;
          e ? t.enable(t.BLEND) : t.disable(t.BLEND), this.current = e, this.dirty = !1;
        }
      }]);

      return Z;
    }(D);

    var V = /*#__PURE__*/function (_D14) {
      _inherits(V, _D14);

      var _super87 = _createSuper(V);

      function V() {
        _classCallCheck(this, V);

        return _super87.apply(this, arguments);
      }

      _createClass(V, [{
        key: "getDefault",
        value: function getDefault() {
          var e = this.gl;
          return [e.ONE, e.ZERO];
        }
      }, {
        key: "set",
        value: function set(e) {
          var t = this.current;
          (e[0] !== t[0] || e[1] !== t[1] || this.dirty) && (this.gl.blendFunc(e[0], e[1]), this.current = e, this.dirty = !1);
        }
      }]);

      return V;
    }(D);

    var W = /*#__PURE__*/function (_D15) {
      _inherits(W, _D15);

      var _super88 = _createSuper(W);

      function W() {
        _classCallCheck(this, W);

        return _super88.apply(this, arguments);
      }

      _createClass(W, [{
        key: "getDefault",
        value: function getDefault() {
          return e.Color.transparent;
        }
      }, {
        key: "set",
        value: function set(e) {
          var t = this.current;
          (e.r !== t.r || e.g !== t.g || e.b !== t.b || e.a !== t.a || this.dirty) && (this.gl.blendColor(e.r, e.g, e.b, e.a), this.current = e, this.dirty = !1);
        }
      }]);

      return W;
    }(D);

    var q = /*#__PURE__*/function (_D16) {
      _inherits(q, _D16);

      var _super89 = _createSuper(q);

      function q() {
        _classCallCheck(this, q);

        return _super89.apply(this, arguments);
      }

      _createClass(q, [{
        key: "getDefault",
        value: function getDefault() {
          return this.gl.FUNC_ADD;
        }
      }, {
        key: "set",
        value: function set(e) {
          (e !== this.current || this.dirty) && (this.gl.blendEquation(e), this.current = e, this.dirty = !1);
        }
      }]);

      return q;
    }(D);

    var X = /*#__PURE__*/function (_D17) {
      _inherits(X, _D17);

      var _super90 = _createSuper(X);

      function X() {
        _classCallCheck(this, X);

        return _super90.apply(this, arguments);
      }

      _createClass(X, [{
        key: "getDefault",
        value: function getDefault() {
          return !1;
        }
      }, {
        key: "set",
        value: function set(e) {
          if (e === this.current && !this.dirty) return;
          var t = this.gl;
          e ? t.enable(t.CULL_FACE) : t.disable(t.CULL_FACE), this.current = e, this.dirty = !1;
        }
      }]);

      return X;
    }(D);

    var $ = /*#__PURE__*/function (_D18) {
      _inherits($, _D18);

      var _super91 = _createSuper($);

      function $() {
        _classCallCheck(this, $);

        return _super91.apply(this, arguments);
      }

      _createClass($, [{
        key: "getDefault",
        value: function getDefault() {
          return this.gl.BACK;
        }
      }, {
        key: "set",
        value: function set(e) {
          (e !== this.current || this.dirty) && (this.gl.cullFace(e), this.current = e, this.dirty = !1);
        }
      }]);

      return $;
    }(D);

    var H = /*#__PURE__*/function (_D19) {
      _inherits(H, _D19);

      var _super92 = _createSuper(H);

      function H() {
        _classCallCheck(this, H);

        return _super92.apply(this, arguments);
      }

      _createClass(H, [{
        key: "getDefault",
        value: function getDefault() {
          return this.gl.CCW;
        }
      }, {
        key: "set",
        value: function set(e) {
          (e !== this.current || this.dirty) && (this.gl.frontFace(e), this.current = e, this.dirty = !1);
        }
      }]);

      return H;
    }(D);

    var K = /*#__PURE__*/function (_D20) {
      _inherits(K, _D20);

      var _super93 = _createSuper(K);

      function K() {
        _classCallCheck(this, K);

        return _super93.apply(this, arguments);
      }

      _createClass(K, [{
        key: "getDefault",
        value: function getDefault() {
          return null;
        }
      }, {
        key: "set",
        value: function set(e) {
          (e !== this.current || this.dirty) && (this.gl.useProgram(e), this.current = e, this.dirty = !1);
        }
      }]);

      return K;
    }(D);

    var Y = /*#__PURE__*/function (_D21) {
      _inherits(Y, _D21);

      var _super94 = _createSuper(Y);

      function Y() {
        _classCallCheck(this, Y);

        return _super94.apply(this, arguments);
      }

      _createClass(Y, [{
        key: "getDefault",
        value: function getDefault() {
          return this.gl.TEXTURE0;
        }
      }, {
        key: "set",
        value: function set(e) {
          (e !== this.current || this.dirty) && (this.gl.activeTexture(e), this.current = e, this.dirty = !1);
        }
      }]);

      return Y;
    }(D);

    var J = /*#__PURE__*/function (_D22) {
      _inherits(J, _D22);

      var _super95 = _createSuper(J);

      function J() {
        _classCallCheck(this, J);

        return _super95.apply(this, arguments);
      }

      _createClass(J, [{
        key: "getDefault",
        value: function getDefault() {
          var e = this.gl;
          return [0, 0, e.drawingBufferWidth, e.drawingBufferHeight];
        }
      }, {
        key: "set",
        value: function set(e) {
          var t = this.current;
          (e[0] !== t[0] || e[1] !== t[1] || e[2] !== t[2] || e[3] !== t[3] || this.dirty) && (this.gl.viewport(e[0], e[1], e[2], e[3]), this.current = e, this.dirty = !1);
        }
      }]);

      return J;
    }(D);

    var Q = /*#__PURE__*/function (_D23) {
      _inherits(Q, _D23);

      var _super96 = _createSuper(Q);

      function Q() {
        _classCallCheck(this, Q);

        return _super96.apply(this, arguments);
      }

      _createClass(Q, [{
        key: "getDefault",
        value: function getDefault() {
          return null;
        }
      }, {
        key: "set",
        value: function set(e) {
          if (e === this.current && !this.dirty) return;
          var t = this.gl;
          t.bindFramebuffer(t.FRAMEBUFFER, e), this.current = e, this.dirty = !1;
        }
      }]);

      return Q;
    }(D);

    var ee = /*#__PURE__*/function (_D24) {
      _inherits(ee, _D24);

      var _super97 = _createSuper(ee);

      function ee() {
        _classCallCheck(this, ee);

        return _super97.apply(this, arguments);
      }

      _createClass(ee, [{
        key: "getDefault",
        value: function getDefault() {
          return null;
        }
      }, {
        key: "set",
        value: function set(e) {
          if (e === this.current && !this.dirty) return;
          var t = this.gl;
          t.bindRenderbuffer(t.RENDERBUFFER, e), this.current = e, this.dirty = !1;
        }
      }]);

      return ee;
    }(D);

    var te = /*#__PURE__*/function (_D25) {
      _inherits(te, _D25);

      var _super98 = _createSuper(te);

      function te() {
        _classCallCheck(this, te);

        return _super98.apply(this, arguments);
      }

      _createClass(te, [{
        key: "getDefault",
        value: function getDefault() {
          return null;
        }
      }, {
        key: "set",
        value: function set(e) {
          if (e === this.current && !this.dirty) return;
          var t = this.gl;
          t.bindTexture(t.TEXTURE_2D, e), this.current = e, this.dirty = !1;
        }
      }]);

      return te;
    }(D);

    var ie = /*#__PURE__*/function (_D26) {
      _inherits(ie, _D26);

      var _super99 = _createSuper(ie);

      function ie() {
        _classCallCheck(this, ie);

        return _super99.apply(this, arguments);
      }

      _createClass(ie, [{
        key: "getDefault",
        value: function getDefault() {
          return null;
        }
      }, {
        key: "set",
        value: function set(e) {
          if (e === this.current && !this.dirty) return;
          var t = this.gl;
          t.bindBuffer(t.ARRAY_BUFFER, e), this.current = e, this.dirty = !1;
        }
      }]);

      return ie;
    }(D);

    var oe = /*#__PURE__*/function (_D27) {
      _inherits(oe, _D27);

      var _super100 = _createSuper(oe);

      function oe() {
        _classCallCheck(this, oe);

        return _super100.apply(this, arguments);
      }

      _createClass(oe, [{
        key: "getDefault",
        value: function getDefault() {
          return null;
        }
      }, {
        key: "set",
        value: function set(e) {
          var t = this.gl;
          t.bindBuffer(t.ELEMENT_ARRAY_BUFFER, e), this.current = e, this.dirty = !1;
        }
      }]);

      return oe;
    }(D);

    var re = /*#__PURE__*/function (_D28) {
      _inherits(re, _D28);

      var _super101 = _createSuper(re);

      function re(e) {
        var _this65;

        _classCallCheck(this, re);

        _this65 = _super101.call(this, e), _this65.vao = e.extVertexArrayObject;
        return _this65;
      }

      _createClass(re, [{
        key: "getDefault",
        value: function getDefault() {
          return null;
        }
      }, {
        key: "set",
        value: function set(e) {
          this.vao && (e !== this.current || this.dirty) && (this.vao.bindVertexArrayOES(e), this.current = e, this.dirty = !1);
        }
      }]);

      return re;
    }(D);

    var ne = /*#__PURE__*/function (_D29) {
      _inherits(ne, _D29);

      var _super102 = _createSuper(ne);

      function ne() {
        _classCallCheck(this, ne);

        return _super102.apply(this, arguments);
      }

      _createClass(ne, [{
        key: "getDefault",
        value: function getDefault() {
          return 4;
        }
      }, {
        key: "set",
        value: function set(e) {
          if (e === this.current && !this.dirty) return;
          var t = this.gl;
          t.pixelStorei(t.UNPACK_ALIGNMENT, e), this.current = e, this.dirty = !1;
        }
      }]);

      return ne;
    }(D);

    var ae = /*#__PURE__*/function (_D30) {
      _inherits(ae, _D30);

      var _super103 = _createSuper(ae);

      function ae() {
        _classCallCheck(this, ae);

        return _super103.apply(this, arguments);
      }

      _createClass(ae, [{
        key: "getDefault",
        value: function getDefault() {
          return !1;
        }
      }, {
        key: "set",
        value: function set(e) {
          if (e === this.current && !this.dirty) return;
          var t = this.gl;
          t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL, e), this.current = e, this.dirty = !1;
        }
      }]);

      return ae;
    }(D);

    var se = /*#__PURE__*/function (_D31) {
      _inherits(se, _D31);

      var _super104 = _createSuper(se);

      function se() {
        _classCallCheck(this, se);

        return _super104.apply(this, arguments);
      }

      _createClass(se, [{
        key: "getDefault",
        value: function getDefault() {
          return !1;
        }
      }, {
        key: "set",
        value: function set(e) {
          if (e === this.current && !this.dirty) return;
          var t = this.gl;
          t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL, e), this.current = e, this.dirty = !1;
        }
      }]);

      return se;
    }(D);

    var le = /*#__PURE__*/function (_D32) {
      _inherits(le, _D32);

      var _super105 = _createSuper(le);

      function le(e, t) {
        var _this66;

        _classCallCheck(this, le);

        _this66 = _super105.call(this, e), _this66.context = e, _this66.parent = t;
        return _this66;
      }

      _createClass(le, [{
        key: "getDefault",
        value: function getDefault() {
          return null;
        }
      }]);

      return le;
    }(D);

    var ce = /*#__PURE__*/function (_le) {
      _inherits(ce, _le);

      var _super106 = _createSuper(ce);

      function ce() {
        _classCallCheck(this, ce);

        return _super106.apply(this, arguments);
      }

      _createClass(ce, [{
        key: "setDirty",
        value: function setDirty() {
          this.dirty = !0;
        }
      }, {
        key: "set",
        value: function set(e) {
          if (e === this.current && !this.dirty) return;
          this.context.bindFramebuffer.set(this.parent);
          var t = this.gl;
          t.framebufferTexture2D(t.FRAMEBUFFER, t.COLOR_ATTACHMENT0, t.TEXTURE_2D, e, 0), this.current = e, this.dirty = !1;
        }
      }]);

      return ce;
    }(le);

    var he = /*#__PURE__*/function (_le2) {
      _inherits(he, _le2);

      var _super107 = _createSuper(he);

      function he() {
        _classCallCheck(this, he);

        return _super107.apply(this, arguments);
      }

      _createClass(he, [{
        key: "attachment",
        value: function attachment() {
          return this.gl.DEPTH_ATTACHMENT;
        }
      }, {
        key: "set",
        value: function set(e) {
          if (e === this.current && !this.dirty) return;
          this.context.bindFramebuffer.set(this.parent);
          var t = this.gl;
          t.framebufferRenderbuffer(t.FRAMEBUFFER, this.attachment(), t.RENDERBUFFER, e), this.current = e, this.dirty = !1;
        }
      }]);

      return he;
    }(le);

    var ue = /*#__PURE__*/function (_he) {
      _inherits(ue, _he);

      var _super108 = _createSuper(ue);

      function ue() {
        _classCallCheck(this, ue);

        return _super108.apply(this, arguments);
      }

      _createClass(ue, [{
        key: "attachment",
        value: function attachment() {
          return this.gl.DEPTH_STENCIL_ATTACHMENT;
        }
      }]);

      return ue;
    }(he);

    var _e = /*#__PURE__*/function () {
      function _e(e, t, i, o) {
        _classCallCheck(this, _e);

        this.context = e, this.width = t, this.height = i;
        var r = this.framebuffer = e.gl.createFramebuffer();
        this.colorAttachment = new ce(e, r), o && (this.depthAttachment = new he(e, r));
      }

      _createClass(_e, [{
        key: "destroy",
        value: function destroy() {
          var e = this.context.gl,
              t = this.colorAttachment.get();

          if (t && e.deleteTexture(t), this.depthAttachment) {
            var _t278 = this.depthAttachment.get();

            _t278 && e.deleteRenderbuffer(_t278);
          }

          e.deleteFramebuffer(this.framebuffer);
        }
      }]);

      return _e;
    }();

    var de = /*#__PURE__*/function () {
      function de(e) {
        _classCallCheck(this, de);

        this.gl = e, this.extVertexArrayObject = this.gl.getExtension("OES_vertex_array_object"), this.clearColor = new P(this), this.clearDepth = new A(this), this.clearStencil = new L(this), this.colorMask = new R(this), this.depthMask = new k(this), this.stencilMask = new O(this), this.stencilFunc = new B(this), this.stencilOp = new F(this), this.stencilTest = new U(this), this.depthRange = new N(this), this.depthTest = new G(this), this.depthFunc = new j(this), this.blend = new Z(this), this.blendFunc = new V(this), this.blendColor = new W(this), this.blendEquation = new q(this), this.cullFace = new X(this), this.cullFaceSide = new $(this), this.frontFace = new H(this), this.program = new K(this), this.activeTexture = new Y(this), this.viewport = new J(this), this.bindFramebuffer = new Q(this), this.bindRenderbuffer = new ee(this), this.bindTexture = new te(this), this.bindVertexBuffer = new ie(this), this.bindElementBuffer = new oe(this), this.bindVertexArrayOES = this.extVertexArrayObject && new re(this), this.pixelStoreUnpack = new ne(this), this.pixelStoreUnpackPremultiplyAlpha = new ae(this), this.pixelStoreUnpackFlipY = new se(this), this.extTextureFilterAnisotropic = e.getExtension("EXT_texture_filter_anisotropic") || e.getExtension("MOZ_EXT_texture_filter_anisotropic") || e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"), this.extTextureFilterAnisotropic && (this.extTextureFilterAnisotropicMax = e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)), this.extTextureFilterAnisotropicForceOff = !1, this.extTextureHalfFloat = e.getExtension("OES_texture_half_float"), this.extTextureHalfFloat && (e.getExtension("OES_texture_half_float_linear"), this.extRenderToTextureHalfFloat = e.getExtension("EXT_color_buffer_half_float")), this.extTimerQuery = e.getExtension("EXT_disjoint_timer_query"), this.maxTextureSize = e.getParameter(e.MAX_TEXTURE_SIZE);
      }

      _createClass(de, [{
        key: "setDefault",
        value: function setDefault() {
          this.unbindVAO(), this.clearColor.setDefault(), this.clearDepth.setDefault(), this.clearStencil.setDefault(), this.colorMask.setDefault(), this.depthMask.setDefault(), this.stencilMask.setDefault(), this.stencilFunc.setDefault(), this.stencilOp.setDefault(), this.stencilTest.setDefault(), this.depthRange.setDefault(), this.depthTest.setDefault(), this.depthFunc.setDefault(), this.blend.setDefault(), this.blendFunc.setDefault(), this.blendColor.setDefault(), this.blendEquation.setDefault(), this.cullFace.setDefault(), this.cullFaceSide.setDefault(), this.frontFace.setDefault(), this.program.setDefault(), this.activeTexture.setDefault(), this.bindFramebuffer.setDefault(), this.pixelStoreUnpack.setDefault(), this.pixelStoreUnpackPremultiplyAlpha.setDefault(), this.pixelStoreUnpackFlipY.setDefault();
        }
      }, {
        key: "setDirty",
        value: function setDirty() {
          this.clearColor.dirty = !0, this.clearDepth.dirty = !0, this.clearStencil.dirty = !0, this.colorMask.dirty = !0, this.depthMask.dirty = !0, this.stencilMask.dirty = !0, this.stencilFunc.dirty = !0, this.stencilOp.dirty = !0, this.stencilTest.dirty = !0, this.depthRange.dirty = !0, this.depthTest.dirty = !0, this.depthFunc.dirty = !0, this.blend.dirty = !0, this.blendFunc.dirty = !0, this.blendColor.dirty = !0, this.blendEquation.dirty = !0, this.cullFace.dirty = !0, this.cullFaceSide.dirty = !0, this.frontFace.dirty = !0, this.program.dirty = !0, this.activeTexture.dirty = !0, this.viewport.dirty = !0, this.bindFramebuffer.dirty = !0, this.bindRenderbuffer.dirty = !0, this.bindTexture.dirty = !0, this.bindVertexBuffer.dirty = !0, this.bindElementBuffer.dirty = !0, this.extVertexArrayObject && (this.bindVertexArrayOES.dirty = !0), this.pixelStoreUnpack.dirty = !0, this.pixelStoreUnpackPremultiplyAlpha.dirty = !0, this.pixelStoreUnpackFlipY.dirty = !0;
        }
      }, {
        key: "createIndexBuffer",
        value: function createIndexBuffer(e, t) {
          return new S(this, e, t);
        }
      }, {
        key: "createVertexBuffer",
        value: function createVertexBuffer(e, t, i) {
          return new z(this, e, t, i);
        }
      }, {
        key: "createRenderbuffer",
        value: function createRenderbuffer(e, t, i) {
          var o = this.gl,
              r = o.createRenderbuffer();
          return this.bindRenderbuffer.set(r), o.renderbufferStorage(o.RENDERBUFFER, e, t, i), this.bindRenderbuffer.set(null), r;
        }
      }, {
        key: "createFramebuffer",
        value: function createFramebuffer(e, t, i) {
          return new _e(this, e, t, i);
        }
      }, {
        key: "clear",
        value: function clear(_ref171) {
          var e = _ref171.color,
              t = _ref171.depth,
              i = _ref171.stencil;
          var o = this.gl;
          var r = 0;
          e && (r |= o.COLOR_BUFFER_BIT, this.clearColor.set(e), this.colorMask.set([!0, !0, !0, !0])), void 0 !== t && (r |= o.DEPTH_BUFFER_BIT, this.depthRange.set([0, 1]), this.clearDepth.set(t), this.depthMask.set(!0)), void 0 !== i && (r |= o.STENCIL_BUFFER_BIT, this.clearStencil.set(i), this.stencilMask.set(255)), o.clear(r);
        }
      }, {
        key: "setCullFace",
        value: function setCullFace(e) {
          !1 === e.enable ? this.cullFace.set(!1) : (this.cullFace.set(!0), this.cullFaceSide.set(e.mode), this.frontFace.set(e.frontFace));
        }
      }, {
        key: "setDepthMode",
        value: function setDepthMode(e) {
          e.func !== this.gl.ALWAYS || e.mask ? (this.depthTest.set(!0), this.depthFunc.set(e.func), this.depthMask.set(e.mask), this.depthRange.set(e.range)) : this.depthTest.set(!1);
        }
      }, {
        key: "setStencilMode",
        value: function setStencilMode(e) {
          e.test.func !== this.gl.ALWAYS || e.mask ? (this.stencilTest.set(!0), this.stencilMask.set(e.mask), this.stencilOp.set([e.fail, e.depthFail, e.pass]), this.stencilFunc.set({
            func: e.test.func,
            ref: e.ref,
            mask: e.test.mask
          })) : this.stencilTest.set(!1);
        }
      }, {
        key: "setColorMode",
        value: function setColorMode(t) {
          n(t.blendFunction, e.ColorMode.Replace) ? this.blend.set(!1) : (this.blend.set(!0), this.blendFunc.set(t.blendFunction), this.blendColor.set(t.blendColor)), this.colorMask.set(t.mask);
        }
      }, {
        key: "unbindVAO",
        value: function unbindVAO() {
          this.extVertexArrayObject && this.bindVertexArrayOES.set(null);
        }
      }]);

      return de;
    }();

    var pe = /*#__PURE__*/function () {
      function pe(e, t, i, o) {
        _classCallCheck(this, pe);

        this.screenBounds = e, this.cameraPoint = t, this._screenRaycastCache = {}, this._cameraRaycastCache = {}, this.isAboveHorizon = i, this.screenGeometry = this.bufferedScreenGeometry(0), this.screenGeometryMercator = this.screenGeometry.map(function (e) {
          return o.pointCoordinate3D(e);
        }), this.cameraGeometry = this.bufferedCameraGeometry(0);
      }

      _createClass(pe, [{
        key: "isPointQuery",
        value: function isPointQuery() {
          return 1 === this.screenBounds.length;
        }
      }, {
        key: "bufferedScreenGeometry",
        value: function bufferedScreenGeometry(t) {
          return e.polygonizeBounds(this.screenBounds[0], 1 === this.screenBounds.length ? this.screenBounds[0] : this.screenBounds[1], t);
        }
      }, {
        key: "bufferedCameraGeometry",
        value: function bufferedCameraGeometry(t) {
          var i = this.screenBounds[0],
              o = 1 === this.screenBounds.length ? this.screenBounds[0].add(new e.pointGeometry(1, 1)) : this.screenBounds[1],
              r = e.polygonizeBounds(i, o, 0, !1);
          return this.cameraPoint.y > o.y && (this.cameraPoint.x > i.x && this.cameraPoint.x < o.x ? r.splice(3, 0, this.cameraPoint) : this.cameraPoint.x >= o.x ? r[2] = this.cameraPoint : this.cameraPoint.x <= i.x && (r[3] = this.cameraPoint)), e.bufferConvexPolygon(r, t);
        }
      }, {
        key: "containsTile",
        value: function containsTile(t, i, o) {
          var r = t.queryPadding + 1,
              n = t.tileID.wrap,
              a = o ? this._bufferedCameraMercator(r, i).map(function (i) {
            return e.getTilePoint(t.tileTransform, i, n);
          }) : this._bufferedScreenMercator(r, i).map(function (i) {
            return e.getTilePoint(t.tileTransform, i, n);
          }),
              s = this.screenGeometryMercator.map(function (i) {
            return e.getTileVec3(t.tileTransform, i, n);
          }),
              l = s.map(function (t) {
            return new e.pointGeometry(t[0], t[1]);
          }),
              c = i.getFreeCameraOptions().position || new e.MercatorCoordinate(0, 0, 0),
              h = e.getTileVec3(t.tileTransform, c, n),
              u = s.map(function (t) {
            var i = e.sub(t, t, h);
            return e.normalize(i, i), new e.Ray(h, i);
          }),
              _ = M(t, 1, i.zoom);

          if (e.polygonIntersectsBox(a, 0, 0, e.EXTENT, e.EXTENT)) return {
            queryGeometry: this,
            tilespaceGeometry: l,
            tilespaceRays: u,
            bufferedTilespaceGeometry: a,
            bufferedTilespaceBounds: (d = e.getBounds(a), d.min.x = e.clamp(d.min.x, 0, e.EXTENT), d.min.y = e.clamp(d.min.y, 0, e.EXTENT), d.max.x = e.clamp(d.max.x, 0, e.EXTENT), d.max.y = e.clamp(d.max.y, 0, e.EXTENT), d),
            tile: t,
            tileID: t.tileID,
            pixelToTileUnitsFactor: _
          };
          var d;
        }
      }, {
        key: "_bufferedScreenMercator",
        value: function _bufferedScreenMercator(e, t) {
          var i = me(e);
          if (this._screenRaycastCache[i]) return this._screenRaycastCache[i];
          {
            var _o79 = this.bufferedScreenGeometry(e).map(function (e) {
              return t.pointCoordinate3D(e);
            });

            return this._screenRaycastCache[i] = _o79, _o79;
          }
        }
      }, {
        key: "_bufferedCameraMercator",
        value: function _bufferedCameraMercator(e, t) {
          var i = me(e);
          if (this._cameraRaycastCache[i]) return this._cameraRaycastCache[i];
          {
            var _o80 = this.bufferedCameraGeometry(e).map(function (e) {
              return t.pointCoordinate3D(e);
            });

            return this._cameraRaycastCache[i] = _o80, _o80;
          }
        }
      }], [{
        key: "createFromScreenPoints",
        value: function createFromScreenPoints(t, i) {
          var o, r;

          if (t instanceof e.pointGeometry || "number" == typeof t[0]) {
            var _n153 = e.pointGeometry.convert(t);

            o = [e.pointGeometry.convert(t)], r = i.isPointAboveHorizon(_n153);
          } else {
            var _n154 = e.pointGeometry.convert(t[0]),
                _a90 = e.pointGeometry.convert(t[1]);

            o = [_n154, _a90], r = e.polygonizeBounds(_n154, _a90).every(function (e) {
              return i.isPointAboveHorizon(e);
            });
          }

          return new pe(o, i.getCameraPoint(), r, i);
        }
      }]);

      return pe;
    }();

    function me(e) {
      return 100 * e | 0;
    }

    function fe(t, i, o) {
      var r = function r(_r221, n) {
        if (_r221) return o(_r221);

        if (n) {
          var _r220 = e.pick(e.extend(n, t), ["tiles", "minzoom", "maxzoom", "attribution", "mapbox_logo", "bounds", "scheme", "tileSize", "encoding"]);

          n.vector_layers && (_r220.vectorLayers = n.vector_layers, _r220.vectorLayerIds = _r220.vectorLayers.map(function (e) {
            return e.id;
          })), _r220.tiles = i.canonicalizeTileset(_r220, t.url), o(null, _r220);
        }
      };

      return t.url ? e.getJSON(i.transformRequest(i.normalizeSourceURL(t.url), e.ResourceType.Source), r) : e.exported.frame(function () {
        return r(null, t);
      });
    }

    var ge = /*#__PURE__*/function () {
      function ge(t, i, o) {
        _classCallCheck(this, ge);

        this.bounds = e.LngLatBounds.convert(this.validateBounds(t)), this.minzoom = i || 0, this.maxzoom = o || 24;
      }

      _createClass(ge, [{
        key: "validateBounds",
        value: function validateBounds(e) {
          return Array.isArray(e) && 4 === e.length ? [Math.max(-180, e[0]), Math.max(-90, e[1]), Math.min(180, e[2]), Math.min(90, e[3])] : [-180, -90, 180, 90];
        }
      }, {
        key: "contains",
        value: function contains(t) {
          var i = Math.pow(2, t.z),
              o = Math.floor(e.mercatorXfromLng(this.bounds.getWest()) * i),
              r = Math.floor(e.mercatorYfromLat(this.bounds.getNorth()) * i),
              n = Math.ceil(e.mercatorXfromLng(this.bounds.getEast()) * i),
              a = Math.ceil(e.mercatorYfromLat(this.bounds.getSouth()) * i);
          return t.x >= o && t.x < n && t.y >= r && t.y < a;
        }
      }]);

      return ge;
    }();

    var ve = /*#__PURE__*/function (_e$Evented5) {
      _inherits(ve, _e$Evented5);

      var _super109 = _createSuper(ve);

      function ve(t, i, o, r) {
        var _this67;

        _classCallCheck(this, ve);

        _this67 = _super109.call(this), _this67.id = t, _this67.dispatcher = o, _this67.setEventedParent(r), _this67.type = "raster", _this67.minzoom = 0, _this67.maxzoom = 22, _this67.roundZoom = !0, _this67.scheme = "xyz", _this67.tileSize = 512, _this67._loaded = !1, _this67._options = e.extend({
          type: "raster"
        }, i), e.extend(_assertThisInitialized(_this67), e.pick(i, ["url", "scheme", "tileSize"]));
        return _this67;
      }

      _createClass(ve, [{
        key: "load",
        value: function load() {
          var _this68 = this;

          this._loaded = !1, this.fire(new e.Event("dataloading", {
            dataType: "source"
          })), this._tileJSONRequest = fe(this._options, this.map._requestManager, function (t, i) {
            _this68._tileJSONRequest = null, _this68._loaded = !0, t ? _this68.fire(new e.ErrorEvent(t)) : i && (e.extend(_this68, i), i.bounds && (_this68.tileBounds = new ge(i.bounds, _this68.minzoom, _this68.maxzoom)), e.postTurnstileEvent(i.tiles), _this68.fire(new e.Event("data", {
              dataType: "source",
              sourceDataType: "metadata"
            })), _this68.fire(new e.Event("data", {
              dataType: "source",
              sourceDataType: "content"
            })));
          });
        }
      }, {
        key: "loaded",
        value: function loaded() {
          return this._loaded;
        }
      }, {
        key: "onAdd",
        value: function onAdd(e) {
          this.map = e, this.load();
        }
      }, {
        key: "onRemove",
        value: function onRemove() {
          this._tileJSONRequest && (this._tileJSONRequest.cancel(), this._tileJSONRequest = null);
        }
      }, {
        key: "serialize",
        value: function serialize() {
          return e.extend({}, this._options);
        }
      }, {
        key: "hasTile",
        value: function hasTile(e) {
          return !this.tileBounds || this.tileBounds.contains(e.canonical);
        }
      }, {
        key: "loadTile",
        value: function loadTile(t, i) {
          var _this69 = this;

          var o = e.exported.devicePixelRatio >= 2,
              r = this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles, this.scheme), o, this.tileSize);

          t.request = e.getImage(this.map._requestManager.transformRequest(r, e.ResourceType.Tile), function (o, r, n, a) {
            if (delete t.request, t.aborted) t.state = "unloaded", i(null);else if (o) t.state = "errored", i(o);else if (r) {
              _this69.map._refreshExpiredTiles && t.setExpiryData({
                cacheControl: n,
                expires: a
              });
              var _o81 = _this69.map.painter.context,
                  _s112 = _o81.gl;
              t.texture = _this69.map.painter.getTileTexture(r.width), t.texture ? t.texture.update(r, {
                useMipmap: !0
              }) : (t.texture = new e.Texture(_o81, r, _s112.RGBA, {
                useMipmap: !0
              }), t.texture.bind(_s112.LINEAR, _s112.CLAMP_TO_EDGE), _o81.extTextureFilterAnisotropic && _s112.texParameterf(_s112.TEXTURE_2D, _o81.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT, _o81.extTextureFilterAnisotropicMax)), t.state = "loaded", e.cacheEntryPossiblyAdded(_this69.dispatcher), i(null);
            }
          });
        }
      }, {
        key: "abortTile",
        value: function abortTile(e, t) {
          e.request && (e.request.cancel(), delete e.request), t();
        }
      }, {
        key: "unloadTile",
        value: function unloadTile(e, t) {
          e.texture && this.map.painter.saveTileTexture(e.texture), t();
        }
      }, {
        key: "hasTransition",
        value: function hasTransition() {
          return !1;
        }
      }]);

      return ve;
    }(e.Evented);

    var xe;

    function ye(t, i, o, r, n, a, s, l) {
      var c = [t, o, n, i, r, a, 1, 1, 1],
          h = [s, l, 1],
          u = e.adjoint([], c),
          _e$transformMat = e.transformMat3(h, h, e.transpose(u, u)),
          _e$transformMat2 = _slicedToArray(_e$transformMat, 3),
          _ = _e$transformMat2[0],
          d = _e$transformMat2[1],
          p = _e$transformMat2[2];

      return e.multiply(c, [_, 0, 0, 0, d, 0, 0, 0, p], c);
    }

    var be = /*#__PURE__*/function (_e$Evented6) {
      _inherits(be, _e$Evented6);

      var _super110 = _createSuper(be);

      function be(e, t, i, o) {
        var _this70;

        _classCallCheck(this, be);

        _this70 = _super110.call(this), _this70.id = e, _this70.dispatcher = i, _this70.coordinates = t.coordinates, _this70.type = "image", _this70.minzoom = 0, _this70.maxzoom = 22, _this70.tileSize = 512, _this70.tiles = {}, _this70._loaded = !1, _this70.setEventedParent(o), _this70.options = t;
        return _this70;
      }

      _createClass(be, [{
        key: "load",
        value: function load(t, i) {
          var _this71 = this;

          this._loaded = !1, this.fire(new e.Event("dataloading", {
            dataType: "source"
          })), this.url = this.options.url, e.getImage(this.map._requestManager.transformRequest(this.url, e.ResourceType.Image), function (o, r) {
            _this71._loaded = !0, o ? _this71.fire(new e.ErrorEvent(o)) : r && (_this71.image = e.exported.getImageData(r), _this71.width = _this71.image.width, _this71.height = _this71.image.height, t && (_this71.coordinates = t), i && i(), _this71._finishLoading());
          });
        }
      }, {
        key: "loaded",
        value: function loaded() {
          return this._loaded;
        }
      }, {
        key: "updateImage",
        value: function updateImage(e) {
          var _this72 = this;

          return this.image && e.url ? (this.options.url = e.url, this.load(e.coordinates, function () {
            _this72.texture = null;
          }), this) : this;
        }
      }, {
        key: "_finishLoading",
        value: function _finishLoading() {
          this.map && (this.setCoordinates(this.coordinates), this.fire(new e.Event("data", {
            dataType: "source",
            sourceDataType: "metadata"
          })));
        }
      }, {
        key: "onAdd",
        value: function onAdd(e) {
          this.map = e, this.load();
        }
      }, {
        key: "setCoordinates",
        value: function setCoordinates(t) {
          this.coordinates = t, delete this._boundsArray;
          var i = t.map(e.MercatorCoordinate.fromLngLat);
          return this.tileID = function (t) {
            var i = 1 / 0,
                o = 1 / 0,
                r = -1 / 0,
                n = -1 / 0;

            var _iterator171 = _createForOfIteratorHelper(t),
                _step171;

            try {
              for (_iterator171.s(); !(_step171 = _iterator171.n()).done;) {
                var _e259 = _step171.value;
                i = Math.min(i, _e259.x), o = Math.min(o, _e259.y), r = Math.max(r, _e259.x), n = Math.max(n, _e259.y);
              }
            } catch (err) {
              _iterator171.e(err);
            } finally {
              _iterator171.f();
            }

            var a = Math.max(r - i, n - o),
                s = Math.max(0, Math.floor(-Math.log(a) / Math.LN2)),
                l = Math.pow(2, s);
            return new e.CanonicalTileID(s, Math.floor((i + r) / 2 * l), Math.floor((o + n) / 2 * l));
          }(i), this.minzoom = this.maxzoom = this.tileID.z, this.fire(new e.Event("data", {
            dataType: "source",
            sourceDataType: "content"
          })), this;
        }
      }, {
        key: "_clear",
        value: function _clear() {
          delete this._boundsArray;
        }
      }, {
        key: "_makeBoundsArray",
        value: function _makeBoundsArray() {
          var t = e.tileTransform(this.tileID, this.map.transform.projection),
              _this$coordinates$map = this.coordinates.map(function (i) {
            var o = t.projection.project(i[0], i[1]);
            return e.getTilePoint(t, o)._round();
          }),
              _this$coordinates$map2 = _slicedToArray(_this$coordinates$map, 4),
              i = _this$coordinates$map2[0],
              o = _this$coordinates$map2[1],
              r = _this$coordinates$map2[2],
              n = _this$coordinates$map2[3];

          return this.perspectiveTransform = function (t, i, o, r, n, a, s, l, c, h) {
            var u = ye(0, 0, t, 0, 0, i, t, i),
                _ = ye(o, r, n, a, s, l, c, h);

            return e.multiply(_, e.adjoint(u, u), _), [_[6] / _[8] * t / e.EXTENT, _[7] / _[8] * i / e.EXTENT];
          }(this.width, this.height, i.x, i.y, o.x, o.y, n.x, n.y, r.x, r.y), this._boundsArray = new e.StructArrayLayout4i8(), this._boundsArray.emplaceBack(i.x, i.y, 0, 0), this._boundsArray.emplaceBack(o.x, o.y, e.EXTENT, 0), this._boundsArray.emplaceBack(n.x, n.y, 0, e.EXTENT), this._boundsArray.emplaceBack(r.x, r.y, e.EXTENT, e.EXTENT), this.boundsBuffer && (this.boundsBuffer.destroy(), delete this.boundsBuffer), this;
        }
      }, {
        key: "prepare",
        value: function prepare() {
          if (0 === Object.keys(this.tiles).length || !this.image) return;
          var t = this.map.painter.context,
              i = t.gl;
          this._boundsArray || this._makeBoundsArray(), this.boundsBuffer || (this.boundsBuffer = t.createVertexBuffer(this._boundsArray, e.boundsAttributes.members)), this.boundsSegments || (this.boundsSegments = e.SegmentVector.simpleSegment(0, 0, 4, 2)), this.texture || (this.texture = new e.Texture(t, this.image, i.RGBA), this.texture.bind(i.LINEAR, i.CLAMP_TO_EDGE));

          for (var _e260 in this.tiles) {
            var _t279 = this.tiles[_e260];
            "loaded" !== _t279.state && (_t279.state = "loaded", _t279.texture = this.texture);
          }
        }
      }, {
        key: "loadTile",
        value: function loadTile(e, t) {
          this.tileID && this.tileID.equals(e.tileID.canonical) ? (this.tiles[String(e.tileID.wrap)] = e, e.buckets = {}, t(null)) : (e.state = "errored", t(null));
        }
      }, {
        key: "serialize",
        value: function serialize() {
          return {
            type: "image",
            url: this.options.url,
            coordinates: this.coordinates
          };
        }
      }, {
        key: "hasTransition",
        value: function hasTransition() {
          return !1;
        }
      }]);

      return be;
    }(e.Evented);

    var we = {
      vector: /*#__PURE__*/function (_e$Evented7) {
        _inherits(vector, _e$Evented7);

        var _super111 = _createSuper(vector);

        function vector(t, i, o, r) {
          var _this73;

          _classCallCheck(this, vector);

          if (_this73 = _super111.call(this), _this73.id = t, _this73.dispatcher = o, _this73.type = "vector", _this73.minzoom = 0, _this73.maxzoom = 22, _this73.scheme = "xyz", _this73.tileSize = 512, _this73.reparseOverscaled = !0, _this73.isTileClipped = !0, _this73._loaded = !1, e.extend(_assertThisInitialized(_this73), e.pick(i, ["url", "scheme", "tileSize", "promoteId"])), _this73._options = e.extend({
            type: "vector"
          }, i), _this73._collectResourceTiming = i.collectResourceTiming, 512 !== _this73.tileSize) throw new Error("vector tile sources must have a tileSize of 512");
          _this73.setEventedParent(r), _this73._tileWorkers = {}, _this73._deduped = new e.DedupedRequest();
          return _possibleConstructorReturn(_this73);
        }

        _createClass(vector, [{
          key: "load",
          value: function load() {
            var _this74 = this;

            this._loaded = !1, this.fire(new e.Event("dataloading", {
              dataType: "source"
            })), this._tileJSONRequest = fe(this._options, this.map._requestManager, function (t, i) {
              _this74._tileJSONRequest = null, _this74._loaded = !0, t ? _this74.fire(new e.ErrorEvent(t)) : i && (e.extend(_this74, i), i.bounds && (_this74.tileBounds = new ge(i.bounds, _this74.minzoom, _this74.maxzoom)), e.postTurnstileEvent(i.tiles, _this74.map._requestManager._customAccessToken), _this74.fire(new e.Event("data", {
                dataType: "source",
                sourceDataType: "metadata"
              })), _this74.fire(new e.Event("data", {
                dataType: "source",
                sourceDataType: "content"
              })));
            });
          }
        }, {
          key: "loaded",
          value: function loaded() {
            return this._loaded;
          }
        }, {
          key: "hasTile",
          value: function hasTile(e) {
            return !this.tileBounds || this.tileBounds.contains(e.canonical);
          }
        }, {
          key: "onAdd",
          value: function onAdd(e) {
            this.map = e, this.load();
          }
        }, {
          key: "setSourceProperty",
          value: function setSourceProperty(e) {
            this._tileJSONRequest && this._tileJSONRequest.cancel(), e();

            var t = this.map.style._getSourceCaches(this.id);

            var _iterator172 = _createForOfIteratorHelper(t),
                _step172;

            try {
              for (_iterator172.s(); !(_step172 = _iterator172.n()).done;) {
                var _e261 = _step172.value;

                _e261.clearTiles();
              }
            } catch (err) {
              _iterator172.e(err);
            } finally {
              _iterator172.f();
            }

            this.load();
          }
        }, {
          key: "setTiles",
          value: function setTiles(e) {
            var _this75 = this;

            return this.setSourceProperty(function () {
              _this75._options.tiles = e;
            }), this;
          }
        }, {
          key: "setUrl",
          value: function setUrl(e) {
            var _this76 = this;

            return this.setSourceProperty(function () {
              _this76.url = e, _this76._options.url = e;
            }), this;
          }
        }, {
          key: "onRemove",
          value: function onRemove() {
            this._tileJSONRequest && (this._tileJSONRequest.cancel(), this._tileJSONRequest = null);
          }
        }, {
          key: "serialize",
          value: function serialize() {
            return e.extend({}, this._options);
          }
        }, {
          key: "loadTile",
          value: function loadTile(t, i) {
            var _this77 = this;

            var o = this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles, this.scheme)),
                r = {
              request: this.map._requestManager.transformRequest(o, e.ResourceType.Tile),
              data: void 0,
              uid: t.uid,
              tileID: t.tileID,
              tileZoom: t.tileZoom,
              zoom: t.tileID.overscaledZ,
              tileSize: this.tileSize * t.tileID.overscaleFactor(),
              type: this.type,
              source: this.id,
              pixelRatio: e.exported.devicePixelRatio,
              showCollisionBoxes: this.map.showCollisionBoxes,
              promoteId: this.promoteId,
              isSymbolTile: t.isSymbolTile
            };

            if (r.request.collectResourceTiming = this._collectResourceTiming, t.actor && "expired" !== t.state) "loading" === t.state ? t.reloadCallback = i : t.request = t.actor.send("reloadTile", r, n.bind(this));else if (t.actor = this._tileWorkers[o] = this._tileWorkers[o] || this.dispatcher.getActor(), this.dispatcher.ready) t.request = t.actor.send("loadTile", r, n.bind(this), void 0, !0);else {
              var _i157 = e.loadVectorTile.call({
                deduped: this._deduped
              }, r, function (e, i) {
                e || !i ? n.call(_this77, e) : (r.data = {
                  cacheControl: i.cacheControl,
                  expires: i.expires,
                  rawData: i.rawData.slice(0)
                }, t.actor && t.actor.send("loadTile", r, n.bind(_this77), void 0, !0));
              }, !0);

              t.request = {
                cancel: _i157
              };
            }

            function n(o, r) {
              return delete t.request, t.aborted ? i(null) : o && 404 !== o.status ? i(o) : (r && r.resourceTiming && (t.resourceTiming = r.resourceTiming), this.map._refreshExpiredTiles && r && t.setExpiryData(r), t.loadVectorData(r, this.map.painter), e.cacheEntryPossiblyAdded(this.dispatcher), i(null), void (t.reloadCallback && (this.loadTile(t, t.reloadCallback), t.reloadCallback = null)));
            }
          }
        }, {
          key: "abortTile",
          value: function abortTile(e) {
            e.request && (e.request.cancel(), delete e.request), e.actor && e.actor.send("abortTile", {
              uid: e.uid,
              type: this.type,
              source: this.id
            });
          }
        }, {
          key: "unloadTile",
          value: function unloadTile(e) {
            e.unloadVectorData(), e.actor && e.actor.send("removeTile", {
              uid: e.uid,
              type: this.type,
              source: this.id
            });
          }
        }, {
          key: "hasTransition",
          value: function hasTransition() {
            return !1;
          }
        }, {
          key: "afterUpdate",
          value: function afterUpdate() {
            this._tileWorkers = {};
          }
        }]);

        return vector;
      }(e.Evented),
      raster: ve,
      "raster-dem": /*#__PURE__*/function (_ve) {
        _inherits(rasterDem, _ve);

        var _super112 = _createSuper(rasterDem);

        function rasterDem(t, i, o, r) {
          var _this78;

          _classCallCheck(this, rasterDem);

          _this78 = _super112.call(this, t, i, o, r), _this78.type = "raster-dem", _this78.maxzoom = 22, _this78._options = e.extend({
            type: "raster-dem"
          }, i), _this78.encoding = i.encoding || "mapbox";
          return _this78;
        }

        _createClass(rasterDem, [{
          key: "loadTile",
          value: function loadTile(t, i) {
            var o = this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles, this.scheme), !1, this.tileSize);

            function r(e, o) {
              e && (t.state = "errored", i(e)), o && (t.dem = o, t.dem.onDeserialize(), t.needsHillshadePrepare = !0, t.needsDEMTextureUpload = !0, t.state = "loaded", i(null));
            }

            t.request = e.getImage(this.map._requestManager.transformRequest(o, e.ResourceType.Tile), function (o, n, a, s) {
              if (delete t.request, t.aborted) t.state = "unloaded", i(null);else if (o) t.state = "errored", i(o);else if (n) {
                this.map._refreshExpiredTiles && t.setExpiryData({
                  cacheControl: a,
                  expires: s
                });

                var _i158 = e.window.ImageBitmap && n instanceof e.window.ImageBitmap && (null == xe && (xe = e.window.OffscreenCanvas && new e.window.OffscreenCanvas(1, 1).getContext("2d") && "function" == typeof e.window.createImageBitmap), xe),
                    _o82 = 1 - (n.width - e.prevPowerOfTwo(n.width)) / 2;

                _o82 < 1 || t.neighboringTiles || (t.neighboringTiles = this._getNeighboringTiles(t.tileID));

                var _l58 = _i158 ? n : e.exported.getImageData(n, _o82),
                    _c35 = {
                  uid: t.uid,
                  coord: t.tileID,
                  source: this.id,
                  rawImageData: _l58,
                  encoding: this.encoding,
                  padding: _o82
                };

                t.actor && "expired" !== t.state || (t.actor = this.dispatcher.getActor(), t.actor.send("loadDEMTile", _c35, r.bind(this), void 0, !0));
              }
            }.bind(this));
          }
        }, {
          key: "_getNeighboringTiles",
          value: function _getNeighboringTiles(t) {
            var i = t.canonical,
                o = Math.pow(2, i.z),
                r = (i.x - 1 + o) % o,
                n = 0 === i.x ? t.wrap - 1 : t.wrap,
                a = (i.x + 1 + o) % o,
                s = i.x + 1 === o ? t.wrap + 1 : t.wrap,
                l = {};
            return l[new e.OverscaledTileID(t.overscaledZ, n, i.z, r, i.y).key] = {
              backfilled: !1
            }, l[new e.OverscaledTileID(t.overscaledZ, s, i.z, a, i.y).key] = {
              backfilled: !1
            }, i.y > 0 && (l[new e.OverscaledTileID(t.overscaledZ, n, i.z, r, i.y - 1).key] = {
              backfilled: !1
            }, l[new e.OverscaledTileID(t.overscaledZ, t.wrap, i.z, i.x, i.y - 1).key] = {
              backfilled: !1
            }, l[new e.OverscaledTileID(t.overscaledZ, s, i.z, a, i.y - 1).key] = {
              backfilled: !1
            }), i.y + 1 < o && (l[new e.OverscaledTileID(t.overscaledZ, n, i.z, r, i.y + 1).key] = {
              backfilled: !1
            }, l[new e.OverscaledTileID(t.overscaledZ, t.wrap, i.z, i.x, i.y + 1).key] = {
              backfilled: !1
            }, l[new e.OverscaledTileID(t.overscaledZ, s, i.z, a, i.y + 1).key] = {
              backfilled: !1
            }), l;
          }
        }, {
          key: "unloadTile",
          value: function unloadTile(e) {
            e.demTexture && this.map.painter.saveTileTexture(e.demTexture), e.fbo && (e.fbo.destroy(), delete e.fbo), e.dem && delete e.dem, delete e.neighboringTiles, e.state = "unloaded";
          }
        }]);

        return rasterDem;
      }(ve),
      geojson: /*#__PURE__*/function (_e$Evented8) {
        _inherits(geojson, _e$Evented8);

        var _super113 = _createSuper(geojson);

        function geojson(t, i, o, r) {
          var _this79;

          _classCallCheck(this, geojson);

          _this79 = _super113.call(this), _this79.id = t, _this79.type = "geojson", _this79.minzoom = 0, _this79.maxzoom = 18, _this79.tileSize = 512, _this79.isTileClipped = !0, _this79.reparseOverscaled = !0, _this79._loaded = !1, _this79.actor = o.getActor(), _this79.setEventedParent(r), _this79._data = i.data, _this79._options = e.extend({}, i), _this79._collectResourceTiming = i.collectResourceTiming, void 0 !== i.maxzoom && (_this79.maxzoom = i.maxzoom), i.type && (_this79.type = i.type), i.attribution && (_this79.attribution = i.attribution), _this79.promoteId = i.promoteId;
          var n = e.EXTENT / _this79.tileSize;
          _this79.workerOptions = e.extend({
            source: _this79.id,
            cluster: i.cluster || !1,
            geojsonVtOptions: {
              buffer: (void 0 !== i.buffer ? i.buffer : 128) * n,
              tolerance: (void 0 !== i.tolerance ? i.tolerance : .375) * n,
              extent: e.EXTENT,
              maxZoom: _this79.maxzoom,
              lineMetrics: i.lineMetrics || !1,
              generateId: i.generateId || !1
            },
            superclusterOptions: {
              maxZoom: void 0 !== i.clusterMaxZoom ? i.clusterMaxZoom : _this79.maxzoom - 1,
              minPoints: Math.max(2, i.clusterMinPoints || 2),
              extent: e.EXTENT,
              radius: (void 0 !== i.clusterRadius ? i.clusterRadius : 50) * n,
              log: !1,
              generateId: i.generateId || !1
            },
            clusterProperties: i.clusterProperties,
            filter: i.filter
          }, i.workerOptions);
          return _this79;
        }

        _createClass(geojson, [{
          key: "onAdd",
          value: function onAdd(e) {
            this.map = e, this.setData(this._data);
          }
        }, {
          key: "setData",
          value: function setData(e) {
            return this._data = e, this._updateWorkerData(), this;
          }
        }, {
          key: "getClusterExpansionZoom",
          value: function getClusterExpansionZoom(e, t) {
            return this.actor.send("geojson.getClusterExpansionZoom", {
              clusterId: e,
              source: this.id
            }, t), this;
          }
        }, {
          key: "getClusterChildren",
          value: function getClusterChildren(e, t) {
            return this.actor.send("geojson.getClusterChildren", {
              clusterId: e,
              source: this.id
            }, t), this;
          }
        }, {
          key: "getClusterLeaves",
          value: function getClusterLeaves(e, t, i, o) {
            return this.actor.send("geojson.getClusterLeaves", {
              source: this.id,
              clusterId: e,
              limit: t,
              offset: i
            }, o), this;
          }
        }, {
          key: "_updateWorkerData",
          value: function _updateWorkerData() {
            var _this80 = this;

            if (this._pendingLoad) return void (this._coalesce = !0);
            this.fire(new e.Event("dataloading", {
              dataType: "source"
            })), this._loaded = !1;
            var t = e.extend({}, this.workerOptions),
                i = this._data;
            "string" == typeof i ? (t.request = this.map._requestManager.transformRequest(e.exported.resolveURL(i), e.ResourceType.Source), t.request.collectResourceTiming = this._collectResourceTiming) : t.data = JSON.stringify(i), this._pendingLoad = this.actor.send("".concat(this.type, ".loadData"), t, function (t, i) {
              if (_this80._loaded = !0, _this80._pendingLoad = null, t) _this80.fire(new e.ErrorEvent(t));else {
                var _t280 = {
                  dataType: "source",
                  sourceDataType: _this80._metadataFired ? "content" : "metadata"
                };
                _this80._collectResourceTiming && i && i.resourceTiming && i.resourceTiming[_this80.id] && (_t280.resourceTiming = i.resourceTiming[_this80.id]), _this80.fire(new e.Event("data", _t280)), _this80._metadataFired = !0;
              }
              _this80._coalesce && (_this80._updateWorkerData(), _this80._coalesce = !1);
            });
          }
        }, {
          key: "loaded",
          value: function loaded() {
            return this._loaded;
          }
        }, {
          key: "loadTile",
          value: function loadTile(t, i) {
            var _this81 = this;

            var o = t.actor ? "reloadTile" : "loadTile";
            t.actor = this.actor, t.request = this.actor.send(o, {
              type: this.type,
              uid: t.uid,
              tileID: t.tileID,
              tileZoom: t.tileZoom,
              zoom: t.tileID.overscaledZ,
              maxZoom: this.maxzoom,
              tileSize: this.tileSize,
              source: this.id,
              pixelRatio: e.exported.devicePixelRatio,
              showCollisionBoxes: this.map.showCollisionBoxes,
              promoteId: this.promoteId
            }, function (e, r) {
              return delete t.request, t.unloadVectorData(), t.aborted ? i(null) : e ? i(e) : (t.loadVectorData(r, _this81.map.painter, "reloadTile" === o), i(null));
            }, void 0, "loadTile" === o);
          }
        }, {
          key: "abortTile",
          value: function abortTile(e) {
            e.request && (e.request.cancel(), delete e.request), e.aborted = !0;
          }
        }, {
          key: "unloadTile",
          value: function unloadTile(e) {
            e.unloadVectorData(), this.actor.send("removeTile", {
              uid: e.uid,
              type: this.type,
              source: this.id
            });
          }
        }, {
          key: "onRemove",
          value: function onRemove() {
            this._pendingLoad && this._pendingLoad.cancel();
          }
        }, {
          key: "serialize",
          value: function serialize() {
            return e.extend({}, this._options, {
              type: this.type,
              data: this._data
            });
          }
        }, {
          key: "hasTransition",
          value: function hasTransition() {
            return !1;
          }
        }]);

        return geojson;
      }(e.Evented),
      video: /*#__PURE__*/function (_be) {
        _inherits(video, _be);

        var _super114 = _createSuper(video);

        function video(e, t, i, o) {
          var _this82;

          _classCallCheck(this, video);

          _this82 = _super114.call(this, e, t, i, o), _this82.roundZoom = !0, _this82.type = "video", _this82.options = t;
          return _this82;
        }

        _createClass(video, [{
          key: "load",
          value: function load() {
            var _this83 = this;

            this._loaded = !1;
            var t = this.options;
            this.urls = [];

            var _iterator173 = _createForOfIteratorHelper(t.urls),
                _step173;

            try {
              for (_iterator173.s(); !(_step173 = _iterator173.n()).done;) {
                var _i159 = _step173.value;
                this.urls.push(this.map._requestManager.transformRequest(_i159, e.ResourceType.Source).url);
              }
            } catch (err) {
              _iterator173.e(err);
            } finally {
              _iterator173.f();
            }

            e.getVideo(this.urls, function (t, i) {
              _this83._loaded = !0, t ? _this83.fire(new e.ErrorEvent(t)) : i && (_this83.video = i, _this83.video.loop = !0, _this83.video.setAttribute("playsinline", ""), _this83.video.addEventListener("playing", function () {
                _this83.map.triggerRepaint();
              }), _this83.map && _this83.video.play(), _this83._finishLoading());
            });
          }
        }, {
          key: "pause",
          value: function pause() {
            this.video && this.video.pause();
          }
        }, {
          key: "play",
          value: function play() {
            this.video && this.video.play();
          }
        }, {
          key: "seek",
          value: function seek(t) {
            if (this.video) {
              var _i160 = this.video.seekable;
              t < _i160.start(0) || t > _i160.end(0) ? this.fire(new e.ErrorEvent(new e.ValidationError("sources.".concat(this.id), null, "Playback for this video can be set only between the ".concat(_i160.start(0), " and ").concat(_i160.end(0), "-second mark.")))) : this.video.currentTime = t;
            }
          }
        }, {
          key: "getVideo",
          value: function getVideo() {
            return this.video;
          }
        }, {
          key: "onAdd",
          value: function onAdd(e) {
            this.map || (this.map = e, this.load(), this.video && (this.video.play(), this.setCoordinates(this.coordinates)));
          }
        }, {
          key: "prepare",
          value: function prepare() {
            if (0 === Object.keys(this.tiles).length || this.video.readyState < 2) return;
            var t = this.map.painter.context,
                i = t.gl;
            this.texture ? this.video.paused || (this.texture.bind(i.LINEAR, i.CLAMP_TO_EDGE), i.texSubImage2D(i.TEXTURE_2D, 0, 0, 0, i.RGBA, i.UNSIGNED_BYTE, this.video)) : (this.texture = new e.Texture(t, this.video, i.RGBA), this.texture.bind(i.LINEAR, i.CLAMP_TO_EDGE), this.width = this.video.videoWidth, this.height = this.video.videoHeight), this._boundsArray || this._makeBoundsArray(), this.boundsBuffer || (this.boundsBuffer = t.createVertexBuffer(this._boundsArray, e.boundsAttributes.members)), this.boundsSegments || (this.boundsSegments = e.SegmentVector.simpleSegment(0, 0, 4, 2));

            for (var _e262 in this.tiles) {
              var _t281 = this.tiles[_e262];
              "loaded" !== _t281.state && (_t281.state = "loaded", _t281.texture = this.texture);
            }
          }
        }, {
          key: "serialize",
          value: function serialize() {
            return {
              type: "video",
              urls: this.urls,
              coordinates: this.coordinates
            };
          }
        }, {
          key: "hasTransition",
          value: function hasTransition() {
            return this.video && !this.video.paused;
          }
        }]);

        return video;
      }(be),
      image: be,
      canvas: /*#__PURE__*/function (_be2) {
        _inherits(canvas, _be2);

        var _super115 = _createSuper(canvas);

        function canvas(t, i, o, r) {
          var _this84;

          _classCallCheck(this, canvas);

          _this84 = _super115.call(this, t, i, o, r), i.coordinates ? Array.isArray(i.coordinates) && 4 === i.coordinates.length && !i.coordinates.some(function (e) {
            return !Array.isArray(e) || 2 !== e.length || e.some(function (e) {
              return "number" != typeof e;
            });
          }) || _this84.fire(new e.ErrorEvent(new e.ValidationError("sources.".concat(t), null, '"coordinates" property must be an array of 4 longitude/latitude array pairs'))) : _this84.fire(new e.ErrorEvent(new e.ValidationError("sources.".concat(t), null, 'missing required property "coordinates"'))), i.animate && "boolean" != typeof i.animate && _this84.fire(new e.ErrorEvent(new e.ValidationError("sources.".concat(t), null, 'optional "animate" property must be a boolean value'))), i.canvas ? "string" == typeof i.canvas || i.canvas instanceof e.window.HTMLCanvasElement || _this84.fire(new e.ErrorEvent(new e.ValidationError("sources.".concat(t), null, '"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))) : _this84.fire(new e.ErrorEvent(new e.ValidationError("sources.".concat(t), null, 'missing required property "canvas"'))), _this84.options = i, _this84.animate = void 0 === i.animate || i.animate;
          return _this84;
        }

        _createClass(canvas, [{
          key: "load",
          value: function load() {
            this._loaded = !0, this.canvas || (this.canvas = this.options.canvas instanceof e.window.HTMLCanvasElement ? this.options.canvas : e.window.document.getElementById(this.options.canvas)), this.width = this.canvas.width, this.height = this.canvas.height, this._hasInvalidDimensions() ? this.fire(new e.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))) : (this.play = function () {
              this._playing = !0, this.map.triggerRepaint();
            }, this.pause = function () {
              this._playing && (this.prepare(), this._playing = !1);
            }, this._finishLoading());
          }
        }, {
          key: "getCanvas",
          value: function getCanvas() {
            return this.canvas;
          }
        }, {
          key: "onAdd",
          value: function onAdd(e) {
            this.map = e, this.load(), this.canvas && this.animate && this.play();
          }
        }, {
          key: "onRemove",
          value: function onRemove() {
            this.pause();
          }
        }, {
          key: "prepare",
          value: function prepare() {
            var t = !1;
            if (this.canvas.width !== this.width && (this.width = this.canvas.width, t = !0), this.canvas.height !== this.height && (this.height = this.canvas.height, t = !0), this._hasInvalidDimensions()) return;
            if (0 === Object.keys(this.tiles).length) return;
            var i = this.map.painter.context,
                o = i.gl;
            this._boundsArray || this._makeBoundsArray(), this.boundsBuffer || (this.boundsBuffer = i.createVertexBuffer(this._boundsArray, e.boundsAttributes.members)), this.boundsSegments || (this.boundsSegments = e.SegmentVector.simpleSegment(0, 0, 4, 2)), this.texture ? (t || this._playing) && this.texture.update(this.canvas, {
              premultiply: !0
            }) : this.texture = new e.Texture(i, this.canvas, o.RGBA, {
              premultiply: !0
            });

            for (var _e263 in this.tiles) {
              var _t282 = this.tiles[_e263];
              "loaded" !== _t282.state && (_t282.state = "loaded", _t282.texture = this.texture);
            }
          }
        }, {
          key: "serialize",
          value: function serialize() {
            return {
              type: "canvas",
              coordinates: this.coordinates
            };
          }
        }, {
          key: "hasTransition",
          value: function hasTransition() {
            return this._playing;
          }
        }, {
          key: "_hasInvalidDimensions",
          value: function _hasInvalidDimensions() {
            for (var _i161 = 0, _arr2 = [this.canvas.width, this.canvas.height]; _i161 < _arr2.length; _i161++) {
              var _e264 = _arr2[_i161];
              if (isNaN(_e264) || _e264 <= 0) return !0;
            }

            return !1;
          }
        }]);

        return canvas;
      }(be)
    },
        Te = function Te(t, i, o, r) {
      var n = new we[i.type](t, i, o, r);
      if (n.id !== t) throw new Error("Expected Source id to be ".concat(t, " instead of ").concat(n.id));
      return e.bindAll(["load", "abort", "unload", "serialize", "prepare"], n), n;
    };

    function Ee(t, i) {
      var o = e.identity([]);
      return e.scale(o, o, [.5 * t.width, .5 * -t.height, 1]), e.translate(o, o, [1, -1, 0]), e.multiply$1(o, o, t.calculateProjMatrix(i.toUnwrapped()));
    }

    function Ce(e, t, i, o, r, n, a) {
      var s = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : !1;
      var l = e.tilesIn(o, a, s);
      l.sort(Se);
      var c = [];

      var _iterator174 = _createForOfIteratorHelper(l),
          _step174;

      try {
        for (_iterator174.s(); !(_step174 = _iterator174.n()).done;) {
          var _o85 = _step174.value;
          c.push({
            wrappedTileID: _o85.tile.tileID.wrapped().key,
            queryResults: _o85.tile.queryRenderedFeatures(t, i, e._state, _o85, r, n, Ee(e.transform, _o85.tile.tileID), s)
          });
        }
      } catch (err) {
        _iterator174.e(err);
      } finally {
        _iterator174.f();
      }

      var h = function (e) {
        var t = {},
            i = {};

        var _iterator175 = _createForOfIteratorHelper(e),
            _step175;

        try {
          for (_iterator175.s(); !(_step175 = _iterator175.n()).done;) {
            var _o83 = _step175.value;

            var _e265 = _o83.queryResults,
                _r222 = _o83.wrappedTileID,
                _n155 = i[_r222] = i[_r222] || {};

            for (var _i162 in _e265) {
              var _o84 = _e265[_i162],
                  _r223 = _n155[_i162] = _n155[_i162] || {},
                  _a91 = t[_i162] = t[_i162] || [];

              var _iterator176 = _createForOfIteratorHelper(_o84),
                  _step176;

              try {
                for (_iterator176.s(); !(_step176 = _iterator176.n()).done;) {
                  var _e266 = _step176.value;
                  _r223[_e266.featureIndex] || (_r223[_e266.featureIndex] = !0, _a91.push(_e266));
                }
              } catch (err) {
                _iterator176.e(err);
              } finally {
                _iterator176.f();
              }
            }
          }
        } catch (err) {
          _iterator175.e(err);
        } finally {
          _iterator175.f();
        }

        return t;
      }(c);

      for (var _t283 in h) {
        h[_t283].forEach(function (t) {
          var i = t.feature,
              o = e.getFeatureState(i.layer["source-layer"], i.id);
          i.source = i.layer.source, i.layer["source-layer"] && (i.sourceLayer = i.layer["source-layer"]), i.state = o;
        });
      }

      return h;
    }

    function Me(e, t) {
      var i = e.getRenderableIds().map(function (t) {
        return e.getTileByID(t);
      }),
          o = [],
          r = {};

      for (var _e267 = 0; _e267 < i.length; _e267++) {
        var _n156 = i[_e267],
            _a92 = _n156.tileID.canonical.key;
        r[_a92] || (r[_a92] = !0, _n156.querySourceFeatures(o, t));
      }

      return o;
    }

    function Se(e, t) {
      var i = e.tileID,
          o = t.tileID;
      return i.overscaledZ - o.overscaledZ || i.canonical.y - o.canonical.y || i.wrap - o.wrap || i.canonical.x - o.canonical.x;
    }

    function Ie() {
      return null != Kr.workerClass ? new Kr.workerClass() : new e.window.Worker(Kr.workerUrl);
    }

    var ze = "mapboxgl_preloaded_worker_pool";

    var De = /*#__PURE__*/function () {
      function De() {
        _classCallCheck(this, De);

        this.active = {};
      }

      _createClass(De, [{
        key: "acquire",
        value: function acquire(e) {
          if (!this.workers) for (this.workers = []; this.workers.length < De.workerCount;) {
            this.workers.push(new Ie());
          }
          return this.active[e] = !0, this.workers.slice();
        }
      }, {
        key: "release",
        value: function release(e) {
          delete this.active[e], 0 === this.numActive() && (this.workers.forEach(function (e) {
            e.terminate();
          }), this.workers = null);
        }
      }, {
        key: "isPreloaded",
        value: function isPreloaded() {
          return !!this.active[ze];
        }
      }, {
        key: "numActive",
        value: function numActive() {
          return Object.keys(this.active).length;
        }
      }]);

      return De;
    }();

    var Pe;

    function Ae() {
      return Pe || (Pe = new De()), Pe;
    }

    function Le(t, i) {
      var o = {};

      for (var _e268 in t) {
        "ref" !== _e268 && (o[_e268] = t[_e268]);
      }

      return e.refProperties.forEach(function (e) {
        e in i && (o[e] = i[e]);
      }), o;
    }

    function Re(e) {
      e = e.slice();
      var t = Object.create(null);

      for (var _i163 = 0; _i163 < e.length; _i163++) {
        t[e[_i163].id] = e[_i163];
      }

      for (var _i164 = 0; _i164 < e.length; _i164++) {
        "ref" in e[_i164] && (e[_i164] = Le(e[_i164], t[e[_i164].ref]));
      }

      return e;
    }

    De.workerCount = 2;
    var ke = {
      setStyle: "setStyle",
      addLayer: "addLayer",
      removeLayer: "removeLayer",
      setPaintProperty: "setPaintProperty",
      setLayoutProperty: "setLayoutProperty",
      setFilter: "setFilter",
      addSource: "addSource",
      removeSource: "removeSource",
      setGeoJSONSourceData: "setGeoJSONSourceData",
      setLayerZoomRange: "setLayerZoomRange",
      setLayerProperty: "setLayerProperty",
      setCenter: "setCenter",
      setZoom: "setZoom",
      setBearing: "setBearing",
      setPitch: "setPitch",
      setSprite: "setSprite",
      setGlyphs: "setGlyphs",
      setTransition: "setTransition",
      setLight: "setLight",
      setTerrain: "setTerrain",
      setFog: "setFog",
      setProjection: "setProjection"
    };

    function Oe(e, t, i) {
      i.push({
        command: ke.addSource,
        args: [e, t[e]]
      });
    }

    function Be(e, t, i) {
      t.push({
        command: ke.removeSource,
        args: [e]
      }), i[e] = !0;
    }

    function Fe(e, t, i, o) {
      Be(e, i, o), Oe(e, t, i);
    }

    function Ue(e, t, i) {
      var o;

      for (o in e[i]) {
        if (e[i].hasOwnProperty(o) && "data" !== o && !n(e[i][o], t[i][o])) return !1;
      }

      for (o in t[i]) {
        if (t[i].hasOwnProperty(o) && "data" !== o && !n(e[i][o], t[i][o])) return !1;
      }

      return !0;
    }

    function Ne(e, t, i, o, r, a) {
      var s;

      for (s in t = t || {}, e = e || {}) {
        e.hasOwnProperty(s) && (n(e[s], t[s]) || i.push({
          command: a,
          args: [o, s, t[s], r]
        }));
      }

      for (s in t) {
        t.hasOwnProperty(s) && !e.hasOwnProperty(s) && (n(e[s], t[s]) || i.push({
          command: a,
          args: [o, s, t[s], r]
        }));
      }
    }

    function Ge(e) {
      return e.id;
    }

    function je(e, t) {
      return e[t.id] = t, e;
    }

    var Ze = /*#__PURE__*/function () {
      function Ze(e, t) {
        _classCallCheck(this, Ze);

        this.reset(e, t);
      }

      _createClass(Ze, [{
        key: "reset",
        value: function reset(e, t) {
          this.points = e || [], this._distances = [0];

          for (var _e269 = 1; _e269 < this.points.length; _e269++) {
            this._distances[_e269] = this._distances[_e269 - 1] + this.points[_e269].dist(this.points[_e269 - 1]);
          }

          this.length = this._distances[this._distances.length - 1], this.padding = Math.min(t || 0, .5 * this.length), this.paddedLength = this.length - 2 * this.padding;
        }
      }, {
        key: "lerp",
        value: function lerp(t) {
          if (1 === this.points.length) return this.points[0];
          t = e.clamp(t, 0, 1);
          var i = 1,
              o = this._distances[i];
          var r = t * this.paddedLength + this.padding;

          for (; o < r && i < this._distances.length;) {
            o = this._distances[++i];
          }

          var n = i - 1,
              a = this._distances[n],
              s = o - a,
              l = s > 0 ? (r - a) / s : 0;
          return this.points[n].mult(1 - l).add(this.points[i].mult(l));
        }
      }]);

      return Ze;
    }();

    var Ve = /*#__PURE__*/function () {
      function Ve(e, t, i) {
        _classCallCheck(this, Ve);

        var o = this.boxCells = [],
            r = this.circleCells = [];
        this.xCellCount = Math.ceil(e / i), this.yCellCount = Math.ceil(t / i);

        for (var _e270 = 0; _e270 < this.xCellCount * this.yCellCount; _e270++) {
          o.push([]), r.push([]);
        }

        this.circleKeys = [], this.boxKeys = [], this.bboxes = [], this.circles = [], this.width = e, this.height = t, this.xScale = this.xCellCount / e, this.yScale = this.yCellCount / t, this.boxUid = 0, this.circleUid = 0;
      }

      _createClass(Ve, [{
        key: "keysLength",
        value: function keysLength() {
          return this.boxKeys.length + this.circleKeys.length;
        }
      }, {
        key: "insert",
        value: function insert(e, t, i, o, r) {
          this._forEachCell(t, i, o, r, this._insertBoxCell, this.boxUid++), this.boxKeys.push(e), this.bboxes.push(t), this.bboxes.push(i), this.bboxes.push(o), this.bboxes.push(r);
        }
      }, {
        key: "insertCircle",
        value: function insertCircle(e, t, i, o) {
          this._forEachCell(t - o, i - o, t + o, i + o, this._insertCircleCell, this.circleUid++), this.circleKeys.push(e), this.circles.push(t), this.circles.push(i), this.circles.push(o);
        }
      }, {
        key: "_insertBoxCell",
        value: function _insertBoxCell(e, t, i, o, r, n) {
          this.boxCells[r].push(n);
        }
      }, {
        key: "_insertCircleCell",
        value: function _insertCircleCell(e, t, i, o, r, n) {
          this.circleCells[r].push(n);
        }
      }, {
        key: "_query",
        value: function _query(e, t, i, o, r, n) {
          if (i < 0 || e > this.width || o < 0 || t > this.height) return !r && [];
          var a = [];

          if (e <= 0 && t <= 0 && this.width <= i && this.height <= o) {
            if (r) return !0;

            for (var _e271 = 0; _e271 < this.boxKeys.length; _e271++) {
              a.push({
                key: this.boxKeys[_e271],
                x1: this.bboxes[4 * _e271],
                y1: this.bboxes[4 * _e271 + 1],
                x2: this.bboxes[4 * _e271 + 2],
                y2: this.bboxes[4 * _e271 + 3]
              });
            }

            for (var _e272 = 0; _e272 < this.circleKeys.length; _e272++) {
              var _t284 = this.circles[3 * _e272],
                  _i165 = this.circles[3 * _e272 + 1],
                  _o86 = this.circles[3 * _e272 + 2];
              a.push({
                key: this.circleKeys[_e272],
                x1: _t284 - _o86,
                y1: _i165 - _o86,
                x2: _t284 + _o86,
                y2: _i165 + _o86
              });
            }

            return n ? a.filter(n) : a;
          }

          return this._forEachCell(e, t, i, o, this._queryCell, a, {
            hitTest: r,
            seenUids: {
              box: {},
              circle: {}
            }
          }, n), r ? a.length > 0 : a;
        }
      }, {
        key: "_queryCircle",
        value: function _queryCircle(e, t, i, o, r) {
          var n = e - i,
              a = e + i,
              s = t - i,
              l = t + i;
          if (a < 0 || n > this.width || l < 0 || s > this.height) return !o && [];
          var c = [];
          return this._forEachCell(n, s, a, l, this._queryCellCircle, c, {
            hitTest: o,
            circle: {
              x: e,
              y: t,
              radius: i
            },
            seenUids: {
              box: {},
              circle: {}
            }
          }, r), o ? c.length > 0 : c;
        }
      }, {
        key: "query",
        value: function query(e, t, i, o, r) {
          return this._query(e, t, i, o, !1, r);
        }
      }, {
        key: "hitTest",
        value: function hitTest(e, t, i, o, r) {
          return this._query(e, t, i, o, !0, r);
        }
      }, {
        key: "hitTestCircle",
        value: function hitTestCircle(e, t, i, o) {
          return this._queryCircle(e, t, i, !0, o);
        }
      }, {
        key: "_queryCell",
        value: function _queryCell(e, t, i, o, r, n, a, s) {
          var l = a.seenUids,
              c = this.boxCells[r];

          if (null !== c) {
            var _r224 = this.bboxes;

            var _iterator177 = _createForOfIteratorHelper(c),
                _step177;

            try {
              for (_iterator177.s(); !(_step177 = _iterator177.n()).done;) {
                var _h24 = _step177.value;

                if (!l.box[_h24]) {
                  l.box[_h24] = !0;

                  var _c36 = 4 * _h24;

                  if (e <= _r224[_c36 + 2] && t <= _r224[_c36 + 3] && i >= _r224[_c36 + 0] && o >= _r224[_c36 + 1] && (!s || s(this.boxKeys[_h24]))) {
                    if (a.hitTest) return n.push(!0), !0;
                    n.push({
                      key: this.boxKeys[_h24],
                      x1: _r224[_c36],
                      y1: _r224[_c36 + 1],
                      x2: _r224[_c36 + 2],
                      y2: _r224[_c36 + 3]
                    });
                  }
                }
              }
            } catch (err) {
              _iterator177.e(err);
            } finally {
              _iterator177.f();
            }
          }

          var h = this.circleCells[r];

          if (null !== h) {
            var _r225 = this.circles;

            var _iterator178 = _createForOfIteratorHelper(h),
                _step178;

            try {
              for (_iterator178.s(); !(_step178 = _iterator178.n()).done;) {
                var _c37 = _step178.value;

                if (!l.circle[_c37]) {
                  l.circle[_c37] = !0;

                  var _h25 = 3 * _c37;

                  if (this._circleAndRectCollide(_r225[_h25], _r225[_h25 + 1], _r225[_h25 + 2], e, t, i, o) && (!s || s(this.circleKeys[_c37]))) {
                    if (a.hitTest) return n.push(!0), !0;
                    {
                      var _e273 = _r225[_h25],
                          _t285 = _r225[_h25 + 1],
                          _i166 = _r225[_h25 + 2];
                      n.push({
                        key: this.circleKeys[_c37],
                        x1: _e273 - _i166,
                        y1: _t285 - _i166,
                        x2: _e273 + _i166,
                        y2: _t285 + _i166
                      });
                    }
                  }
                }
              }
            } catch (err) {
              _iterator178.e(err);
            } finally {
              _iterator178.f();
            }
          }
        }
      }, {
        key: "_queryCellCircle",
        value: function _queryCellCircle(e, t, i, o, r, n, a, s) {
          var l = a.circle,
              c = a.seenUids,
              h = this.boxCells[r];

          if (null !== h) {
            var _e274 = this.bboxes;

            var _iterator179 = _createForOfIteratorHelper(h),
                _step179;

            try {
              for (_iterator179.s(); !(_step179 = _iterator179.n()).done;) {
                var _t286 = _step179.value;

                if (!c.box[_t286]) {
                  c.box[_t286] = !0;

                  var _i167 = 4 * _t286;

                  if (this._circleAndRectCollide(l.x, l.y, l.radius, _e274[_i167 + 0], _e274[_i167 + 1], _e274[_i167 + 2], _e274[_i167 + 3]) && (!s || s(this.boxKeys[_t286]))) return n.push(!0), !0;
                }
              }
            } catch (err) {
              _iterator179.e(err);
            } finally {
              _iterator179.f();
            }
          }

          var u = this.circleCells[r];

          if (null !== u) {
            var _e275 = this.circles;

            var _iterator180 = _createForOfIteratorHelper(u),
                _step180;

            try {
              for (_iterator180.s(); !(_step180 = _iterator180.n()).done;) {
                var _t287 = _step180.value;

                if (!c.circle[_t287]) {
                  c.circle[_t287] = !0;

                  var _i168 = 3 * _t287;

                  if (this._circlesCollide(_e275[_i168], _e275[_i168 + 1], _e275[_i168 + 2], l.x, l.y, l.radius) && (!s || s(this.circleKeys[_t287]))) return n.push(!0), !0;
                }
              }
            } catch (err) {
              _iterator180.e(err);
            } finally {
              _iterator180.f();
            }
          }
        }
      }, {
        key: "_forEachCell",
        value: function _forEachCell(e, t, i, o, r, n, a, s) {
          var l = this._convertToXCellCoord(e),
              c = this._convertToYCellCoord(t),
              h = this._convertToXCellCoord(i),
              u = this._convertToYCellCoord(o);

          for (var _10 = l; _10 <= h; _10++) {
            for (var _l59 = c; _l59 <= u; _l59++) {
              if (r.call(this, e, t, i, o, this.xCellCount * _l59 + _10, n, a, s)) return;
            }
          }
        }
      }, {
        key: "_convertToXCellCoord",
        value: function _convertToXCellCoord(e) {
          return Math.max(0, Math.min(this.xCellCount - 1, Math.floor(e * this.xScale)));
        }
      }, {
        key: "_convertToYCellCoord",
        value: function _convertToYCellCoord(e) {
          return Math.max(0, Math.min(this.yCellCount - 1, Math.floor(e * this.yScale)));
        }
      }, {
        key: "_circlesCollide",
        value: function _circlesCollide(e, t, i, o, r, n) {
          var a = o - e,
              s = r - t,
              l = i + n;
          return l * l > a * a + s * s;
        }
      }, {
        key: "_circleAndRectCollide",
        value: function _circleAndRectCollide(e, t, i, o, r, n, a) {
          var s = (n - o) / 2,
              l = Math.abs(e - (o + s));
          if (l > s + i) return !1;
          var c = (a - r) / 2,
              h = Math.abs(t - (r + c));
          if (h > c + i) return !1;
          if (l <= s || h <= c) return !0;

          var u = l - s,
              _ = h - c;

          return u * u + _ * _ <= i * i;
        }
      }]);

      return Ve;
    }();

    var We = Math.tan(85 * Math.PI / 180);

    function qe(t, i, o, n, a, s) {
      var l = e.create();

      if (o) {
        if ("globe" === a.projection.name) l = e.calculateGlobeMatrix(a, a.worldSize / a._projectionScaler, [0, 0]), e.multiply$1(l, l, e.globeDenormalizeECEF(e.globeTileBounds(i)));else {
          var _e276 = r([], s);

          l[0] = _e276[0], l[1] = _e276[1], l[4] = _e276[2], l[5] = _e276[3];
        }
        n || e.rotateZ(l, l, a.angle);
      } else e.multiply$1(l, a.labelPlaneMatrix, t);

      return l;
    }

    function Xe(t, i, o, r, n, a) {
      if (o) {
        if ("globe" === n.projection.name) {
          var _s113 = qe(t, i, o, r, n, a);

          return e.invert(_s113, _s113), e.multiply$1(_s113, t, _s113), _s113;
        }

        {
          var _i169 = e.clone(t),
              _o87 = e.identity([]);

          return _o87[0] = a[0], _o87[1] = a[1], _o87[4] = a[2], _o87[5] = a[3], e.multiply$1(_i169, _i169, _o87), r || e.rotateZ(_i169, _i169, -n.angle), _i169;
        }
      }

      return n.glCoordMatrix;
    }

    function $e(t, i) {
      var o = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
      var r = [t.x, t.y, o, 1];
      o ? e.transformMat4$1(r, r, i) : at(r, r, i);
      var n = r[3];
      return {
        point: new e.pointGeometry(r[0] / n, r[1] / n),
        signedDistanceFromCamera: n
      };
    }

    function He(e, t) {
      return Math.min(.5 + e / t * .5, 1.5);
    }

    function Ke(e, t) {
      var i = e[0] / e[3],
          o = e[1] / e[3];
      return i >= -t[0] && i <= t[0] && o >= -t[1] && o <= t[1];
    }

    function Ye(t, i, o, r, n, a, s, l, c, h) {
      var u = o.transform,
          _ = r ? t.textSizeData : t.iconSizeData,
          d = e.evaluateSizeForZoom(_, o.transform.zoom),
          p = [256 / o.width * 2 + 1, 256 / o.height * 2 + 1],
          m = r ? t.text.dynamicLayoutVertexArray : t.icon.dynamicLayoutVertexArray;

      m.clear();
      var f = t.lineVertexArray,
          g = r ? t.text.placedSymbolArray : t.icon.placedSymbolArray,
          v = o.transform.width / o.transform.height;
      var x = !1;

      for (var _r226 = 0; _r226 < g.length; _r226++) {
        var _y9 = g.get(_r226);

        if (_y9.writingMode !== e.WritingMode.vertical || x || 0 !== _r226 && g.get(_r226 - 1).writingMode === e.WritingMode.horizontal || (x = !0), _y9.hidden || _y9.writingMode === e.WritingMode.vertical && !x) {
          nt(_y9.numGlyphs, m);
          continue;
        }

        x = !1;

        var _b11 = new e.pointGeometry(_y9.tileAnchorX, _y9.tileAnchorY),
            _w9 = c ? c(_b11) : [0, 0, 0],
            _T3 = u.projection.projectTilePoint(_b11.x, _b11.y, h.canonical),
            _E = [_T3.x + _w9[0], _T3.y + _w9[1], _T3.z + _w9[2]],
            _C2 = [].concat(_E, [1]);

        if (e.transformMat4$1(_C2, _C2, i), !Ke(_C2, p)) {
          nt(_y9.numGlyphs, m);
          continue;
        }

        var _M4 = He(o.transform.cameraToCenterDistance, _C2[3]),
            _S5 = e.evaluateSizeForFeature(_, d, _y9),
            _I5 = s ? _S5 / _M4 : _S5 * _M4,
            _z5 = $e(new e.pointGeometry(_E[0], _E[1]), n, _E[2]);

        if (_z5.signedDistanceFromCamera <= 0) {
          nt(_y9.numGlyphs, m);
          continue;
        }

        var _D33 = {};

        var _P = s ? null : c,
            _A9 = et(_y9, _I5, !1, l, i, n, a, t.glyphOffsetArray, f, m, _z5.point, _b11, _D33, v, _P, u.projection, h);

        x = _A9.useVertical, _P && _A9.needsFlipping && (_D33 = {}), (_A9.notEnoughRoom || x || _A9.needsFlipping && et(_y9, _I5, !0, l, i, n, a, t.glyphOffsetArray, f, m, _z5.point, _b11, _D33, v, _P, u.projection, h).notEnoughRoom) && nt(_y9.numGlyphs, m);
      }

      r ? t.text.dynamicLayoutVertexBuffer.updateData(m) : t.icon.dynamicLayoutVertexBuffer.updateData(m);
    }

    function Je(e, t, i, o, r, n, a, s, l, c, h, u, _, d, p) {
      var m = s.glyphStartIndex + s.numGlyphs,
          f = s.lineStartIndex,
          g = s.lineStartIndex + s.lineLength,
          v = t.getoffsetX(s.glyphStartIndex),
          x = t.getoffsetX(m - 1),
          y = ot(e * v, i, o, r, n, a, s.segment, f, g, l, c, h, u, _, !0, d, p);
      if (!y) return null;
      var b = ot(e * x, i, o, r, n, a, s.segment, f, g, l, c, h, u, _, !0, d, p);
      return b ? {
        first: y,
        last: b
      } : null;
    }

    function Qe(t, i, o, r) {
      return t.writingMode === e.WritingMode.horizontal && Math.abs(o.y - i.y) > Math.abs(o.x - i.x) * r ? {
        useVertical: !0
      } : t.writingMode === e.WritingMode.vertical ? i.y < o.y ? {
        needsFlipping: !0
      } : null : 0 !== t.flipState && function (e, t, i) {
        var o = (t.x - e.x) * i;
        return 0 === o || Math.abs((t.y - e.y) / o) > We;
      }(i, o, r) ? 1 === t.flipState ? {
        needsFlipping: !0
      } : null : i.x > o.x ? {
        needsFlipping: !0
      } : null;
    }

    function et(t, i, o, r, n, a, s, l, c, h, u, _, d, p, m, f, g) {
      var v = i / 24,
          x = t.lineOffsetX * v,
          y = t.lineOffsetY * v;
      var b;

      if (t.numGlyphs > 1) {
        var _e277 = t.glyphStartIndex + t.numGlyphs,
            _i170 = t.lineStartIndex,
            _n157 = t.lineStartIndex + t.lineLength,
            _h26 = Je(v, l, x, y, o, u, _, t, c, a, d, m, !1, f, g);

        if (!_h26) return {
          notEnoughRoom: !0
        };
        var _w10 = $e(_h26.first.point, s).point,
            _T4 = $e(_h26.last.point, s).point;

        if (r && !o) {
          var _e278 = Qe(t, _w10, _T4, p);

          if (t.flipState = _e278 && _e278.needsFlipping ? 1 : 2, _e278) return _e278;
        }

        b = [_h26.first];

        for (var _r227 = t.glyphStartIndex + 1; _r227 < _e277 - 1; _r227++) {
          b.push(ot(v * l.getoffsetX(_r227), x, y, o, u, _, t.segment, _i170, _n157, c, a, d, m, !1, !1, f, g));
        }

        b.push(_h26.last);
      } else {
        if (r && !o) {
          var _i172 = $e(_, n).point,
              _o88 = t.lineStartIndex + t.segment + 1,
              _r228 = new e.pointGeometry(c.getx(_o88), c.gety(_o88)),
              _a93 = $e(_r228, n),
              _s114 = Qe(t, _i172, _a93.signedDistanceFromCamera > 0 ? _a93.point : it(_, _r228, _i172, 1, n, void 0, f, g.canonical), p);

          if (t.flipState = _s114 && _s114.needsFlipping ? 1 : 2, _s114) return _s114;
        }

        var _i171 = ot(v * l.getoffsetX(t.glyphStartIndex), x, y, o, u, _, t.segment, t.lineStartIndex, t.lineStartIndex + t.lineLength, c, a, d, m, !1, !1, f, g);

        if (!_i171) return {
          notEnoughRoom: !0
        };
        b = [_i171];
      }

      var _iterator181 = _createForOfIteratorHelper(b),
          _step181;

      try {
        for (_iterator181.s(); !(_step181 = _iterator181.n()).done;) {
          var _t288 = _step181.value;
          e.addDynamicAttributes(h, _t288.point, _t288.angle);
        }
      } catch (err) {
        _iterator181.e(err);
      } finally {
        _iterator181.f();
      }

      return {};
    }

    function tt(t, i, o, r, n) {
      var a = r.projectTilePoint(t.x, t.y, i);
      if (!n) return $e(a, o, a.z);
      var s = n(t);
      return $e(new e.pointGeometry(a.x + s[0], a.y + s[1]), o, a.z + s[2]);
    }

    function it(e, t, i, o, r, n, a, s) {
      var l = tt(e.add(e.sub(t)._unit()), s, r, a, n).point,
          c = i.sub(l);
      return i.add(c._mult(o / c.mag()));
    }

    function ot(t, i, o, r, n, a, s, l, c, h, u, _, d, p, m, f, g) {
      var v = r ? t - i : t + i;
      var x = v > 0 ? 1 : -1,
          y = 0;
      r && (x *= -1, y = Math.PI), x < 0 && (y += Math.PI);
      var b = x > 0 ? l + s : l + s + 1,
          w = n,
          T = n,
          E = 0,
          C = 0;
      var M = Math.abs(v),
          S = [],
          I = [];
      var z = a;

      var D = function D() {
        var t = b - x;
        return 0 === E ? a : new e.pointGeometry(h.getx(t), h.gety(t));
      },
          P = function P() {
        return it(D(), z, T, M - E + 1, u, d, f, g.canonical);
      };

      for (; E + C <= M;) {
        if (b += x, b < l || b >= c) return null;

        if (T = w, S.push(w), p && I.push(z || D()), w = _[b], void 0 === w) {
          z = new e.pointGeometry(h.getx(b), h.gety(b));

          var _t289 = tt(z, g.canonical, u, f, d);

          w = _t289.signedDistanceFromCamera > 0 ? _[b] = _t289.point : P();
        } else z = null;

        E += C, C = T.dist(w);
      }

      m && d && (z = z || new e.pointGeometry(h.getx(b), h.gety(b)), _[b] = w = void 0 === _[b] ? w : P(), C = T.dist(w));

      var A = (M - E) / C,
          L = w.sub(T),
          R = L.mult(A)._add(T);

      o && R._add(L._unit()._perp()._mult(o * x));
      var k = y + Math.atan2(w.y - T.y, w.x - T.x);
      return S.push(R), p && (z = z || new e.pointGeometry(h.getx(b), h.gety(b)), I.push(function (t, i, o) {
        var r = 1 - o;
        return new e.pointGeometry(t.x * r + i.x * o, t.y * r + i.y * o);
      }(I.length > 0 ? I[I.length - 1] : z, z, A))), {
        point: R,
        angle: k,
        path: S,
        tilePath: I
      };
    }

    var rt = new Float32Array([-1 / 0, -1 / 0, 0, -1 / 0, -1 / 0, 0, -1 / 0, -1 / 0, 0, -1 / 0, -1 / 0, 0]);

    function nt(e, t) {
      for (var _i173 = 0; _i173 < e; _i173++) {
        var _e279 = t.length;
        t.resize(_e279 + 4), t.float32.set(rt, 3 * _e279);
      }
    }

    function at(e, t, i) {
      var o = t[0],
          r = t[1];
      return e[0] = i[0] * o + i[4] * r + i[12], e[1] = i[1] * o + i[5] * r + i[13], e[3] = i[3] * o + i[7] * r + i[15], e;
    }

    var st = 100;

    var lt = /*#__PURE__*/function () {
      function lt(e, t) {
        var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : new Ve(e.width + 200, e.height + 200, 25);
        var o = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : new Ve(e.width + 200, e.height + 200, 25);

        _classCallCheck(this, lt);

        this.transform = e, this.grid = i, this.ignoredGrid = o, this.pitchfactor = Math.cos(e._pitch) * e.cameraToCenterDistance, this.screenRightBoundary = e.width + st, this.screenBottomBoundary = e.height + st, this.gridRightBoundary = e.width + 200, this.gridBottomBoundary = e.height + 200, this.fogState = t;
      }

      _createClass(lt, [{
        key: "placeCollisionBox",
        value: function placeCollisionBox(e, t, i, o, r, n, a) {
          var s = t.projectedAnchorX,
              l = t.projectedAnchorY,
              c = t.projectedAnchorZ;
          var h = t.elevation,
              u = t.tileID;

          if (h && u) {
            var _e280 = this.transform.projection.createTileTransform(this.transform, this.transform.worldSize),
                _i174 = _e280.upVector(u.canonical, t.tileAnchorX, t.tileAnchorY),
                _o89 = _e280.upVectorScale(u.canonical);

            s += _i174[0] * h * _o89, l += _i174[1] * h * _o89, c += _i174[2] * h * _o89;
          }

          var _ = this.projectAndGetPerspectiveRatio(n, s, l, c, t.tileID),
              d = r * _.perspectiveRatio,
              p = (t.x1 * e + i.x - t.padding) * d + _.point.x,
              m = (t.y1 * e + i.y - t.padding) * d + _.point.y,
              f = (t.x2 * e + i.x + t.padding) * d + _.point.x,
              g = (t.y2 * e + i.y + t.padding) * d + _.point.y,
              v = _.perspectiveRatio <= .55 || _.aboveHorizon;

          return !this.isInsideGrid(p, m, f, g) || !o && this.grid.hitTest(p, m, f, g, a) || v ? {
            box: [],
            offscreen: !1
          } : {
            box: [p, m, f, g],
            offscreen: this.isOffscreen(p, m, f, g)
          };
        }
      }, {
        key: "placeCollisionCircles",
        value: function placeCollisionCircles(t, i, o, r, n, a, s, l, c, h, u, _, d, p) {
          var m = [],
              f = this.transform.elevation,
              g = this.transform.projection.createTileTransform(this.transform, this.transform.worldSize),
              v = f ? f.getAtTileOffsetFunc(p, g) : function (e) {
            return [0, 0, 0];
          },
              x = new e.pointGeometry(i.tileAnchorX, i.tileAnchorY),
              y = this.transform.projection.projectTilePoint(i.tileAnchorX, i.tileAnchorY, p.canonical),
              b = v(x),
              w = [y.x + b[0], y.y + b[1], y.z + b[2]],
              T = this.projectAndGetPerspectiveRatio(a, w[0], w[1], w[2], p),
              E = T.perspectiveRatio,
              C = (h ? n / E : n * E) / e.ONE_EM,
              M = $e(new e.pointGeometry(w[0], w[1]), s, w[2]).point,
              S = T.signedDistanceFromCamera > 0 ? Je(C, r, i.lineOffsetX * C, i.lineOffsetY * C, !1, M, x, i, o, s, {}, f && !h ? v : null, h && !!f, this.transform.projection, p) : null;
          var I = !1,
              z = !1,
              D = !0;

          if (S && !T.aboveHorizon) {
            var _i175 = .5 * _ * E + d,
                _o90 = new e.pointGeometry(-100, -100),
                _r229 = new e.pointGeometry(this.screenRightBoundary, this.screenBottomBoundary),
                _n158 = new Ze(),
                _a94 = S.first,
                _s115 = S.last;

            var _h27 = [];

            for (var _e281 = _a94.path.length - 1; _e281 >= 1; _e281--) {
              _h27.push(_a94.path[_e281]);
            }

            for (var _e282 = 1; _e282 < _s115.path.length; _e282++) {
              _h27.push(_s115.path[_e282]);
            }

            var _p26 = 2.5 * _i175;

            if (l) {
              var _e283 = _h27.map(f ? function (e, t) {
                var i = v(t < _a94.path.length - 1 ? _a94.tilePath[_a94.path.length - 1 - t] : _s115.tilePath[t - _a94.path.length + 2]);
                return $e(e, l, i[2]);
              } : function (e) {
                return $e(e, l);
              });

              _h27 = _e283.some(function (e) {
                return e.signedDistanceFromCamera <= 0;
              }) ? [] : _e283.map(function (e) {
                return e.point;
              });
            }

            var _g15 = [];

            if (_h27.length > 0) {
              var _t290 = _h27[0].clone(),
                  _i176 = _h27[0].clone();

              for (var _e284 = 1; _e284 < _h27.length; _e284++) {
                _t290.x = Math.min(_t290.x, _h27[_e284].x), _t290.y = Math.min(_t290.y, _h27[_e284].y), _i176.x = Math.max(_i176.x, _h27[_e284].x), _i176.y = Math.max(_i176.y, _h27[_e284].y);
              }

              _g15 = _t290.x >= _o90.x && _i176.x <= _r229.x && _t290.y >= _o90.y && _i176.y <= _r229.y ? [_h27] : _i176.x < _o90.x || _t290.x > _r229.x || _i176.y < _o90.y || _t290.y > _r229.y ? [] : e.clipLine([_h27], _o90.x, _o90.y, _r229.x, _r229.y);
            }

            var _iterator182 = _createForOfIteratorHelper(_g15),
                _step182;

            try {
              for (_iterator182.s(); !(_step182 = _iterator182.n()).done;) {
                var _e285 = _step182.value;

                _n158.reset(_e285, .25 * _i175);

                var _o91 = 0;
                _o91 = _n158.length <= .5 * _i175 ? 1 : Math.ceil(_n158.paddedLength / _p26) + 1;

                for (var _e286 = 0; _e286 < _o91; _e286++) {
                  var _r230 = _e286 / Math.max(_o91 - 1, 1),
                      _a95 = _n158.lerp(_r230),
                      _s116 = _a95.x + st,
                      _l60 = _a95.y + st;

                  m.push(_s116, _l60, _i175, 0);

                  var _h28 = _s116 - _i175,
                      _11 = _l60 - _i175,
                      _d19 = _s116 + _i175,
                      _p27 = _l60 + _i175;

                  if (D = D && this.isOffscreen(_h28, _11, _d19, _p27), z = z || this.isInsideGrid(_h28, _11, _d19, _p27), !t && this.grid.hitTestCircle(_s116, _l60, _i175, u) && (I = !0, !c)) return {
                    circles: [],
                    offscreen: !1,
                    collisionDetected: I
                  };
                }
              }
            } catch (err) {
              _iterator182.e(err);
            } finally {
              _iterator182.f();
            }
          }

          return {
            circles: !c && I || !z ? [] : m,
            offscreen: D,
            collisionDetected: I
          };
        }
      }, {
        key: "queryRenderedSymbols",
        value: function queryRenderedSymbols(t) {
          if (0 === t.length || 0 === this.grid.keysLength() && 0 === this.ignoredGrid.keysLength()) return {};
          var i = [];
          var o = 1 / 0,
              r = 1 / 0,
              n = -1 / 0,
              a = -1 / 0;

          var _iterator183 = _createForOfIteratorHelper(t),
              _step183;

          try {
            for (_iterator183.s(); !(_step183 = _iterator183.n()).done;) {
              var _s117 = _step183.value;

              var _t291 = new e.pointGeometry(_s117.x + st, _s117.y + st);

              o = Math.min(o, _t291.x), r = Math.min(r, _t291.y), n = Math.max(n, _t291.x), a = Math.max(a, _t291.y), i.push(_t291);
            }
          } catch (err) {
            _iterator183.e(err);
          } finally {
            _iterator183.f();
          }

          var s = this.grid.query(o, r, n, a).concat(this.ignoredGrid.query(o, r, n, a)),
              l = {},
              c = {};

          var _iterator184 = _createForOfIteratorHelper(s),
              _step184;

          try {
            for (_iterator184.s(); !(_step184 = _iterator184.n()).done;) {
              var _t292 = _step184.value;
              var _o92 = _t292.key;
              if (void 0 === l[_o92.bucketInstanceId] && (l[_o92.bucketInstanceId] = {}), l[_o92.bucketInstanceId][_o92.featureIndex]) continue;
              var _r231 = [new e.pointGeometry(_t292.x1, _t292.y1), new e.pointGeometry(_t292.x2, _t292.y1), new e.pointGeometry(_t292.x2, _t292.y2), new e.pointGeometry(_t292.x1, _t292.y2)];
              e.polygonIntersectsPolygon(i, _r231) && (l[_o92.bucketInstanceId][_o92.featureIndex] = !0, void 0 === c[_o92.bucketInstanceId] && (c[_o92.bucketInstanceId] = []), c[_o92.bucketInstanceId].push(_o92.featureIndex));
            }
          } catch (err) {
            _iterator184.e(err);
          } finally {
            _iterator184.f();
          }

          return c;
        }
      }, {
        key: "insertCollisionBox",
        value: function insertCollisionBox(e, t, i, o, r) {
          (t ? this.ignoredGrid : this.grid).insert({
            bucketInstanceId: i,
            featureIndex: o,
            collisionGroupID: r
          }, e[0], e[1], e[2], e[3]);
        }
      }, {
        key: "insertCollisionCircles",
        value: function insertCollisionCircles(e, t, i, o, r) {
          var n = t ? this.ignoredGrid : this.grid,
              a = {
            bucketInstanceId: i,
            featureIndex: o,
            collisionGroupID: r
          };

          for (var _t293 = 0; _t293 < e.length; _t293 += 4) {
            n.insertCircle(a, e[_t293], e[_t293 + 1], e[_t293 + 2]);
          }
        }
      }, {
        key: "projectAndGetPerspectiveRatio",
        value: function projectAndGetPerspectiveRatio(t, i, o, r, n) {
          var a = [i, o, r || 0, 1];
          var s = !1;

          if (r || this.transform.pitch > 0) {
            e.transformMat4$1(a, a, t);

            var _l61 = !1;

            this.fogState && n && (_l61 = function (t, i, o, r, n, a) {
              var s = a.calculateFogTileMatrix(n),
                  l = [i, o, r];
              return e.transformMat4(l, l, s), y(t, l, a.pitch, a._fov);
            }(this.fogState, i, o, r || 0, n.toUnwrapped(), this.transform) > .9), s = a[2] > a[3] || _l61;
          } else at(a, a, t);

          return {
            point: new e.pointGeometry((a[0] / a[3] + 1) / 2 * this.transform.width + st, (-a[1] / a[3] + 1) / 2 * this.transform.height + st),
            perspectiveRatio: Math.min(.5 + this.transform.cameraToCenterDistance / a[3] * .5, 1.5),
            signedDistanceFromCamera: a[3],
            aboveHorizon: s
          };
        }
      }, {
        key: "isOffscreen",
        value: function isOffscreen(e, t, i, o) {
          return i < st || e >= this.screenRightBoundary || o < st || t > this.screenBottomBoundary;
        }
      }, {
        key: "isInsideGrid",
        value: function isInsideGrid(e, t, i, o) {
          return i >= 0 && e < this.gridRightBoundary && o >= 0 && t < this.gridBottomBoundary;
        }
      }, {
        key: "getViewportMatrix",
        value: function getViewportMatrix() {
          var t = e.identity([]);
          return e.translate(t, t, [-100, -100, 0]), t;
        }
      }]);

      return lt;
    }();

    var ct = /*#__PURE__*/function () {
      function ct(e, t, i, o) {
        _classCallCheck(this, ct);

        this.opacity = e ? Math.max(0, Math.min(1, e.opacity + (e.placed ? t : -t))) : o && i ? 1 : 0, this.placed = i;
      }

      _createClass(ct, [{
        key: "isHidden",
        value: function isHidden() {
          return 0 === this.opacity && !this.placed;
        }
      }]);

      return ct;
    }();

    var ht = /*#__PURE__*/function () {
      function ht(e, t, i, o, r) {
        var n = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : !1;

        _classCallCheck(this, ht);

        this.text = new ct(e ? e.text : null, t, i, r), this.icon = new ct(e ? e.icon : null, t, o, r), this.clipped = n;
      }

      _createClass(ht, [{
        key: "isHidden",
        value: function isHidden() {
          return this.text.isHidden() && this.icon.isHidden();
        }
      }]);

      return ht;
    }();

    var ut = /*#__PURE__*/_createClass(function ut(e, t, i) {
      var o = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : !1;

      _classCallCheck(this, ut);

      this.text = e, this.icon = t, this.skipFade = i, this.clipped = o;
    });

    var _t = /*#__PURE__*/_createClass(function _t() {
      _classCallCheck(this, _t);

      this.invProjMatrix = e.create(), this.viewportMatrix = e.create(), this.circles = [];
    });

    var dt = /*#__PURE__*/_createClass(function dt(e, t, i, o, r) {
      _classCallCheck(this, dt);

      this.bucketInstanceId = e, this.featureIndex = t, this.sourceLayerIndex = i, this.bucketIndex = o, this.tileID = r;
    });

    var pt = /*#__PURE__*/function () {
      function pt(e) {
        _classCallCheck(this, pt);

        this.crossSourceCollisions = e, this.maxGroupID = 0, this.collisionGroups = {};
      }

      _createClass(pt, [{
        key: "get",
        value: function get(e) {
          if (this.crossSourceCollisions) return {
            ID: 0,
            predicate: null
          };

          if (!this.collisionGroups[e]) {
            var _t294 = ++this.maxGroupID;

            this.collisionGroups[e] = {
              ID: _t294,
              predicate: function predicate(e) {
                return e.collisionGroupID === _t294;
              }
            };
          }

          return this.collisionGroups[e];
        }
      }]);

      return pt;
    }();

    function mt(t, i, o, r, n) {
      var _e$getAnchorAlignment = e.getAnchorAlignment(t),
          a = _e$getAnchorAlignment.horizontalAlign,
          s = _e$getAnchorAlignment.verticalAlign,
          l = -(a - .5) * i,
          c = -(s - .5) * o,
          h = e.evaluateVariableOffset(t, r);

      return new e.pointGeometry(l + h[0] * n, c + h[1] * n);
    }

    function ft(t, i, o, r, n) {
      var a = new e.pointGeometry(t, i);
      return o && a._rotate(r ? n : -n), a;
    }

    var gt = /*#__PURE__*/function () {
      function gt(e, t, i, o, r) {
        _classCallCheck(this, gt);

        this.transform = e.clone(), this.collisionIndex = new lt(this.transform, r), this.placements = {}, this.opacities = {}, this.variableOffsets = {}, this.stale = !1, this.commitTime = 0, this.fadeDuration = t, this.retainedQueryData = {}, this.collisionGroups = new pt(i), this.collisionCircleArrays = {}, this.prevPlacement = o, o && (o.prevPlacement = void 0), this.placedOrientations = {};
      }

      _createClass(gt, [{
        key: "getBucketParts",
        value: function getBucketParts(t, i, o, r) {
          var n = o.getBucket(i),
              a = o.latestFeatureIndex;
          if (!n || !a || i.id !== n.layerIds[0]) return;

          var s = n.layers[0].layout,
              l = o.collisionBoxArray,
              c = Math.pow(2, this.transform.zoom - o.tileID.overscaledZ),
              h = o.tileSize / e.EXTENT,
              u = o.tileID.toUnwrapped(),
              _ = this.transform.calculateProjMatrix(u),
              d = "map" === s.get("text-pitch-alignment"),
              p = "map" === s.get("text-rotation-alignment");

          i.compileFilter();
          var m = i.dynamicFilter(),
              f = i.dynamicFilterNeedsFeature(),
              g = this.transform.calculatePixelsToTileUnitsMatrix(o),
              v = qe(_, o.tileID.canonical, d, p, this.transform, g);
          var x = null;

          if (d) {
            var _t295 = Xe(_, o.tileID.canonical, d, p, this.transform, g);

            x = e.multiply$1([], this.transform.labelPlaneMatrix, _t295);
          }

          var y = null;
          m && o.latestFeatureIndex && (y = {
            unwrappedTileID: u,
            dynamicFilter: m,
            dynamicFilterNeedsFeature: f,
            featureIndex: o.latestFeatureIndex
          }), this.retainedQueryData[n.bucketInstanceId] = new dt(n.bucketInstanceId, a, n.sourceLayerIndex, n.index, o.tileID);
          var b = {
            bucket: n,
            layout: s,
            posMatrix: _,
            textLabelPlaneMatrix: v,
            labelToScreenMatrix: x,
            clippingData: y,
            scale: c,
            textPixelRatio: h,
            holdingForFade: o.holdingForFade(),
            collisionBoxArray: l,
            partiallyEvaluatedTextSize: e.evaluateSizeForZoom(n.textSizeData, this.transform.zoom),
            partiallyEvaluatedIconSize: e.evaluateSizeForZoom(n.iconSizeData, this.transform.zoom),
            collisionGroup: this.collisionGroups.get(n.sourceID)
          };

          if (r) {
            var _iterator185 = _createForOfIteratorHelper(n.sortKeyRanges),
                _step185;

            try {
              for (_iterator185.s(); !(_step185 = _iterator185.n()).done;) {
                var _e287 = _step185.value;
                var _i177 = _e287.sortKey,
                    _o93 = _e287.symbolInstanceStart,
                    _r232 = _e287.symbolInstanceEnd;
                t.push({
                  sortKey: _i177,
                  symbolInstanceStart: _o93,
                  symbolInstanceEnd: _r232,
                  parameters: b
                });
              }
            } catch (err) {
              _iterator185.e(err);
            } finally {
              _iterator185.f();
            }
          } else t.push({
            symbolInstanceStart: 0,
            symbolInstanceEnd: n.symbolInstances.length,
            parameters: b
          });
        }
      }, {
        key: "attemptAnchorPlacement",
        value: function attemptAnchorPlacement(e, t, i, o, r, n, a, s, l, c, h, u, _, d, p, m, f, g) {
          var v = [u.textOffset0, u.textOffset1],
              x = mt(e, i, o, v, r),
              y = this.collisionIndex.placeCollisionBox(r, t, ft(x.x, x.y, n, a, this.transform.angle), h, s, l, c.predicate);

          if ((!m || 0 !== this.collisionIndex.placeCollisionBox(d.getSymbolInstanceIconSize(g, this.transform.zoom, _), m, ft(x.x, x.y, n, a, this.transform.angle), h, s, l, c.predicate).box.length) && y.box.length > 0) {
            var _t296;

            return this.prevPlacement && this.prevPlacement.variableOffsets[u.crossTileID] && this.prevPlacement.placements[u.crossTileID] && this.prevPlacement.placements[u.crossTileID].text && (_t296 = this.prevPlacement.variableOffsets[u.crossTileID].anchor), this.variableOffsets[u.crossTileID] = {
              textOffset: v,
              width: i,
              height: o,
              anchor: e,
              textScale: r,
              prevAnchor: _t296
            }, this.markUsedJustification(d, e, u, p), d.allowVerticalPlacement && (this.markUsedOrientation(d, p, u), this.placedOrientations[u.crossTileID] = p), {
              shift: x,
              placedGlyphBoxes: y
            };
          }
        }
      }, {
        key: "placeLayerBucketPart",
        value: function placeLayerBucketPart(t, i, o, r) {
          var _this85 = this;

          var _t$parameters = t.parameters,
              n = _t$parameters.bucket,
              a = _t$parameters.layout,
              s = _t$parameters.posMatrix,
              l = _t$parameters.textLabelPlaneMatrix,
              c = _t$parameters.labelToScreenMatrix,
              h = _t$parameters.clippingData,
              u = _t$parameters.textPixelRatio,
              _ = _t$parameters.holdingForFade,
              d = _t$parameters.collisionBoxArray,
              p = _t$parameters.partiallyEvaluatedTextSize,
              m = _t$parameters.partiallyEvaluatedIconSize,
              f = _t$parameters.collisionGroup,
              g = a.get("text-optional"),
              v = a.get("icon-optional"),
              x = a.get("text-allow-overlap"),
              y = a.get("icon-allow-overlap"),
              b = "map" === a.get("text-rotation-alignment"),
              w = "map" === a.get("text-pitch-alignment"),
              T = "none" !== a.get("icon-text-fit"),
              E = "viewport-y" === a.get("symbol-z-order"),
              C = x && (y || !n.hasIconData() || v),
              M = y && (x || !n.hasTextData() || g);
          !n.collisionArrays && d && n.deserializeCollisionBoxes(d), o && r && n.updateCollisionDebugBuffers(this.transform.zoom, d);

          var S = function S(t, r, d) {
            if (h) {
              var _o94 = {
                zoom: _this85.transform.zoom,
                pitch: _this85.transform.pitch
              };
              var _r233 = null;

              if (h.dynamicFilterNeedsFeature) {
                var _e288 = _this85.retainedQueryData[n.bucketInstanceId];
                _r233 = h.featureIndex.loadFeature({
                  featureIndex: t.featureIndex,
                  bucketIndex: _e288.bucketIndex,
                  sourceLayerIndex: _e288.sourceLayerIndex,
                  layoutVertexArrayOffset: 0
                });
              }

              if (!(0, h.dynamicFilter)(_o94, _r233, _this85.retainedQueryData[n.bucketInstanceId].tileID.canonical, new e.pointGeometry(t.tileAnchorX, t.tileAnchorY), _this85.transform.calculateDistanceTileData(h.unwrappedTileID))) return _this85.placements[t.crossTileID] = new ut(!1, !1, !1, !0), void (i[t.crossTileID] = !0);
            }

            if (i[t.crossTileID]) return;
            if (_) return void (_this85.placements[t.crossTileID] = new ut(!1, !1, !1));
            var E = !1,
                S = !1,
                I = !0,
                z = null,
                D = {
              box: null,
              offscreen: null
            },
                P = {
              box: null,
              offscreen: null
            },
                A = null,
                L = null,
                R = null,
                k = 0,
                O = 0,
                B = 0;
            d.textFeatureIndex ? k = d.textFeatureIndex : t.useRuntimeCollisionCircles && (k = t.featureIndex), d.verticalTextFeatureIndex && (O = d.verticalTextFeatureIndex);

            var F = function F(e) {
              e.tileID = _this85.retainedQueryData[n.bucketInstanceId].tileID, (_this85.transform.elevation || e.elevation) && (e.elevation = _this85.transform.elevation ? _this85.transform.elevation.getAtTileOffset(_this85.retainedQueryData[n.bucketInstanceId].tileID, e.tileAnchorX, e.tileAnchorY) : 0);
            },
                U = d.textBox;

            if (U) {
              F(U);

              var _i178 = function _i178(i) {
                var o = e.WritingMode.horizontal;

                if (n.allowVerticalPlacement && !i && _this85.prevPlacement) {
                  var _e289 = _this85.prevPlacement.placedOrientations[t.crossTileID];
                  _e289 && (_this85.placedOrientations[t.crossTileID] = _e289, o = _e289, _this85.markUsedOrientation(n, o, t));
                }

                return o;
              },
                  _o95 = function _o95(i, o) {
                if (n.allowVerticalPlacement && t.numVerticalGlyphVertices > 0 && d.verticalTextBox) {
                  var _iterator186 = _createForOfIteratorHelper(n.writingModes),
                      _step186;

                  try {
                    for (_iterator186.s(); !(_step186 = _iterator186.n()).done;) {
                      var _t297 = _step186.value;
                      if (_t297 === e.WritingMode.vertical ? (D = o(), P = D) : D = i(), D && D.box && D.box.length) break;
                    }
                  } catch (err) {
                    _iterator186.e(err);
                  } finally {
                    _iterator186.f();
                  }
                } else D = i();
              };

              if (a.get("text-variable-anchor")) {
                var _l62 = a.get("text-variable-anchor");

                if (_this85.prevPlacement && _this85.prevPlacement.variableOffsets[t.crossTileID]) {
                  var _e290 = _this85.prevPlacement.variableOffsets[t.crossTileID];
                  _l62.indexOf(_e290.anchor) > 0 && (_l62 = _l62.filter(function (t) {
                    return t !== _e290.anchor;
                  }), _l62.unshift(_e290.anchor));
                }

                var _c38 = function _c38(e, i, o) {
                  var a = n.getSymbolInstanceTextSize(p, t, _this85.transform.zoom, r),
                      c = (e.x2 - e.x1) * a + 2 * e.padding,
                      h = (e.y2 - e.y1) * a + 2 * e.padding,
                      _ = T && !y ? i : null;

                  _ && F(_);
                  var d = {
                    box: [],
                    offscreen: !1
                  };
                  var g = x ? 2 * _l62.length : _l62.length;

                  for (var _i179 = 0; _i179 < g; ++_i179) {
                    var _g16 = _this85.attemptAnchorPlacement(_l62[_i179 % _l62.length], e, c, h, a, b, w, u, s, f, _i179 >= _l62.length, t, r, n, o, _, p, m);

                    if (_g16 && (d = _g16.placedGlyphBoxes, d && d.box && d.box.length)) {
                      E = !0, z = _g16.shift;
                      break;
                    }
                  }

                  return d;
                };

                _o95(function () {
                  return _c38(U, d.iconBox, e.WritingMode.horizontal);
                }, function () {
                  var i = d.verticalTextBox;
                  return i && F(i), n.allowVerticalPlacement && !(D && D.box && D.box.length) && t.numVerticalGlyphVertices > 0 && i ? _c38(i, d.verticalIconBox, e.WritingMode.vertical) : {
                    box: null,
                    offscreen: null
                  };
                }), D && (E = D.box, I = D.offscreen);

                var _h29 = _i178(D && D.box);

                if (!E && _this85.prevPlacement) {
                  var _e291 = _this85.prevPlacement.variableOffsets[t.crossTileID];
                  _e291 && (_this85.variableOffsets[t.crossTileID] = _e291, _this85.markUsedJustification(n, _e291.anchor, t, _h29));
                }
              } else {
                var _a96 = function _a96(i, o) {
                  var a = n.getSymbolInstanceTextSize(p, t, _this85.transform.zoom, r),
                      l = _this85.collisionIndex.placeCollisionBox(a, i, new e.pointGeometry(0, 0), x, u, s, f.predicate);

                  return l && l.box && l.box.length && (_this85.markUsedOrientation(n, o, t), _this85.placedOrientations[t.crossTileID] = o), l;
                };

                _o95(function () {
                  return _a96(U, e.WritingMode.horizontal);
                }, function () {
                  var i = d.verticalTextBox;
                  return n.allowVerticalPlacement && t.numVerticalGlyphVertices > 0 && i ? (F(i), _a96(i, e.WritingMode.vertical)) : {
                    box: null,
                    offscreen: null
                  };
                }), _i178(D && D.box && D.box.length);
              }
            }

            if (A = D, E = A && A.box && A.box.length > 0, I = A && A.offscreen, t.useRuntimeCollisionCircles) {
              var _i180 = n.text.placedSymbolArray.get(t.centerJustifiedTextSymbolIndex >= 0 ? t.centerJustifiedTextSymbolIndex : t.verticalPlacedTextSymbolIndex),
                  _r234 = e.evaluateSizeForFeature(n.textSizeData, p, _i180),
                  _h30 = a.get("text-padding");

              L = _this85.collisionIndex.placeCollisionCircles(x, _i180, n.lineVertexArray, n.glyphOffsetArray, _r234, s, l, c, o, w, f.predicate, t.collisionCircleDiameter * _r234 / e.ONE_EM, _h30, _this85.retainedQueryData[n.bucketInstanceId].tileID), E = x || L.circles.length > 0 && !L.collisionDetected, I = I && L.offscreen;
            }

            if (d.iconFeatureIndex && (B = d.iconFeatureIndex), d.iconBox) {
              var _t298 = function _t298(t) {
                F(t);
                var i = T && z ? ft(z.x, z.y, b, w, _this85.transform.angle) : new e.pointGeometry(0, 0),
                    o = n.getSymbolInstanceIconSize(m, _this85.transform.zoom, r);
                return _this85.collisionIndex.placeCollisionBox(o, t, i, y, u, s, f.predicate);
              };

              P && P.box && P.box.length && d.verticalIconBox ? (R = _t298(d.verticalIconBox), S = R.box.length > 0) : (R = _t298(d.iconBox), S = R.box.length > 0), I = I && R.offscreen;
            }

            var N = g || 0 === t.numHorizontalGlyphVertices && 0 === t.numVerticalGlyphVertices,
                G = v || 0 === t.numIconVertices;

            if (N || G ? G ? N || (S = S && E) : E = S && E : S = E = S && E, E && A && A.box && _this85.collisionIndex.insertCollisionBox(A.box, a.get("text-ignore-placement"), n.bucketInstanceId, P && P.box && O ? O : k, f.ID), S && R && _this85.collisionIndex.insertCollisionBox(R.box, a.get("icon-ignore-placement"), n.bucketInstanceId, B, f.ID), L && (E && _this85.collisionIndex.insertCollisionCircles(L.circles, a.get("text-ignore-placement"), n.bucketInstanceId, k, f.ID), o)) {
              var _e292 = n.bucketInstanceId;
              var _t299 = _this85.collisionCircleArrays[_e292];
              void 0 === _t299 && (_t299 = _this85.collisionCircleArrays[_e292] = new _t());

              for (var _e293 = 0; _e293 < L.circles.length; _e293 += 4) {
                _t299.circles.push(L.circles[_e293 + 0]), _t299.circles.push(L.circles[_e293 + 1]), _t299.circles.push(L.circles[_e293 + 2]), _t299.circles.push(L.collisionDetected ? 1 : 0);
              }
            }

            _this85.placements[t.crossTileID] = new ut(E || C, S || M, I || n.justReloaded), i[t.crossTileID] = !0;
          };

          if (E) {
            var _e294 = n.getSortedSymbolIndexes(this.transform.angle);

            for (var _t300 = _e294.length - 1; _t300 >= 0; --_t300) {
              var _i181 = _e294[_t300];
              S(n.symbolInstances.get(_i181), _i181, n.collisionArrays[_i181]);
            }
          } else for (var _e295 = t.symbolInstanceStart; _e295 < t.symbolInstanceEnd; _e295++) {
            S(n.symbolInstances.get(_e295), _e295, n.collisionArrays[_e295]);
          }

          if (o && n.bucketInstanceId in this.collisionCircleArrays) {
            var _t301 = this.collisionCircleArrays[n.bucketInstanceId];
            e.invert(_t301.invProjMatrix, s), _t301.viewportMatrix = this.collisionIndex.getViewportMatrix();
          }

          n.justReloaded = !1;
        }
      }, {
        key: "markUsedJustification",
        value: function markUsedJustification(t, i, o, r) {
          var n;
          n = r === e.WritingMode.vertical ? o.verticalPlacedTextSymbolIndex : {
            left: o.leftJustifiedTextSymbolIndex,
            center: o.centerJustifiedTextSymbolIndex,
            right: o.rightJustifiedTextSymbolIndex
          }[e.getAnchorJustification(i)];
          var a = [o.leftJustifiedTextSymbolIndex, o.centerJustifiedTextSymbolIndex, o.rightJustifiedTextSymbolIndex, o.verticalPlacedTextSymbolIndex];

          for (var _i182 = 0, _a97 = a; _i182 < _a97.length; _i182++) {
            var _e296 = _a97[_i182];
            _e296 >= 0 && (t.text.placedSymbolArray.get(_e296).crossTileID = n >= 0 && _e296 !== n ? 0 : o.crossTileID);
          }
        }
      }, {
        key: "markUsedOrientation",
        value: function markUsedOrientation(t, i, o) {
          var r = i === e.WritingMode.horizontal || i === e.WritingMode.horizontalOnly ? i : 0,
              n = i === e.WritingMode.vertical ? i : 0,
              a = [o.leftJustifiedTextSymbolIndex, o.centerJustifiedTextSymbolIndex, o.rightJustifiedTextSymbolIndex];

          for (var _i183 = 0, _a98 = a; _i183 < _a98.length; _i183++) {
            var _e297 = _a98[_i183];
            t.text.placedSymbolArray.get(_e297).placedOrientation = r;
          }

          o.verticalPlacedTextSymbolIndex && (t.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).placedOrientation = n);
        }
      }, {
        key: "commit",
        value: function commit(e) {
          this.commitTime = e, this.zoomAtLastRecencyCheck = this.transform.zoom;
          var t = this.prevPlacement;
          var i = !1;
          this.prevZoomAdjustment = t ? t.zoomAdjustment(this.transform.zoom) : 0;
          var o = t ? t.symbolFadeChange(e) : 1,
              r = t ? t.opacities : {},
              n = t ? t.variableOffsets : {},
              a = t ? t.placedOrientations : {};

          for (var _e298 in this.placements) {
            var _t302 = this.placements[_e298],
                _n159 = r[_e298];
            _n159 ? (this.opacities[_e298] = new ht(_n159, o, _t302.text, _t302.icon, null, _t302.clipped), i = i || _t302.text !== _n159.text.placed || _t302.icon !== _n159.icon.placed) : (this.opacities[_e298] = new ht(null, o, _t302.text, _t302.icon, _t302.skipFade, _t302.clipped), i = i || _t302.text || _t302.icon);
          }

          for (var _e299 in r) {
            var _t303 = r[_e299];

            if (!this.opacities[_e299]) {
              var _r235 = new ht(_t303, o, !1, !1);

              _r235.isHidden() || (this.opacities[_e299] = _r235, i = i || _t303.text.placed || _t303.icon.placed);
            }
          }

          for (var _e300 in n) {
            this.variableOffsets[_e300] || !this.opacities[_e300] || this.opacities[_e300].isHidden() || (this.variableOffsets[_e300] = n[_e300]);
          }

          for (var _e301 in a) {
            this.placedOrientations[_e301] || !this.opacities[_e301] || this.opacities[_e301].isHidden() || (this.placedOrientations[_e301] = a[_e301]);
          }

          i ? this.lastPlacementChangeTime = e : "number" != typeof this.lastPlacementChangeTime && (this.lastPlacementChangeTime = t ? t.lastPlacementChangeTime : e);
        }
      }, {
        key: "updateLayerOpacities",
        value: function updateLayerOpacities(e, t) {
          var i = {};

          var _iterator187 = _createForOfIteratorHelper(t),
              _step187;

          try {
            for (_iterator187.s(); !(_step187 = _iterator187.n()).done;) {
              var _o96 = _step187.value;

              var _t304 = _o96.getBucket(e);

              _t304 && _o96.latestFeatureIndex && e.id === _t304.layerIds[0] && this.updateBucketOpacities(_t304, i, _o96.collisionBoxArray);
            }
          } catch (err) {
            _iterator187.e(err);
          } finally {
            _iterator187.f();
          }
        }
      }, {
        key: "updateBucketOpacities",
        value: function updateBucketOpacities(t, i, o) {
          var _this86 = this;

          t.hasTextData() && t.text.opacityVertexArray.clear(), t.hasIconData() && t.icon.opacityVertexArray.clear(), t.hasIconCollisionBoxData() && t.iconCollisionBox.collisionVertexArray.clear(), t.hasTextCollisionBoxData() && t.textCollisionBox.collisionVertexArray.clear();

          var r = t.layers[0].layout,
              n = !!t.layers[0].dynamicFilter(),
              a = new ht(null, 0, !1, !1, !0),
              s = r.get("text-allow-overlap"),
              l = r.get("icon-allow-overlap"),
              c = r.get("text-variable-anchor"),
              h = "map" === r.get("text-rotation-alignment"),
              u = "map" === r.get("text-pitch-alignment"),
              _ = "none" !== r.get("icon-text-fit"),
              d = new ht(null, 0, s && (l || !t.hasIconData() || r.get("icon-optional")), l && (s || !t.hasTextData() || r.get("text-optional")), !0);

          !t.collisionArrays && o && (t.hasIconCollisionBoxData() || t.hasTextCollisionBoxData()) && t.deserializeCollisionBoxes(o);

          var p = function p(e, t, i) {
            for (var _o97 = 0; _o97 < t / 4; _o97++) {
              e.opacityVertexArray.emplaceBack(i);
            }
          };

          var m = 0;

          var _loop7 = function _loop7(_o98) {
            var r = t.symbolInstances.get(_o98),
                s = r.numHorizontalGlyphVertices,
                l = r.numVerticalGlyphVertices,
                f = r.crossTileID;
            var g = _this86.opacities[f];
            i[f] ? g = a : g || (g = d, _this86.opacities[f] = g), i[f] = !0;
            var v = s > 0 || l > 0,
                x = r.numIconVertices > 0,
                y = _this86.placedOrientations[r.crossTileID],
                b = y === e.WritingMode.vertical,
                w = y === e.WritingMode.horizontal || y === e.WritingMode.horizontalOnly;

            if (!v && !x || g.isHidden() || m++, v) {
              var _e303 = Mt(g.text);

              p(t.text, s, b ? St : _e303), p(t.text, l, w ? St : _e303);

              var _i184 = g.text.isHidden();

              [r.rightJustifiedTextSymbolIndex, r.centerJustifiedTextSymbolIndex, r.leftJustifiedTextSymbolIndex].forEach(function (e) {
                e >= 0 && (t.text.placedSymbolArray.get(e).hidden = _i184 || b ? 1 : 0);
              }), r.verticalPlacedTextSymbolIndex >= 0 && (t.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).hidden = _i184 || w ? 1 : 0);
              var _o99 = _this86.variableOffsets[r.crossTileID];
              _o99 && _this86.markUsedJustification(t, _o99.anchor, r, y);
              var _n160 = _this86.placedOrientations[r.crossTileID];
              _n160 && (_this86.markUsedJustification(t, "left", r, _n160), _this86.markUsedOrientation(t, _n160, r));
            }

            if (x) {
              var _e304 = Mt(g.icon);

              r.placedIconSymbolIndex >= 0 && (p(t.icon, r.numIconVertices, b ? St : _e304), t.icon.placedSymbolArray.get(r.placedIconSymbolIndex).hidden = g.icon.isHidden()), r.verticalPlacedIconSymbolIndex >= 0 && (p(t.icon, r.numVerticalIconVertices, w ? St : _e304), t.icon.placedSymbolArray.get(r.verticalPlacedIconSymbolIndex).hidden = g.icon.isHidden());
            }

            if (t.hasIconCollisionBoxData() || t.hasTextCollisionBoxData()) {
              var _i185 = t.collisionArrays[_o98];

              if (_i185) {
                var _o100 = new e.pointGeometry(0, 0),
                    _r236 = !0;

                if (_i185.textBox || _i185.verticalTextBox) {
                  if (c) {
                    var _e305 = _this86.variableOffsets[f];
                    _e305 ? (_o100 = mt(_e305.anchor, _e305.width, _e305.height, _e305.textOffset, _e305.textScale), h && _o100._rotate(u ? _this86.transform.angle : -_this86.transform.angle)) : _r236 = !1;
                  }

                  n && (_r236 = !g.clipped), _i185.textBox && vt(t.textCollisionBox.collisionVertexArray, g.text.placed, !_r236 || b, _o100.x, _o100.y), _i185.verticalTextBox && vt(t.textCollisionBox.collisionVertexArray, g.text.placed, !_r236 || w, _o100.x, _o100.y);
                }

                var _a99 = _r236 && Boolean(!w && _i185.verticalIconBox);

                _i185.iconBox && vt(t.iconCollisionBox.collisionVertexArray, g.icon.placed, _a99, _ ? _o100.x : 0, _ ? _o100.y : 0), _i185.verticalIconBox && vt(t.iconCollisionBox.collisionVertexArray, g.icon.placed, !_a99, _ ? _o100.x : 0, _ ? _o100.y : 0);
              }
            }
          };

          for (var _o98 = 0; _o98 < t.symbolInstances.length; _o98++) {
            _loop7(_o98);
          }

          if (t.fullyClipped = 0 === m, t.sortFeatures(this.transform.angle), this.retainedQueryData[t.bucketInstanceId] && (this.retainedQueryData[t.bucketInstanceId].featureSortOrder = t.featureSortOrder), t.hasTextData() && t.text.opacityVertexBuffer && t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray), t.hasIconData() && t.icon.opacityVertexBuffer && t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray), t.hasIconCollisionBoxData() && t.iconCollisionBox.collisionVertexBuffer && t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray), t.hasTextCollisionBoxData() && t.textCollisionBox.collisionVertexBuffer && t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray), t.bucketInstanceId in this.collisionCircleArrays) {
            var _e302 = this.collisionCircleArrays[t.bucketInstanceId];
            t.placementInvProjMatrix = _e302.invProjMatrix, t.placementViewportMatrix = _e302.viewportMatrix, t.collisionCircleArray = _e302.circles, delete this.collisionCircleArrays[t.bucketInstanceId];
          }
        }
      }, {
        key: "symbolFadeChange",
        value: function symbolFadeChange(e) {
          return 0 === this.fadeDuration ? 1 : (e - this.commitTime) / this.fadeDuration + this.prevZoomAdjustment;
        }
      }, {
        key: "zoomAdjustment",
        value: function zoomAdjustment(e) {
          return Math.max(0, (this.transform.zoom - e) / 1.5);
        }
      }, {
        key: "hasTransitions",
        value: function hasTransitions(e) {
          return this.stale || e - this.lastPlacementChangeTime < this.fadeDuration;
        }
      }, {
        key: "stillRecent",
        value: function stillRecent(e, t) {
          var i = this.zoomAtLastRecencyCheck === t ? 1 - this.zoomAdjustment(t) : 1;
          return this.zoomAtLastRecencyCheck = t, this.commitTime + this.fadeDuration * i > e;
        }
      }, {
        key: "setStale",
        value: function setStale() {
          this.stale = !0;
        }
      }]);

      return gt;
    }();

    function vt(e, t, i, o, r) {
      e.emplaceBack(t ? 1 : 0, i ? 1 : 0, o || 0, r || 0), e.emplaceBack(t ? 1 : 0, i ? 1 : 0, o || 0, r || 0), e.emplaceBack(t ? 1 : 0, i ? 1 : 0, o || 0, r || 0), e.emplaceBack(t ? 1 : 0, i ? 1 : 0, o || 0, r || 0);
    }

    var xt = Math.pow(2, 25),
        yt = Math.pow(2, 24),
        bt = Math.pow(2, 17),
        wt = Math.pow(2, 16),
        Tt = Math.pow(2, 9),
        Et = Math.pow(2, 8),
        Ct = Math.pow(2, 1);

    function Mt(e) {
      if (0 === e.opacity && !e.placed) return 0;
      if (1 === e.opacity && e.placed) return 4294967295;
      var t = e.placed ? 1 : 0,
          i = Math.floor(127 * e.opacity);
      return i * xt + t * yt + i * bt + t * wt + i * Tt + t * Et + i * Ct + t;
    }

    var St = 0;

    var It = /*#__PURE__*/function () {
      function It(e) {
        _classCallCheck(this, It);

        this._sortAcrossTiles = "viewport-y" !== e.layout.get("symbol-z-order") && void 0 !== e.layout.get("symbol-sort-key").constantOr(1), this._currentTileIndex = 0, this._currentPartIndex = 0, this._seenCrossTileIDs = {}, this._bucketParts = [];
      }

      _createClass(It, [{
        key: "continuePlacement",
        value: function continuePlacement(e, t, i, o, r) {
          var n = this._bucketParts;

          for (; this._currentTileIndex < e.length;) {
            if (t.getBucketParts(n, o, e[this._currentTileIndex], this._sortAcrossTiles), this._currentTileIndex++, r()) return !0;
          }

          for (this._sortAcrossTiles && (this._sortAcrossTiles = !1, n.sort(function (e, t) {
            return e.sortKey - t.sortKey;
          })); this._currentPartIndex < n.length;) {
            var _e306 = n[this._currentPartIndex];
            if (t.placeLayerBucketPart(_e306, this._seenCrossTileIDs, i, 0 === _e306.symbolInstanceStart), this._currentPartIndex++, r()) return !0;
          }

          return !1;
        }
      }]);

      return It;
    }();

    var zt = /*#__PURE__*/function () {
      function zt(e, t, i, o, r, n, a, s) {
        _classCallCheck(this, zt);

        this.placement = new gt(e, r, n, a, s), this._currentPlacementIndex = t.length - 1, this._forceFullPlacement = i, this._showCollisionBoxes = o, this._done = !1;
      }

      _createClass(zt, [{
        key: "isDone",
        value: function isDone() {
          return this._done;
        }
      }, {
        key: "continuePlacement",
        value: function continuePlacement(t, i, o) {
          var _this87 = this;

          var r = e.exported.now(),
              n = function n() {
            var t = e.exported.now() - r;
            return !_this87._forceFullPlacement && t > 2;
          };

          for (; this._currentPlacementIndex >= 0;) {
            var _e307 = i[t[this._currentPlacementIndex]],
                _r237 = this.placement.collisionIndex.transform.zoom;

            if ("symbol" === _e307.type && (!_e307.minzoom || _e307.minzoom <= _r237) && (!_e307.maxzoom || _e307.maxzoom > _r237)) {
              if (this._inProgressLayer || (this._inProgressLayer = new It(_e307)), this._inProgressLayer.continuePlacement(o[_e307.source], this.placement, this._showCollisionBoxes, _e307, n)) return;
              delete this._inProgressLayer;
            }

            this._currentPlacementIndex--;
          }

          this._done = !0;
        }
      }, {
        key: "commit",
        value: function commit(e) {
          return this.placement.commit(e), this.placement;
        }
      }]);

      return zt;
    }();

    var Dt = 512 / e.EXTENT / 2;

    var Pt = /*#__PURE__*/function () {
      function Pt(e, t, i) {
        _classCallCheck(this, Pt);

        this.tileID = e, this.indexedSymbolInstances = {}, this.bucketInstanceId = i;

        for (var _i186 = 0; _i186 < t.length; _i186++) {
          var _o101 = t.get(_i186),
              _r238 = _o101.key;

          this.indexedSymbolInstances[_r238] || (this.indexedSymbolInstances[_r238] = []), this.indexedSymbolInstances[_r238].push({
            crossTileID: _o101.crossTileID,
            coord: this.getScaledCoordinates(_o101, e)
          });
        }
      }

      _createClass(Pt, [{
        key: "getScaledCoordinates",
        value: function getScaledCoordinates(t, i) {
          var o = Dt / Math.pow(2, i.canonical.z - this.tileID.canonical.z);
          return {
            x: Math.floor((i.canonical.x * e.EXTENT + t.tileAnchorX) * o),
            y: Math.floor((i.canonical.y * e.EXTENT + t.tileAnchorY) * o)
          };
        }
      }, {
        key: "findMatches",
        value: function findMatches(e, t, i) {
          var o = this.tileID.canonical.z < t.canonical.z ? 1 : Math.pow(2, this.tileID.canonical.z - t.canonical.z);

          for (var _r239 = 0; _r239 < e.length; _r239++) {
            var _n161 = e.get(_r239);

            if (_n161.crossTileID) continue;
            var _a100 = this.indexedSymbolInstances[_n161.key];
            if (!_a100) continue;

            var _s118 = this.getScaledCoordinates(_n161, t);

            var _iterator188 = _createForOfIteratorHelper(_a100),
                _step188;

            try {
              for (_iterator188.s(); !(_step188 = _iterator188.n()).done;) {
                var _e308 = _step188.value;

                if (Math.abs(_e308.coord.x - _s118.x) <= o && Math.abs(_e308.coord.y - _s118.y) <= o && !i[_e308.crossTileID]) {
                  i[_e308.crossTileID] = !0, _n161.crossTileID = _e308.crossTileID;
                  break;
                }
              }
            } catch (err) {
              _iterator188.e(err);
            } finally {
              _iterator188.f();
            }
          }
        }
      }]);

      return Pt;
    }();

    var At = /*#__PURE__*/function () {
      function At() {
        _classCallCheck(this, At);

        this.maxCrossTileID = 0;
      }

      _createClass(At, [{
        key: "generate",
        value: function generate() {
          return ++this.maxCrossTileID;
        }
      }]);

      return At;
    }();

    var Lt = /*#__PURE__*/function () {
      function Lt() {
        _classCallCheck(this, Lt);

        this.indexes = {}, this.usedCrossTileIDs = {}, this.lng = 0;
      }

      _createClass(Lt, [{
        key: "handleWrapJump",
        value: function handleWrapJump(e) {
          var t = Math.round((e - this.lng) / 360);
          if (0 !== t) for (var _e309 in this.indexes) {
            var _i187 = this.indexes[_e309],
                _o102 = {};

            for (var _e310 in _i187) {
              var _r240 = _i187[_e310];
              _r240.tileID = _r240.tileID.unwrapTo(_r240.tileID.wrap + t), _o102[_r240.tileID.key] = _r240;
            }

            this.indexes[_e309] = _o102;
          }
          this.lng = e;
        }
      }, {
        key: "addBucket",
        value: function addBucket(e, t, i) {
          if (this.indexes[e.overscaledZ] && this.indexes[e.overscaledZ][e.key]) {
            if (this.indexes[e.overscaledZ][e.key].bucketInstanceId === t.bucketInstanceId) return !1;
            this.removeBucketCrossTileIDs(e.overscaledZ, this.indexes[e.overscaledZ][e.key]);
          }

          for (var _e311 = 0; _e311 < t.symbolInstances.length; _e311++) {
            t.symbolInstances.get(_e311).crossTileID = 0;
          }

          this.usedCrossTileIDs[e.overscaledZ] || (this.usedCrossTileIDs[e.overscaledZ] = {});
          var o = this.usedCrossTileIDs[e.overscaledZ];

          for (var _i188 in this.indexes) {
            var _r241 = this.indexes[_i188];
            if (Number(_i188) > e.overscaledZ) for (var _i189 in _r241) {
              var _n162 = _r241[_i189];
              _n162.tileID.isChildOf(e) && _n162.findMatches(t.symbolInstances, e, o);
            } else {
              var _n163 = _r241[e.scaledTo(Number(_i188)).key];

              _n163 && _n163.findMatches(t.symbolInstances, e, o);
            }
          }

          for (var _e312 = 0; _e312 < t.symbolInstances.length; _e312++) {
            var _r242 = t.symbolInstances.get(_e312);

            _r242.crossTileID || (_r242.crossTileID = i.generate(), o[_r242.crossTileID] = !0);
          }

          return void 0 === this.indexes[e.overscaledZ] && (this.indexes[e.overscaledZ] = {}), this.indexes[e.overscaledZ][e.key] = new Pt(e, t.symbolInstances, t.bucketInstanceId), !0;
        }
      }, {
        key: "removeBucketCrossTileIDs",
        value: function removeBucketCrossTileIDs(e, t) {
          for (var _i190 in t.indexedSymbolInstances) {
            var _iterator189 = _createForOfIteratorHelper(t.indexedSymbolInstances[_i190]),
                _step189;

            try {
              for (_iterator189.s(); !(_step189 = _iterator189.n()).done;) {
                var _o103 = _step189.value;
                delete this.usedCrossTileIDs[e][_o103.crossTileID];
              }
            } catch (err) {
              _iterator189.e(err);
            } finally {
              _iterator189.f();
            }
          }
        }
      }, {
        key: "removeStaleBuckets",
        value: function removeStaleBuckets(e) {
          var t = !1;

          for (var _i191 in this.indexes) {
            var _o104 = this.indexes[_i191];

            for (var _r243 in _o104) {
              e[_o104[_r243].bucketInstanceId] || (this.removeBucketCrossTileIDs(_i191, _o104[_r243]), delete _o104[_r243], t = !0);
            }
          }

          return t;
        }
      }]);

      return Lt;
    }();

    var Rt = /*#__PURE__*/function () {
      function Rt() {
        _classCallCheck(this, Rt);

        this.layerIndexes = {}, this.crossTileIDs = new At(), this.maxBucketInstanceId = 0, this.bucketsInCurrentPlacement = {};
      }

      _createClass(Rt, [{
        key: "addLayer",
        value: function addLayer(e, t, i, o) {
          var r = this.layerIndexes[e.id];
          void 0 === r && (r = this.layerIndexes[e.id] = new Lt());
          var n = !1;
          var a = {};
          "globe" !== o.name && r.handleWrapJump(i);

          var _iterator190 = _createForOfIteratorHelper(t),
              _step190;

          try {
            for (_iterator190.s(); !(_step190 = _iterator190.n()).done;) {
              var _i192 = _step190.value;

              var _t305 = _i192.getBucket(e);

              _t305 && e.id === _t305.layerIds[0] && (_t305.bucketInstanceId || (_t305.bucketInstanceId = ++this.maxBucketInstanceId), r.addBucket(_i192.tileID, _t305, this.crossTileIDs) && (n = !0), a[_t305.bucketInstanceId] = !0);
            }
          } catch (err) {
            _iterator190.e(err);
          } finally {
            _iterator190.f();
          }

          return r.removeStaleBuckets(a) && (n = !0), n;
        }
      }, {
        key: "pruneUnusedLayers",
        value: function pruneUnusedLayers(e) {
          var t = {};
          e.forEach(function (e) {
            t[e] = !0;
          });

          for (var _e313 in this.layerIndexes) {
            t[_e313] || delete this.layerIndexes[_e313];
          }
        }
      }]);

      return Rt;
    }();

    var kt = function kt(t, i) {
      return e.emitValidationErrors(t, i && i.filter(function (e) {
        return "source.canvas" !== e.identifier;
      }));
    },
        Ot = e.pick(ke, ["addLayer", "removeLayer", "setPaintProperty", "setLayoutProperty", "setFilter", "addSource", "removeSource", "setLayerZoomRange", "setLight", "setTransition", "setGeoJSONSourceData", "setTerrain", "setFog", "setProjection"]),
        Bt = e.pick(ke, ["setCenter", "setZoom", "setBearing", "setPitch"]),
        Ft = function () {
      var t = {},
          i = e.spec.$version;

      for (var _o105 in e.spec.$root) {
        var _r244 = e.spec.$root[_o105];

        if (_r244.required) {
          var _e314 = null;
          _e314 = "version" === _o105 ? i : "array" === _r244.type ? [] : {}, null != _e314 && (t[_o105] = _e314);
        }
      }

      return t;
    }(),
        Ut = {
      fill: !0,
      line: !0,
      background: !0,
      hillshade: !0,
      raster: !0
    };

    var Nt = /*#__PURE__*/function (_e$Evented9) {
      _inherits(Nt, _e$Evented9);

      var _super116 = _createSuper(Nt);

      function Nt(t) {
        var _this88;

        var i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

        _classCallCheck(this, Nt);

        _this88 = _super116.call(this), _this88.map = t, _this88.dispatcher = new C(Ae(), _assertThisInitialized(_this88)), _this88.imageManager = new d(), _this88.imageManager.setEventedParent(_assertThisInitialized(_this88)), _this88.glyphManager = new e.GlyphManager(t._requestManager, i.localFontFamily ? e.LocalGlyphMode.all : i.localIdeographFontFamily ? e.LocalGlyphMode.ideographs : e.LocalGlyphMode.none, i.localFontFamily || i.localIdeographFontFamily), _this88.lineAtlas = new e.LineAtlas(256, 512), _this88.crossTileSymbolIndex = new Rt(), _this88._layers = {}, _this88._num3DLayers = 0, _this88._numSymbolLayers = 0, _this88._numCircleLayers = 0, _this88._serializedLayers = {}, _this88._sourceCaches = {}, _this88._otherSourceCaches = {}, _this88._symbolSourceCaches = {}, _this88.zoomHistory = new e.ZoomHistory(), _this88._loaded = !1, _this88._availableImages = [], _this88._order = [], _this88._drapedFirstOrder = [], _this88._markersNeedUpdate = !1, _this88._resetUpdates(), _this88.dispatcher.broadcast("setReferrer", e.getReferrer());

        var o = _assertThisInitialized(_this88);

        _this88._rtlTextPluginCallback = Nt.registerForPluginStateChange(function (t) {
          o.dispatcher.broadcast("syncRTLPluginState", {
            pluginStatus: t.pluginStatus,
            pluginURL: t.pluginURL
          }, function (t, i) {
            if (e.triggerPluginCompletionEvent(t), i && i.every(function (e) {
              return e;
            })) for (var _e315 in o._sourceCaches) {
              var _t306 = o._sourceCaches[_e315],
                  _i193 = _t306.getSource().type;

              "vector" !== _i193 && "geojson" !== _i193 || _t306.reload();
            }
          });
        }), _this88.on("data", function (e) {
          if ("source" !== e.dataType || "metadata" !== e.sourceDataType) return;

          var t = _this88.getSource(e.sourceId);

          if (t && t.vectorLayerIds) for (var _e316 in _this88._layers) {
            var _i194 = _this88._layers[_e316];
            _i194.source === t.id && _this88._validateLayer(_i194);
          }
        });
        return _this88;
      }

      _createClass(Nt, [{
        key: "loadURL",
        value: function loadURL(t) {
          var _this89 = this;

          var i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
          this.fire(new e.Event("dataloading", {
            dataType: "style"
          }));
          var o = "boolean" == typeof i.validate ? i.validate : !e.isMapboxURL(t);
          t = this.map._requestManager.normalizeStyleURL(t, i.accessToken);

          var r = this.map._requestManager.transformRequest(t, e.ResourceType.Style);

          this._request = e.getJSON(r, function (t, i) {
            _this89._request = null, t ? _this89.fire(new e.ErrorEvent(t)) : i && _this89._load(i, o);
          });
        }
      }, {
        key: "loadJSON",
        value: function loadJSON(t) {
          var _this90 = this;

          var i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
          this.fire(new e.Event("dataloading", {
            dataType: "style"
          })), this._request = e.exported.frame(function () {
            _this90._request = null, _this90._load(t, !1 !== i.validate);
          });
        }
      }, {
        key: "loadEmpty",
        value: function loadEmpty() {
          this.fire(new e.Event("dataloading", {
            dataType: "style"
          })), this._load(Ft, !1);
        }
      }, {
        key: "_updateLayerCount",
        value: function _updateLayerCount(e, t) {
          var i = t ? 1 : -1;
          e.is3D() && (this._num3DLayers += i), "circle" === e.type && (this._numCircleLayers += i), "symbol" === e.type && (this._numSymbolLayers += i);
        }
      }, {
        key: "_load",
        value: function _load(t, i) {
          if (i && kt(this, e.validateStyle(t))) return;
          this._loaded = !0, this.stylesheet = t, this.updateProjection();

          for (var _e317 in t.sources) {
            this.addSource(_e317, t.sources[_e317], {
              validate: !1
            });
          }

          this._changed = !1, t.sprite ? this._loadSprite(t.sprite) : (this.imageManager.setLoaded(!0), this.dispatcher.broadcast("spriteLoaded", !0)), this.glyphManager.setURL(t.glyphs);
          var o = Re(this.stylesheet.layers);
          this._order = o.map(function (e) {
            return e.id;
          }), this._layers = {}, this._serializedLayers = {};

          var _iterator191 = _createForOfIteratorHelper(o),
              _step191;

          try {
            for (_iterator191.s(); !(_step191 = _iterator191.n()).done;) {
              var _t307 = _step191.value;
              _t307 = e.createStyleLayer(_t307), _t307.setEventedParent(this, {
                layer: {
                  id: _t307.id
                }
              }), this._layers[_t307.id] = _t307, this._serializedLayers[_t307.id] = _t307.serialize(), this._updateLayerCount(_t307, !0);
            }
          } catch (err) {
            _iterator191.e(err);
          } finally {
            _iterator191.f();
          }

          this.dispatcher.broadcast("setLayers", this._serializeLayers(this._order)), this.light = new f(this.stylesheet.light), this.stylesheet.terrain && !this.terrainSetForDrapingOnly() && this._createTerrain(this.stylesheet.terrain, 1), this.stylesheet.fog && this._createFog(this.stylesheet.fog), this._updateDrapeFirstLayers(), this.fire(new e.Event("data", {
            dataType: "style"
          })), this.fire(new e.Event("style.load"));
        }
      }, {
        key: "terrainSetForDrapingOnly",
        value: function terrainSetForDrapingOnly() {
          return this.terrain && 0 === this.terrain.drapeRenderMode;
        }
      }, {
        key: "setProjection",
        value: function setProjection(e) {
          e ? this.stylesheet.projection = e : delete this.stylesheet.projection, this.updateProjection();
        }
      }, {
        key: "updateProjection",
        value: function updateProjection() {
          var e = this.map.transform.projection,
              t = this.map.transform.setProjection(this.map._runtimeProjection || (this.stylesheet ? this.stylesheet.projection : void 0)),
              i = this.map.transform.projection;

          if (this._loaded && (i.requiresDraping ? this.getTerrain() || this.stylesheet.terrain || this.setTerrainForDraping() : this.terrainSetForDrapingOnly() && this.setTerrain(null)), this.dispatcher.broadcast("setProjection", this.map.transform.projectionOptions), t) {
            if (i.isReprojectedInTileSpace || e.isReprojectedInTileSpace) {
              this.map.painter.clearBackgroundTiles();

              for (var _e318 in this._sourceCaches) {
                this._sourceCaches[_e318].clearTiles();
              }
            } else this._forceSymbolLayerUpdate();

            this.map._update(!0);
          }
        }
      }, {
        key: "_loadSprite",
        value: function _loadSprite(t) {
          var _this91 = this;

          this._spriteRequest = function (t, i, o) {
            var r, n, a;
            var s = e.exported.devicePixelRatio > 1 ? "@2x" : "";
            var l = e.getJSON(i.transformRequest(i.normalizeSpriteURL(t, s, ".json"), e.ResourceType.SpriteJSON), function (e, t) {
              l = null, a || (a = e, r = t, h());
            }),
                c = e.getImage(i.transformRequest(i.normalizeSpriteURL(t, s, ".png"), e.ResourceType.SpriteImage), function (e, t) {
              c = null, a || (a = e, n = t, h());
            });

            function h() {
              if (a) o(a);else if (r && n) {
                var _t308 = e.exported.getImageData(n),
                    _i195 = {};

                for (var _o106 in r) {
                  var _r$_o = r[_o106],
                      _n164 = _r$_o.width,
                      _a101 = _r$_o.height,
                      _s119 = _r$_o.x,
                      _l63 = _r$_o.y,
                      _c39 = _r$_o.sdf,
                      _h31 = _r$_o.pixelRatio,
                      _u52 = _r$_o.stretchX,
                      _12 = _r$_o.stretchY,
                      _d20 = _r$_o.content,
                      _p28 = new e.RGBAImage({
                    width: _n164,
                    height: _a101
                  });

                  e.RGBAImage.copy(_t308, _p28, {
                    x: _s119,
                    y: _l63
                  }, {
                    x: 0,
                    y: 0
                  }, {
                    width: _n164,
                    height: _a101
                  }), _i195[_o106] = {
                    data: _p28,
                    pixelRatio: _h31,
                    sdf: _c39,
                    stretchX: _u52,
                    stretchY: _12,
                    content: _d20
                  };
                }

                o(null, _i195);
              }
            }

            return {
              cancel: function cancel() {
                l && (l.cancel(), l = null), c && (c.cancel(), c = null);
              }
            };
          }(t, this.map._requestManager, function (t, i) {
            if (_this91._spriteRequest = null, t) _this91.fire(new e.ErrorEvent(t));else if (i) for (var _e319 in i) {
              _this91.imageManager.addImage(_e319, i[_e319]);
            }
            _this91.imageManager.setLoaded(!0), _this91._availableImages = _this91.imageManager.listImages(), _this91.dispatcher.broadcast("setImages", _this91._availableImages), _this91.dispatcher.broadcast("spriteLoaded", !0), _this91.fire(new e.Event("data", {
              dataType: "style"
            }));
          });
        }
      }, {
        key: "_validateLayer",
        value: function _validateLayer(t) {
          var i = this.getSource(t.source);
          if (!i) return;
          var o = t.sourceLayer;
          o && ("geojson" === i.type || i.vectorLayerIds && -1 === i.vectorLayerIds.indexOf(o)) && this.fire(new e.ErrorEvent(new Error("Source layer \"".concat(o, "\" does not exist on source \"").concat(i.id, "\" as specified by style layer \"").concat(t.id, "\""))));
        }
      }, {
        key: "loaded",
        value: function loaded() {
          if (!this._loaded) return !1;
          if (Object.keys(this._updatedSources).length) return !1;

          for (var _e320 in this._sourceCaches) {
            if (!this._sourceCaches[_e320].loaded()) return !1;
          }

          return !!this.imageManager.isLoaded();
        }
      }, {
        key: "_serializeLayers",
        value: function _serializeLayers(e) {
          var t = [];

          var _iterator192 = _createForOfIteratorHelper(e),
              _step192;

          try {
            for (_iterator192.s(); !(_step192 = _iterator192.n()).done;) {
              var _i196 = _step192.value;
              var _e321 = this._layers[_i196];
              "custom" !== _e321.type && t.push(_e321.serialize());
            }
          } catch (err) {
            _iterator192.e(err);
          } finally {
            _iterator192.f();
          }

          return t;
        }
      }, {
        key: "hasTransitions",
        value: function hasTransitions() {
          if (this.light && this.light.hasTransition()) return !0;
          if (this.fog && this.fog.hasTransition()) return !0;

          for (var _e322 in this._sourceCaches) {
            if (this._sourceCaches[_e322].hasTransition()) return !0;
          }

          for (var _e323 in this._layers) {
            if (this._layers[_e323].hasTransition()) return !0;
          }

          return !1;
        }
      }, {
        key: "order",
        get: function get() {
          return this.map._optimizeForTerrain && this.terrain ? this._drapedFirstOrder : this._order;
        }
      }, {
        key: "isLayerDraped",
        value: function isLayerDraped(e) {
          return !!this.terrain && Ut[e.type];
        }
      }, {
        key: "_checkLoaded",
        value: function _checkLoaded() {
          if (!this._loaded) throw new Error("Style is not done loading");
        }
      }, {
        key: "update",
        value: function update(t) {
          if (!this._loaded) return;
          var i = this._changed;

          if (this._changed) {
            var _e324 = Object.keys(this._updatedLayers),
                _i197 = Object.keys(this._removedLayers);

            (_e324.length || _i197.length) && this._updateWorkerLayers(_e324, _i197);

            for (var _e325 in this._updatedSources) {
              var _t309 = this._updatedSources[_e325];
              "reload" === _t309 ? this._reloadSource(_e325) : "clear" === _t309 && this._clearSource(_e325);
            }

            this._updateTilesForChangedImages();

            for (var _e326 in this._updatedPaintProps) {
              this._layers[_e326].updateTransitions(t);
            }

            this.light.updateTransitions(t), this.fog && this.fog.updateTransitions(t), this._resetUpdates();
          }

          var o = {};

          for (var _e327 in this._sourceCaches) {
            var _t310 = this._sourceCaches[_e327];
            o[_e327] = _t310.used, _t310.used = !1;
          }

          var _iterator193 = _createForOfIteratorHelper(this._order),
              _step193;

          try {
            for (_iterator193.s(); !(_step193 = _iterator193.n()).done;) {
              var _e328 = _step193.value;
              var _i199 = this._layers[_e328];

              if (_i199.recalculate(t, this._availableImages), !_i199.isHidden(t.zoom)) {
                var _e329 = this._getLayerSourceCache(_i199);

                _e329 && (_e329.used = !0);
              }

              var _o107 = this.map.painter;

              if (_o107) {
                var _e330 = _i199.getProgramIds();

                if (!_e330) continue;

                var _r245 = _i199.getProgramConfiguration(t.zoom);

                var _iterator194 = _createForOfIteratorHelper(_e330),
                    _step194;

                try {
                  for (_iterator194.s(); !(_step194 = _iterator194.n()).done;) {
                    var _t312 = _step194.value;

                    _o107.useProgram(_t312, _r245);
                  }
                } catch (err) {
                  _iterator194.e(err);
                } finally {
                  _iterator194.f();
                }
              }
            }
          } catch (err) {
            _iterator193.e(err);
          } finally {
            _iterator193.f();
          }

          for (var _t311 in o) {
            var _i198 = this._sourceCaches[_t311];
            o[_t311] !== _i198.used && _i198.getSource().fire(new e.Event("data", {
              sourceDataType: "visibility",
              dataType: "source",
              sourceId: _i198.getSource().id
            }));
          }

          this.light.recalculate(t), this.terrain && this.terrain.recalculate(t), this.fog && this.fog.recalculate(t), this.z = t.zoom, this._markersNeedUpdate && (this._updateMarkersOpacity(), this._markersNeedUpdate = !1), i && this.fire(new e.Event("data", {
            dataType: "style"
          }));
        }
      }, {
        key: "_updateTilesForChangedImages",
        value: function _updateTilesForChangedImages() {
          var e = Object.keys(this._changedImages);

          if (e.length) {
            for (var _t313 in this._sourceCaches) {
              this._sourceCaches[_t313].reloadTilesForDependencies(["icons", "patterns"], e);
            }

            this._changedImages = {};
          }
        }
      }, {
        key: "_updateWorkerLayers",
        value: function _updateWorkerLayers(e, t) {
          this.dispatcher.broadcast("updateLayers", {
            layers: this._serializeLayers(e),
            removedIds: t
          });
        }
      }, {
        key: "_resetUpdates",
        value: function _resetUpdates() {
          this._changed = !1, this._updatedLayers = {}, this._removedLayers = {}, this._updatedSources = {}, this._updatedPaintProps = {}, this._changedImages = {};
        }
      }, {
        key: "setState",
        value: function setState(t) {
          var _this92 = this;

          if (this._checkLoaded(), kt(this, e.validateStyle(t))) return !1;
          (t = e.clone$1(t)).layers = Re(t.layers);

          var i = function (e, t) {
            if (!e) return [{
              command: ke.setStyle,
              args: [t]
            }];
            var i = [];

            try {
              if (!n(e.version, t.version)) return [{
                command: ke.setStyle,
                args: [t]
              }];
              n(e.center, t.center) || i.push({
                command: ke.setCenter,
                args: [t.center]
              }), n(e.zoom, t.zoom) || i.push({
                command: ke.setZoom,
                args: [t.zoom]
              }), n(e.bearing, t.bearing) || i.push({
                command: ke.setBearing,
                args: [t.bearing]
              }), n(e.pitch, t.pitch) || i.push({
                command: ke.setPitch,
                args: [t.pitch]
              }), n(e.sprite, t.sprite) || i.push({
                command: ke.setSprite,
                args: [t.sprite]
              }), n(e.glyphs, t.glyphs) || i.push({
                command: ke.setGlyphs,
                args: [t.glyphs]
              }), n(e.transition, t.transition) || i.push({
                command: ke.setTransition,
                args: [t.transition]
              }), n(e.light, t.light) || i.push({
                command: ke.setLight,
                args: [t.light]
              }), n(e.fog, t.fog) || i.push({
                command: ke.setFog,
                args: [t.fog]
              }), n(e.projection, t.projection) || i.push({
                command: ke.setProjection,
                args: [t.projection]
              });
              var _o108 = {},
                  _r246 = [];
              !function (e, t, i, o) {
                var r;

                for (r in t = t || {}, e = e || {}) {
                  e.hasOwnProperty(r) && (t.hasOwnProperty(r) || Be(r, i, o));
                }

                for (r in t) {
                  t.hasOwnProperty(r) && (e.hasOwnProperty(r) ? n(e[r], t[r]) || ("geojson" === e[r].type && "geojson" === t[r].type && Ue(e, t, r) ? i.push({
                    command: ke.setGeoJSONSourceData,
                    args: [r, t[r].data]
                  }) : Fe(r, t, i, o)) : Oe(r, t, i));
                }
              }(e.sources, t.sources, _r246, _o108);
              var _a102 = [];
              e.layers && e.layers.forEach(function (e) {
                _o108[e.source] ? i.push({
                  command: ke.removeLayer,
                  args: [e.id]
                }) : _a102.push(e);
              });
              var _s120 = e.terrain;
              _s120 && _o108[_s120.source] && (i.push({
                command: ke.setTerrain,
                args: [void 0]
              }), _s120 = void 0), i = i.concat(_r246), n(_s120, t.terrain) || i.push({
                command: ke.setTerrain,
                args: [t.terrain]
              }), function (e, t, i) {
                t = t || [];
                var o = (e = e || []).map(Ge),
                    r = t.map(Ge),
                    a = e.reduce(je, {}),
                    s = t.reduce(je, {}),
                    l = o.slice(),
                    c = Object.create(null);

                var h, u, _, d, p, m, f;

                for (h = 0, u = 0; h < o.length; h++) {
                  _ = o[h], s.hasOwnProperty(_) ? u++ : (i.push({
                    command: ke.removeLayer,
                    args: [_]
                  }), l.splice(l.indexOf(_, u), 1));
                }

                for (h = 0, u = 0; h < r.length; h++) {
                  _ = r[r.length - 1 - h], l[l.length - 1 - h] !== _ && (a.hasOwnProperty(_) ? (i.push({
                    command: ke.removeLayer,
                    args: [_]
                  }), l.splice(l.lastIndexOf(_, l.length - u), 1)) : u++, m = l[l.length - h], i.push({
                    command: ke.addLayer,
                    args: [s[_], m]
                  }), l.splice(l.length - h, 0, _), c[_] = !0);
                }

                for (h = 0; h < r.length; h++) {
                  if (_ = r[h], d = a[_], p = s[_], !c[_] && !n(d, p)) if (n(d.source, p.source) && n(d["source-layer"], p["source-layer"]) && n(d.type, p.type)) {
                    for (f in Ne(d.layout, p.layout, i, _, null, ke.setLayoutProperty), Ne(d.paint, p.paint, i, _, null, ke.setPaintProperty), n(d.filter, p.filter) || i.push({
                      command: ke.setFilter,
                      args: [_, p.filter]
                    }), n(d.minzoom, p.minzoom) && n(d.maxzoom, p.maxzoom) || i.push({
                      command: ke.setLayerZoomRange,
                      args: [_, p.minzoom, p.maxzoom]
                    }), d) {
                      d.hasOwnProperty(f) && "layout" !== f && "paint" !== f && "filter" !== f && "metadata" !== f && "minzoom" !== f && "maxzoom" !== f && (0 === f.indexOf("paint.") ? Ne(d[f], p[f], i, _, f.slice(6), ke.setPaintProperty) : n(d[f], p[f]) || i.push({
                        command: ke.setLayerProperty,
                        args: [_, f, p[f]]
                      }));
                    }

                    for (f in p) {
                      p.hasOwnProperty(f) && !d.hasOwnProperty(f) && "layout" !== f && "paint" !== f && "filter" !== f && "metadata" !== f && "minzoom" !== f && "maxzoom" !== f && (0 === f.indexOf("paint.") ? Ne(d[f], p[f], i, _, f.slice(6), ke.setPaintProperty) : n(d[f], p[f]) || i.push({
                        command: ke.setLayerProperty,
                        args: [_, f, p[f]]
                      }));
                    }
                  } else i.push({
                    command: ke.removeLayer,
                    args: [_]
                  }), m = l[l.lastIndexOf(_) + 1], i.push({
                    command: ke.addLayer,
                    args: [p, m]
                  });
                }
              }(_a102, t.layers, i);
            } catch (e) {
              console.warn("Unable to compute style diff:", e), i = [{
                command: ke.setStyle,
                args: [t]
              }];
            }

            return i;
          }(this.serialize(), t).filter(function (e) {
            return !(e.command in Bt);
          });

          if (0 === i.length) return !1;
          var o = i.filter(function (e) {
            return !(e.command in Ot);
          });
          if (o.length > 0) throw new Error("Unimplemented: ".concat(o.map(function (e) {
            return e.command;
          }).join(", "), "."));
          return i.forEach(function (e) {
            "setTransition" !== e.command && _this92[e.command].apply(_this92, e.args);
          }), this.stylesheet = t, this.updateProjection(), !0;
        }
      }, {
        key: "addImage",
        value: function addImage(t, i) {
          if (this.getImage(t)) return this.fire(new e.ErrorEvent(new Error("An image with this name already exists.")));
          this.imageManager.addImage(t, i), this._afterImageUpdated(t);
        }
      }, {
        key: "updateImage",
        value: function updateImage(e, t) {
          this.imageManager.updateImage(e, t);
        }
      }, {
        key: "getImage",
        value: function getImage(e) {
          return this.imageManager.getImage(e);
        }
      }, {
        key: "removeImage",
        value: function removeImage(t) {
          if (!this.getImage(t)) return this.fire(new e.ErrorEvent(new Error("No image with this name exists.")));
          this.imageManager.removeImage(t), this._afterImageUpdated(t);
        }
      }, {
        key: "_afterImageUpdated",
        value: function _afterImageUpdated(t) {
          this._availableImages = this.imageManager.listImages(), this._changedImages[t] = !0, this._changed = !0, this.dispatcher.broadcast("setImages", this._availableImages), this.fire(new e.Event("data", {
            dataType: "style"
          }));
        }
      }, {
        key: "listImages",
        value: function listImages() {
          return this._checkLoaded(), this._availableImages.slice();
        }
      }, {
        key: "addSource",
        value: function addSource(t, i) {
          var _this93 = this;

          var o = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
          if (this._checkLoaded(), void 0 !== this.getSource(t)) throw new Error("There is already a source with this ID");
          if (!i.type) throw new Error("The type property must be defined, but only the following properties were given: ".concat(Object.keys(i).join(", "), "."));
          if (["vector", "raster", "geojson", "video", "image"].indexOf(i.type) >= 0 && this._validate(e.validateStyle.source, "sources.".concat(t), i, null, o)) return;
          this.map && this.map._collectResourceTiming && (i.collectResourceTiming = !0);
          var r = Te(t, i, this.dispatcher, this);
          r.setEventedParent(this, function () {
            return {
              isSourceLoaded: _this93.loaded(),
              source: r.serialize(),
              sourceId: t
            };
          });

          var n = function n(i) {
            var o = (i ? "symbol:" : "other:") + t,
                n = _this93._sourceCaches[o] = new e.SourceCache(o, r, i);
            (i ? _this93._symbolSourceCaches : _this93._otherSourceCaches)[t] = n, n.style = _this93, n.onAdd(_this93.map);
          };

          n(!1), "vector" !== i.type && "geojson" !== i.type || n(!0), r.onAdd && r.onAdd(this.map), this._changed = !0;
        }
      }, {
        key: "removeSource",
        value: function removeSource(t) {
          this._checkLoaded();

          var i = this.getSource(t);
          if (void 0 === i) throw new Error("There is no source with this ID");

          for (var _i200 in this._layers) {
            if (this._layers[_i200].source === t) return this.fire(new e.ErrorEvent(new Error("Source \"".concat(t, "\" cannot be removed while layer \"").concat(_i200, "\" is using it."))));
          }

          if (this.terrain && this.terrain.get().source === t) return this.fire(new e.ErrorEvent(new Error("Source \"".concat(t, "\" cannot be removed while terrain is using it."))));

          var o = this._getSourceCaches(t);

          var _iterator195 = _createForOfIteratorHelper(o),
              _step195;

          try {
            for (_iterator195.s(); !(_step195 = _iterator195.n()).done;) {
              var _t314 = _step195.value;
              delete this._sourceCaches[_t314.id], delete this._updatedSources[_t314.id], _t314.fire(new e.Event("data", {
                sourceDataType: "metadata",
                dataType: "source",
                sourceId: _t314.getSource().id
              })), _t314.setEventedParent(null), _t314.clearTiles();
            }
          } catch (err) {
            _iterator195.e(err);
          } finally {
            _iterator195.f();
          }

          delete this._otherSourceCaches[t], delete this._symbolSourceCaches[t], i.setEventedParent(null), i.onRemove && i.onRemove(this.map), this._changed = !0;
        }
      }, {
        key: "setGeoJSONSourceData",
        value: function setGeoJSONSourceData(e, t) {
          this._checkLoaded(), this.getSource(e).setData(t), this._changed = !0;
        }
      }, {
        key: "getSource",
        value: function getSource(e) {
          var t = this._getSourceCache(e);

          return t && t.getSource();
        }
      }, {
        key: "addLayer",
        value: function addLayer(t, i) {
          var o = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

          this._checkLoaded();

          var r = t.id;
          if (this.getLayer(r)) return void this.fire(new e.ErrorEvent(new Error("Layer with id \"".concat(r, "\" already exists on this map"))));
          var n;

          if ("custom" === t.type) {
            if (kt(this, e.validateCustomStyleLayer(t))) return;
            n = e.createStyleLayer(t);
          } else {
            if ("object" == _typeof(t.source) && (this.addSource(r, t.source), t = e.clone$1(t), t = e.extend(t, {
              source: r
            })), this._validate(e.validateStyle.layer, "layers.".concat(r), t, {
              arrayIndex: -1
            }, o)) return;
            n = e.createStyleLayer(t), this._validateLayer(n), n.setEventedParent(this, {
              layer: {
                id: r
              }
            }), this._serializedLayers[n.id] = n.serialize(), this._updateLayerCount(n, !0);
          }

          var a = i ? this._order.indexOf(i) : this._order.length;
          if (i && -1 === a) return void this.fire(new e.ErrorEvent(new Error("Layer with id \"".concat(i, "\" does not exist on this map."))));
          this._order.splice(a, 0, r), this._layerOrderChanged = !0, this._layers[r] = n;

          var s = this._getLayerSourceCache(n);

          if (this._removedLayers[r] && n.source && s && "custom" !== n.type) {
            var _e331 = this._removedLayers[r];
            delete this._removedLayers[r], _e331.type !== n.type ? this._updatedSources[n.source] = "clear" : (this._updatedSources[n.source] = "reload", s.pause());
          }

          this._updateLayer(n), n.onAdd && n.onAdd(this.map), this._updateDrapeFirstLayers();
        }
      }, {
        key: "moveLayer",
        value: function moveLayer(t, i) {
          if (this._checkLoaded(), this._changed = !0, !this._layers[t]) return void this.fire(new e.ErrorEvent(new Error("The layer '".concat(t, "' does not exist in the map's style and cannot be moved."))));
          if (t === i) return;

          var o = this._order.indexOf(t);

          this._order.splice(o, 1);

          var r = i ? this._order.indexOf(i) : this._order.length;
          i && -1 === r ? this.fire(new e.ErrorEvent(new Error("Layer with id \"".concat(i, "\" does not exist on this map.")))) : (this._order.splice(r, 0, t), this._layerOrderChanged = !0, this._updateDrapeFirstLayers());
        }
      }, {
        key: "removeLayer",
        value: function removeLayer(t) {
          this._checkLoaded();

          var i = this._layers[t];
          if (!i) return void this.fire(new e.ErrorEvent(new Error("The layer '".concat(t, "' does not exist in the map's style and cannot be removed."))));
          i.setEventedParent(null), this._updateLayerCount(i, !1);

          var o = this._order.indexOf(t);

          this._order.splice(o, 1), this._layerOrderChanged = !0, this._changed = !0, this._removedLayers[t] = i, delete this._layers[t], delete this._serializedLayers[t], delete this._updatedLayers[t], delete this._updatedPaintProps[t], i.onRemove && i.onRemove(this.map), this._updateDrapeFirstLayers();
        }
      }, {
        key: "getLayer",
        value: function getLayer(e) {
          return this._layers[e];
        }
      }, {
        key: "hasLayer",
        value: function hasLayer(e) {
          return e in this._layers;
        }
      }, {
        key: "hasLayerType",
        value: function hasLayerType(e) {
          for (var _t315 in this._layers) {
            if (this._layers[_t315].type === e) return !0;
          }

          return !1;
        }
      }, {
        key: "setLayerZoomRange",
        value: function setLayerZoomRange(t, i, o) {
          this._checkLoaded();

          var r = this.getLayer(t);
          r ? r.minzoom === i && r.maxzoom === o || (null != i && (r.minzoom = i), null != o && (r.maxzoom = o), this._updateLayer(r)) : this.fire(new e.ErrorEvent(new Error("The layer '".concat(t, "' does not exist in the map's style and cannot have zoom extent."))));
        }
      }, {
        key: "setFilter",
        value: function setFilter(t, i) {
          var o = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

          this._checkLoaded();

          var r = this.getLayer(t);

          if (r) {
            if (!n(r.filter, i)) return null == i ? (r.filter = void 0, void this._updateLayer(r)) : void (this._validate(e.validateStyle.filter, "layers.".concat(r.id, ".filter"), i, {
              layerType: r.type
            }, o) || (r.filter = e.clone$1(i), this._updateLayer(r)));
          } else this.fire(new e.ErrorEvent(new Error("The layer '".concat(t, "' does not exist in the map's style and cannot be filtered."))));
        }
      }, {
        key: "getFilter",
        value: function getFilter(t) {
          return e.clone$1(this.getLayer(t).filter);
        }
      }, {
        key: "setLayoutProperty",
        value: function setLayoutProperty(t, i, o) {
          var r = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};

          this._checkLoaded();

          var a = this.getLayer(t);
          a ? n(a.getLayoutProperty(i), o) || (a.setLayoutProperty(i, o, r), this._updateLayer(a)) : this.fire(new e.ErrorEvent(new Error("The layer '".concat(t, "' does not exist in the map's style and cannot be styled."))));
        }
      }, {
        key: "getLayoutProperty",
        value: function getLayoutProperty(t, i) {
          var o = this.getLayer(t);
          if (o) return o.getLayoutProperty(i);
          this.fire(new e.ErrorEvent(new Error("The layer '".concat(t, "' does not exist in the map's style."))));
        }
      }, {
        key: "setPaintProperty",
        value: function setPaintProperty(t, i, o) {
          var r = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};

          this._checkLoaded();

          var a = this.getLayer(t);
          a ? n(a.getPaintProperty(i), o) || (a.setPaintProperty(i, o, r) && this._updateLayer(a), this._changed = !0, this._updatedPaintProps[t] = !0) : this.fire(new e.ErrorEvent(new Error("The layer '".concat(t, "' does not exist in the map's style and cannot be styled."))));
        }
      }, {
        key: "getPaintProperty",
        value: function getPaintProperty(e, t) {
          return this.getLayer(e).getPaintProperty(t);
        }
      }, {
        key: "setFeatureState",
        value: function setFeatureState(t, i) {
          this._checkLoaded();

          var o = t.source,
              r = t.sourceLayer,
              n = this.getSource(o);
          if (void 0 === n) return void this.fire(new e.ErrorEvent(new Error("The source '".concat(o, "' does not exist in the map's style."))));
          var a = n.type;
          if ("geojson" === a && r) return void this.fire(new e.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));
          if ("vector" === a && !r) return void this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));
          void 0 === t.id && this.fire(new e.ErrorEvent(new Error("The feature id parameter must be provided.")));

          var s = this._getSourceCaches(o);

          var _iterator196 = _createForOfIteratorHelper(s),
              _step196;

          try {
            for (_iterator196.s(); !(_step196 = _iterator196.n()).done;) {
              var _e332 = _step196.value;

              _e332.setFeatureState(r, t.id, i);
            }
          } catch (err) {
            _iterator196.e(err);
          } finally {
            _iterator196.f();
          }
        }
      }, {
        key: "removeFeatureState",
        value: function removeFeatureState(t, i) {
          this._checkLoaded();

          var o = t.source,
              r = this.getSource(o);
          if (void 0 === r) return void this.fire(new e.ErrorEvent(new Error("The source '".concat(o, "' does not exist in the map's style."))));
          var n = r.type,
              a = "vector" === n ? t.sourceLayer : void 0;
          if ("vector" === n && !a) return void this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));
          if (i && "string" != typeof t.id && "number" != typeof t.id) return void this.fire(new e.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));

          var s = this._getSourceCaches(o);

          var _iterator197 = _createForOfIteratorHelper(s),
              _step197;

          try {
            for (_iterator197.s(); !(_step197 = _iterator197.n()).done;) {
              var _e333 = _step197.value;

              _e333.removeFeatureState(a, t.id, i);
            }
          } catch (err) {
            _iterator197.e(err);
          } finally {
            _iterator197.f();
          }
        }
      }, {
        key: "getFeatureState",
        value: function getFeatureState(t) {
          this._checkLoaded();

          var i = t.source,
              o = t.sourceLayer,
              r = this.getSource(i);

          if (void 0 !== r) {
            if ("vector" !== r.type || o) return void 0 === t.id && this.fire(new e.ErrorEvent(new Error("The feature id parameter must be provided."))), this._getSourceCaches(i)[0].getFeatureState(o, t.id);
            this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));
          } else this.fire(new e.ErrorEvent(new Error("The source '".concat(i, "' does not exist in the map's style."))));
        }
      }, {
        key: "getTransition",
        value: function getTransition() {
          return e.extend({
            duration: 300,
            delay: 0
          }, this.stylesheet && this.stylesheet.transition);
        }
      }, {
        key: "serialize",
        value: function serialize() {
          var t = {};

          for (var _e334 in this._sourceCaches) {
            var _i201 = this._sourceCaches[_e334].getSource();

            t[_i201.id] || (t[_i201.id] = _i201.serialize());
          }

          return e.filterObject({
            version: this.stylesheet.version,
            name: this.stylesheet.name,
            metadata: this.stylesheet.metadata,
            light: this.stylesheet.light,
            terrain: this.stylesheet.terrain,
            fog: this.stylesheet.fog,
            center: this.stylesheet.center,
            zoom: this.stylesheet.zoom,
            bearing: this.stylesheet.bearing,
            pitch: this.stylesheet.pitch,
            sprite: this.stylesheet.sprite,
            glyphs: this.stylesheet.glyphs,
            transition: this.stylesheet.transition,
            projection: this.stylesheet.projection,
            sources: t,
            layers: this._serializeLayers(this._order)
          }, function (e) {
            return void 0 !== e;
          });
        }
      }, {
        key: "_updateLayer",
        value: function _updateLayer(e) {
          this._updatedLayers[e.id] = !0;

          var t = this._getLayerSourceCache(e);

          e.source && !this._updatedSources[e.source] && t && "raster" !== t.getSource().type && (this._updatedSources[e.source] = "reload", t.pause()), this._changed = !0, e.invalidateCompiledFilter();
        }
      }, {
        key: "_flattenAndSortRenderedFeatures",
        value: function _flattenAndSortRenderedFeatures(e) {
          var _this94 = this;

          var t = function t(e) {
            return "fill-extrusion" === _this94._layers[e].type;
          },
              i = {},
              o = [];

          for (var _r247 = this._order.length - 1; _r247 >= 0; _r247--) {
            var _n165 = this._order[_r247];

            if (t(_n165)) {
              i[_n165] = _r247;

              var _iterator198 = _createForOfIteratorHelper(e),
                  _step198;

              try {
                for (_iterator198.s(); !(_step198 = _iterator198.n()).done;) {
                  var _t316 = _step198.value;
                  var _e335 = _t316[_n165];

                  if (_e335) {
                    var _iterator199 = _createForOfIteratorHelper(_e335),
                        _step199;

                    try {
                      for (_iterator199.s(); !(_step199 = _iterator199.n()).done;) {
                        var _t317 = _step199.value;
                        o.push(_t317);
                      }
                    } catch (err) {
                      _iterator199.e(err);
                    } finally {
                      _iterator199.f();
                    }
                  }
                }
              } catch (err) {
                _iterator198.e(err);
              } finally {
                _iterator198.f();
              }
            }
          }

          o.sort(function (e, t) {
            return t.intersectionZ - e.intersectionZ;
          });
          var r = [];

          for (var _n166 = this._order.length - 1; _n166 >= 0; _n166--) {
            var _a103 = this._order[_n166];
            if (t(_a103)) for (var _e336 = o.length - 1; _e336 >= 0; _e336--) {
              var _t318 = o[_e336].feature;
              if (i[_t318.layer.id] < _n166) break;
              r.push(_t318), o.pop();
            } else {
              var _iterator200 = _createForOfIteratorHelper(e),
                  _step200;

              try {
                for (_iterator200.s(); !(_step200 = _iterator200.n()).done;) {
                  var _t319 = _step200.value;
                  var _e337 = _t319[_a103];

                  if (_e337) {
                    var _iterator201 = _createForOfIteratorHelper(_e337),
                        _step201;

                    try {
                      for (_iterator201.s(); !(_step201 = _iterator201.n()).done;) {
                        var _t320 = _step201.value;
                        r.push(_t320.feature);
                      }
                    } catch (err) {
                      _iterator201.e(err);
                    } finally {
                      _iterator201.f();
                    }
                  }
                }
              } catch (err) {
                _iterator200.e(err);
              } finally {
                _iterator200.f();
              }
            }
          }

          return r;
        }
      }, {
        key: "queryRenderedFeatures",
        value: function queryRenderedFeatures(t, i, o) {
          var _this95 = this;

          i && i.filter && this._validate(e.validateStyle.filter, "queryRenderedFeatures.filter", i.filter, null, i);
          var r = {};

          if (i && i.layers) {
            if (!Array.isArray(i.layers)) return this.fire(new e.ErrorEvent(new Error("parameters.layers must be an Array."))), [];

            var _iterator202 = _createForOfIteratorHelper(i.layers),
                _step202;

            try {
              for (_iterator202.s(); !(_step202 = _iterator202.n()).done;) {
                var _t321 = _step202.value;
                var _i202 = this._layers[_t321];
                if (!_i202) return this.fire(new e.ErrorEvent(new Error("The layer '".concat(_t321, "' does not exist in the map's style and cannot be queried for features.")))), [];
                r[_i202.source] = !0;
              }
            } catch (err) {
              _iterator202.e(err);
            } finally {
              _iterator202.f();
            }
          }

          var n = [];
          i.availableImages = this._availableImages;
          var a = i && i.layers ? i.layers.some(function (e) {
            var t = _this95.getLayer(e);

            return t && t.is3D();
          }) : this.has3DLayers(),
              s = pe.createFromScreenPoints(t, o);

          for (var _e338 in this._sourceCaches) {
            var _t322 = this._sourceCaches[_e338].getSource().id;

            i.layers && !r[_t322] || n.push(Ce(this._sourceCaches[_e338], this._layers, this._serializedLayers, s, i, o, a, !!this.map._showQueryGeometry));
          }

          return this.placement && n.push(function (e, t, i, o, r, n, a) {
            var s = {},
                l = n.queryRenderedSymbols(o),
                c = [];

            var _iterator203 = _createForOfIteratorHelper(Object.keys(l).map(Number)),
                _step203;

            try {
              for (_iterator203.s(); !(_step203 = _iterator203.n()).done;) {
                var _e341 = _step203.value;
                c.push(a[_e341]);
              }
            } catch (err) {
              _iterator203.e(err);
            } finally {
              _iterator203.f();
            }

            c.sort(Se);

            var _loop8 = function _loop8() {
              var i = _c40[_i203];
              var o = i.featureIndex.lookupSymbolFeatures(l[i.bucketInstanceId], t, i.bucketIndex, i.sourceLayerIndex, r.filter, r.layers, r.availableImages, e);

              for (var _e339 in o) {
                var _t323 = s[_e339] = s[_e339] || [],
                    _r248 = o[_e339];

                _r248.sort(function (e, t) {
                  var o = i.featureSortOrder;

                  if (o) {
                    var _i204 = o.indexOf(e.featureIndex);

                    return o.indexOf(t.featureIndex) - _i204;
                  }

                  return t.featureIndex - e.featureIndex;
                });

                var _iterator204 = _createForOfIteratorHelper(_r248),
                    _step204;

                try {
                  for (_iterator204.s(); !(_step204 = _iterator204.n()).done;) {
                    var _e340 = _step204.value;

                    _t323.push(_e340);
                  }
                } catch (err) {
                  _iterator204.e(err);
                } finally {
                  _iterator204.f();
                }
              }
            };

            for (var _i203 = 0, _c40 = c; _i203 < _c40.length; _i203++) {
              _loop8();
            }

            var _loop9 = function _loop9(_t324) {
              s[_t324].forEach(function (o) {
                var r = o.feature,
                    n = i(e[_t324]).getFeatureState(r.layer["source-layer"], r.id);
                r.source = r.layer.source, r.layer["source-layer"] && (r.sourceLayer = r.layer["source-layer"]), r.state = n;
              });
            };

            for (var _t324 in s) {
              _loop9(_t324);
            }

            return s;
          }(this._layers, this._serializedLayers, this._getLayerSourceCache.bind(this), s.screenGeometry, i, this.placement.collisionIndex, this.placement.retainedQueryData)), this._flattenAndSortRenderedFeatures(n);
        }
      }, {
        key: "querySourceFeatures",
        value: function querySourceFeatures(t, i) {
          i && i.filter && this._validate(e.validateStyle.filter, "querySourceFeatures.filter", i.filter, null, i);

          var o = this._getSourceCaches(t);

          var r = [];

          var _iterator205 = _createForOfIteratorHelper(o),
              _step205;

          try {
            for (_iterator205.s(); !(_step205 = _iterator205.n()).done;) {
              var _e342 = _step205.value;
              r = r.concat(Me(_e342, i));
            }
          } catch (err) {
            _iterator205.e(err);
          } finally {
            _iterator205.f();
          }

          return r;
        }
      }, {
        key: "addSourceType",
        value: function addSourceType(e, t, i) {
          return Nt.getSourceType(e) ? i(new Error("A source type called \"".concat(e, "\" already exists."))) : (Nt.setSourceType(e, t), t.workerSourceURL ? void this.dispatcher.broadcast("loadWorkerSource", {
            name: e,
            url: t.workerSourceURL
          }, i) : i(null, null));
        }
      }, {
        key: "getLight",
        value: function getLight() {
          return this.light.getLight();
        }
      }, {
        key: "setLight",
        value: function setLight(t) {
          var i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

          this._checkLoaded();

          var o = this.light.getLight();
          var r = !1;

          for (var _e343 in t) {
            if (!n(t[_e343], o[_e343])) {
              r = !0;
              break;
            }
          }

          if (!r) return;
          var a = {
            now: e.exported.now(),
            transition: e.extend({
              duration: 300,
              delay: 0
            }, this.stylesheet.transition)
          };
          this.light.setLight(t, i), this.light.updateTransitions(a);
        }
      }, {
        key: "getTerrain",
        value: function getTerrain() {
          return this.terrain && 1 === this.terrain.drapeRenderMode ? this.terrain.get() : null;
        }
      }, {
        key: "setTerrainForDraping",
        value: function setTerrainForDraping() {
          this.setTerrain({
            source: "",
            exaggeration: 0
          }, 0);
        }
      }, {
        key: "setTerrain",
        value: function setTerrain(t) {
          var i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;
          if (this._checkLoaded(), !t) return delete this.terrain, delete this.stylesheet.terrain, this.dispatcher.broadcast("enableTerrain", !1), this._force3DLayerUpdate(), void (this._markersNeedUpdate = !0);

          if (1 === i) {
            if ("object" == _typeof(t.source)) {
              var _i205 = "terrain-dem-src";
              this.addSource(_i205, t.source), t = e.clone$1(t), t = e.extend(t, {
                source: _i205
              });
            }

            if (this._validate(e.validateStyle.terrain, "terrain", t)) return;
          }

          if (!this.terrain || this.terrain && i !== this.terrain.drapeRenderMode) this._createTerrain(t, i);else {
            var _i206 = this.terrain,
                _o109 = _i206.get();

            for (var _r249 in t) {
              if (!n(t[_r249], _o109[_r249])) {
                _i206.set(t), this.stylesheet.terrain = t;
                var _o110 = {
                  now: e.exported.now(),
                  transition: e.extend({
                    duration: 0
                  }, this.stylesheet.transition)
                };

                _i206.updateTransitions(_o110);

                break;
              }
            }
          }
          this._updateDrapeFirstLayers(), this._markersNeedUpdate = !0;
        }
      }, {
        key: "_createFog",
        value: function _createFog(t) {
          var i = this.fog = new E(t, this.map.transform);
          this.stylesheet.fog = t;
          var o = {
            now: e.exported.now(),
            transition: e.extend({
              duration: 0
            }, this.stylesheet.transition)
          };
          i.updateTransitions(o);
        }
      }, {
        key: "_updateMarkersOpacity",
        value: function _updateMarkersOpacity() {
          var _this96 = this;

          0 !== this.map._markers.length && this.map._requestDomTask(function () {
            var _iterator206 = _createForOfIteratorHelper(_this96.map._markers),
                _step206;

            try {
              for (_iterator206.s(); !(_step206 = _iterator206.n()).done;) {
                var _e344 = _step206.value;

                _e344._evaluateOpacity();
              }
            } catch (err) {
              _iterator206.e(err);
            } finally {
              _iterator206.f();
            }
          });
        }
      }, {
        key: "getFog",
        value: function getFog() {
          return this.fog ? this.fog.get() : null;
        }
      }, {
        key: "setFog",
        value: function setFog(t) {
          if (this._checkLoaded(), !t) return delete this.fog, delete this.stylesheet.fog, void (this._markersNeedUpdate = !0);

          if (this.fog) {
            var _i207 = this.fog,
                _o111 = _i207.get();

            for (var _r250 in t) {
              if (!n(t[_r250], _o111[_r250])) {
                _i207.set(t), this.stylesheet.fog = t;
                var _o112 = {
                  now: e.exported.now(),
                  transition: e.extend({
                    duration: 0
                  }, this.stylesheet.transition)
                };

                _i207.updateTransitions(_o112);

                break;
              }
            }
          } else this._createFog(t);

          this._markersNeedUpdate = !0;
        }
      }, {
        key: "_updateDrapeFirstLayers",
        value: function _updateDrapeFirstLayers() {
          var _this97 = this,
              _this$_drapedFirstOrd,
              _this$_drapedFirstOrd2;

          if (!this.map._optimizeForTerrain || !this.terrain) return;

          var e = this._order.filter(function (e) {
            return _this97.isLayerDraped(_this97._layers[e]);
          }),
              t = this._order.filter(function (e) {
            return !_this97.isLayerDraped(_this97._layers[e]);
          });

          this._drapedFirstOrder = [], (_this$_drapedFirstOrd = this._drapedFirstOrder).push.apply(_this$_drapedFirstOrd, _toConsumableArray(e)), (_this$_drapedFirstOrd2 = this._drapedFirstOrder).push.apply(_this$_drapedFirstOrd2, _toConsumableArray(t));
        }
      }, {
        key: "_createTerrain",
        value: function _createTerrain(t, i) {
          var o = this.terrain = new x(t, i);
          this.stylesheet.terrain = t, this.dispatcher.broadcast("enableTerrain", !0), this._force3DLayerUpdate();
          var r = {
            now: e.exported.now(),
            transition: e.extend({
              duration: 0
            }, this.stylesheet.transition)
          };
          o.updateTransitions(r);
        }
      }, {
        key: "_force3DLayerUpdate",
        value: function _force3DLayerUpdate() {
          for (var _e345 in this._layers) {
            var _t325 = this._layers[_e345];
            "fill-extrusion" === _t325.type && this._updateLayer(_t325);
          }
        }
      }, {
        key: "_forceSymbolLayerUpdate",
        value: function _forceSymbolLayerUpdate() {
          for (var _e346 in this._layers) {
            var _t326 = this._layers[_e346];
            "symbol" === _t326.type && this._updateLayer(_t326);
          }
        }
      }, {
        key: "_validate",
        value: function _validate(t, i, o, r) {
          var n = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {};
          return (!n || !1 !== n.validate) && kt(this, t.call(e.validateStyle, e.extend({
            key: i,
            style: this.serialize(),
            value: o,
            styleSpec: e.spec
          }, r)));
        }
      }, {
        key: "_remove",
        value: function _remove() {
          this._request && (this._request.cancel(), this._request = null), this._spriteRequest && (this._spriteRequest.cancel(), this._spriteRequest = null), e.evented.off("pluginStateChange", this._rtlTextPluginCallback);

          for (var _e347 in this._layers) {
            this._layers[_e347].setEventedParent(null);
          }

          for (var _e348 in this._sourceCaches) {
            this._sourceCaches[_e348].clearTiles(), this._sourceCaches[_e348].setEventedParent(null);
          }

          this.imageManager.setEventedParent(null), this.setEventedParent(null), this.dispatcher.remove();
        }
      }, {
        key: "_clearSource",
        value: function _clearSource(e) {
          var t = this._getSourceCaches(e);

          var _iterator207 = _createForOfIteratorHelper(t),
              _step207;

          try {
            for (_iterator207.s(); !(_step207 = _iterator207.n()).done;) {
              var _e349 = _step207.value;

              _e349.clearTiles();
            }
          } catch (err) {
            _iterator207.e(err);
          } finally {
            _iterator207.f();
          }
        }
      }, {
        key: "_reloadSource",
        value: function _reloadSource(e) {
          var t = this._getSourceCaches(e);

          var _iterator208 = _createForOfIteratorHelper(t),
              _step208;

          try {
            for (_iterator208.s(); !(_step208 = _iterator208.n()).done;) {
              var _e350 = _step208.value;
              _e350.resume(), _e350.reload();
            }
          } catch (err) {
            _iterator208.e(err);
          } finally {
            _iterator208.f();
          }
        }
      }, {
        key: "_updateSources",
        value: function _updateSources(e) {
          for (var _t327 in this._sourceCaches) {
            this._sourceCaches[_t327].update(e);
          }
        }
      }, {
        key: "_generateCollisionBoxes",
        value: function _generateCollisionBoxes() {
          for (var _e351 in this._sourceCaches) {
            var _t328 = this._sourceCaches[_e351];
            _t328.resume(), _t328.reload();
          }
        }
      }, {
        key: "_updatePlacement",
        value: function _updatePlacement(t, i, o, r) {
          var _this98 = this;

          var n = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : !1;
          var a = !1,
              s = !1;
          var l = {};

          var _iterator209 = _createForOfIteratorHelper(this._order),
              _step209;

          try {
            for (_iterator209.s(); !(_step209 = _iterator209.n()).done;) {
              var _e353 = _step209.value;
              var _i208 = this._layers[_e353];
              if ("symbol" !== _i208.type) continue;

              if (!l[_i208.source]) {
                var _ret3 = function () {
                  var e = _this98._getLayerSourceCache(_i208);

                  if (!e) return "continue";
                  l[_i208.source] = e.getRenderableIds(!0).map(function (t) {
                    return e.getTileByID(t);
                  }).sort(function (e, t) {
                    return t.tileID.overscaledZ - e.tileID.overscaledZ || (e.tileID.isLessThan(t.tileID) ? -1 : 1);
                  });
                }();

                if (_ret3 === "continue") continue;
              }

              var _o113 = this.crossTileSymbolIndex.addLayer(_i208, l[_i208.source], t.center.lng, t.projection);

              a = a || _o113;
            }
          } catch (err) {
            _iterator209.e(err);
          } finally {
            _iterator209.f();
          }

          if (this.crossTileSymbolIndex.pruneUnusedLayers(this._order), n = n || this._layerOrderChanged || 0 === o, this._layerOrderChanged && this.fire(new e.Event("neworder")), (n || !this.pauseablePlacement || this.pauseablePlacement.isDone() && !this.placement.stillRecent(e.exported.now(), t.zoom)) && (this.pauseablePlacement = new zt(t, this._order, n, i, o, r, this.placement, this.fog && t.projection.supportsFog ? this.fog.state : null), this._layerOrderChanged = !1), this.pauseablePlacement.isDone() ? this.placement.setStale() : (this.pauseablePlacement.continuePlacement(this._order, this._layers, l), this.pauseablePlacement.isDone() && (this.placement = this.pauseablePlacement.commit(e.exported.now()), s = !0), a && this.pauseablePlacement.placement.setStale()), s || a) {
            var _iterator210 = _createForOfIteratorHelper(this._order),
                _step210;

            try {
              for (_iterator210.s(); !(_step210 = _iterator210.n()).done;) {
                var _e352 = _step210.value;
                var _t329 = this._layers[_e352];
                "symbol" === _t329.type && this.placement.updateLayerOpacities(_t329, l[_t329.source]);
              }
            } catch (err) {
              _iterator210.e(err);
            } finally {
              _iterator210.f();
            }
          }

          return !this.pauseablePlacement.isDone() || this.placement.hasTransitions(e.exported.now());
        }
      }, {
        key: "_releaseSymbolFadeTiles",
        value: function _releaseSymbolFadeTiles() {
          for (var _e354 in this._sourceCaches) {
            this._sourceCaches[_e354].releaseSymbolFadeTiles();
          }
        }
      }, {
        key: "getImages",
        value: function getImages(e, t, i) {
          this.imageManager.getImages(t.icons, i), this._updateTilesForChangedImages();

          var o = function o(e) {
            e && e.setDependencies(t.tileID.key, t.type, t.icons);
          };

          o(this._otherSourceCaches[t.source]), o(this._symbolSourceCaches[t.source]);
        }
      }, {
        key: "getGlyphs",
        value: function getGlyphs(e, t, i) {
          this.glyphManager.getGlyphs(t.stacks, i);
        }
      }, {
        key: "getResource",
        value: function getResource(t, i, o) {
          return e.makeRequest(i, o);
        }
      }, {
        key: "_getSourceCache",
        value: function _getSourceCache(e) {
          return this._otherSourceCaches[e];
        }
      }, {
        key: "_getLayerSourceCache",
        value: function _getLayerSourceCache(e) {
          return "symbol" === e.type ? this._symbolSourceCaches[e.source] : this._otherSourceCaches[e.source];
        }
      }, {
        key: "_getSourceCaches",
        value: function _getSourceCaches(e) {
          var t = [];
          return this._otherSourceCaches[e] && t.push(this._otherSourceCaches[e]), this._symbolSourceCaches[e] && t.push(this._symbolSourceCaches[e]), t;
        }
      }, {
        key: "has3DLayers",
        value: function has3DLayers() {
          return this._num3DLayers > 0;
        }
      }, {
        key: "hasSymbolLayers",
        value: function hasSymbolLayers() {
          return this._numSymbolLayers > 0;
        }
      }, {
        key: "hasCircleLayers",
        value: function hasCircleLayers() {
          return this._numCircleLayers > 0;
        }
      }, {
        key: "_clearWorkerCaches",
        value: function _clearWorkerCaches() {
          this.dispatcher.broadcast("clearCaches");
        }
      }, {
        key: "destroy",
        value: function destroy() {
          this._clearWorkerCaches(), this.terrainSetForDrapingOnly() && (delete this.terrain, delete this.stylesheet.terrain);
        }
      }]);

      return Nt;
    }(e.Evented);

    Nt.getSourceType = function (e) {
      return we[e];
    }, Nt.setSourceType = function (e, t) {
      we[e] = t;
    }, Nt.registerForPluginStateChange = e.registerForPluginStateChange;
    var Gt = "\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",
        jt = "attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";
    var Zt = {},
        Vt = {};
    Zt = $t("", "\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif", !0), Vt = $t("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif", "#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif", !0);
    var Wt = $t("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif", "\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nreturn mix(globe,mercator,t);\n#else\nreturn globe;\n#endif\n}\n#ifdef PROJECTION_GLOBE_VIEW\nmat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),
        qt = Gt;
    var Xt = {
      background: $t("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),
      backgroundPattern: $t("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),
      circle: $t("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\n#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)\nview_scale*=a_scale;\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),
      clippingMask: $t("void main() {gl_FragColor=vec4(1.0);}", "attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),
      heatmap: $t("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nextrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),
      heatmapTexture: $t("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}", "attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),
      collisionBox: $t("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}", "attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),
      collisionCircle: $t("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}", "attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),
      debug: $t("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}", "attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),
      fill: $t("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),
      fillOutline: $t("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),
      fillOutlinePattern: $t("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),
      fillPattern: $t("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),
      fillExtrusion: $t("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),
      fillExtrusionPattern: $t("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),
      hillshadePrepare: $t("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),
      hillshade: $t("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),
      line: $t("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),
      linePattern: $t("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),
      raster: $t("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),
      symbolIcon: $t("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),
      symbolSDF: $t("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),
      symbolTextAndIcon: $t("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),
      terrainRaster: $t("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),
      terrainDepth: $t("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}", "uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),
      skybox: $t("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", jt),
      skyboxGradient: $t("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", jt),
      skyboxCapture: $t("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}", "attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),
      globeRaster: $t("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}", "uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;const float wireframeOffset=1e3;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nvec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}"),
      globeAtmosphere: $t("uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)\ndiscard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}", "attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}")
    };

    function $t(e, t, i) {
      var o = /#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,
          r = /uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,
          n = t.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),
          a = e.match(r),
          s = t.match(r),
          l = Gt.match(r);
      var c = s ? s.concat(a) : a;
      i || (Zt.staticUniforms && (c = Zt.staticUniforms.concat(c)), Vt.staticUniforms && (c = Vt.staticUniforms.concat(c))), c && (c = c.concat(l));
      var h = {};
      return {
        fragmentSource: e = e.replace(o, function (e, t, i, o, r) {
          return h[r] = !0, "define" === t ? "\n#ifndef HAS_UNIFORM_u_".concat(r, "\nvarying ").concat(i, " ").concat(o, " ").concat(r, ";\n#else\nuniform ").concat(i, " ").concat(o, " u_").concat(r, ";\n#endif\n") : "\n#ifdef HAS_UNIFORM_u_".concat(r, "\n    ").concat(i, " ").concat(o, " ").concat(r, " = u_").concat(r, ";\n#endif\n");
        }),
        vertexSource: t = t.replace(o, function (e, t, i, o, r) {
          var n = "float" === o ? "vec2" : "vec4",
              a = r.match(/color/) ? "color" : n;
          return h[r] ? "define" === t ? "\n#ifndef HAS_UNIFORM_u_".concat(r, "\nuniform lowp float u_").concat(r, "_t;\nattribute ").concat(i, " ").concat(n, " a_").concat(r, ";\nvarying ").concat(i, " ").concat(o, " ").concat(r, ";\n#else\nuniform ").concat(i, " ").concat(o, " u_").concat(r, ";\n#endif\n") : "vec4" === a ? "\n#ifndef HAS_UNIFORM_u_".concat(r, "\n    ").concat(r, " = a_").concat(r, ";\n#else\n    ").concat(i, " ").concat(o, " ").concat(r, " = u_").concat(r, ";\n#endif\n") : "\n#ifndef HAS_UNIFORM_u_".concat(r, "\n    ").concat(r, " = unpack_mix_").concat(a, "(a_").concat(r, ", u_").concat(r, "_t);\n#else\n    ").concat(i, " ").concat(o, " ").concat(r, " = u_").concat(r, ";\n#endif\n") : "define" === t ? "\n#ifndef HAS_UNIFORM_u_".concat(r, "\nuniform lowp float u_").concat(r, "_t;\nattribute ").concat(i, " ").concat(n, " a_").concat(r, ";\n#else\nuniform ").concat(i, " ").concat(o, " u_").concat(r, ";\n#endif\n") : "vec4" === a ? "\n#ifndef HAS_UNIFORM_u_".concat(r, "\n    ").concat(i, " ").concat(o, " ").concat(r, " = a_").concat(r, ";\n#else\n    ").concat(i, " ").concat(o, " ").concat(r, " = u_").concat(r, ";\n#endif\n") : "\n#ifndef HAS_UNIFORM_u_".concat(r, "\n    ").concat(i, " ").concat(o, " ").concat(r, " = unpack_mix_").concat(a, "(a_").concat(r, ", u_").concat(r, "_t);\n#else\n    ").concat(i, " ").concat(o, " ").concat(r, " = u_").concat(r, ";\n#endif\n");
        }),
        staticAttributes: n,
        staticUniforms: c
      };
    }

    var Ht = /*#__PURE__*/function () {
      function Ht() {
        _classCallCheck(this, Ht);

        this.boundProgram = null, this.boundLayoutVertexBuffer = null, this.boundPaintVertexBuffers = [], this.boundIndexBuffer = null, this.boundVertexOffset = null, this.boundDynamicVertexBuffer = null, this.vao = null;
      }

      _createClass(Ht, [{
        key: "bind",
        value: function bind(e, t, i, o, r, n, a, s) {
          this.context = e;
          var l = this.boundPaintVertexBuffers.length !== o.length;

          for (var _e355 = 0; !l && _e355 < o.length; _e355++) {
            this.boundPaintVertexBuffers[_e355] !== o[_e355] && (l = !0);
          }

          e.extVertexArrayObject && this.vao && this.boundProgram === t && this.boundLayoutVertexBuffer === i && !l && this.boundIndexBuffer === r && this.boundVertexOffset === n && this.boundDynamicVertexBuffer === a && this.boundDynamicVertexBuffer2 === s ? (e.bindVertexArrayOES.set(this.vao), a && a.bind(), r && r.dynamicDraw && r.bind(), s && s.bind()) : this.freshBind(t, i, o, r, n, a, s);
        }
      }, {
        key: "freshBind",
        value: function freshBind(e, t, i, o, r, n, a) {
          var s;
          var l = e.numAttributes,
              c = this.context,
              h = c.gl;
          if (c.extVertexArrayObject) this.vao && this.destroy(), this.vao = c.extVertexArrayObject.createVertexArrayOES(), c.bindVertexArrayOES.set(this.vao), s = 0, this.boundProgram = e, this.boundLayoutVertexBuffer = t, this.boundPaintVertexBuffers = i, this.boundIndexBuffer = o, this.boundVertexOffset = r, this.boundDynamicVertexBuffer = n, this.boundDynamicVertexBuffer2 = a;else {
            s = c.currentNumAttributes || 0;

            for (var _e356 = l; _e356 < s; _e356++) {
              h.disableVertexAttribArray(_e356);
            }
          }
          t.enableAttributes(h, e);

          var _iterator211 = _createForOfIteratorHelper(i),
              _step211;

          try {
            for (_iterator211.s(); !(_step211 = _iterator211.n()).done;) {
              var _t330 = _step211.value;

              _t330.enableAttributes(h, e);
            }
          } catch (err) {
            _iterator211.e(err);
          } finally {
            _iterator211.f();
          }

          n && n.enableAttributes(h, e), a && a.enableAttributes(h, e), t.bind(), t.setVertexAttribPointers(h, e, r);

          var _iterator212 = _createForOfIteratorHelper(i),
              _step212;

          try {
            for (_iterator212.s(); !(_step212 = _iterator212.n()).done;) {
              var _t331 = _step212.value;
              _t331.bind(), _t331.setVertexAttribPointers(h, e, r);
            }
          } catch (err) {
            _iterator212.e(err);
          } finally {
            _iterator212.f();
          }

          n && (n.bind(), n.setVertexAttribPointers(h, e, r)), o && o.bind(), a && (a.bind(), a.setVertexAttribPointers(h, e, r)), c.currentNumAttributes = l;
        }
      }, {
        key: "destroy",
        value: function destroy() {
          this.vao && (this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao), this.vao = null);
        }
      }]);

      return Ht;
    }();

    function Kt(t, i) {
      var o = Math.pow(2, i.canonical.z),
          r = i.canonical.y;
      return [new e.MercatorCoordinate(0, r / o).toLngLat().lat, new e.MercatorCoordinate(0, (r + 1) / o).toLngLat().lat];
    }

    function Yt(t, i, o, r, n, a, s) {
      var l = t.context,
          c = l.gl,
          h = o.fbo;
      if (!h) return;
      t.prepareDrawTile(i);
      var u = t.useProgram("hillshade");
      l.activeTexture.set(c.TEXTURE0), c.bindTexture(c.TEXTURE_2D, h.colorAttachment.get());

      var _ = function (e, t, i, o) {
        var r = i.paint.get("hillshade-shadow-color"),
            n = i.paint.get("hillshade-highlight-color"),
            a = i.paint.get("hillshade-accent-color");
        var s = i.paint.get("hillshade-illumination-direction") * (Math.PI / 180);
        "viewport" === i.paint.get("hillshade-illumination-anchor") && (s -= e.transform.angle);
        var l = !e.options.moving;
        return {
          u_matrix: o || e.transform.calculateProjMatrix(t.tileID.toUnwrapped(), l),
          u_image: 0,
          u_latrange: Kt(0, t.tileID),
          u_light: [i.paint.get("hillshade-exaggeration"), s],
          u_shadow: r,
          u_highlight: n,
          u_accent: a
        };
      }(t, o, r, t.terrain ? i.projMatrix : null);

      t.prepareDrawProgram(l, u, i.toUnwrapped());

      var _t$getTileBoundsBuffe = t.getTileBoundsBuffers(o),
          d = _t$getTileBoundsBuffe.tileBoundsBuffer,
          p = _t$getTileBoundsBuffe.tileBoundsIndexBuffer,
          m = _t$getTileBoundsBuffe.tileBoundsSegments;

      u.draw(l, c.TRIANGLES, n, a, s, e.CullFaceMode.disabled, _, r.id, d, p, m);
    }

    function Jt(t, i, o) {
      if (!i.needsDEMTextureUpload) return;
      var r = t.context,
          n = r.gl;
      r.pixelStoreUnpackPremultiplyAlpha.set(!1), i.demTexture = i.demTexture || t.getTileTexture(o.stride);
      var a = o.getPixels();
      i.demTexture ? i.demTexture.update(a, {
        premultiply: !1
      }) : i.demTexture = new e.Texture(r, a, n.RGBA, {
        premultiply: !1
      }), i.needsDEMTextureUpload = !1;
    }

    function Qt(t, i, o, r, n, a) {
      var s = t.context,
          l = s.gl;
      if (!i.dem) return;
      var c = i.dem;
      if (s.activeTexture.set(l.TEXTURE1), Jt(t, i, c), !i.demTexture) return;
      i.demTexture.bind(l.NEAREST, l.CLAMP_TO_EDGE);
      var h = c.dim;
      s.activeTexture.set(l.TEXTURE0);
      var u = i.fbo;

      if (!u) {
        var _t332 = new e.Texture(s, {
          width: h,
          height: h,
          data: null
        }, l.RGBA);

        _t332.bind(l.LINEAR, l.CLAMP_TO_EDGE), u = i.fbo = s.createFramebuffer(h, h, !0), u.colorAttachment.set(_t332.texture);
      }

      s.bindFramebuffer.set(u.framebuffer), s.viewport.set([0, 0, h, h]);

      var _t$getMercatorTileBou = t.getMercatorTileBoundsBuffers(),
          _ = _t$getMercatorTileBou.tileBoundsBuffer,
          d = _t$getMercatorTileBou.tileBoundsIndexBuffer,
          p = _t$getMercatorTileBou.tileBoundsSegments;

      t.useProgram("hillshadePrepare").draw(s, l.TRIANGLES, r, n, a, e.CullFaceMode.disabled, function (t, i) {
        var o = i.stride,
            r = e.create();
        return e.ortho(r, 0, e.EXTENT, -e.EXTENT, 0, 0, 1), e.translate(r, r, [0, -e.EXTENT, 0]), {
          u_matrix: r,
          u_image: 1,
          u_dimension: [o, o],
          u_zoom: t.overscaledZ,
          u_unpack: i.unpackVector
        };
      }(i.tileID, c), o.id, _, d, p), i.needsHillshadePrepare = !1;
    }

    var ei = function ei(t, i) {
      return {
        u_matrix: new e.UniformMatrix4f(t, i.u_matrix),
        u_image0: new e.Uniform1i(t, i.u_image0),
        u_skirt_height: new e.Uniform1f(t, i.u_skirt_height)
      };
    },
        ti = function ti(e, t) {
      return {
        u_matrix: e,
        u_image0: 0,
        u_skirt_height: t
      };
    },
        ii = function ii(e, t, i, o, r) {
      return {
        u_proj_matrix: Float32Array.from(e),
        u_globe_matrix: t,
        u_merc_matrix: i,
        u_zoom_transition: o,
        u_merc_center: r,
        u_image0: 0
      };
    };

    function oi(e, t) {
      return null != e && null != t && !(!e.hasData() || !t.hasData()) && null != e.demTexture && null != t.demTexture && e.tileID.key !== t.tileID.key;
    }

    var ri = new ( /*#__PURE__*/function () {
      function _class18() {
        _classCallCheck(this, _class18);

        this.operations = {};
      }

      _createClass(_class18, [{
        key: "newMorphing",
        value: function newMorphing(e, t, i, o, r) {
          if (e in this.operations) {
            var _t333 = this.operations[e];
            _t333.to.tileID.key !== i.tileID.key && (_t333.queued = i);
          } else this.operations[e] = {
            startTime: o,
            phase: 0,
            duration: r,
            from: t,
            to: i,
            queued: null
          };
        }
      }, {
        key: "getMorphValuesForProxy",
        value: function getMorphValuesForProxy(e) {
          if (!(e in this.operations)) return null;
          var t = this.operations[e];
          return {
            from: t.from,
            to: t.to,
            phase: t.phase
          };
        }
      }, {
        key: "update",
        value: function update(e) {
          for (var _t334 in this.operations) {
            var _i209 = this.operations[_t334];

            for (_i209.phase = (e - _i209.startTime) / _i209.duration; _i209.phase >= 1 || !this._validOp(_i209);) {
              if (!this._nextOp(_i209, e)) {
                delete this.operations[_t334];
                break;
              }
            }
          }
        }
      }, {
        key: "_nextOp",
        value: function _nextOp(e, t) {
          return !!e.queued && (e.from = e.to, e.to = e.queued, e.queued = null, e.phase = 0, e.startTime = t, !0);
        }
      }, {
        key: "_validOp",
        value: function _validOp(e) {
          return e.from.hasData() && e.to.hasData();
        }
      }]);

      return _class18;
    }())(),
        ni = {
      0: null,
      1: "TERRAIN_VERTEX_MORPHING",
      2: "TERRAIN_WIREFRAME"
    };

    function ai(e, t) {
      var i = 1 << e.z;
      return !t && (0 === e.x || e.x === i - 1) || 0 === e.y || e.y === i - 1;
    }

    var si = function si(e) {
      return {
        u_matrix: e
      };
    };

    function li(t, i, o, r, n) {
      if (n > 0) {
        var _a104 = e.exported.now(),
            _s121 = (_a104 - t.timeAdded) / n,
            _l64 = i ? (_a104 - i.timeAdded) / n : -1,
            _c41 = o.getSource(),
            _h32 = r.coveringZoomLevel({
          tileSize: _c41.tileSize,
          roundZoom: _c41.roundZoom
        }),
            _u53 = !i || Math.abs(i.tileID.overscaledZ - _h32) > Math.abs(t.tileID.overscaledZ - _h32),
            _13 = _u53 && t.refreshedUponExpiration ? 1 : e.clamp(_u53 ? _s121 : 1 - _l64, 0, 1);

        return t.refreshedUponExpiration && _s121 >= 1 && (t.refreshedUponExpiration = !1), i ? {
          opacity: 1,
          mix: 1 - _13
        } : {
          opacity: _13,
          mix: 0
        };
      }

      return {
        opacity: 1,
        mix: 0
      };
    }

    var ci = /*#__PURE__*/function (_e$SourceCache) {
      _inherits(ci, _e$SourceCache);

      var _super117 = _createSuper(ci);

      function ci(e) {
        var _this99;

        _classCallCheck(this, ci);

        var t = {
          type: "raster-dem",
          maxzoom: e.transform.maxZoom
        },
            i = new C(Ae(), null),
            o = Te("mock-dem", t, i, e.style);
        _this99 = _super117.call(this, "mock-dem", o, !1), o.setEventedParent(_assertThisInitialized(_this99)), _this99._sourceLoaded = !0;
        return _this99;
      }

      _createClass(ci, [{
        key: "_loadTile",
        value: function _loadTile(e, t) {
          e.state = "loaded", t(null);
        }
      }]);

      return ci;
    }(e.SourceCache);

    var hi = /*#__PURE__*/function (_e$SourceCache2) {
      _inherits(hi, _e$SourceCache2);

      var _super118 = _createSuper(hi);

      function hi(e) {
        var _this100;

        _classCallCheck(this, hi);

        var t = Te("proxy", {
          type: "geojson",
          maxzoom: e.transform.maxZoom
        }, new C(Ae(), null), e.style);
        _this100 = _super118.call(this, "proxy", t, !1), t.setEventedParent(_assertThisInitialized(_this100)), _this100.map = _this100.getSource().map = e, _this100.used = _this100._sourceLoaded = !0, _this100.renderCache = [], _this100.renderCachePool = [], _this100.proxyCachedFBO = {};
        return _this100;
      }

      _createClass(hi, [{
        key: "update",
        value: function update(t, i, o) {
          var _this101 = this;

          if (t.freezeTileCoverage) return;
          this.transform = t;
          var r = t.coveringTiles({
            tileSize: this._source.tileSize,
            minzoom: this._source.minzoom,
            maxzoom: this._source.maxzoom,
            roundZoom: this._source.roundZoom,
            reparseOverscaled: this._source.reparseOverscaled
          }).reduce(function (i, o) {
            if (i[o.key] = "", !_this101._tiles[o.key]) {
              var _i210 = new e.Tile(o, _this101._source.tileSize * o.overscaleFactor(), t.tileZoom);

              _i210.state = "loaded", _this101._tiles[o.key] = _i210;
            }

            return i;
          }, {});

          for (var _e357 in this._tiles) {
            _e357 in r || (this.freeFBO(_e357), this._tiles[_e357].unloadVectorData(), delete this._tiles[_e357]);
          }
        }
      }, {
        key: "freeFBO",
        value: function freeFBO(e) {
          var t = this.proxyCachedFBO[e];

          if (void 0 !== t) {
            var _this$renderCachePool;

            var _i211 = Object.values(t);

            (_this$renderCachePool = this.renderCachePool).push.apply(_this$renderCachePool, _toConsumableArray(_i211)), delete this.proxyCachedFBO[e];
          }
        }
      }, {
        key: "deallocRenderCache",
        value: function deallocRenderCache() {
          this.renderCache.forEach(function (e) {
            return e.fb.destroy();
          }), this.renderCache = [], this.renderCachePool = [], this.proxyCachedFBO = {};
        }
      }]);

      return hi;
    }(e.SourceCache);

    var ui = /*#__PURE__*/function (_e$OverscaledTileID) {
      _inherits(ui, _e$OverscaledTileID);

      var _super119 = _createSuper(ui);

      function ui(e, t, i) {
        var _this102;

        _classCallCheck(this, ui);

        _this102 = _super119.call(this, e.overscaledZ, e.wrap, e.canonical.z, e.canonical.x, e.canonical.y), _this102.proxyTileKey = t, _this102.projMatrix = i;
        return _this102;
      }

      return _createClass(ui);
    }(e.OverscaledTileID);

    var _i = /*#__PURE__*/function (_e$Elevation) {
      _inherits(_i, _e$Elevation);

      var _super120 = _createSuper(_i);

      function _i(t, i) {
        var _this103;

        _classCallCheck(this, _i);

        _this103 = _super120.call(this), _this103.painter = t, _this103.terrainTileForTile = {}, _this103.prevTerrainTileForTile = {};

        var _ref172 = function (t) {
          var i = new e.StructArrayLayout4i8(),
              o = new e.StructArrayLayout3ui6(),
              r = 131;
          i.reserve(17161), o.reserve(33800);
          var n = e.EXTENT / 128,
              a = e.EXTENT + n / 2,
              s = a + n;

          for (var _t335 = -n; _t335 < s; _t335 += n) {
            for (var _o114 = -n; _o114 < s; _o114 += n) {
              var _r251 = _o114 < 0 || _o114 > a || _t335 < 0 || _t335 > a ? 24575 : 0,
                  _n167 = e.clamp(Math.round(_o114), 0, e.EXTENT),
                  _s122 = e.clamp(Math.round(_t335), 0, e.EXTENT);

              i.emplaceBack(_n167 + _r251, _s122, _n167, _s122);
            }
          }

          var l = function l(e, t) {
            var i = t * r + e;
            o.emplaceBack(i + 1, i, i + r), o.emplaceBack(i + r, i + r + 1, i + 1);
          };

          for (var _e358 = 1; _e358 < 129; _e358++) {
            for (var _t336 = 1; _t336 < 129; _t336++) {
              l(_t336, _e358);
            }
          }

          return [0, 129].forEach(function (e) {
            for (var _t337 = 0; _t337 < 130; _t337++) {
              l(_t337, e), l(e, _t337);
            }
          }), [i, o, 32768];
        }(),
            _ref173 = _slicedToArray(_ref172, 3),
            o = _ref173[0],
            r = _ref173[1],
            n = _ref173[2],
            a = t.context;

        _this103.gridBuffer = a.createVertexBuffer(o, e.boundsAttributes.members), _this103.gridIndexBuffer = a.createIndexBuffer(r), _this103.gridSegments = e.SegmentVector.simpleSegment(0, 0, o.length, r.length), _this103.gridNoSkirtSegments = e.SegmentVector.simpleSegment(0, 0, o.length, n), _this103.proxyCoords = [], _this103.proxiedCoords = {}, _this103._visibleDemTiles = [], _this103._drapedRenderBatches = [], _this103._sourceTilesOverlap = {}, _this103.proxySourceCache = new hi(i.map), _this103.orthoMatrix = e.create(), e.ortho(_this103.orthoMatrix, 0, e.EXTENT, 0, e.EXTENT, 0, 1);
        var s = a.gl;
        _this103._overlapStencilMode = new e.StencilMode({
          func: s.GEQUAL,
          mask: 255
        }, 0, 255, s.KEEP, s.KEEP, s.REPLACE), _this103._previousZoom = t.transform.zoom, _this103.pool = [], _this103._findCoveringTileCache = {}, _this103._tilesDirty = {}, _this103.style = i, _this103._useVertexMorphing = !0, _this103._exaggeration = 1, _this103._mockSourceCache = new ci(i.map);
        return _this103;
      }

      _createClass(_i, [{
        key: "style",
        set: function set(e) {
          e.on("data", this._onStyleDataEvent.bind(this)), e.on("neworder", this._checkRenderCacheEfficiency.bind(this)), this._style = e, this._checkRenderCacheEfficiency();
        }
      }, {
        key: "update",
        value: function update(t, i, o) {
          var _this104 = this;

          if (t && t.terrain) {
            this._style !== t && (this.style = t), this.enabled = !0;
            var _r252 = t.terrain.properties;
            this.sourceCache = 0 === t.terrain.drapeRenderMode ? this._mockSourceCache : t._getSourceCache(_r252.get("source")), this._exaggeration = _r252.get("exaggeration");

            var _n168 = function _n168() {
              _this104.sourceCache.used && e.warnOnce("Raster DEM source '".concat(_this104.sourceCache.id, "' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source."));

              var t = _this104.getScaledDemTileSize();

              _this104.sourceCache.update(i, t, !0), _this104.resetTileLookupCache(_this104.sourceCache.id);
            };

            this.sourceCache.usedForTerrain || (this.resetTileLookupCache(this.sourceCache.id), this.sourceCache.usedForTerrain = !0, _n168(), this._initializing = !0), _n168(), i.updateElevation(!o), this.resetTileLookupCache(this.proxySourceCache.id), this.proxySourceCache.update(i), this._emptyDEMTextureDirty = !0;
          } else this._disable();
        }
      }, {
        key: "resetTileLookupCache",
        value: function resetTileLookupCache(e) {
          this._findCoveringTileCache[e] = {};
        }
      }, {
        key: "getScaledDemTileSize",
        value: function getScaledDemTileSize() {
          return this.sourceCache.getSource().tileSize / 128 * this.proxySourceCache.getSource().tileSize;
        }
      }, {
        key: "_checkRenderCacheEfficiency",
        value: function _checkRenderCacheEfficiency() {
          var t = this.renderCacheEfficiency(this._style);
          this._style.map._optimizeForTerrain || 100 !== t.efficiency && e.warnOnce("Terrain render cache efficiency is not optimal (".concat(t.efficiency, "%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '").concat(t.firstUndrapedLayer, "' or create a map using optimizeForTerrain: true option."));
        }
      }, {
        key: "_onStyleDataEvent",
        value: function _onStyleDataEvent(e) {
          e.coord && "source" === e.dataType ? this._clearRenderCacheForTile(e.sourceCacheId, e.coord) : "style" === e.dataType && (this._invalidateRenderCache = !0);
        }
      }, {
        key: "_disable",
        value: function _disable() {
          if (this.enabled && (this.enabled = !1, this._sharedDepthStencil = void 0, this.proxySourceCache.deallocRenderCache(), this._style)) for (var _e359 in this._style._sourceCaches) {
            this._style._sourceCaches[_e359].usedForTerrain = !1;
          }
        }
      }, {
        key: "destroy",
        value: function destroy() {
          this._disable(), this._emptyDEMTexture && this._emptyDEMTexture.destroy(), this._emptyDepthBufferTexture && this._emptyDepthBufferTexture.destroy(), this.pool.forEach(function (e) {
            return e.fb.destroy();
          }), this.pool = [], this._depthFBO && (this._depthFBO.destroy(), delete this._depthFBO, delete this._depthTexture);
        }
      }, {
        key: "_source",
        value: function _source() {
          return this.enabled ? this.sourceCache : null;
        }
      }, {
        key: "exaggeration",
        value: function exaggeration() {
          return this._exaggeration;
        }
      }, {
        key: "visibleDemTiles",
        get: function get() {
          return this._visibleDemTiles;
        }
      }, {
        key: "drapeBufferSize",
        get: function get() {
          var e = 2 * this.proxySourceCache.getSource().tileSize;
          return [e, e];
        }
      }, {
        key: "useVertexMorphing",
        set: function set(e) {
          this._useVertexMorphing = e;
        }
      }, {
        key: "updateTileBinding",
        value: function updateTileBinding(t) {
          var _this105 = this;

          if (!this.enabled) return;
          this.prevTerrainTileForTile = this.terrainTileForTile;
          var i = this.proxySourceCache,
              o = this.painter.transform;
          this._initializing && (this._initializing = 0 === o._centerAltitude && -1 === this.getAtPointOrZero(e.MercatorCoordinate.fromLngLat(o.center), -1), this._emptyDEMTextureDirty = !this._initializing);
          var r = this.proxyCoords = i.getIds().map(function (e) {
            var t = i.getTileByID(e).tileID;
            return t.projMatrix = o.calculateProjMatrix(t.toUnwrapped()), t;
          });
          !function (t, i) {
            var o = i.transform.pointCoordinate(i.transform.getCameraPoint()),
                r = new e.pointGeometry(o.x, o.y);
            t.sort(function (t, i) {
              if (i.overscaledZ - t.overscaledZ) return i.overscaledZ - t.overscaledZ;
              var o = new e.pointGeometry(t.canonical.x + (1 << t.canonical.z) * t.wrap, t.canonical.y),
                  n = new e.pointGeometry(i.canonical.x + (1 << i.canonical.z) * i.wrap, i.canonical.y),
                  a = r.mult(1 << t.canonical.z);
              return a.x -= .5, a.y -= .5, a.distSqr(o) - a.distSqr(n);
            });
          }(r, this.painter), this._previousZoom = o.zoom;
          var n = this.proxyToSource || {};
          this.proxyToSource = {}, r.forEach(function (e) {
            _this105.proxyToSource[e.key] = {};
          }), this.terrainTileForTile = {};
          var a = this._style._sourceCaches;

          for (var _e360 in a) {
            var _i212 = a[_e360];
            if (!_i212.used) continue;
            if (_i212 !== this.sourceCache && this.resetTileLookupCache(_i212.id), this._setupProxiedCoordsForOrtho(_i212, t[_e360], n), _i212.usedForTerrain) continue;
            var _o115 = t[_e360];
            _i212.getSource().reparseOverscaled && this._assignTerrainTiles(_o115);
          }

          this.proxiedCoords[i.id] = r.map(function (e) {
            return new ui(e, e.key, _this105.orthoMatrix);
          }), this._assignTerrainTiles(r), this._prepareDEMTextures(), this._setupDrapedRenderBatches(), this._initFBOPool(), this._setupRenderCache(n), this.renderingToTexture = !1, this._updateTimestamp = e.exported.now();
          var s = {};
          this._visibleDemTiles = [];

          var _iterator213 = _createForOfIteratorHelper(this.proxyCoords),
              _step213;

          try {
            for (_iterator213.s(); !(_step213 = _iterator213.n()).done;) {
              var _e361 = _step213.value;
              var _t338 = this.terrainTileForTile[_e361.key];
              if (!_t338) continue;
              var _i213 = _t338.tileID.key;
              _i213 in s || (this._visibleDemTiles.push(_t338), s[_i213] = _i213);
            }
          } catch (err) {
            _iterator213.e(err);
          } finally {
            _iterator213.f();
          }
        }
      }, {
        key: "_assignTerrainTiles",
        value: function _assignTerrainTiles(e) {
          var _this106 = this;

          this._initializing || e.forEach(function (e) {
            if (_this106.terrainTileForTile[e.key]) return;

            var t = _this106._findTileCoveringTileID(e, _this106.sourceCache);

            t && (_this106.terrainTileForTile[e.key] = t);
          });
        }
      }, {
        key: "_prepareDEMTextures",
        value: function _prepareDEMTextures() {
          var e = this.painter.context,
              t = e.gl;

          for (var _i214 in this.terrainTileForTile) {
            var _o116 = this.terrainTileForTile[_i214],
                _r253 = _o116.dem;
            !_r253 || _o116.demTexture && !_o116.needsDEMTextureUpload || (e.activeTexture.set(t.TEXTURE1), Jt(this.painter, _o116, _r253));
          }
        }
      }, {
        key: "_prepareDemTileUniforms",
        value: function _prepareDemTileUniforms(e, t, i, o) {
          if (!t || null == t.demTexture) return !1;
          var r = e.tileID.canonical,
              n = Math.pow(2, t.tileID.canonical.z - r.z),
              a = o || "";
          return i["u_dem_tl".concat(a)] = [r.x * n % 1, r.y * n % 1], i["u_dem_scale".concat(a)] = n, !0;
        }
      }, {
        key: "emptyDEMTexture",
        get: function get() {
          return !this._emptyDEMTextureDirty && this._emptyDEMTexture ? this._emptyDEMTexture : this._updateEmptyDEMTexture();
        }
      }, {
        key: "emptyDepthBufferTexture",
        get: function get() {
          var t = this.painter.context,
              i = t.gl;

          if (!this._emptyDepthBufferTexture) {
            var _o117 = {
              width: 1,
              height: 1,
              data: new Uint8Array([255, 255, 255, 255])
            };
            this._emptyDepthBufferTexture = new e.Texture(t, _o117, i.RGBA, {
              premultiply: !1
            });
          }

          return this._emptyDepthBufferTexture;
        }
      }, {
        key: "_getLoadedAreaMinimum",
        value: function _getLoadedAreaMinimum() {
          var e = 0;

          var t = this._visibleDemTiles.reduce(function (t, i) {
            if (!i.dem) return t;
            var o = i.dem.tree.minimums[0];
            return o > 0 && e++, t + o;
          }, 0);

          return e ? t / e : 0;
        }
      }, {
        key: "_updateEmptyDEMTexture",
        value: function _updateEmptyDEMTexture() {
          var t = this.painter.context,
              i = t.gl;
          t.activeTexture.set(i.TEXTURE2);

          var o = this._getLoadedAreaMinimum(),
              r = {
            width: 1,
            height: 1,
            data: new Uint8Array(e.DEMData.pack(o, this.sourceCache.getSource().encoding))
          };

          this._emptyDEMTextureDirty = !1;
          var n = this._emptyDEMTexture;
          return n ? n.update(r, {
            premultiply: !1
          }) : n = this._emptyDEMTexture = new e.Texture(t, r, i.RGBA, {
            premultiply: !1
          }), n;
        }
      }, {
        key: "setupElevationDraw",
        value: function setupElevationDraw(t, i, o) {
          var r = this.painter.context,
              n = r.gl,
              a = (s = this.sourceCache.getSource().encoding, {
            u_dem: 2,
            u_dem_prev: 4,
            u_dem_unpack: e.DEMData.getUnpackVector(s),
            u_dem_tl: [0, 0],
            u_dem_tl_prev: [0, 0],
            u_dem_scale: 0,
            u_dem_scale_prev: 0,
            u_dem_size: 0,
            u_dem_lerp: 1,
            u_depth: 3,
            u_depth_size_inv: [0, 0],
            u_exaggeration: 0,
            u_tile_tl_up: [0, 0, 1],
            u_tile_tr_up: [0, 0, 1],
            u_tile_br_up: [0, 0, 1],
            u_tile_bl_up: [0, 0, 1],
            u_tile_up_scale: 1
          });
          var s;
          a.u_dem_size = this.sourceCache.getSource().tileSize, a.u_exaggeration = this.exaggeration();
          var l = this.painter.transform,
              c = l.projection.createTileTransform(l, l.worldSize),
              h = t.tileID.canonical;
          a.u_tile_tl_up = c.upVector(h, 0, 0), a.u_tile_tr_up = c.upVector(h, e.EXTENT, 0), a.u_tile_br_up = c.upVector(h, e.EXTENT, e.EXTENT), a.u_tile_bl_up = c.upVector(h, 0, e.EXTENT), a.u_tile_up_scale = c.upVectorScale(h);
          var u = null,
              _ = null,
              d = 1;

          if (o && o.morphing && this._useVertexMorphing) {
            var _e362 = o.morphing.srcDemTile,
                _i215 = o.morphing.dstDemTile;
            d = o.morphing.phase, _e362 && _i215 && (this._prepareDemTileUniforms(t, _e362, a, "_prev") && (_ = _e362), this._prepareDemTileUniforms(t, _i215, a) && (u = _i215));
          }

          if (_ && u ? (r.activeTexture.set(n.TEXTURE2), u.demTexture.bind(n.NEAREST, n.CLAMP_TO_EDGE, n.NEAREST), r.activeTexture.set(n.TEXTURE4), _.demTexture.bind(n.NEAREST, n.CLAMP_TO_EDGE, n.NEAREST), a.u_dem_lerp = d) : (u = this.terrainTileForTile[t.tileID.key], r.activeTexture.set(n.TEXTURE2), (this._prepareDemTileUniforms(t, u, a) ? u.demTexture : this.emptyDEMTexture).bind(n.NEAREST, n.CLAMP_TO_EDGE)), r.activeTexture.set(n.TEXTURE3), o && o.useDepthForOcclusion ? (this._depthTexture.bind(n.NEAREST, n.CLAMP_TO_EDGE), a.u_depth_size_inv = [1 / this._depthFBO.width, 1 / this._depthFBO.height]) : (this.emptyDepthBufferTexture.bind(n.NEAREST, n.CLAMP_TO_EDGE), a.u_depth_size_inv = [1, 1]), o && o.useMeterToDem && u) {
            var _t339 = (1 << u.tileID.canonical.z) * e.mercatorZfromAltitude(1, this.painter.transform.center.lat) * this.sourceCache.getSource().tileSize;

            a.u_meter_to_dem = _t339;
          }

          o && o.labelPlaneMatrixInv && (a.u_label_plane_matrix_inv = o.labelPlaneMatrixInv), i.setTerrainUniformValues(r, a);
        }
      }, {
        key: "renderToBackBuffer",
        value: function renderToBackBuffer(t) {
          var i = this.painter,
              o = this.painter.context;
          0 !== t.length && (o.bindFramebuffer.set(null), o.viewport.set([0, 0, i.width, i.height]), this.renderingToTexture = !1, function (t, i, o, r, n) {
            if ("globe" === t.transform.projection.name) !function (t, i, o, r, n) {
              var a = t.context,
                  s = a.gl;
              var l, c;

              var h = t.options.showTerrainWireframe ? 2 : 0,
                  u = function u(e, i) {
                if (c === e) return;
                var o = [];
                i && o.push(ni[h]), o.push(ni[e]), o.push("PROJECTION_GLOBE_VIEW"), l = t.useProgram("globeRaster", null, o), c = e;
              },
                  _ = t.colorModeForRenderPass(),
                  d = new e.DepthMode(s.LEQUAL, e.DepthMode.ReadWrite, t.depthRangeFor3D);

              ri.update(n);
              var p = t.transform,
                  m = e.calculateGlobeMatrix(p, p.worldSize),
                  f = e.calculateGlobeMercatorMatrix(p),
                  g = [e.mercatorXfromLng(p.center.lng), e.mercatorYfromLat(p.center.lat)],
                  v = t.globeSharedBuffers;
              (h ? [!1, !0] : [!1]).forEach(function (h) {
                c = -1;
                var x = h ? s.LINES : s.TRIANGLES;

                var _iterator214 = _createForOfIteratorHelper(r),
                    _step214;

                try {
                  for (_iterator214.s(); !(_step214 = _iterator214.n()).done;) {
                    var _c42 = _step214.value;

                    var _r254 = o.getTile(_c42),
                        _y10 = Math.pow(2, _c42.canonical.z),
                        _e$globeBuffersForTil = e.globeBuffersForTileMesh(t, _r254, _c42, _y10),
                        _e$globeBuffersForTil2 = _slicedToArray(_e$globeBuffersForTil, 2),
                        _b12 = _e$globeBuffersForTil2[0],
                        _w11 = _e$globeBuffersForTil2[1],
                        _T5 = e.StencilMode.disabled,
                        _E2 = i.prevTerrainTileForTile[_c42.key],
                        _C3 = i.terrainTileForTile[_c42.key];

                    oi(_E2, _C3) && ri.newMorphing(_c42.key, _E2, _C3, n, 250), a.activeTexture.set(s.TEXTURE0), _r254.texture.bind(s.LINEAR, s.CLAMP_TO_EDGE);

                    var _M5 = ri.getMorphValuesForProxy(_c42.key),
                        _S6 = _M5 ? 1 : 0,
                        _I6 = {};

                    _M5 && e.extend$1(_I6, {
                      morphing: {
                        srcDemTile: _M5.from,
                        dstDemTile: _M5.to,
                        phase: e.easeCubicInOut(_M5.phase)
                      }
                    });

                    var _z6 = e.globeMatrixForTile(_c42.canonical, m),
                        _D34 = ii(p.projMatrix, _z6, f, e.globeToMercatorTransition(p.zoom), g);

                    if (u(_S6, h), i.setupElevationDraw(_r254, l, _I6), t.prepareDrawProgram(a, l, _c42.toUnwrapped()), v) {
                      var _ref174 = h ? v.getWirefameBuffer(t.context) : [v.gridIndexBuffer, v.gridSegments],
                          _ref175 = _slicedToArray(_ref174, 2),
                          _i216 = _ref175[0],
                          _o118 = _ref175[1];

                      l.draw(a, x, d, _T5, _, e.CullFaceMode.backCCW, _D34, "globe_raster", _b12, _i216, _o118);
                    }

                    if (!h) {
                      var _t340 = [0 === _c42.canonical.y ? e.globePoleMatrixForTile(_c42.canonical, !1, p) : null, _c42.canonical.y === _y10 - 1 ? e.globePoleMatrixForTile(_c42.canonical, !0, p) : null];

                      for (var _i217 = 0, _t341 = _t340; _i217 < _t341.length; _i217++) {
                        var _i218 = _t341[_i217];
                        if (!_i218) continue;

                        var _t342 = ii(p.projMatrix, _i218, _i218, 0, g);

                        v && l.draw(a, x, d, _T5, _, e.CullFaceMode.disabled, _t342, "globe_pole_raster", _w11, v.poleIndexBuffer, v.poleSegments);
                      }
                    }
                  }
                } catch (err) {
                  _iterator214.e(err);
                } finally {
                  _iterator214.f();
                }
              });
            }(t, i, o, r, n);else {
              var _a105 = t.context,
                  _s123 = _a105.gl;

              var _l65, _c43;

              var _h33 = t.options.showTerrainWireframe ? 2 : 0,
                  _u54 = function _u54(e, i) {
                if (_c43 === e) return;
                var o = [ni[e]];
                i && o.push(ni[_h33]), _l65 = t.useProgram("terrainRaster", null, o), _c43 = e;
              },
                  _14 = t.colorModeForRenderPass(),
                  _d21 = new e.DepthMode(_s123.LEQUAL, e.DepthMode.ReadWrite, t.depthRangeFor3D);

              ri.update(n);

              var _p29 = t.transform,
                  _m11 = 6 * Math.pow(1.5, 22 - _p29.zoom) * i.exaggeration();

              (_h33 ? [!1, !0] : [!1]).forEach(function (h) {
                _c43 = -1;

                var f = h ? _s123.LINES : _s123.TRIANGLES,
                    _ref176 = h ? i.getWirefameBuffer() : [i.gridIndexBuffer, i.gridSegments],
                    _ref177 = _slicedToArray(_ref176, 2),
                    g = _ref177[0],
                    v = _ref177[1];

                var _iterator215 = _createForOfIteratorHelper(r),
                    _step215;

                try {
                  for (_iterator215.s(); !(_step215 = _iterator215.n()).done;) {
                    var _c44 = _step215.value;

                    var _r255 = o.getTile(_c44),
                        _x12 = e.StencilMode.disabled,
                        _y11 = i.prevTerrainTileForTile[_c44.key],
                        _b13 = i.terrainTileForTile[_c44.key];

                    oi(_y11, _b13) && ri.newMorphing(_c44.key, _y11, _b13, n, 250), _a105.activeTexture.set(_s123.TEXTURE0), _r255.texture.bind(_s123.LINEAR, _s123.CLAMP_TO_EDGE, _s123.LINEAR_MIPMAP_NEAREST);

                    var _w12 = ri.getMorphValuesForProxy(_c44.key),
                        _T6 = _w12 ? 1 : 0;

                    var _E3 = void 0;

                    _w12 && (_E3 = {
                      morphing: {
                        srcDemTile: _w12.from,
                        dstDemTile: _w12.to,
                        phase: e.easeCubicInOut(_w12.phase)
                      }
                    });

                    var _C4 = ti(_c44.projMatrix, ai(_c44.canonical, _p29.renderWorldCopies) ? _m11 / 10 : _m11);

                    _u54(_T6, h), i.setupElevationDraw(_r255, _l65, _E3), t.prepareDrawProgram(_a105, _l65, _c44.toUnwrapped()), _l65.draw(_a105, f, _d21, _x12, _14, e.CullFaceMode.backCCW, _C4, "terrain_raster", i.gridBuffer, g, v);
                  }
                } catch (err) {
                  _iterator215.e(err);
                } finally {
                  _iterator215.f();
                }
              });
            }
          }(i, this, this.proxySourceCache, t, this._updateTimestamp), this.renderingToTexture = !0, t.splice(0, t.length));
        }
      }, {
        key: "renderBatch",
        value: function renderBatch(t) {
          if (0 === this._drapedRenderBatches.length) return t + 1;
          this.renderingToTexture = !0;

          var i = this.painter,
              o = this.painter.context,
              r = this.proxySourceCache,
              n = this.proxiedCoords[r.id],
              a = this._drapedRenderBatches.shift(),
              s = [],
              l = i.style.order;

          var c = 0;

          var _iterator216 = _createForOfIteratorHelper(n),
              _step216;

          try {
            for (_iterator216.s(); !(_step216 = _iterator216.n()).done;) {
              var _h34 = _step216.value;

              var _n169 = r.getTileByID(_h34.proxyTileKey),
                  _u55 = r.proxyCachedFBO[_h34.key] ? r.proxyCachedFBO[_h34.key][t] : void 0,
                  _15 = void 0 !== _u55 ? r.renderCache[_u55] : this.pool[c++],
                  _d22 = void 0 !== _u55;

              if (_n169.texture = _15.tex, _d22 && !_15.dirty) {
                s.push(_n169.tileID);
                continue;
              }

              var _p30 = void 0;

              o.bindFramebuffer.set(_15.fb.framebuffer), this.renderedToTile = !1, _15.dirty && (o.clear({
                color: e.Color.transparent,
                stencil: 0
              }), _15.dirty = !1);

              for (var _e363 = a.start; _e363 <= a.end; ++_e363) {
                var _t343 = i.style._layers[l[_e363]];
                if (_t343.isHidden(i.transform.zoom)) continue;

                var _r256 = i.style._getLayerSourceCache(_t343),
                    _n170 = _r256 ? this.proxyToSource[_h34.key][_r256.id] : [_h34];

                if (!_n170) continue;
                var _a106 = _n170;
                o.viewport.set([0, 0, _15.fb.width, _15.fb.height]), _p30 !== (_r256 ? _r256.id : null) && (this._setupStencil(_15, _n170, _t343, _r256), _p30 = _r256 ? _r256.id : null), i.renderLayer(i, _r256, _t343, _a106);
              }

              this.renderedToTile ? (_15.dirty = !0, s.push(_n169.tileID)) : _d22 || --c, 5 === c && (c = 0, this.renderToBackBuffer(s));
            }
          } catch (err) {
            _iterator216.e(err);
          } finally {
            _iterator216.f();
          }

          return this.renderToBackBuffer(s), this.renderingToTexture = !1, o.bindFramebuffer.set(null), o.viewport.set([0, 0, i.width, i.height]), a.end + 1;
        }
      }, {
        key: "postRender",
        value: function postRender() {}
      }, {
        key: "renderCacheEfficiency",
        value: function renderCacheEfficiency(e) {
          var t = e.order.length;
          if (0 === t) return {
            efficiency: 100
          };
          var i,
              o = 0,
              r = 0,
              n = !1;

          for (var _a107 = 0; _a107 < t; ++_a107) {
            var _t344 = e._layers[e.order[_a107]];
            this._style.isLayerDraped(_t344) ? (n && ++o, ++r) : n || (n = !0, i = _t344.id);
          }

          return 0 === r ? {
            efficiency: 100
          } : {
            efficiency: 100 * (1 - o / r),
            firstUndrapedLayer: i
          };
        }
      }, {
        key: "getMinElevationBelowMSL",
        value: function getMinElevationBelowMSL() {
          var e = 0;
          return this._visibleDemTiles.filter(function (e) {
            return e.dem;
          }).forEach(function (t) {
            e = Math.min(e, t.dem.tree.minimums[0]);
          }), 0 === e ? e : (e - 30) * this._exaggeration;
        }
      }, {
        key: "raycast",
        value: function raycast(e, t, i) {
          if (!this._visibleDemTiles) return null;

          var o = this._visibleDemTiles.filter(function (e) {
            return e.dem;
          }).map(function (o) {
            var r = o.tileID,
                n = Math.pow(2, r.overscaledZ),
                _r$canonical = r.canonical,
                a = _r$canonical.x,
                s = _r$canonical.y,
                l = a / n,
                c = (a + 1) / n,
                h = s / n,
                u = (s + 1) / n;
            return {
              minx: l,
              miny: h,
              maxx: c,
              maxy: u,
              t: o.dem.tree.raycastRoot(l, h, c, u, e, t, i),
              tile: o
            };
          });

          o.sort(function (e, t) {
            return (null !== e.t ? e.t : Number.MAX_VALUE) - (null !== t.t ? t.t : Number.MAX_VALUE);
          });

          var _iterator217 = _createForOfIteratorHelper(o),
              _step217;

          try {
            for (_iterator217.s(); !(_step217 = _iterator217.n()).done;) {
              var _r257 = _step217.value;
              if (null == _r257.t) return null;

              var _o119 = _r257.tile.dem.tree.raycast(_r257.minx, _r257.miny, _r257.maxx, _r257.maxy, e, t, i);

              if (null != _o119) return _o119;
            }
          } catch (err) {
            _iterator217.e(err);
          } finally {
            _iterator217.f();
          }

          return null;
        }
      }, {
        key: "_createFBO",
        value: function _createFBO() {
          var t = this.painter.context,
              i = t.gl,
              o = this.drapeBufferSize;
          t.activeTexture.set(i.TEXTURE0);
          var r = new e.Texture(t, {
            width: o[0],
            height: o[1],
            data: null
          }, i.RGBA);
          r.bind(i.LINEAR, i.CLAMP_TO_EDGE);
          var n = t.createFramebuffer(o[0], o[1], !1);
          return n.colorAttachment.set(r.texture), n.depthAttachment = new ue(t, n.framebuffer), void 0 === this._sharedDepthStencil ? (this._sharedDepthStencil = t.createRenderbuffer(t.gl.DEPTH_STENCIL, o[0], o[1]), this._stencilRef = 0, n.depthAttachment.set(this._sharedDepthStencil), t.clear({
            stencil: 0
          })) : n.depthAttachment.set(this._sharedDepthStencil), t.extTextureFilterAnisotropic && !t.extTextureFilterAnisotropicForceOff && i.texParameterf(i.TEXTURE_2D, t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT, t.extTextureFilterAnisotropicMax), {
            fb: n,
            tex: r,
            dirty: !1
          };
        }
      }, {
        key: "_initFBOPool",
        value: function _initFBOPool() {
          for (; this.pool.length < Math.min(5, this.proxyCoords.length);) {
            this.pool.push(this._createFBO());
          }
        }
      }, {
        key: "_shouldDisableRenderCache",
        value: function _shouldDisableRenderCache() {
          var _this107 = this;

          if (this._style.light && this._style.light.hasTransition()) return !0;

          for (var _e364 in this._style._sourceCaches) {
            if (this._style._sourceCaches[_e364].hasTransition()) return !0;
          }

          return this._style.order.some(function (e) {
            var t = _this107._style._layers[e],
                i = t.isHidden(_this107.painter.transform.zoom),
                o = t.getCrossfadeParameters(),
                r = !!o && 1 !== o.t,
                n = t.hasTransition();
            return "custom" !== t.type && !i && (r || n);
          });
        }
      }, {
        key: "_clearRasterFadeFromRenderCache",
        value: function _clearRasterFadeFromRenderCache() {
          var e = !1;

          for (var _t345 in this._style._sourceCaches) {
            if (this._style._sourceCaches[_t345]._source instanceof ve) {
              e = !0;
              break;
            }
          }

          if (e) for (var _e365 = 0; _e365 < this._style.order.length; ++_e365) {
            var _t346 = this._style._layers[this._style.order[_e365]],
                _i219 = _t346.isHidden(this.painter.transform.zoom),
                _o120 = this._style._getLayerSourceCache(_t346);

            if ("raster" !== _t346.type || _i219 || !_o120) continue;

            var _r258 = _t346.paint.get("raster-fade-duration");

            var _iterator218 = _createForOfIteratorHelper(this.proxyCoords),
                _step218;

            try {
              for (_iterator218.s(); !(_step218 = _iterator218.n()).done;) {
                var _e366 = _step218.value;
                var _t347 = this.proxyToSource[_e366.key][_o120.id];

                if (_t347) {
                  var _iterator219 = _createForOfIteratorHelper(_t347),
                      _step219;

                  try {
                    for (_iterator219.s(); !(_step219 = _iterator219.n()).done;) {
                      var _e367 = _step219.value;

                      var _t348 = li(_o120.getTile(_e367), _o120.findLoadedParent(_e367, 0), _o120, this.painter.transform, _r258);

                      (1 !== _t348.opacity || 0 !== _t348.mix) && this._clearRenderCacheForTile(_o120.id, _e367);
                    }
                  } catch (err) {
                    _iterator219.e(err);
                  } finally {
                    _iterator219.f();
                  }
                }
              }
            } catch (err) {
              _iterator218.e(err);
            } finally {
              _iterator218.f();
            }
          }
        }
      }, {
        key: "_setupDrapedRenderBatches",
        value: function _setupDrapedRenderBatches() {
          var e = this._style.order,
              t = e.length;
          if (0 === t) return;
          var i = [];
          var o,
              r = 0,
              n = this._style._layers[e[r]];

          for (; !this._style.isLayerDraped(n) && n.isHidden(this.painter.transform.zoom) && ++r < t;) {
            n = this._style._layers[e[r]];
          }

          for (; r < t; ++r) {
            var _t349 = this._style._layers[e[r]];
            _t349.isHidden(this.painter.transform.zoom) || (this._style.isLayerDraped(_t349) ? void 0 === o && (o = r) : void 0 !== o && (i.push({
              start: o,
              end: r - 1
            }), o = void 0));
          }

          void 0 !== o && i.push({
            start: o,
            end: r - 1
          }), this._drapedRenderBatches = i;
        }
      }, {
        key: "_setupRenderCache",
        value: function _setupRenderCache(e) {
          var t = this.proxySourceCache;

          if (this._shouldDisableRenderCache() || this._invalidateRenderCache) {
            if (this._invalidateRenderCache = !1, t.renderCache.length > t.renderCachePool.length) {
              var _e368 = Object.values(t.proxyCachedFBO);

              t.proxyCachedFBO = {};

              for (var _i220 = 0; _i220 < _e368.length; ++_i220) {
                var _t$renderCachePool;

                var _o121 = Object.values(_e368[_i220]);

                (_t$renderCachePool = t.renderCachePool).push.apply(_t$renderCachePool, _toConsumableArray(_o121));
              }
            }

            return;
          }

          this._clearRasterFadeFromRenderCache();

          var i = this.proxyCoords,
              o = this._tilesDirty;

          for (var _r259 = i.length - 1; _r259 >= 0; _r259--) {
            var _n171 = i[_r259];

            if (t.getTileByID(_n171.key), void 0 !== t.proxyCachedFBO[_n171.key]) {
              var _i221 = e[_n171.key],
                  _r260 = this.proxyToSource[_n171.key];
              var _a108 = 0;

              var _loop10 = function _loop10(_e369) {
                var t = _r260[_e369],
                    n = _i221[_e369];

                if (!n || n.length !== t.length || t.some(function (t, i) {
                  return t !== n[i] || o[_e369] && o[_e369].hasOwnProperty(t.key);
                })) {
                  _a108 = -1;
                  return "break";
                }

                ++_a108;
              };

              for (var _e369 in _r260) {
                var _ret4 = _loop10(_e369);

                if (_ret4 === "break") break;
              }

              for (var _e370 in t.proxyCachedFBO[_n171.key]) {
                t.renderCache[t.proxyCachedFBO[_n171.key][_e370]].dirty = _a108 < 0 || _a108 !== Object.values(_i221).length;
              }
            }
          }

          var r = _toConsumableArray(this._drapedRenderBatches);

          r.sort(function (e, t) {
            return t.end - t.start - (e.end - e.start);
          });

          var _iterator220 = _createForOfIteratorHelper(r),
              _step220;

          try {
            for (_iterator220.s(); !(_step220 = _iterator220.n()).done;) {
              var _e371 = _step220.value;

              var _iterator221 = _createForOfIteratorHelper(i),
                  _step221;

              try {
                for (_iterator221.s(); !(_step221 = _iterator221.n()).done;) {
                  var _o122 = _step221.value;
                  if (t.proxyCachedFBO[_o122.key]) continue;

                  var _i222 = t.renderCachePool.pop();

                  void 0 === _i222 && t.renderCache.length < 50 && (_i222 = t.renderCache.length, t.renderCache.push(this._createFBO())), void 0 !== _i222 && (t.proxyCachedFBO[_o122.key] = {}, t.proxyCachedFBO[_o122.key][_e371.start] = _i222, t.renderCache[_i222].dirty = !0);
                }
              } catch (err) {
                _iterator221.e(err);
              } finally {
                _iterator221.f();
              }
            }
          } catch (err) {
            _iterator220.e(err);
          } finally {
            _iterator220.f();
          }

          this._tilesDirty = {};
        }
      }, {
        key: "_setupStencil",
        value: function _setupStencil(e, t, i, o) {
          if (!o || !this._sourceTilesOverlap[o.id]) return void (this._overlapStencilType && (this._overlapStencilType = !1));
          var r = this.painter.context,
              n = r.gl;
          if (t.length <= 1) return void (this._overlapStencilType = !1);
          var a;
          if (i.isTileClipped()) a = t.length, this._overlapStencilMode.test = {
            func: n.EQUAL,
            mask: 255
          }, this._overlapStencilType = "Clip";else {
            if (!(t[0].overscaledZ > t[t.length - 1].overscaledZ)) return void (this._overlapStencilType = !1);
            a = 1, this._overlapStencilMode.test = {
              func: n.GREATER,
              mask: 255
            }, this._overlapStencilType = "Mask";
          }
          this._stencilRef + a > 255 && (r.clear({
            stencil: 0
          }), this._stencilRef = 0), this._stencilRef += a, this._overlapStencilMode.ref = this._stencilRef, i.isTileClipped() && this._renderTileClippingMasks(t, this._overlapStencilMode.ref);
        }
      }, {
        key: "clipOrMaskOverlapStencilType",
        value: function clipOrMaskOverlapStencilType() {
          return "Clip" === this._overlapStencilType || "Mask" === this._overlapStencilType;
        }
      }, {
        key: "stencilModeForRTTOverlap",
        value: function stencilModeForRTTOverlap(t) {
          return this.renderingToTexture && this._overlapStencilType ? ("Clip" === this._overlapStencilType && (this._overlapStencilMode.ref = this.painter._tileClippingMaskIDs[t.key]), this._overlapStencilMode) : e.StencilMode.disabled;
        }
      }, {
        key: "_renderTileClippingMasks",
        value: function _renderTileClippingMasks(t, i) {
          var o = this.painter,
              r = this.painter.context,
              n = r.gl;
          o._tileClippingMaskIDs = {}, r.setColorMode(e.ColorMode.disabled), r.setDepthMode(e.DepthMode.disabled);
          var a = o.useProgram("clippingMask");

          var _iterator222 = _createForOfIteratorHelper(t),
              _step222;

          try {
            for (_iterator222.s(); !(_step222 = _iterator222.n()).done;) {
              var _s124 = _step222.value;

              var _t350 = o._tileClippingMaskIDs[_s124.key] = --i;

              a.draw(r, n.TRIANGLES, e.DepthMode.disabled, new e.StencilMode({
                func: n.ALWAYS,
                mask: 0
              }, _t350, 255, n.KEEP, n.KEEP, n.REPLACE), e.ColorMode.disabled, e.CullFaceMode.disabled, si(_s124.projMatrix), "$clipping", o.tileExtentBuffer, o.quadTriangleIndexBuffer, o.tileExtentSegments);
            }
          } catch (err) {
            _iterator222.e(err);
          } finally {
            _iterator222.f();
          }
        }
      }, {
        key: "pointCoordinate",
        value: function pointCoordinate(t) {
          var i = this.painter.transform;
          if (t.x < 0 || t.x > i.width || t.y < 0 || t.y > i.height) return null;
          var o = [t.x, t.y, 1, 1];
          e.transformMat4$1(o, o, i.pixelMatrixInverse), e.scale$1(o, o, 1 / o[3]), o[0] /= i.worldSize, o[1] /= i.worldSize;
          var r = i._camera.position,
              n = e.mercatorZfromAltitude(1, i.center.lat),
              a = [r[0], r[1], r[2] / n, 0],
              s = e.subtract([], o.slice(0, 3), a);
          e.normalize(s, s);
          var l = this.raycast(a, s, this._exaggeration);
          return null !== l && l ? (e.scaleAndAdd(a, a, s, l), a[3] = a[2], a[2] *= n, a) : null;
        }
      }, {
        key: "drawDepth",
        value: function drawDepth() {
          var t = this.painter,
              i = t.context,
              o = this.proxySourceCache,
              r = Math.ceil(t.width),
              n = Math.ceil(t.height);

          if (!this._depthFBO || this._depthFBO.width === r && this._depthFBO.height === n || (this._depthFBO.destroy(), delete this._depthFBO, delete this._depthTexture), !this._depthFBO) {
            var _t351 = i.gl,
                _o123 = i.createFramebuffer(r, n, !0);

            i.activeTexture.set(_t351.TEXTURE0);

            var _a109 = new e.Texture(i, {
              width: r,
              height: n,
              data: null
            }, _t351.RGBA);

            _a109.bind(_t351.NEAREST, _t351.CLAMP_TO_EDGE), _o123.colorAttachment.set(_a109.texture);

            var _s125 = i.createRenderbuffer(i.gl.DEPTH_COMPONENT16, r, n);

            _o123.depthAttachment.set(_s125), this._depthFBO = _o123, this._depthTexture = _a109;
          }

          i.bindFramebuffer.set(this._depthFBO.framebuffer), i.viewport.set([0, 0, r, n]), function (t, i, o, r) {
            if ("globe" === t.transform.projection.name) return;
            var n = t.context,
                a = n.gl;
            n.clear({
              depth: 1
            });
            var s = t.useProgram("terrainDepth"),
                l = new e.DepthMode(a.LESS, e.DepthMode.ReadWrite, t.depthRangeFor3D);

            var _iterator223 = _createForOfIteratorHelper(r),
                _step223;

            try {
              for (_iterator223.s(); !(_step223 = _iterator223.n()).done;) {
                var _t352 = _step223.value;

                var _r261 = o.getTile(_t352),
                    _c45 = ti(_t352.projMatrix, 0);

                i.setupElevationDraw(_r261, s), s.draw(n, a.TRIANGLES, l, e.StencilMode.disabled, e.ColorMode.unblended, e.CullFaceMode.backCCW, _c45, "terrain_depth", i.gridBuffer, i.gridIndexBuffer, i.gridNoSkirtSegments);
              }
            } catch (err) {
              _iterator223.e(err);
            } finally {
              _iterator223.f();
            }
          }(t, this, o, this.proxyCoords);
        }
      }, {
        key: "_setupProxiedCoordsForOrtho",
        value: function _setupProxiedCoordsForOrtho(e, t, i) {
          if (e.getSource() instanceof be) return this._setupProxiedCoordsForImageSource(e, t, i);
          this._findCoveringTileCache[e.id] = this._findCoveringTileCache[e.id] || {};
          var o = this.proxiedCoords[e.id] = [],
              r = this.proxyCoords;

          for (var _t353 = 0; _t353 < r.length; _t353++) {
            var _n172 = r[_t353],
                _a110 = this._findTileCoveringTileID(_n172, e);

            if (_a110) {
              var _t354 = this._createProxiedId(_n172, _a110, i[_n172.key] && i[_n172.key][e.id]);

              o.push(_t354), this.proxyToSource[_n172.key][e.id] = [_t354];
            }
          }

          var n = !1;

          for (var _r262 = 0; _r262 < t.length; _r262++) {
            var _a111 = e.getTile(t[_r262]);

            if (!_a111 || !_a111.hasData()) continue;

            var _s126 = this._findTileCoveringTileID(_a111.tileID, this.proxySourceCache);

            if (_s126 && _s126.tileID.canonical.z !== _a111.tileID.canonical.z) {
              var _t355 = this.proxyToSource[_s126.tileID.key][e.id],
                  _r263 = this._createProxiedId(_s126.tileID, _a111, i[_s126.tileID.key] && i[_s126.tileID.key][e.id]);

              _t355 ? _t355.splice(_t355.length - 1, 0, _r263) : this.proxyToSource[_s126.tileID.key][e.id] = [_r263], o.push(_r263), n = !0;
            }
          }

          this._sourceTilesOverlap[e.id] = n;
        }
      }, {
        key: "_setupProxiedCoordsForImageSource",
        value: function _setupProxiedCoordsForImageSource(t, i, o) {
          if (!t.getSource().loaded()) return;

          var r = this.proxiedCoords[t.id] = [],
              n = this.proxyCoords,
              a = t.getSource(),
              s = new e.pointGeometry(a.tileID.x, a.tileID.y)._div(1 << a.tileID.z),
              l = a.coordinates.map(e.MercatorCoordinate.fromLngLat).reduce(function (e, t) {
            return e.min.x = Math.min(e.min.x, t.x - s.x), e.min.y = Math.min(e.min.y, t.y - s.y), e.max.x = Math.max(e.max.x, t.x - s.x), e.max.y = Math.max(e.max.y, t.y - s.y), e;
          }, {
            min: new e.pointGeometry(Number.MAX_VALUE, Number.MAX_VALUE),
            max: new e.pointGeometry(-Number.MAX_VALUE, -Number.MAX_VALUE)
          }),
              c = function c(t, i) {
            var o = t.wrap + t.canonical.x / (1 << t.canonical.z),
                r = t.canonical.y / (1 << t.canonical.z),
                n = e.EXTENT / (1 << t.canonical.z),
                a = i.wrap + i.canonical.x / (1 << i.canonical.z),
                s = i.canonical.y / (1 << i.canonical.z);
            return o + n < a + l.min.x || o > a + l.max.x || r + n < s + l.min.y || r > s + l.max.y;
          };

          for (var _e372 = 0; _e372 < n.length; _e372++) {
            var _a112 = n[_e372];

            for (var _e373 = 0; _e373 < i.length; _e373++) {
              var _n173 = t.getTile(i[_e373]);

              if (!_n173 || !_n173.hasData()) continue;
              if (c(_a112, _n173.tileID)) continue;

              var _s127 = this._createProxiedId(_a112, _n173, o[_a112.key] && o[_a112.key][t.id]),
                  _l66 = this.proxyToSource[_a112.key][t.id];

              _l66 ? _l66.push(_s127) : this.proxyToSource[_a112.key][t.id] = [_s127], r.push(_s127);
            }
          }
        }
      }, {
        key: "_createProxiedId",
        value: function _createProxiedId(t, i, o) {
          var r = this.orthoMatrix;

          if (o) {
            var _e374 = o.find(function (e) {
              return e.key === i.tileID.key;
            });

            if (_e374) return _e374;
          }

          if (i.tileID.key !== t.key) {
            var _o124 = t.canonical.z - i.tileID.canonical.z;

            var _n174, _a113, _s128;

            r = e.create();

            var _l67 = i.tileID.wrap - t.wrap << t.overscaledZ;

            _o124 > 0 ? (_n174 = e.EXTENT >> _o124, _a113 = _n174 * ((i.tileID.canonical.x << _o124) - t.canonical.x + _l67), _s128 = _n174 * ((i.tileID.canonical.y << _o124) - t.canonical.y)) : (_n174 = e.EXTENT << -_o124, _a113 = e.EXTENT * (i.tileID.canonical.x - (t.canonical.x + _l67 << -_o124)), _s128 = e.EXTENT * (i.tileID.canonical.y - (t.canonical.y << -_o124))), e.ortho(r, 0, _n174, 0, _n174, 0, 1), e.translate(r, r, [_a113, _s128, 0]);
          }

          return new ui(i.tileID, t.key, r);
        }
      }, {
        key: "_findTileCoveringTileID",
        value: function _findTileCoveringTileID(t, i) {
          var o = i.getTile(t);
          if (o && o.hasData()) return o;
          var r = this._findCoveringTileCache[i.id],
              n = r[t.key];
          if (o = n ? i.getTileByID(n) : null, o && o.hasData() || null === n) return o;
          var a = o ? o.tileID : t,
              s = a.overscaledZ;
          var l = i.getSource().minzoom,
              c = [];

          if (!n) {
            var _r264 = i.getSource().maxzoom;

            if (t.canonical.z >= _r264) {
              var _o125 = t.canonical.z - _r264;

              i.getSource().reparseOverscaled ? (s = Math.max(t.canonical.z + 2, i.transform.tileZoom), a = new e.OverscaledTileID(s, t.wrap, _r264, t.canonical.x >> _o125, t.canonical.y >> _o125)) : 0 !== _o125 && (s = _r264, a = new e.OverscaledTileID(s, t.wrap, _r264, t.canonical.x >> _o125, t.canonical.y >> _o125));
            }

            a.key !== t.key && (c.push(a.key), o = i.getTile(a));
          }

          var h = function h(e) {
            c.forEach(function (t) {
              r[t] = e;
            }), c.length = 0;
          };

          for (s -= 1; s >= l && (!o || !o.hasData()); s--) {
            o && h(o.tileID.key);

            var _e375 = a.calculateScaledKey(s);

            if (o = i.getTileByID(_e375), o && o.hasData()) break;
            var _t356 = r[_e375];
            if (null === _t356) break;
            void 0 === _t356 ? c.push(_e375) : o = i.getTileByID(_t356);
          }

          return h(o ? o.tileID.key : null), o && o.hasData() ? o : null;
        }
      }, {
        key: "findDEMTileFor",
        value: function findDEMTileFor(e) {
          return this.enabled ? this._findTileCoveringTileID(e, this.sourceCache) : null;
        }
      }, {
        key: "prepareDrawTile",
        value: function prepareDrawTile(e) {
          this.renderedToTile = !0;
        }
      }, {
        key: "_clearRenderCacheForTile",
        value: function _clearRenderCacheForTile(e, t) {
          var i = this._tilesDirty[e];
          i || (i = this._tilesDirty[e] = {}), i[t.key] = !0;
        }
      }, {
        key: "getWirefameBuffer",
        value: function getWirefameBuffer() {
          if (!this.wireframeSegments) {
            var _t357 = function (t) {
              var i, o, r;
              var n = new e.StructArrayLayout2ui4(),
                  a = 131;

              for (o = 1; o < 129; o++) {
                for (i = 1; i < 129; i++) {
                  r = o * a + i, n.emplaceBack(r, r + 1), n.emplaceBack(r, r + a), n.emplaceBack(r + 1, r + a), 128 === o && n.emplaceBack(r + a, r + a + 1);
                }

                n.emplaceBack(r + 1, r + 1 + a);
              }

              return n;
            }();

            this.wireframeIndexBuffer = this.painter.context.createIndexBuffer(_t357), this.wireframeSegments = e.SegmentVector.simpleSegment(0, 0, this.gridBuffer.length, _t357.length);
          }

          return [this.wireframeIndexBuffer, this.wireframeSegments];
        }
      }]);

      return _i;
    }(e.Elevation);

    function di(e) {
      var t = [];

      for (var _i223 = 0; _i223 < e.length; _i223++) {
        if (null === e[_i223]) continue;

        var _o126 = e[_i223].split(" ");

        t.push(_o126.pop());
      }

      return t;
    }

    var pi = /*#__PURE__*/function () {
      function pi(t, i, o, r, n, a) {
        _classCallCheck(this, pi);

        var s = t.gl;
        this.program = s.createProgram();

        var l = di(o.staticAttributes),
            c = r ? r.getBinderAttributes() : [],
            h = l.concat(c),
            u = o.staticUniforms ? di(o.staticUniforms) : [],
            _ = r ? r.getBinderUniforms() : [],
            d = u.concat(_),
            p = [];

        var _iterator224 = _createForOfIteratorHelper(d),
            _step224;

        try {
          for (_iterator224.s(); !(_step224 = _iterator224.n()).done;) {
            var _e379 = _step224.value;
            p.indexOf(_e379) < 0 && p.push(_e379);
          }
        } catch (err) {
          _iterator224.e(err);
        } finally {
          _iterator224.f();
        }

        var m = r ? r.defines() : [];
        m = m.concat(a.map(function (e) {
          return "#define ".concat(e);
        }));
        var f = m.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif", qt, Wt.fragmentSource, Vt.fragmentSource, o.fragmentSource).join("\n"),
            g = m.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif", qt, Wt.vertexSource, Vt.vertexSource, Zt.vertexSource, o.vertexSource).join("\n"),
            v = s.createShader(s.FRAGMENT_SHADER);
        if (s.isContextLost()) return void (this.failedToCreate = !0);
        s.shaderSource(v, f), s.compileShader(v), s.attachShader(this.program, v);
        var x = s.createShader(s.VERTEX_SHADER);
        if (s.isContextLost()) return void (this.failedToCreate = !0);
        s.shaderSource(x, g), s.compileShader(x), s.attachShader(this.program, x), this.attributes = {};
        var y = {};
        this.numAttributes = h.length;

        for (var _e376 = 0; _e376 < this.numAttributes; _e376++) {
          h[_e376] && (s.bindAttribLocation(this.program, _e376, h[_e376]), this.attributes[h[_e376]] = _e376);
        }

        s.linkProgram(this.program), s.deleteShader(x), s.deleteShader(v);

        for (var _e377 = 0; _e377 < p.length; _e377++) {
          var _t358 = p[_e377];

          if (_t358 && !y[_t358]) {
            var _e378 = s.getUniformLocation(this.program, _t358);

            _e378 && (y[_t358] = _e378);
          }
        }

        this.fixedUniforms = n(t, y), this.binderUniforms = r ? r.getUniforms(t, y) : [], -1 !== a.indexOf("TERRAIN") && (this.terrainUniforms = function (t, i) {
          return {
            u_dem: new e.Uniform1i(t, i.u_dem),
            u_dem_prev: new e.Uniform1i(t, i.u_dem_prev),
            u_dem_unpack: new e.Uniform4f(t, i.u_dem_unpack),
            u_dem_tl: new e.Uniform2f(t, i.u_dem_tl),
            u_dem_scale: new e.Uniform1f(t, i.u_dem_scale),
            u_dem_tl_prev: new e.Uniform2f(t, i.u_dem_tl_prev),
            u_dem_scale_prev: new e.Uniform1f(t, i.u_dem_scale_prev),
            u_dem_size: new e.Uniform1f(t, i.u_dem_size),
            u_dem_lerp: new e.Uniform1f(t, i.u_dem_lerp),
            u_exaggeration: new e.Uniform1f(t, i.u_exaggeration),
            u_depth: new e.Uniform1i(t, i.u_depth),
            u_depth_size_inv: new e.Uniform2f(t, i.u_depth_size_inv),
            u_meter_to_dem: new e.Uniform1f(t, i.u_meter_to_dem),
            u_label_plane_matrix_inv: new e.UniformMatrix4f(t, i.u_label_plane_matrix_inv),
            u_tile_tl_up: new e.Uniform3f(t, i.u_tile_tl_up),
            u_tile_tr_up: new e.Uniform3f(t, i.u_tile_tr_up),
            u_tile_br_up: new e.Uniform3f(t, i.u_tile_br_up),
            u_tile_bl_up: new e.Uniform3f(t, i.u_tile_bl_up),
            u_tile_up_scale: new e.Uniform1f(t, i.u_tile_up_scale)
          };
        }(t, y)), -1 !== a.indexOf("FOG") && (this.fogUniforms = function (t, i) {
          return {
            u_fog_matrix: new e.UniformMatrix4f(t, i.u_fog_matrix),
            u_fog_range: new e.Uniform2f(t, i.u_fog_range),
            u_fog_color: new e.Uniform4f(t, i.u_fog_color),
            u_fog_horizon_blend: new e.Uniform1f(t, i.u_fog_horizon_blend),
            u_fog_temporal_offset: new e.Uniform1f(t, i.u_fog_temporal_offset)
          };
        }(t, y));
      }

      _createClass(pi, [{
        key: "setTerrainUniformValues",
        value: function setTerrainUniformValues(e, t) {
          if (!this.terrainUniforms) return;
          var i = this.terrainUniforms;

          if (!this.failedToCreate) {
            e.program.set(this.program);

            for (var _e380 in t) {
              i[_e380].set(t[_e380]);
            }
          }
        }
      }, {
        key: "setFogUniformValues",
        value: function setFogUniformValues(e, t) {
          if (!this.fogUniforms) return;
          var i = this.fogUniforms;

          if (!this.failedToCreate) {
            e.program.set(this.program);

            for (var _e381 in t) {
              i[_e381].location && i[_e381].set(t[_e381]);
            }
          }
        }
      }, {
        key: "draw",
        value: function draw(e, t, i, o, r, n, a, s, l, c, h, u, _, d, p, m) {
          var _f$LINES$f$TRIANGLES$;

          var f = e.gl;
          if (this.failedToCreate) return;
          e.program.set(this.program), e.setDepthMode(i), e.setStencilMode(o), e.setColorMode(r), e.setCullFace(n);

          for (var _i224 = 0, _Object$keys11 = Object.keys(this.fixedUniforms); _i224 < _Object$keys11.length; _i224++) {
            var _e382 = _Object$keys11[_i224];

            this.fixedUniforms[_e382].set(a[_e382]);
          }

          d && d.setUniforms(e, this.binderUniforms, u, {
            zoom: _
          });
          var g = (_f$LINES$f$TRIANGLES$ = {}, _defineProperty(_f$LINES$f$TRIANGLES$, f.LINES, 2), _defineProperty(_f$LINES$f$TRIANGLES$, f.TRIANGLES, 3), _defineProperty(_f$LINES$f$TRIANGLES$, f.LINE_STRIP, 1), _f$LINES$f$TRIANGLES$)[t];

          var _iterator225 = _createForOfIteratorHelper(h.get()),
              _step225;

          try {
            for (_iterator225.s(); !(_step225 = _iterator225.n()).done;) {
              var _i225 = _step225.value;

              var _o127 = _i225.vaos || (_i225.vaos = {});

              (_o127[s] || (_o127[s] = new Ht())).bind(e, this, l, d ? d.getPaintVertexBuffers() : [], c, _i225.vertexOffset, p, m), f.drawElements(t, _i225.primitiveLength * g, f.UNSIGNED_SHORT, _i225.primitiveOffset * g * 2);
            }
          } catch (err) {
            _iterator225.e(err);
          } finally {
            _iterator225.f();
          }
        }
      }], [{
        key: "cacheKey",
        value: function cacheKey(e, t, i) {
          var o = "".concat(e).concat(i ? i.cacheKey : "");

          var _iterator226 = _createForOfIteratorHelper(t),
              _step226;

          try {
            for (_iterator226.s(); !(_step226 = _iterator226.n()).done;) {
              var _e383 = _step226.value;
              o += "/".concat(_e383);
            }
          } catch (err) {
            _iterator226.e(err);
          } finally {
            _iterator226.f();
          }

          return o;
        }
      }]);

      return pi;
    }();

    function mi(e, t, i) {
      var o = 1 / M(i, 1, t.transform.tileZoom),
          r = Math.pow(2, i.tileID.overscaledZ),
          n = i.tileSize * Math.pow(2, t.transform.tileZoom) / r,
          a = n * (i.tileID.canonical.x + i.tileID.wrap * r),
          s = n * i.tileID.canonical.y;
      return {
        u_image: 0,
        u_texsize: i.imageAtlasTexture.size,
        u_scale: [o, e.fromScale, e.toScale],
        u_fade: e.t,
        u_pixel_coord_upper: [a >> 16, s >> 16],
        u_pixel_coord_lower: [65535 & a, 65535 & s]
      };
    }

    var fi = function fi(t, i, o, r) {
      var n = i.style.light,
          a = n.properties.get("position"),
          s = [a.x, a.y, a.z],
          l = e.create$1();
      "viewport" === n.properties.get("anchor") && (e.fromRotation(l, -i.transform.angle), e.transformMat3(s, s, l));
      var c = n.properties.get("color");
      return {
        u_matrix: t,
        u_lightpos: s,
        u_lightintensity: n.properties.get("intensity"),
        u_lightcolor: [c.r, c.g, c.b],
        u_vertical_gradient: +o,
        u_opacity: r
      };
    },
        gi = function gi(t, i, o, r, n, a, s) {
      return e.extend(fi(t, i, o, r), mi(a, i, s), {
        u_height_factor: -Math.pow(2, n.overscaledZ) / s.tileSize / 8
      });
    },
        vi = function vi(e) {
      return {
        u_matrix: e
      };
    },
        xi = function xi(t, i, o, r) {
      return e.extend(vi(t), mi(o, i, r));
    },
        yi = function yi(e, t) {
      return {
        u_matrix: e,
        u_world: t
      };
    },
        bi = function bi(t, i, o, r, n) {
      return e.extend(xi(t, i, o, r), {
        u_world: n
      });
    },
        wi = function wi(t, i, o, r) {
      var n = t.transform;
      var a;
      return a = "map" === r.paint.get("circle-pitch-alignment") ? n.calculatePixelsToTileUnitsMatrix(o) : new Float32Array([n.pixelsToGLUnits[0], 0, 0, n.pixelsToGLUnits[1]]), {
        u_camera_to_center_distance: n.cameraToCenterDistance,
        u_matrix: t.translatePosMatrix(i.projMatrix, o, r.paint.get("circle-translate"), r.paint.get("circle-translate-anchor")),
        u_device_pixel_ratio: e.exported.devicePixelRatio,
        u_extrude_scale: a
      };
    },
        Ti = function Ti(e) {
      var t = [];
      return "map" === e.paint.get("circle-pitch-alignment") && t.push("PITCH_WITH_MAP"), "map" === e.paint.get("circle-pitch-scale") && t.push("SCALE_WITH_MAP"), t;
    },
        Ei = function Ei(t, i, o) {
      var r = e.EXTENT / o.tileSize;
      return {
        u_matrix: t,
        u_camera_to_center_distance: i.cameraToCenterDistance,
        u_extrude_scale: [i.pixelsToGLUnits[0] / r, i.pixelsToGLUnits[1] / r]
      };
    },
        Ci = function Ci(e, t) {
      var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;
      return {
        u_matrix: e,
        u_color: t,
        u_overlay: 0,
        u_overlay_scale: i
      };
    },
        Mi = function Mi(e, t, i, o) {
      return {
        u_matrix: e,
        u_extrude_scale: M(t, 1, i),
        u_intensity: o
      };
    },
        Si = function Si(t, i, o, r, n, a) {
      var s = t.transform,
          l = s.calculatePixelsToTileUnitsMatrix(i),
          c = {
        u_matrix: Di(t, i, o, n),
        u_pixels_to_tile_units: l,
        u_device_pixel_ratio: e.exported.devicePixelRatio,
        u_units_to_pixels: [1 / s.pixelsToGLUnits[0], 1 / s.pixelsToGLUnits[1]],
        u_dash_image: 0,
        u_gradient_image: 1,
        u_image_height: a,
        u_texsize: [0, 0],
        u_scale: [0, 0, 0],
        u_mix: 0,
        u_alpha_discard_threshold: 0
      };

      if (Pi(o)) {
        var _e384 = zi(i, t.transform);

        c.u_texsize = i.lineAtlasTexture.size, c.u_scale = [_e384, r.fromScale, r.toScale], c.u_mix = r.t;
      }

      return c;
    },
        Ii = function Ii(t, i, o, r, n) {
      var a = t.transform,
          s = zi(i, a);
      return {
        u_matrix: Di(t, i, o, n),
        u_texsize: i.imageAtlasTexture.size,
        u_pixels_to_tile_units: a.calculatePixelsToTileUnitsMatrix(i),
        u_device_pixel_ratio: e.exported.devicePixelRatio,
        u_image: 0,
        u_scale: [s, r.fromScale, r.toScale],
        u_fade: r.t,
        u_units_to_pixels: [1 / a.pixelsToGLUnits[0], 1 / a.pixelsToGLUnits[1]],
        u_alpha_discard_threshold: 0
      };
    };

    function zi(e, t) {
      return 1 / M(e, 1, t.tileZoom);
    }

    function Di(e, t, i, o) {
      return e.translatePosMatrix(o || t.tileID.projMatrix, t, i.paint.get("line-translate"), i.paint.get("line-translate-anchor"));
    }

    function Pi(e) {
      var t = e.paint.get("line-dasharray").value;
      return t.value || "constant" !== t.kind;
    }

    var Ai = function Ai(e, t, i, o, r, n) {
      return {
        u_matrix: e,
        u_tl_parent: t,
        u_scale_parent: i,
        u_fade_t: o.mix,
        u_opacity: o.opacity * r.paint.get("raster-opacity"),
        u_image0: 0,
        u_image1: 1,
        u_brightness_low: r.paint.get("raster-brightness-min"),
        u_brightness_high: r.paint.get("raster-brightness-max"),
        u_saturation_factor: (s = r.paint.get("raster-saturation"), s > 0 ? 1 - 1 / (1.001 - s) : -s),
        u_contrast_factor: (a = r.paint.get("raster-contrast"), a > 0 ? 1 / (1 - a) : 1 + a),
        u_spin_weights: Li(r.paint.get("raster-hue-rotate")),
        u_perspective_transform: n
      };
      var a, s;
    };

    function Li(e) {
      e *= Math.PI / 180;
      var t = Math.sin(e),
          i = Math.cos(e);
      return [(2 * i + 1) / 3, (-Math.sqrt(3) * t - i + 1) / 3, (Math.sqrt(3) * t - i + 1) / 3];
    }

    var Ri = function Ri(e, t, i, o, r, n, a, s, l, c, h, u, _, d) {
      var p = r.transform;
      return {
        u_is_size_zoom_constant: +("constant" === e || "source" === e),
        u_is_size_feature_constant: +("constant" === e || "camera" === e),
        u_size_t: t ? t.uSizeT : 0,
        u_size: t ? t.uSize : 0,
        u_camera_to_center_distance: p.cameraToCenterDistance,
        u_pitch: p.pitch / 360 * 2 * Math.PI,
        u_rotate_symbol: +i,
        u_aspect_ratio: p.width / p.height,
        u_fade_change: r.options.fadeDuration ? r.symbolFadeChange : 1,
        u_matrix: n,
        u_label_plane_matrix: a,
        u_coord_matrix: s,
        u_is_text: +l,
        u_pitch_with_map: +o,
        u_texsize: c,
        u_tile_id: h,
        u_zoom_transition: u,
        u_inv_rot_matrix: _,
        u_merc_center: d,
        u_texture: 0
      };
    },
        ki = function ki(t, i, o, r, n, a, s, l, c, h, u, _, d, p, m) {
      var _n$transform = n.transform,
          f = _n$transform.cameraToCenterDistance,
          g = _n$transform._pitch;
      return e.extend(Ri(t, i, o, r, n, a, s, l, c, h, _, d, p, m), {
        u_gamma_scale: r ? f * Math.cos(n.terrain ? 0 : g) : 1,
        u_device_pixel_ratio: e.exported.devicePixelRatio,
        u_is_halo: +u
      });
    },
        Oi = function Oi(t, i, o, r, n, a, s, l, c, h, u, _, d, p) {
      return e.extend(ki(t, i, o, r, n, a, s, l, !0, c, !0, u, _, d, p), {
        u_texsize_icon: h,
        u_texture_icon: 1
      });
    },
        Bi = function Bi(e, t, i) {
      return {
        u_matrix: e,
        u_opacity: t,
        u_color: i
      };
    },
        Fi = function Fi(t, i, o, r, n, a) {
      return e.extend(function (e, t, i, o) {
        var r = i.imageManager.getPattern(e.from.toString()),
            n = i.imageManager.getPattern(e.to.toString()),
            _i$imageManager$getPi = i.imageManager.getPixelSize(),
            a = _i$imageManager$getPi.width,
            s = _i$imageManager$getPi.height,
            l = Math.pow(2, o.tileID.overscaledZ),
            c = o.tileSize * Math.pow(2, i.transform.tileZoom) / l,
            h = c * (o.tileID.canonical.x + o.tileID.wrap * l),
            u = c * o.tileID.canonical.y;

        return {
          u_image: 0,
          u_pattern_tl_a: r.tl,
          u_pattern_br_a: r.br,
          u_pattern_tl_b: n.tl,
          u_pattern_br_b: n.br,
          u_texsize: [a, s],
          u_mix: t.t,
          u_pattern_size_a: r.displaySize,
          u_pattern_size_b: n.displaySize,
          u_scale_a: t.fromScale,
          u_scale_b: t.toScale,
          u_tile_units_to_pixels: 1 / M(o, 1, i.transform.tileZoom),
          u_pixel_coord_upper: [h >> 16, u >> 16],
          u_pixel_coord_lower: [65535 & h, 65535 & u]
        };
      }(r, a, o, n), {
        u_matrix: t,
        u_opacity: i
      });
    },
        Ui = {
      fillExtrusion: function fillExtrusion(t, i) {
        return {
          u_matrix: new e.UniformMatrix4f(t, i.u_matrix),
          u_lightpos: new e.Uniform3f(t, i.u_lightpos),
          u_lightintensity: new e.Uniform1f(t, i.u_lightintensity),
          u_lightcolor: new e.Uniform3f(t, i.u_lightcolor),
          u_vertical_gradient: new e.Uniform1f(t, i.u_vertical_gradient),
          u_opacity: new e.Uniform1f(t, i.u_opacity)
        };
      },
      fillExtrusionPattern: function fillExtrusionPattern(t, i) {
        return {
          u_matrix: new e.UniformMatrix4f(t, i.u_matrix),
          u_lightpos: new e.Uniform3f(t, i.u_lightpos),
          u_lightintensity: new e.Uniform1f(t, i.u_lightintensity),
          u_lightcolor: new e.Uniform3f(t, i.u_lightcolor),
          u_vertical_gradient: new e.Uniform1f(t, i.u_vertical_gradient),
          u_height_factor: new e.Uniform1f(t, i.u_height_factor),
          u_image: new e.Uniform1i(t, i.u_image),
          u_texsize: new e.Uniform2f(t, i.u_texsize),
          u_pixel_coord_upper: new e.Uniform2f(t, i.u_pixel_coord_upper),
          u_pixel_coord_lower: new e.Uniform2f(t, i.u_pixel_coord_lower),
          u_scale: new e.Uniform3f(t, i.u_scale),
          u_fade: new e.Uniform1f(t, i.u_fade),
          u_opacity: new e.Uniform1f(t, i.u_opacity)
        };
      },
      fill: function fill(t, i) {
        return {
          u_matrix: new e.UniformMatrix4f(t, i.u_matrix)
        };
      },
      fillPattern: function fillPattern(t, i) {
        return {
          u_matrix: new e.UniformMatrix4f(t, i.u_matrix),
          u_image: new e.Uniform1i(t, i.u_image),
          u_texsize: new e.Uniform2f(t, i.u_texsize),
          u_pixel_coord_upper: new e.Uniform2f(t, i.u_pixel_coord_upper),
          u_pixel_coord_lower: new e.Uniform2f(t, i.u_pixel_coord_lower),
          u_scale: new e.Uniform3f(t, i.u_scale),
          u_fade: new e.Uniform1f(t, i.u_fade)
        };
      },
      fillOutline: function fillOutline(t, i) {
        return {
          u_matrix: new e.UniformMatrix4f(t, i.u_matrix),
          u_world: new e.Uniform2f(t, i.u_world)
        };
      },
      fillOutlinePattern: function fillOutlinePattern(t, i) {
        return {
          u_matrix: new e.UniformMatrix4f(t, i.u_matrix),
          u_world: new e.Uniform2f(t, i.u_world),
          u_image: new e.Uniform1i(t, i.u_image),
          u_texsize: new e.Uniform2f(t, i.u_texsize),
          u_pixel_coord_upper: new e.Uniform2f(t, i.u_pixel_coord_upper),
          u_pixel_coord_lower: new e.Uniform2f(t, i.u_pixel_coord_lower),
          u_scale: new e.Uniform3f(t, i.u_scale),
          u_fade: new e.Uniform1f(t, i.u_fade)
        };
      },
      circle: function circle(t, i) {
        return {
          u_camera_to_center_distance: new e.Uniform1f(t, i.u_camera_to_center_distance),
          u_extrude_scale: new e.UniformMatrix2f(t, i.u_extrude_scale),
          u_device_pixel_ratio: new e.Uniform1f(t, i.u_device_pixel_ratio),
          u_matrix: new e.UniformMatrix4f(t, i.u_matrix)
        };
      },
      collisionBox: function collisionBox(t, i) {
        return {
          u_matrix: new e.UniformMatrix4f(t, i.u_matrix),
          u_camera_to_center_distance: new e.Uniform1f(t, i.u_camera_to_center_distance),
          u_extrude_scale: new e.Uniform2f(t, i.u_extrude_scale)
        };
      },
      collisionCircle: function collisionCircle(t, i) {
        return {
          u_matrix: new e.UniformMatrix4f(t, i.u_matrix),
          u_inv_matrix: new e.UniformMatrix4f(t, i.u_inv_matrix),
          u_camera_to_center_distance: new e.Uniform1f(t, i.u_camera_to_center_distance),
          u_viewport_size: new e.Uniform2f(t, i.u_viewport_size)
        };
      },
      debug: function debug(t, i) {
        return {
          u_color: new e.UniformColor(t, i.u_color),
          u_matrix: new e.UniformMatrix4f(t, i.u_matrix),
          u_overlay: new e.Uniform1i(t, i.u_overlay),
          u_overlay_scale: new e.Uniform1f(t, i.u_overlay_scale)
        };
      },
      clippingMask: function clippingMask(t, i) {
        return {
          u_matrix: new e.UniformMatrix4f(t, i.u_matrix)
        };
      },
      heatmap: function heatmap(t, i) {
        return {
          u_extrude_scale: new e.Uniform1f(t, i.u_extrude_scale),
          u_intensity: new e.Uniform1f(t, i.u_intensity),
          u_matrix: new e.UniformMatrix4f(t, i.u_matrix)
        };
      },
      heatmapTexture: function heatmapTexture(t, i) {
        return {
          u_image: new e.Uniform1i(t, i.u_image),
          u_color_ramp: new e.Uniform1i(t, i.u_color_ramp),
          u_opacity: new e.Uniform1f(t, i.u_opacity)
        };
      },
      hillshade: function hillshade(t, i) {
        return {
          u_matrix: new e.UniformMatrix4f(t, i.u_matrix),
          u_image: new e.Uniform1i(t, i.u_image),
          u_latrange: new e.Uniform2f(t, i.u_latrange),
          u_light: new e.Uniform2f(t, i.u_light),
          u_shadow: new e.UniformColor(t, i.u_shadow),
          u_highlight: new e.UniformColor(t, i.u_highlight),
          u_accent: new e.UniformColor(t, i.u_accent)
        };
      },
      hillshadePrepare: function hillshadePrepare(t, i) {
        return {
          u_matrix: new e.UniformMatrix4f(t, i.u_matrix),
          u_image: new e.Uniform1i(t, i.u_image),
          u_dimension: new e.Uniform2f(t, i.u_dimension),
          u_zoom: new e.Uniform1f(t, i.u_zoom),
          u_unpack: new e.Uniform4f(t, i.u_unpack)
        };
      },
      line: function line(t, i) {
        return {
          u_matrix: new e.UniformMatrix4f(t, i.u_matrix),
          u_pixels_to_tile_units: new e.UniformMatrix2f(t, i.u_pixels_to_tile_units),
          u_device_pixel_ratio: new e.Uniform1f(t, i.u_device_pixel_ratio),
          u_units_to_pixels: new e.Uniform2f(t, i.u_units_to_pixels),
          u_dash_image: new e.Uniform1i(t, i.u_dash_image),
          u_gradient_image: new e.Uniform1i(t, i.u_gradient_image),
          u_image_height: new e.Uniform1f(t, i.u_image_height),
          u_texsize: new e.Uniform2f(t, i.u_texsize),
          u_scale: new e.Uniform3f(t, i.u_scale),
          u_mix: new e.Uniform1f(t, i.u_mix),
          u_alpha_discard_threshold: new e.Uniform1f(t, i.u_alpha_discard_threshold)
        };
      },
      linePattern: function linePattern(t, i) {
        return {
          u_matrix: new e.UniformMatrix4f(t, i.u_matrix),
          u_texsize: new e.Uniform2f(t, i.u_texsize),
          u_pixels_to_tile_units: new e.UniformMatrix2f(t, i.u_pixels_to_tile_units),
          u_device_pixel_ratio: new e.Uniform1f(t, i.u_device_pixel_ratio),
          u_image: new e.Uniform1i(t, i.u_image),
          u_units_to_pixels: new e.Uniform2f(t, i.u_units_to_pixels),
          u_scale: new e.Uniform3f(t, i.u_scale),
          u_fade: new e.Uniform1f(t, i.u_fade),
          u_alpha_discard_threshold: new e.Uniform1f(t, i.u_alpha_discard_threshold)
        };
      },
      raster: function raster(t, i) {
        return {
          u_matrix: new e.UniformMatrix4f(t, i.u_matrix),
          u_tl_parent: new e.Uniform2f(t, i.u_tl_parent),
          u_scale_parent: new e.Uniform1f(t, i.u_scale_parent),
          u_fade_t: new e.Uniform1f(t, i.u_fade_t),
          u_opacity: new e.Uniform1f(t, i.u_opacity),
          u_image0: new e.Uniform1i(t, i.u_image0),
          u_image1: new e.Uniform1i(t, i.u_image1),
          u_brightness_low: new e.Uniform1f(t, i.u_brightness_low),
          u_brightness_high: new e.Uniform1f(t, i.u_brightness_high),
          u_saturation_factor: new e.Uniform1f(t, i.u_saturation_factor),
          u_contrast_factor: new e.Uniform1f(t, i.u_contrast_factor),
          u_spin_weights: new e.Uniform3f(t, i.u_spin_weights),
          u_perspective_transform: new e.Uniform2f(t, i.u_perspective_transform)
        };
      },
      symbolIcon: function symbolIcon(t, i) {
        return {
          u_is_size_zoom_constant: new e.Uniform1i(t, i.u_is_size_zoom_constant),
          u_is_size_feature_constant: new e.Uniform1i(t, i.u_is_size_feature_constant),
          u_size_t: new e.Uniform1f(t, i.u_size_t),
          u_size: new e.Uniform1f(t, i.u_size),
          u_camera_to_center_distance: new e.Uniform1f(t, i.u_camera_to_center_distance),
          u_pitch: new e.Uniform1f(t, i.u_pitch),
          u_rotate_symbol: new e.Uniform1i(t, i.u_rotate_symbol),
          u_aspect_ratio: new e.Uniform1f(t, i.u_aspect_ratio),
          u_fade_change: new e.Uniform1f(t, i.u_fade_change),
          u_matrix: new e.UniformMatrix4f(t, i.u_matrix),
          u_label_plane_matrix: new e.UniformMatrix4f(t, i.u_label_plane_matrix),
          u_coord_matrix: new e.UniformMatrix4f(t, i.u_coord_matrix),
          u_is_text: new e.Uniform1i(t, i.u_is_text),
          u_pitch_with_map: new e.Uniform1i(t, i.u_pitch_with_map),
          u_texsize: new e.Uniform2f(t, i.u_texsize),
          u_tile_id: new e.Uniform3f(t, i.u_tile_id),
          u_zoom_transition: new e.Uniform1f(t, i.u_zoom_transition),
          u_inv_rot_matrix: new e.UniformMatrix4f(t, i.u_inv_rot_matrix),
          u_merc_center: new e.Uniform2f(t, i.u_merc_center),
          u_texture: new e.Uniform1i(t, i.u_texture)
        };
      },
      symbolSDF: function symbolSDF(t, i) {
        return {
          u_is_size_zoom_constant: new e.Uniform1i(t, i.u_is_size_zoom_constant),
          u_is_size_feature_constant: new e.Uniform1i(t, i.u_is_size_feature_constant),
          u_size_t: new e.Uniform1f(t, i.u_size_t),
          u_size: new e.Uniform1f(t, i.u_size),
          u_camera_to_center_distance: new e.Uniform1f(t, i.u_camera_to_center_distance),
          u_pitch: new e.Uniform1f(t, i.u_pitch),
          u_rotate_symbol: new e.Uniform1i(t, i.u_rotate_symbol),
          u_aspect_ratio: new e.Uniform1f(t, i.u_aspect_ratio),
          u_fade_change: new e.Uniform1f(t, i.u_fade_change),
          u_matrix: new e.UniformMatrix4f(t, i.u_matrix),
          u_label_plane_matrix: new e.UniformMatrix4f(t, i.u_label_plane_matrix),
          u_coord_matrix: new e.UniformMatrix4f(t, i.u_coord_matrix),
          u_is_text: new e.Uniform1i(t, i.u_is_text),
          u_pitch_with_map: new e.Uniform1i(t, i.u_pitch_with_map),
          u_texsize: new e.Uniform2f(t, i.u_texsize),
          u_texture: new e.Uniform1i(t, i.u_texture),
          u_gamma_scale: new e.Uniform1f(t, i.u_gamma_scale),
          u_device_pixel_ratio: new e.Uniform1f(t, i.u_device_pixel_ratio),
          u_tile_id: new e.Uniform3f(t, i.u_tile_id),
          u_zoom_transition: new e.Uniform1f(t, i.u_zoom_transition),
          u_inv_rot_matrix: new e.UniformMatrix4f(t, i.u_inv_rot_matrix),
          u_merc_center: new e.Uniform2f(t, i.u_merc_center),
          u_is_halo: new e.Uniform1i(t, i.u_is_halo)
        };
      },
      symbolTextAndIcon: function symbolTextAndIcon(t, i) {
        return {
          u_is_size_zoom_constant: new e.Uniform1i(t, i.u_is_size_zoom_constant),
          u_is_size_feature_constant: new e.Uniform1i(t, i.u_is_size_feature_constant),
          u_size_t: new e.Uniform1f(t, i.u_size_t),
          u_size: new e.Uniform1f(t, i.u_size),
          u_camera_to_center_distance: new e.Uniform1f(t, i.u_camera_to_center_distance),
          u_pitch: new e.Uniform1f(t, i.u_pitch),
          u_rotate_symbol: new e.Uniform1i(t, i.u_rotate_symbol),
          u_aspect_ratio: new e.Uniform1f(t, i.u_aspect_ratio),
          u_fade_change: new e.Uniform1f(t, i.u_fade_change),
          u_matrix: new e.UniformMatrix4f(t, i.u_matrix),
          u_label_plane_matrix: new e.UniformMatrix4f(t, i.u_label_plane_matrix),
          u_coord_matrix: new e.UniformMatrix4f(t, i.u_coord_matrix),
          u_is_text: new e.Uniform1i(t, i.u_is_text),
          u_pitch_with_map: new e.Uniform1i(t, i.u_pitch_with_map),
          u_texsize: new e.Uniform2f(t, i.u_texsize),
          u_texsize_icon: new e.Uniform2f(t, i.u_texsize_icon),
          u_texture: new e.Uniform1i(t, i.u_texture),
          u_texture_icon: new e.Uniform1i(t, i.u_texture_icon),
          u_gamma_scale: new e.Uniform1f(t, i.u_gamma_scale),
          u_device_pixel_ratio: new e.Uniform1f(t, i.u_device_pixel_ratio),
          u_is_halo: new e.Uniform1i(t, i.u_is_halo)
        };
      },
      background: function background(t, i) {
        return {
          u_matrix: new e.UniformMatrix4f(t, i.u_matrix),
          u_opacity: new e.Uniform1f(t, i.u_opacity),
          u_color: new e.UniformColor(t, i.u_color)
        };
      },
      backgroundPattern: function backgroundPattern(t, i) {
        return {
          u_matrix: new e.UniformMatrix4f(t, i.u_matrix),
          u_opacity: new e.Uniform1f(t, i.u_opacity),
          u_image: new e.Uniform1i(t, i.u_image),
          u_pattern_tl_a: new e.Uniform2f(t, i.u_pattern_tl_a),
          u_pattern_br_a: new e.Uniform2f(t, i.u_pattern_br_a),
          u_pattern_tl_b: new e.Uniform2f(t, i.u_pattern_tl_b),
          u_pattern_br_b: new e.Uniform2f(t, i.u_pattern_br_b),
          u_texsize: new e.Uniform2f(t, i.u_texsize),
          u_mix: new e.Uniform1f(t, i.u_mix),
          u_pattern_size_a: new e.Uniform2f(t, i.u_pattern_size_a),
          u_pattern_size_b: new e.Uniform2f(t, i.u_pattern_size_b),
          u_scale_a: new e.Uniform1f(t, i.u_scale_a),
          u_scale_b: new e.Uniform1f(t, i.u_scale_b),
          u_pixel_coord_upper: new e.Uniform2f(t, i.u_pixel_coord_upper),
          u_pixel_coord_lower: new e.Uniform2f(t, i.u_pixel_coord_lower),
          u_tile_units_to_pixels: new e.Uniform1f(t, i.u_tile_units_to_pixels)
        };
      },
      terrainRaster: ei,
      terrainDepth: ei,
      skybox: function skybox(t, i) {
        return {
          u_matrix: new e.UniformMatrix4f(t, i.u_matrix),
          u_sun_direction: new e.Uniform3f(t, i.u_sun_direction),
          u_cubemap: new e.Uniform1i(t, i.u_cubemap),
          u_opacity: new e.Uniform1f(t, i.u_opacity),
          u_temporal_offset: new e.Uniform1f(t, i.u_temporal_offset)
        };
      },
      skyboxGradient: function skyboxGradient(t, i) {
        return {
          u_matrix: new e.UniformMatrix4f(t, i.u_matrix),
          u_color_ramp: new e.Uniform1i(t, i.u_color_ramp),
          u_center_direction: new e.Uniform3f(t, i.u_center_direction),
          u_radius: new e.Uniform1f(t, i.u_radius),
          u_opacity: new e.Uniform1f(t, i.u_opacity),
          u_temporal_offset: new e.Uniform1f(t, i.u_temporal_offset)
        };
      },
      skyboxCapture: function skyboxCapture(t, i) {
        return {
          u_matrix_3f: new e.UniformMatrix3f(t, i.u_matrix_3f),
          u_sun_direction: new e.Uniform3f(t, i.u_sun_direction),
          u_sun_intensity: new e.Uniform1f(t, i.u_sun_intensity),
          u_color_tint_r: new e.Uniform4f(t, i.u_color_tint_r),
          u_color_tint_m: new e.Uniform4f(t, i.u_color_tint_m),
          u_luminance: new e.Uniform1f(t, i.u_luminance)
        };
      },
      globeRaster: function globeRaster(t, i) {
        return {
          u_proj_matrix: new e.UniformMatrix4f(t, i.u_proj_matrix),
          u_globe_matrix: new e.UniformMatrix4f(t, i.u_globe_matrix),
          u_merc_matrix: new e.UniformMatrix4f(t, i.u_merc_matrix),
          u_zoom_transition: new e.Uniform1f(t, i.u_zoom_transition),
          u_merc_center: new e.Uniform2f(t, i.u_merc_center),
          u_image0: new e.Uniform1i(t, i.u_image0)
        };
      },
      globeAtmosphere: function globeAtmosphere(t, i) {
        return {
          u_center: new e.Uniform2f(t, i.u_center),
          u_radius: new e.Uniform1f(t, i.u_radius),
          u_screen_size: new e.Uniform2f(t, i.u_screen_size),
          u_pixel_ratio: new e.Uniform1f(t, i.u_pixel_ratio),
          u_opacity: new e.Uniform1f(t, i.u_opacity),
          u_fadeout_range: new e.Uniform1f(t, i.u_fadeout_range),
          u_start_color: new e.Uniform3f(t, i.u_start_color),
          u_end_color: new e.Uniform3f(t, i.u_end_color)
        };
      }
    };

    var Ni;

    function Gi(t, i, o, r, n, a, s) {
      var l = t.context,
          c = l.gl,
          h = t.useProgram("collisionBox"),
          u = [];
      var _ = 0,
          d = 0;

      for (var _p31 = 0; _p31 < r.length; _p31++) {
        var _m12 = r[_p31],
            _f18 = i.getTile(_m12),
            _g17 = _f18.getBucket(o);

        if (!_g17) continue;
        var _v10 = _m12.projMatrix;
        0 === n[0] && 0 === n[1] || (_v10 = t.translatePosMatrix(_m12.projMatrix, _f18, n, a));

        var _x13 = s ? _g17.textCollisionBox : _g17.iconCollisionBox,
            _y12 = _g17.collisionCircleArray;

        if (_y12.length > 0) {
          var _i226 = e.create(),
              _o128 = _v10;

          e.mul(_i226, _g17.placementInvProjMatrix, t.transform.glCoordMatrix), e.mul(_i226, _i226, _g17.placementViewportMatrix), u.push({
            circleArray: _y12,
            circleOffset: d,
            transform: _o128,
            invTransform: _i226
          }), _ += _y12.length / 4, d = _;
        }

        _x13 && (t.terrain && t.terrain.setupElevationDraw(_f18, h), h.draw(l, c.LINES, e.DepthMode.disabled, e.StencilMode.disabled, t.colorModeForRenderPass(), e.CullFaceMode.disabled, Ei(_v10, t.transform, _f18), o.id, _x13.layoutVertexBuffer, _x13.indexBuffer, _x13.segments, null, t.transform.zoom, null, _x13.collisionVertexBuffer, _x13.collisionVertexBufferExt));
      }

      if (!s || !u.length) return;
      var p = t.useProgram("collisionCircle"),
          m = new e.StructArrayLayout2f1f2i16();
      m.resize(4 * _), m._trim();
      var f = 0;

      for (var _i227 = 0, _u56 = u; _i227 < _u56.length; _i227++) {
        var _e385 = _u56[_i227];

        for (var _t359 = 0; _t359 < _e385.circleArray.length / 4; _t359++) {
          var _i228 = 4 * _t359,
              _o129 = _e385.circleArray[_i228 + 0],
              _r265 = _e385.circleArray[_i228 + 1],
              _n175 = _e385.circleArray[_i228 + 2],
              _a114 = _e385.circleArray[_i228 + 3];

          m.emplace(f++, _o129, _r265, _n175, _a114, 0), m.emplace(f++, _o129, _r265, _n175, _a114, 1), m.emplace(f++, _o129, _r265, _n175, _a114, 2), m.emplace(f++, _o129, _r265, _n175, _a114, 3);
        }
      }

      (!Ni || Ni.length < 2 * _) && (Ni = function (t) {
        var i = 2 * t,
            o = new e.StructArrayLayout3ui6();
        o.resize(i), o._trim();

        for (var _e386 = 0; _e386 < i; _e386++) {
          var _t360 = 6 * _e386;

          o.uint16[_t360 + 0] = 4 * _e386 + 0, o.uint16[_t360 + 1] = 4 * _e386 + 1, o.uint16[_t360 + 2] = 4 * _e386 + 2, o.uint16[_t360 + 3] = 4 * _e386 + 2, o.uint16[_t360 + 4] = 4 * _e386 + 3, o.uint16[_t360 + 5] = 4 * _e386 + 0;
        }

        return o;
      }(_));
      var g = l.createIndexBuffer(Ni, !0),
          v = l.createVertexBuffer(m, e.collisionCircleLayout.members, !0);

      for (var _i229 = 0, _u57 = u; _i229 < _u57.length; _i229++) {
        var _i230 = _u57[_i229];
        var _r266 = {
          u_matrix: _i230.transform,
          u_inv_matrix: _i230.invTransform,
          u_camera_to_center_distance: (x = t.transform).cameraToCenterDistance,
          u_viewport_size: [x.width, x.height]
        };
        p.draw(l, c.TRIANGLES, e.DepthMode.disabled, e.StencilMode.disabled, t.colorModeForRenderPass(), e.CullFaceMode.disabled, _r266, o.id, v, g, e.SegmentVector.simpleSegment(0, 2 * _i230.circleOffset, _i230.circleArray.length, _i230.circleArray.length / 2), null, t.transform.zoom, null, null, null);
      }

      var x;
      v.destroy(), g.destroy();
    }

    var ji = e.identity(new Float32Array(16));

    function Zi(t, i, o, r, n, a) {
      var _e$getAnchorAlignment2 = e.getAnchorAlignment(t),
          s = _e$getAnchorAlignment2.horizontalAlign,
          l = _e$getAnchorAlignment2.verticalAlign,
          c = -(s - .5) * i,
          h = -(l - .5) * o,
          u = e.evaluateVariableOffset(t, r);

      return new e.pointGeometry((c / n + u[0]) * a, (h / n + u[1]) * a);
    }

    function Vi(t, i, o, r, n, a, s, l, c, h, u, _) {
      var d = t.text.placedSymbolArray,
          p = t.text.dynamicLayoutVertexArray,
          m = t.icon.dynamicLayoutVertexArray,
          f = {},
          g = l.projMatrix,
          v = a.elevation,
          x = v ? v.getAtTileOffsetFunc(l, _) : function (e) {
        return [0, 0, 0];
      };
      p.clear();

      for (var _l68 = 0; _l68 < d.length; _l68++) {
        var _16 = d.get(_l68),
            _m13 = t.allowVerticalPlacement && !_16.placedOrientation,
            _v11 = _16.hidden || !_16.crossTileID || _m13 ? null : r[_16.crossTileID];

        if (_v11) {
          var _r267 = new e.pointGeometry(_16.tileAnchorX, _16.tileAnchorY),
              _l69 = x(_r267),
              _d23 = $e(_r267, o ? g : s, _l69[2]),
              _m14 = He(a.cameraToCenterDistance, _d23.signedDistanceFromCamera);

          var _y13 = n.evaluateSizeForFeature(t.textSizeData, h, _16) * _m14 / e.ONE_EM;

          o && (_y13 *= t.tilePixelRatio / c);

          var _b14 = _v11.width,
              _w13 = _v11.height,
              _T7 = _v11.anchor,
              _E4 = _v11.textOffset,
              _C5 = _v11.textScale,
              _M6 = Zi(_T7, _b14, _w13, _E4, _C5, _y13),
              _S7 = o ? $e(_r267.add(_M6), s, _l69[2]).point : _d23.point.add(i ? _M6.rotate(-a.angle) : _M6),
              _I7 = t.allowVerticalPlacement && _16.placedOrientation === e.WritingMode.vertical ? Math.PI / 2 : 0;

          for (var _t361 = 0; _t361 < _16.numGlyphs; _t361++) {
            e.addDynamicAttributes(p, _S7, _I7);
          }

          u && _16.associatedIconIndex >= 0 && (f[_16.associatedIconIndex] = {
            shiftedAnchor: _S7,
            angle: _I7
          });
        } else nt(_16.numGlyphs, p);
      }

      if (u) {
        m.clear();
        var _i231 = t.icon.placedSymbolArray;

        for (var _t362 = 0; _t362 < _i231.length; _t362++) {
          var _o130 = _i231.get(_t362);

          if (_o130.hidden) nt(_o130.numGlyphs, m);else {
            var _i232 = f[_t362];
            if (_i232) for (var _t363 = 0; _t363 < _o130.numGlyphs; _t363++) {
              e.addDynamicAttributes(m, _i232.shiftedAnchor, _i232.angle);
            } else nt(_o130.numGlyphs, m);
          }
        }

        t.icon.dynamicLayoutVertexBuffer.updateData(m);
      }

      t.text.dynamicLayoutVertexBuffer.updateData(p);
    }

    function Wi(e, t, i) {
      return i.iconsInText && t ? "symbolTextAndIcon" : e ? "symbolSDF" : "symbolIcon";
    }

    function qi(t, i, o, r, n, a, s, l, c, h, u, _) {
      var d = t.context,
          p = d.gl,
          m = t.transform,
          f = m.projection.createTileTransform(m, m.worldSize),
          g = "map" === l,
          v = "map" === c,
          x = g && "point" !== o.layout.get("symbol-placement"),
          y = g && !v && !x,
          b = void 0 !== o.layout.get("symbol-sort-key").constantOr(1);
      var w = !1;
      var T = t.depthModeForSublayer(0, e.DepthMode.ReadOnly),
          E = [e.mercatorXfromLng(m.center.lng), e.mercatorYfromLat(m.center.lat)],
          C = o.layout.get("text-variable-anchor"),
          M = "globe" === m.projection.name,
          S = M ? e.globeToMercatorTransition(m.zoom) : 0,
          I = [],
          z = [];
      t.terrain && v && z.push("PITCH_WITH_MAP_TERRAIN"), M && z.push("PROJECTION_GLOBE_VIEW"), x && z.push("PROJECTED_POS_ON_VIEWPORT");

      var _iterator227 = _createForOfIteratorHelper(r),
          _step227;

      try {
        for (_iterator227.s(); !(_step227 = _iterator227.n()).done;) {
          var _l70 = _step227.value;

          var _r269 = i.getTile(_l70),
              _c46 = _r269.getBucket(o);

          if (!_c46 || _c46.projection !== m.projection.name) continue;

          var _u58 = n ? _c46.text : _c46.icon;

          if (!_u58 || _c46.fullyClipped || !_u58.segments.get().length) continue;

          var _17 = _u58.programConfigurations.get(o.id),
              _d24 = n || _c46.sdfIcons,
              _T8 = n ? _c46.textSizeData : _c46.iconSizeData,
              _M7 = v || 0 !== m.pitch,
              _D35 = t.useProgram(Wi(_d24, n, _c46), _17, z),
              _P2 = e.evaluateSizeForZoom(_T8, m.zoom),
              _A10 = [_l70.canonical.x, _l70.canonical.y, 1 << _l70.canonical.z];

          var _L = void 0,
              _R = void 0,
              _k10 = void 0,
              _O = void 0,
              _B2 = [0, 0],
              _F = null;

          if (n) {
            if (_R = _r269.glyphAtlasTexture, _k10 = p.LINEAR, _L = _r269.glyphAtlasTexture.size, _c46.iconsInText) {
              _B2 = _r269.imageAtlasTexture.size, _F = _r269.imageAtlasTexture;

              var _e388 = "composite" === _T8.kind || "camera" === _T8.kind;

              _O = _M7 || t.options.rotating || t.options.zooming || _e388 ? p.LINEAR : p.NEAREST;
            }
          } else {
            var _e389 = 1 !== o.layout.get("icon-size").constantOr(0) || _c46.iconsNeedLinear;

            _R = _r269.imageAtlasTexture, _k10 = _d24 || t.options.rotating || t.options.zooming || _e389 || _M7 ? p.LINEAR : p.NEAREST, _L = _r269.imageAtlasTexture.size;
          }

          var _U = t.transform.calculatePixelsToTileUnitsMatrix(_r269),
              _N = qe(_l70.projMatrix, _r269.tileID.canonical, v, g, t.transform, _U),
              _G = t.terrain && v && x ? e.invert(new Float32Array(16), _N) : ji,
              _j = Xe(_l70.projMatrix, _r269.tileID.canonical, v, g, t.transform, _U),
              _Z = C && _c46.hasTextData(),
              _V = "none" !== o.layout.get("icon-text-fit") && _Z && _c46.hasIconData();

          if (x) {
            var _e390 = m.elevation,
                _i235 = _e390 ? _e390.getAtTileOffsetFunc(_l70, f) : function (e) {
              return [0, 0, 0];
            };

            Ye(_c46, _l70.projMatrix, t, n, _N, _j, v, h, _i235, _l70);
          }

          var _W = t.translatePosMatrix(_l70.projMatrix, _r269, a, s),
              _q = x || n && C || _V ? ji : _N,
              _X = t.translatePosMatrix(_j, _r269, a, s, !0),
              _$ = _d24 && 0 !== o.paint.get(n ? "text-halo-width" : "icon-halo-width").constantOr(1);

          var _H = void 0;

          var _K = f.createInversionMatrix(_l70.toUnwrapped());

          _H = _d24 ? _c46.iconsInText ? Oi(_T8.kind, _P2, y, v, t, _W, _q, _X, _L, _B2, _A10, S, _K, E) : ki(_T8.kind, _P2, y, v, t, _W, _q, _X, n, _L, !0, _A10, S, _K, E) : Ri(_T8.kind, _P2, y, v, t, _W, _q, _X, n, _L, _A10, S, _K, E);
          var _Y = {
            program: _D35,
            buffers: _u58,
            uniformValues: _H,
            atlasTexture: _R,
            atlasTextureIcon: _F,
            atlasInterpolation: _k10,
            atlasInterpolationIcon: _O,
            isSDF: _d24,
            hasHalo: _$,
            tile: _r269,
            labelPlaneMatrixInv: _G
          };

          if (b && _c46.canOverlap) {
            w = !0;

            var _t364 = _u58.segments.get();

            var _iterator228 = _createForOfIteratorHelper(_t364),
                _step228;

            try {
              for (_iterator228.s(); !(_step228 = _iterator228.n()).done;) {
                var _i236 = _step228.value;
                I.push({
                  segments: new e.SegmentVector([_i236]),
                  sortKey: _i236.sortKey,
                  state: _Y
                });
              }
            } catch (err) {
              _iterator228.e(err);
            } finally {
              _iterator228.f();
            }
          } else I.push({
            segments: _u58.segments,
            sortKey: 0,
            state: _Y
          });
        }
      } catch (err) {
        _iterator227.e(err);
      } finally {
        _iterator227.f();
      }

      w && I.sort(function (e, t) {
        return e.sortKey - t.sortKey;
      });

      for (var _i233 = 0, _I8 = I; _i233 < _I8.length; _i233++) {
        var _e387 = _I8[_i233];
        var _i234 = _e387.state;

        if (t.terrain && t.terrain.setupElevationDraw(_i234.tile, _i234.program, {
          useDepthForOcclusion: !M,
          labelPlaneMatrixInv: _i234.labelPlaneMatrixInv
        }), d.activeTexture.set(p.TEXTURE0), _i234.atlasTexture.bind(_i234.atlasInterpolation, p.CLAMP_TO_EDGE), _i234.atlasTextureIcon && (d.activeTexture.set(p.TEXTURE1), _i234.atlasTextureIcon && _i234.atlasTextureIcon.bind(_i234.atlasInterpolationIcon, p.CLAMP_TO_EDGE)), _i234.isSDF) {
          var _r268 = _i234.uniformValues;
          _i234.hasHalo && (_r268.u_is_halo = 1, Xi(_i234.buffers, _e387.segments, o, t, _i234.program, T, u, _, _r268)), _r268.u_is_halo = 0;
        }

        Xi(_i234.buffers, _e387.segments, o, t, _i234.program, T, u, _, _i234.uniformValues);
      }
    }

    function Xi(t, i, o, r, n, a, s, l, c) {
      var h = r.context;
      n.draw(h, h.gl.TRIANGLES, a, s, l, e.CullFaceMode.disabled, c, o.id, t.layoutVertexBuffer, t.indexBuffer, i, o.paint, r.transform.zoom, t.programConfigurations.get(o.id), t.dynamicLayoutVertexBuffer, t.opacityVertexBuffer);
    }

    function $i(t, i, o, r, n, a, s) {
      var l = t.context.gl,
          c = o.paint.get("fill-pattern"),
          h = c && c.constantOr(1),
          u = o.getCrossfadeParameters();

      var _, d, p, m, f;

      s ? (d = h && !o.getPaintProperty("fill-outline-color") ? "fillOutlinePattern" : "fillOutline", _ = l.LINES) : (d = h ? "fillPattern" : "fill", _ = l.TRIANGLES);

      var _iterator229 = _createForOfIteratorHelper(r),
          _step229;

      try {
        for (_iterator229.s(); !(_step229 = _iterator229.n()).done;) {
          var _g18 = _step229.value;

          var _r270 = i.getTile(_g18);

          if (h && !_r270.patternsLoaded()) continue;

          var _v12 = _r270.getBucket(o);

          if (!_v12) continue;
          t.prepareDrawTile(_g18);

          var _x14 = _v12.programConfigurations.get(o.id),
              _y14 = t.useProgram(d, _x14);

          h && (t.context.activeTexture.set(l.TEXTURE0), _r270.imageAtlasTexture.bind(l.LINEAR, l.CLAMP_TO_EDGE), _x14.updatePaintBuffers(u));

          var _b15 = c.constantOr(null);

          if (_b15 && _r270.imageAtlas) {
            var _e391 = _r270.imageAtlas,
                _t365 = _e391.patternPositions[_b15.to.toString()],
                _i237 = _e391.patternPositions[_b15.from.toString()];

            _t365 && _i237 && _x14.setConstantPatternPositions(_t365, _i237);
          }

          var _w14 = t.translatePosMatrix(_g18.projMatrix, _r270, o.paint.get("fill-translate"), o.paint.get("fill-translate-anchor"));

          if (s) {
            m = _v12.indexBuffer2, f = _v12.segments2;

            var _e392 = t.terrain && t.terrain.renderingToTexture ? t.terrain.drapeBufferSize : [l.drawingBufferWidth, l.drawingBufferHeight];

            p = "fillOutlinePattern" === d && h ? bi(_w14, t, u, _r270, _e392) : yi(_w14, _e392);
          } else m = _v12.indexBuffer, f = _v12.segments, p = h ? xi(_w14, t, u, _r270) : vi(_w14);

          t.prepareDrawProgram(t.context, _y14, _g18.toUnwrapped()), _y14.draw(t.context, _, n, t.stencilModeForClipping(_g18), a, e.CullFaceMode.disabled, p, o.id, _v12.layoutVertexBuffer, m, f, o.paint, t.transform.zoom, _x14);
        }
      } catch (err) {
        _iterator229.e(err);
      } finally {
        _iterator229.f();
      }
    }

    function Hi(t, i, o, r, n, a, s) {
      var l = t.context,
          c = l.gl,
          h = o.paint.get("fill-extrusion-pattern"),
          u = h.constantOr(1),
          _ = o.getCrossfadeParameters(),
          d = o.paint.get("fill-extrusion-opacity");

      var _iterator230 = _createForOfIteratorHelper(r),
          _step230;

      try {
        for (_iterator230.s(); !(_step230 = _iterator230.n()).done;) {
          var _p32 = _step230.value;

          var _r271 = i.getTile(_p32),
              _m15 = _r271.getBucket(o);

          if (!_m15) continue;

          var _f19 = _m15.programConfigurations.get(o.id),
              _g19 = t.useProgram(u ? "fillExtrusionPattern" : "fillExtrusion", _f19);

          if (t.terrain) {
            var _e393 = t.terrain;
            if (!_m15.enableTerrain) continue;

            if (_e393.setupElevationDraw(_r271, _g19, {
              useMeterToDem: !0
            }), Ki(l, i, _p32, _m15, o, _e393), !_m15.centroidVertexBuffer) {
              var _e394 = _g19.attributes.a_centroid_pos;
              void 0 !== _e394 && c.vertexAttrib2f(_e394, 0, 0);
            }
          }

          u && (t.context.activeTexture.set(c.TEXTURE0), _r271.imageAtlasTexture.bind(c.LINEAR, c.CLAMP_TO_EDGE), _f19.updatePaintBuffers(_));

          var _v13 = h.constantOr(null);

          if (_v13 && _r271.imageAtlas) {
            var _e395 = _r271.imageAtlas,
                _t366 = _e395.patternPositions[_v13.to.toString()],
                _i238 = _e395.patternPositions[_v13.from.toString()];

            _t366 && _i238 && _f19.setConstantPatternPositions(_t366, _i238);
          }

          var _x15 = t.translatePosMatrix(_p32.projMatrix, _r271, o.paint.get("fill-extrusion-translate"), o.paint.get("fill-extrusion-translate-anchor")),
              _y15 = o.paint.get("fill-extrusion-vertical-gradient"),
              _b16 = u ? gi(_x15, t, _y15, d, _p32, _, _r271) : fi(_x15, t, _y15, d);

          t.prepareDrawProgram(l, _g19, _p32.toUnwrapped()), _g19.draw(l, l.gl.TRIANGLES, n, a, s, e.CullFaceMode.backCCW, _b16, o.id, _m15.layoutVertexBuffer, _m15.indexBuffer, _m15.segments, o.paint, t.transform.zoom, _f19, t.terrain ? _m15.centroidVertexBuffer : null);
        }
      } catch (err) {
        _iterator230.e(err);
      } finally {
        _iterator230.f();
      }
    }

    function Ki(t, i, o, r, n, a) {
      var s = [function (t) {
        var i = t.canonical.x - 1,
            o = t.wrap;
        return i < 0 && (i = (1 << t.canonical.z) - 1, o--), new e.OverscaledTileID(t.overscaledZ, o, t.canonical.z, i, t.canonical.y);
      }, function (t) {
        var i = t.canonical.x + 1,
            o = t.wrap;
        return i === 1 << t.canonical.z && (i = 0, o++), new e.OverscaledTileID(t.overscaledZ, o, t.canonical.z, i, t.canonical.y);
      }, function (t) {
        return new e.OverscaledTileID(t.overscaledZ, t.wrap, t.canonical.z, t.canonical.x, (0 === t.canonical.y ? 1 << t.canonical.z : t.canonical.y) - 1);
      }, function (t) {
        return new e.OverscaledTileID(t.overscaledZ, t.wrap, t.canonical.z, t.canonical.x, t.canonical.y === (1 << t.canonical.z) - 1 ? 0 : t.canonical.y + 1);
      }],
          l = function l(e) {
        var t = i.getSource().maxzoom,
            o = function o(e) {
          var t = i.getTileByID(e);
          if (t && t.hasData()) return t.getBucket(n);
        };

        var r, a, s;
        return (e.overscaledZ === e.canonical.z || e.overscaledZ >= t) && (r = o(e.key)), e.overscaledZ >= t && (a = o(e.calculateScaledKey(e.overscaledZ + 1))), e.overscaledZ > t && (s = o(e.calculateScaledKey(e.overscaledZ - 1))), r || a || s;
      },
          c = [0, 0, 0],
          h = function h(t, i) {
        return c[0] = Math.min(t.min.y, i.min.y), c[1] = Math.max(t.max.y, i.max.y), c[2] = e.EXTENT - i.min.x > t.max.x ? i.min.x - e.EXTENT : t.max.x, c;
      },
          u = function u(t, i) {
        return c[0] = Math.min(t.min.x, i.min.x), c[1] = Math.max(t.max.x, i.max.x), c[2] = e.EXTENT - i.min.y > t.max.y ? i.min.y - e.EXTENT : t.max.y, c;
      },
          _ = [function (e, t) {
        return h(e, t);
      }, function (e, t) {
        return h(t, e);
      }, function (e, t) {
        return u(e, t);
      }, function (e, t) {
        return u(t, e);
      }],
          d = new e.pointGeometry(0, 0);

      var p, m, f;

      var g = function g(t, i, r, n, s) {
        var l = [[n ? r : t, n ? t : r, 0], [n ? r : i, n ? i : r, 0]],
            c = s < 0 ? e.EXTENT + s : s,
            h = [n ? c : (t + i) / 2, n ? (t + i) / 2 : c, 0];
        return 0 === r && s < 0 || 0 !== r && s > 0 ? a.getForTilePoints(f, [h], !0, m) : l.push(h), a.getForTilePoints(o, l, !0, p), Math.max(l[0][2], l[1][2], h[2]) / a.exaggeration();
      };

      for (var _t367 = 0; _t367 < 4; _t367++) {
        var _i239 = r.borders[_t367];
        if (0 === _i239.length && (r.borderDone[_t367] = !0), r.borderDone[_t367]) continue;

        var _n176 = f = s[_t367](o),
            _c47 = l(_n176);

        if (!_c47 || !_c47.enableTerrain) continue;
        if (m = a.findDEMTileFor(_n176), !m || !m.dem) continue;

        if (!p) {
          var _e396 = a.findDEMTileFor(o);

          if (!_e396 || !_e396.dem) return;
          p = _e396;
        }

        var _h35 = (_t367 < 2 ? 1 : 5) - _t367,
            _u59 = _c47.borders[_h35];

        var _v14 = 0;

        for (var _o131 = 0; _o131 < _i239.length; _o131++) {
          var _n177 = r.featuresOnBorder[_i239[_o131]],
              _a115 = _n177.borders[_t367];

          var _s129 = void 0;

          for (; _v14 < _u59.length && (_s129 = _c47.featuresOnBorder[_u59[_v14]], !(_s129.borders[_h35][1] > _a115[0] + 3));) {
            _c47.borderDone[_h35] || _c47.encodeCentroid(void 0, _s129, !1), _v14++;
          }

          if (_s129 && _v14 < _u59.length) {
            var _i240 = _v14;
            var _o132 = 0;

            for (; !(_s129.borders[_h35][0] > _a115[1] - 3) && (_o132++, ++_v14 !== _u59.length);) {
              _s129 = _c47.featuresOnBorder[_u59[_v14]];
            }

            if (_s129 = _c47.featuresOnBorder[_u59[_i240]], _n177.intersectsCount() > 1 || _s129.intersectsCount() > 1 || 1 !== _o132) {
              1 !== _o132 && (_v14 = _i240), r.encodeCentroid(void 0, _n177, !1), _c47.borderDone[_h35] || _c47.encodeCentroid(void 0, _s129, !1);
              continue;
            }

            var _l71 = _[_t367](_n177, _s129),
                _p33 = _t367 % 2 ? e.EXTENT - 1 : 0;

            d.x = g(_l71[0], Math.min(e.EXTENT - 1, _l71[1]), _p33, _t367 < 2, _l71[2]), d.y = 0, r.encodeCentroid(d, _n177, !1), _c47.borderDone[_h35] || _c47.encodeCentroid(d, _s129, !1);
          } else r.encodeCentroid(void 0, _n177, !1);
        }

        r.borderDone[_t367] = r.needsCentroidUpdate = !0, _c47.borderDone[_h35] || (_c47.borderDone[_h35] = _c47.needsCentroidUpdate = !0);
      }

      (r.needsCentroidUpdate || !r.centroidVertexBuffer && 0 !== r.centroidVertexArray.length) && r.uploadCentroid(t);
    }

    var Yi = new e.Color(1, 0, 0, 1),
        Ji = new e.Color(0, 1, 0, 1),
        Qi = new e.Color(0, 0, 1, 1),
        eo = new e.Color(1, 0, 1, 1),
        to = new e.Color(0, 1, 1, 1);

    function io(e, t, i, o) {
      ro(e, 0, t + i / 2, e.transform.width, i, o);
    }

    function oo(e, t, i, o) {
      ro(e, t - i / 2, 0, i, e.transform.height, o);
    }

    function ro(t, i, o, r, n, a) {
      var s = t.context,
          l = s.gl;
      l.enable(l.SCISSOR_TEST), l.scissor(i * e.exported.devicePixelRatio, o * e.exported.devicePixelRatio, r * e.exported.devicePixelRatio, n * e.exported.devicePixelRatio), s.clear({
        color: a
      }), l.disable(l.SCISSOR_TEST);
    }

    function no(t, i, o) {
      var r = t.context,
          n = r.gl,
          a = o.projMatrix,
          s = t.useProgram("debug"),
          l = i.getTileByID(o.key);
      t.terrain && t.terrain.setupElevationDraw(l, s);
      var c = e.DepthMode.disabled,
          h = e.StencilMode.disabled,
          u = t.colorModeForRenderPass(),
          _ = "$debug";
      r.activeTexture.set(n.TEXTURE0), t.emptyTexture.bind(n.LINEAR, n.CLAMP_TO_EDGE), l._makeDebugTileBoundsBuffers(t.context, t.transform.projection);
      var d = l._tileDebugBuffer || t.debugBuffer,
          p = l._tileDebugIndexBuffer || t.debugIndexBuffer,
          m = l._tileDebugSegments || t.debugSegments;
      s.draw(r, n.LINE_STRIP, c, h, u, e.CullFaceMode.disabled, Ci(a, e.Color.red), _, d, p, m);
      var f = l.latestRawTileData,
          g = Math.floor((f && f.byteLength || 0) / 1024),
          v = i.getTile(o).tileSize,
          x = 512 / Math.min(v, 512) * (o.overscaledZ / t.transform.zoom) * .5;
      var y = o.canonical.toString();
      o.overscaledZ !== o.canonical.z && (y += " => ".concat(o.overscaledZ)), function (e, t) {
        e.initDebugOverlayCanvas();
        var i = e.debugOverlayCanvas,
            o = e.context.gl,
            r = e.debugOverlayCanvas.getContext("2d");
        r.clearRect(0, 0, i.width, i.height), r.shadowColor = "white", r.shadowBlur = 2, r.lineWidth = 1.5, r.strokeStyle = "white", r.textBaseline = "top", r.font = "bold 36px Open Sans, sans-serif", r.fillText(t, 5, 5), r.strokeText(t, 5, 5), e.debugOverlayTexture.update(i), e.debugOverlayTexture.bind(o.LINEAR, o.CLAMP_TO_EDGE);
      }(t, "".concat(y, " ").concat(g, "kb")), s.draw(r, n.TRIANGLES, c, h, e.ColorMode.alphaBlended, e.CullFaceMode.disabled, Ci(a, e.Color.transparent, x), _, t.debugBuffer, t.quadTriangleIndexBuffer, t.debugSegments);
    }

    var ao = e.createLayout([{
      name: "a_pos_3f",
      components: 3,
      type: "Float32"
    }]),
        so = ao.members;

    function lo(e, t, i, o) {
      e.emplaceBack(t, i, o);
    }

    var co = /*#__PURE__*/_createClass(function co(t) {
      _classCallCheck(this, co);

      this.vertexArray = new e.StructArrayLayout3f12(), this.indices = new e.StructArrayLayout3ui6(), lo(this.vertexArray, -1, -1, 1), lo(this.vertexArray, 1, -1, 1), lo(this.vertexArray, -1, 1, 1), lo(this.vertexArray, 1, 1, 1), lo(this.vertexArray, -1, -1, -1), lo(this.vertexArray, 1, -1, -1), lo(this.vertexArray, -1, 1, -1), lo(this.vertexArray, 1, 1, -1), this.indices.emplaceBack(5, 1, 3), this.indices.emplaceBack(3, 7, 5), this.indices.emplaceBack(6, 2, 0), this.indices.emplaceBack(0, 4, 6), this.indices.emplaceBack(2, 6, 7), this.indices.emplaceBack(7, 3, 2), this.indices.emplaceBack(5, 4, 0), this.indices.emplaceBack(0, 1, 5), this.indices.emplaceBack(0, 2, 3), this.indices.emplaceBack(3, 1, 0), this.indices.emplaceBack(7, 6, 4), this.indices.emplaceBack(4, 5, 7), this.vertexBuffer = t.createVertexBuffer(this.vertexArray, so), this.indexBuffer = t.createIndexBuffer(this.indices), this.segment = e.SegmentVector.simpleSegment(0, 0, 36, 12);
    });

    function ho(t, i, o, r, n, a) {
      var s = t.gl,
          l = i.paint.get("sky-atmosphere-color"),
          c = i.paint.get("sky-atmosphere-halo-color"),
          h = i.paint.get("sky-atmosphere-sun-intensity"),
          u = function (e, t, i, o, r) {
        return {
          u_matrix_3f: e,
          u_sun_direction: t,
          u_sun_intensity: i,
          u_color_tint_r: [o.r, o.g, o.b, o.a],
          u_color_tint_m: [r.r, r.g, r.b, r.a],
          u_luminance: 5e-5
        };
      }(e.fromMat4([], r), n, h, l, c);

      s.framebufferTexture2D(s.FRAMEBUFFER, s.COLOR_ATTACHMENT0, s.TEXTURE_CUBE_MAP_POSITIVE_X + a, i.skyboxTexture, 0), o.draw(t, s.TRIANGLES, e.DepthMode.disabled, e.StencilMode.disabled, e.ColorMode.unblended, e.CullFaceMode.frontCW, u, "skyboxCapture", i.skyboxGeometry.vertexBuffer, i.skyboxGeometry.indexBuffer, i.skyboxGeometry.segment);
    }

    var uo = {
      symbol: function symbol(t, i, o, r, n) {
        if ("translucent" !== t.renderPass) return;
        var a = e.StencilMode.disabled,
            s = t.colorModeForRenderPass();
        o.layout.get("text-variable-anchor") && function (t, i, o, r, n, a, s) {
          var l = i.transform,
              c = "map" === n,
              h = "map" === a,
              u = l.projection.createTileTransform(l, l.worldSize);

          var _iterator231 = _createForOfIteratorHelper(t),
              _step231;

          try {
            for (_iterator231.s(); !(_step231 = _iterator231.n()).done;) {
              var _n178 = _step231.value;

              var _t368 = r.getTile(_n178),
                  _a116 = _t368.getBucket(o);

              if (!_a116 || _a116.projection !== l.projection.name || !_a116.text || !_a116.text.segments.get().length) continue;

              var _18 = e.evaluateSizeForZoom(_a116.textSizeData, l.zoom),
                  _d25 = i.transform.calculatePixelsToTileUnitsMatrix(_t368),
                  _p34 = qe(_n178.projMatrix, _t368.tileID.canonical, h, c, i.transform, _d25),
                  _m16 = "none" !== o.layout.get("icon-text-fit") && _a116.hasIconData();

              if (_18) {
                var _i241 = Math.pow(2, l.zoom - _t368.tileID.overscaledZ);

                Vi(_a116, c, h, s, e.symbolSize, l, _p34, _n178, _i241, _18, _m16, u);
              }
            }
          } catch (err) {
            _iterator231.e(err);
          } finally {
            _iterator231.f();
          }
        }(r, t, o, i, o.layout.get("text-rotation-alignment"), o.layout.get("text-pitch-alignment"), n), 0 !== o.paint.get("icon-opacity").constantOr(1) && qi(t, i, o, r, !1, o.paint.get("icon-translate"), o.paint.get("icon-translate-anchor"), o.layout.get("icon-rotation-alignment"), o.layout.get("icon-pitch-alignment"), o.layout.get("icon-keep-upright"), a, s), 0 !== o.paint.get("text-opacity").constantOr(1) && qi(t, i, o, r, !0, o.paint.get("text-translate"), o.paint.get("text-translate-anchor"), o.layout.get("text-rotation-alignment"), o.layout.get("text-pitch-alignment"), o.layout.get("text-keep-upright"), a, s), i.map.showCollisionBoxes && (Gi(t, i, o, r, o.paint.get("text-translate"), o.paint.get("text-translate-anchor"), !0), Gi(t, i, o, r, o.paint.get("icon-translate"), o.paint.get("icon-translate-anchor"), !1));
      },
      circle: function circle(t, i, o, r) {
        if ("translucent" !== t.renderPass) return;
        var n = o.paint.get("circle-opacity"),
            a = o.paint.get("circle-stroke-width"),
            s = o.paint.get("circle-stroke-opacity"),
            l = void 0 !== o.layout.get("circle-sort-key").constantOr(1);
        if (0 === n.constantOr(1) && (0 === a.constantOr(1) || 0 === s.constantOr(1))) return;
        var c = t.context,
            h = c.gl,
            u = t.depthModeForSublayer(0, e.DepthMode.ReadOnly),
            _ = e.StencilMode.disabled,
            d = t.colorModeForRenderPass(),
            p = [];

        for (var _n179 = 0; _n179 < r.length; _n179++) {
          var _a117 = r[_n179],
              _s130 = i.getTile(_a117),
              _c48 = _s130.getBucket(o);

          if (!_c48) continue;

          var _h36 = _c48.programConfigurations.get(o.id),
              _u60 = Ti(o),
              _19 = {
            programConfiguration: _h36,
            program: t.useProgram("circle", _h36, _u60),
            layoutVertexBuffer: _c48.layoutVertexBuffer,
            indexBuffer: _c48.indexBuffer,
            uniformValues: wi(t, _a117, _s130, o),
            tile: _s130
          };

          if (l) {
            var _t369 = _c48.segments.get();

            var _iterator232 = _createForOfIteratorHelper(_t369),
                _step232;

            try {
              for (_iterator232.s(); !(_step232 = _iterator232.n()).done;) {
                var _i242 = _step232.value;
                p.push({
                  segments: new e.SegmentVector([_i242]),
                  sortKey: _i242.sortKey,
                  state: _19
                });
              }
            } catch (err) {
              _iterator232.e(err);
            } finally {
              _iterator232.f();
            }
          } else p.push({
            segments: _c48.segments,
            sortKey: 0,
            state: _19
          });
        }

        l && p.sort(function (e, t) {
          return e.sortKey - t.sortKey;
        });
        var m = {
          useDepthForOcclusion: !("globe" === t.transform.projection.name)
        };

        for (var _i243 = 0, _p35 = p; _i243 < _p35.length; _i243++) {
          var _i244 = _p35[_i243];
          var _i244$state = _i244.state,
              _r272 = _i244$state.programConfiguration,
              _n180 = _i244$state.program,
              _a118 = _i244$state.layoutVertexBuffer,
              _s131 = _i244$state.indexBuffer,
              _l72 = _i244$state.uniformValues,
              _p36 = _i244$state.tile,
              _f20 = _i244.segments;
          t.terrain && t.terrain.setupElevationDraw(_p36, _n180, m), t.prepareDrawProgram(c, _n180, _p36.tileID.toUnwrapped()), _n180.draw(c, h.TRIANGLES, u, _, d, e.CullFaceMode.disabled, _l72, o.id, _a118, _s131, _f20, o.paint, t.transform.zoom, _r272);
        }
      },
      heatmap: function heatmap(t, i, o, r) {
        if (0 !== o.paint.get("heatmap-opacity")) if ("offscreen" === t.renderPass) {
          var _n181 = t.context,
              _a119 = _n181.gl,
              _s132 = e.StencilMode.disabled,
              _l73 = new e.ColorMode([_a119.ONE, _a119.ONE], e.Color.transparent, [!0, !0, !0, !0]);

          !function (e, t, i) {
            var o = e.gl;
            e.activeTexture.set(o.TEXTURE1), e.viewport.set([0, 0, t.width / 4, t.height / 4]);
            var r = i.heatmapFbo;
            if (r) o.bindTexture(o.TEXTURE_2D, r.colorAttachment.get()), e.bindFramebuffer.set(r.framebuffer);else {
              var _n182 = o.createTexture();

              o.bindTexture(o.TEXTURE_2D, _n182), o.texParameteri(o.TEXTURE_2D, o.TEXTURE_WRAP_S, o.CLAMP_TO_EDGE), o.texParameteri(o.TEXTURE_2D, o.TEXTURE_WRAP_T, o.CLAMP_TO_EDGE), o.texParameteri(o.TEXTURE_2D, o.TEXTURE_MIN_FILTER, o.LINEAR), o.texParameteri(o.TEXTURE_2D, o.TEXTURE_MAG_FILTER, o.LINEAR), r = i.heatmapFbo = e.createFramebuffer(t.width / 4, t.height / 4, !1), function (e, t, i, o) {
                var r = e.gl;
                r.texImage2D(r.TEXTURE_2D, 0, r.RGBA, t.width / 4, t.height / 4, 0, r.RGBA, e.extRenderToTextureHalfFloat ? e.extTextureHalfFloat.HALF_FLOAT_OES : r.UNSIGNED_BYTE, null), o.colorAttachment.set(i);
              }(e, t, _n182, r);
            }
          }(_n181, t, o), _n181.clear({
            color: e.Color.transparent
          });

          for (var _c49 = 0; _c49 < r.length; _c49++) {
            var _h37 = r[_c49];
            if (i.hasRenderableParent(_h37)) continue;

            var _u61 = i.getTile(_h37),
                _20 = _u61.getBucket(o);

            if (!_20) continue;

            var _d26 = _20.programConfigurations.get(o.id),
                _p37 = t.useProgram("heatmap", _d26),
                _m17 = t.transform.zoom;

            t.terrain && t.terrain.setupElevationDraw(_u61, _p37), t.prepareDrawProgram(_n181, _p37, _h37.toUnwrapped()), _p37.draw(_n181, _a119.TRIANGLES, e.DepthMode.disabled, _s132, _l73, e.CullFaceMode.disabled, Mi(_h37.projMatrix, _u61, _m17, o.paint.get("heatmap-intensity")), o.id, _20.layoutVertexBuffer, _20.indexBuffer, _20.segments, o.paint, t.transform.zoom, _d26);
          }

          _n181.viewport.set([0, 0, t.width, t.height]);
        } else "translucent" === t.renderPass && (t.context.setColorMode(t.colorModeForRenderPass()), function (t, i) {
          var o = t.context,
              r = o.gl,
              n = i.heatmapFbo;
          if (!n) return;
          o.activeTexture.set(r.TEXTURE0), r.bindTexture(r.TEXTURE_2D, n.colorAttachment.get()), o.activeTexture.set(r.TEXTURE1);
          var a = i.colorRampTexture;
          a || (a = i.colorRampTexture = new e.Texture(o, i.colorRamp, r.RGBA)), a.bind(r.LINEAR, r.CLAMP_TO_EDGE), t.useProgram("heatmapTexture").draw(o, r.TRIANGLES, e.DepthMode.disabled, e.StencilMode.disabled, t.colorModeForRenderPass(), e.CullFaceMode.disabled, function (e, t, i, o) {
            return {
              u_image: 0,
              u_color_ramp: 1,
              u_opacity: t.paint.get("heatmap-opacity")
            };
          }(0, i), i.id, t.viewportBuffer, t.quadTriangleIndexBuffer, t.viewportSegments, i.paint, t.transform.zoom);
        }(t, o));
      },
      line: function line(t, i, o, r) {
        if ("translucent" !== t.renderPass) return;
        var n = o.paint.get("line-opacity"),
            a = o.paint.get("line-width");
        if (0 === n.constantOr(1) || 0 === a.constantOr(1)) return;

        var s = t.depthModeForSublayer(0, e.DepthMode.ReadOnly),
            l = t.colorModeForRenderPass(),
            c = o.paint.get("line-dasharray"),
            h = c.constantOr(1),
            u = o.layout.get("line-cap"),
            _ = o.paint.get("line-pattern"),
            d = _.constantOr(1),
            p = o.paint.get("line-gradient"),
            m = o.getCrossfadeParameters(),
            f = d ? "linePattern" : "line",
            g = t.context,
            v = g.gl,
            x = function (e) {
          var t = [];
          Pi(e) && t.push("RENDER_LINE_DASH"), e.paint.get("line-gradient") && t.push("RENDER_LINE_GRADIENT");
          var i = e.paint.get("line-pattern").constantOr(1),
              o = 1 !== e.paint.get("line-opacity").constantOr(1);
          return !i && o && t.push("RENDER_LINE_ALPHA_DISCARD"), t;
        }(o);

        var y = x.includes("RENDER_LINE_ALPHA_DISCARD");
        t.terrain && t.terrain.clipOrMaskOverlapStencilType() && (y = !1);

        var _iterator233 = _createForOfIteratorHelper(r),
            _step233;

        try {
          var _loop11 = function _loop11() {
            var n = _step233.value;
            var r = i.getTile(n);
            if (d && !r.patternsLoaded()) return "continue";
            var a = r.getBucket(o);
            if (!a) return "continue";
            t.prepareDrawTile(n);

            var b = a.programConfigurations.get(o.id),
                w = t.useProgram(f, b, x),
                T = _.constantOr(null);

            if (T && r.imageAtlas) {
              var _e397 = r.imageAtlas,
                  _t370 = _e397.patternPositions[T.to.toString()],
                  _i245 = _e397.patternPositions[T.from.toString()];

              _t370 && _i245 && b.setConstantPatternPositions(_t370, _i245);
            }

            var E = c.constantOr(null),
                C = u.constantOr(null);

            if (!d && E && C && r.lineAtlas) {
              var _e398 = r.lineAtlas,
                  _t371 = _e398.getDash(E.to, C),
                  _i246 = _e398.getDash(E.from, C);

              _t371 && _i246 && b.setConstantPatternPositions(_t371, _i246);
            }

            var M = t.terrain ? n.projMatrix : null,
                S = d ? Ii(t, r, o, m, M) : Si(t, r, o, m, M, a.lineClipsArray.length);

            if (p) {
              var _r273 = a.gradients[o.id];
              var _s133 = _r273.texture;

              if (o.gradientVersion !== _r273.version) {
                var _l74 = 256;

                if (o.stepInterpolant) {
                  var _o133 = i.getSource().maxzoom,
                      _r274 = n.canonical.z === _o133 ? Math.ceil(1 << t.transform.maxZoom - n.canonical.z) : 1;

                  _l74 = e.clamp(e.nextPowerOfTwo(a.maxLineLength / e.EXTENT * 1024 * _r274), 256, g.maxTextureSize);
                }

                _r273.gradient = e.renderColorRamp({
                  expression: o.gradientExpression(),
                  evaluationKey: "lineProgress",
                  resolution: _l74,
                  image: _r273.gradient || void 0,
                  clips: a.lineClipsArray
                }), _r273.texture ? _r273.texture.update(_r273.gradient) : _r273.texture = new e.Texture(g, _r273.gradient, v.RGBA), _r273.version = o.gradientVersion, _s133 = _r273.texture;
              }

              g.activeTexture.set(v.TEXTURE1), _s133.bind(o.stepInterpolant ? v.NEAREST : v.LINEAR, v.CLAMP_TO_EDGE);
            }

            h && (g.activeTexture.set(v.TEXTURE0), r.lineAtlasTexture.bind(v.LINEAR, v.REPEAT), b.updatePaintBuffers(m)), d && (g.activeTexture.set(v.TEXTURE0), r.imageAtlasTexture.bind(v.LINEAR, v.CLAMP_TO_EDGE), b.updatePaintBuffers(m)), t.prepareDrawProgram(g, w, n.toUnwrapped());

            var I = function I(i) {
              w.draw(g, v.TRIANGLES, s, i, l, e.CullFaceMode.disabled, S, o.id, a.layoutVertexBuffer, a.indexBuffer, a.segments, o.paint, t.transform.zoom, b, a.layoutVertexBuffer2);
            };

            if (y) {
              var _i247 = t.stencilModeForClipping(n).ref;
              0 === _i247 && t.terrain && g.clear({
                stencil: 0
              });
              var _o134 = {
                func: v.EQUAL,
                mask: 255
              };
              S.u_alpha_discard_threshold = .8, I(new e.StencilMode(_o134, _i247, 255, v.KEEP, v.KEEP, v.INVERT)), S.u_alpha_discard_threshold = 0, I(new e.StencilMode(_o134, _i247, 255, v.KEEP, v.KEEP, v.KEEP));
            } else I(t.stencilModeForClipping(n));
          };

          for (_iterator233.s(); !(_step233 = _iterator233.n()).done;) {
            var _ret5 = _loop11();

            if (_ret5 === "continue") continue;
          }
        } catch (err) {
          _iterator233.e(err);
        } finally {
          _iterator233.f();
        }

        y && (t.resetStencilClippingMasks(), t.terrain && g.clear({
          stencil: 0
        }));
      },
      fill: function fill(t, i, o, r) {
        var n = o.paint.get("fill-color"),
            a = o.paint.get("fill-opacity");
        if (0 === a.constantOr(1)) return;
        var s = t.colorModeForRenderPass(),
            l = o.paint.get("fill-pattern"),
            c = t.opaquePassEnabledForLayer() && !l.constantOr(1) && 1 === n.constantOr(e.Color.transparent).a && 1 === a.constantOr(0) ? "opaque" : "translucent";

        if (t.renderPass === c) {
          var _n183 = t.depthModeForSublayer(1, "opaque" === t.renderPass ? e.DepthMode.ReadWrite : e.DepthMode.ReadOnly);

          $i(t, i, o, r, _n183, s, !1);
        }

        if ("translucent" === t.renderPass && o.paint.get("fill-antialias")) {
          var _n184 = t.depthModeForSublayer(o.getPaintProperty("fill-outline-color") ? 2 : 0, e.DepthMode.ReadOnly);

          $i(t, i, o, r, _n184, s, !0);
        }
      },
      "fill-extrusion": function fillExtrusion(t, i, o, r) {
        var n = o.paint.get("fill-extrusion-opacity");

        if (0 !== n && "translucent" === t.renderPass) {
          var _a120 = new e.DepthMode(t.context.gl.LEQUAL, e.DepthMode.ReadWrite, t.depthRangeFor3D);

          if (1 !== n || o.paint.get("fill-extrusion-pattern").constantOr(1)) Hi(t, i, o, r, _a120, e.StencilMode.disabled, e.ColorMode.disabled), Hi(t, i, o, r, _a120, t.stencilModeFor3D(), t.colorModeForRenderPass()), t.resetStencilClippingMasks();else {
            var _n185 = t.colorModeForRenderPass();

            Hi(t, i, o, r, _a120, e.StencilMode.disabled, _n185);
          }
        }
      },
      hillshade: function hillshade(t, i, o, r) {
        if ("offscreen" !== t.renderPass && "translucent" !== t.renderPass) return;

        var n = t.context,
            a = t.depthModeForSublayer(0, e.DepthMode.ReadOnly),
            s = t.colorModeForRenderPass(),
            l = t.terrain && t.terrain.renderingToTexture,
            _ref178 = "translucent" !== t.renderPass || l ? [{}, r] : t.stencilConfigForOverlap(r),
            _ref179 = _slicedToArray(_ref178, 2),
            c = _ref179[0],
            h = _ref179[1];

        var _iterator234 = _createForOfIteratorHelper(h),
            _step234;

        try {
          for (_iterator234.s(); !(_step234 = _iterator234.n()).done;) {
            var _r275 = _step234.value;

            var _n186 = i.getTile(_r275);

            if (_n186.needsHillshadePrepare && "offscreen" === t.renderPass) Qt(t, _n186, o, a, e.StencilMode.disabled, s);else if ("translucent" === t.renderPass) {
              var _e399 = l && t.terrain ? t.terrain.stencilModeForRTTOverlap(_r275) : c[_r275.overscaledZ];

              Yt(t, _r275, _n186, o, a, _e399, s);
            }
          }
        } catch (err) {
          _iterator234.e(err);
        } finally {
          _iterator234.f();
        }

        n.viewport.set([0, 0, t.width, t.height]), t.resetStencilClippingMasks();
      },
      raster: function raster(t, i, o, r, n, a) {
        if ("translucent" !== t.renderPass) return;
        if (0 === o.paint.get("raster-opacity")) return;
        if (!r.length) return;

        var s = t.context,
            l = s.gl,
            c = i.getSource(),
            h = t.useProgram("raster"),
            u = t.colorModeForRenderPass(),
            _ = t.terrain && t.terrain.renderingToTexture,
            _ref180 = c instanceof be || _ ? [{}, r] : t.stencilConfigForOverlap(r),
            _ref181 = _slicedToArray(_ref180, 2),
            d = _ref181[0],
            p = _ref181[1],
            m = p[p.length - 1].overscaledZ,
            f = !t.options.moving;

        var _iterator235 = _createForOfIteratorHelper(p),
            _step235;

        try {
          for (_iterator235.s(); !(_step235 = _iterator235.n()).done;) {
            var _r276 = _step235.value;

            var _n187 = _ ? e.DepthMode.disabled : t.depthModeForSublayer(_r276.overscaledZ - m, 1 === o.paint.get("raster-opacity") ? e.DepthMode.ReadWrite : e.DepthMode.ReadOnly, l.LESS),
                _p38 = _r276.toUnwrapped(),
                _g20 = i.getTile(_r276);

            if (_ && (!_g20 || !_g20.hasData())) continue;

            var _v15 = _ ? _r276.projMatrix : t.transform.calculateProjMatrix(_p38, f),
                _x16 = t.terrain && _ ? t.terrain.stencilModeForRTTOverlap(_r276) : d[_r276.overscaledZ],
                _y16 = a ? 0 : o.paint.get("raster-fade-duration");

            _g20.registerFadeDuration(_y16);

            var _b17 = i.findLoadedParent(_r276, 0),
                _w15 = li(_g20, _b17, i, t.transform, _y16);

            var _T9 = void 0,
                _E5 = void 0;

            t.terrain && t.terrain.prepareDrawTile(_r276);

            var _C6 = "nearest" === o.paint.get("raster-resampling") ? l.NEAREST : l.LINEAR;

            s.activeTexture.set(l.TEXTURE0), _g20.texture.bind(_C6, l.CLAMP_TO_EDGE), s.activeTexture.set(l.TEXTURE1), _b17 ? (_b17.texture.bind(_C6, l.CLAMP_TO_EDGE), _T9 = Math.pow(2, _b17.tileID.overscaledZ - _g20.tileID.overscaledZ), _E5 = [_g20.tileID.canonical.x * _T9 % 1, _g20.tileID.canonical.y * _T9 % 1]) : _g20.texture.bind(_C6, l.CLAMP_TO_EDGE);

            var _M8 = Ai(_v15, _E5 || [0, 0], _T9 || 1, _w15, o, c instanceof be ? c.perspectiveTransform : [0, 0]);

            if (t.prepareDrawProgram(s, h, _p38), c instanceof be) h.draw(s, l.TRIANGLES, _n187, e.StencilMode.disabled, u, e.CullFaceMode.disabled, _M8, o.id, c.boundsBuffer, t.quadTriangleIndexBuffer, c.boundsSegments);else {
              var _t$getTileBoundsBuffe2 = t.getTileBoundsBuffers(_g20),
                  _i248 = _t$getTileBoundsBuffe2.tileBoundsBuffer,
                  _r277 = _t$getTileBoundsBuffe2.tileBoundsIndexBuffer,
                  _a121 = _t$getTileBoundsBuffe2.tileBoundsSegments;

              h.draw(s, l.TRIANGLES, _n187, _x16, u, e.CullFaceMode.disabled, _M8, o.id, _i248, _r277, _a121);
            }
          }
        } catch (err) {
          _iterator235.e(err);
        } finally {
          _iterator235.f();
        }

        t.resetStencilClippingMasks();
      },
      background: function background(t, i, o, r) {
        var n = o.paint.get("background-color"),
            a = o.paint.get("background-opacity");
        if (0 === a) return;
        var s = t.context,
            l = s.gl,
            c = t.transform,
            h = c.tileSize,
            u = o.paint.get("background-pattern");
        if (t.isPatternMissing(u)) return;

        var _ = !u && 1 === n.a && 1 === a && t.opaquePassEnabledForLayer() ? "opaque" : "translucent";

        if (t.renderPass !== _) return;
        var d = e.StencilMode.disabled,
            p = t.depthModeForSublayer(0, "opaque" === _ ? e.DepthMode.ReadWrite : e.DepthMode.ReadOnly),
            m = t.colorModeForRenderPass(),
            f = t.useProgram(u ? "backgroundPattern" : "background");
        var g,
            v = r;
        v || (g = t.getBackgroundTiles(), v = Object.values(g).map(function (e) {
          return e.tileID;
        })), u && (s.activeTexture.set(l.TEXTURE0), t.imageManager.bind(t.context));
        var x = o.getCrossfadeParameters();

        var _iterator236 = _createForOfIteratorHelper(v),
            _step236;

        try {
          for (_iterator236.s(); !(_step236 = _iterator236.n()).done;) {
            var _21 = _step236.value;

            var _v16 = _21.toUnwrapped(),
                _y17 = r ? _21.projMatrix : t.transform.calculateProjMatrix(_v16);

            t.prepareDrawTile(_21);

            var _b18 = i ? i.getTile(_21) : g ? g[_21.key] : new e.Tile(_21, h, c.zoom, t),
                _w16 = u ? Fi(_y17, a, t, u, {
              tileID: _21,
              tileSize: h
            }, x) : Bi(_y17, a, n);

            t.prepareDrawProgram(s, f, _v16);

            var _t$getTileBoundsBuffe3 = t.getTileBoundsBuffers(_b18),
                _T10 = _t$getTileBoundsBuffe3.tileBoundsBuffer,
                _E6 = _t$getTileBoundsBuffe3.tileBoundsIndexBuffer,
                _C7 = _t$getTileBoundsBuffe3.tileBoundsSegments;

            f.draw(s, l.TRIANGLES, p, d, m, e.CullFaceMode.disabled, _w16, o.id, _T10, _E6, _C7);
          }
        } catch (err) {
          _iterator236.e(err);
        } finally {
          _iterator236.f();
        }
      },
      sky: function sky(t, i, o) {
        var r = t.transform,
            n = "mercator" === r.projection.name || "globe" === r.projection.name ? 1 : e.smoothstep(7, 8, r.zoom),
            a = o.paint.get("sky-opacity") * n;
        if (0 === a) return;
        var s = t.context,
            l = o.paint.get("sky-type"),
            c = new e.DepthMode(s.gl.LEQUAL, e.DepthMode.ReadOnly, [0, 1]),
            h = t.frameCounter / 1e3 % 1;
        "atmosphere" === l ? "offscreen" === t.renderPass ? o.needsSkyboxCapture(t) && (function (t, i, o, r) {
          var n = t.context,
              a = n.gl;
          var s = i.skyboxFbo;

          if (!s) {
            s = i.skyboxFbo = n.createFramebuffer(32, 32, !1), i.skyboxGeometry = new co(n), i.skyboxTexture = n.gl.createTexture(), a.bindTexture(a.TEXTURE_CUBE_MAP, i.skyboxTexture), a.texParameteri(a.TEXTURE_CUBE_MAP, a.TEXTURE_WRAP_S, a.CLAMP_TO_EDGE), a.texParameteri(a.TEXTURE_CUBE_MAP, a.TEXTURE_WRAP_T, a.CLAMP_TO_EDGE), a.texParameteri(a.TEXTURE_CUBE_MAP, a.TEXTURE_MIN_FILTER, a.LINEAR), a.texParameteri(a.TEXTURE_CUBE_MAP, a.TEXTURE_MAG_FILTER, a.LINEAR);

            for (var _e400 = 0; _e400 < 6; ++_e400) {
              a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X + _e400, 0, a.RGBA, 32, 32, 0, a.RGBA, a.UNSIGNED_BYTE, null);
            }
          }

          n.bindFramebuffer.set(s.framebuffer), n.viewport.set([0, 0, 32, 32]);
          var l = i.getCenter(t, !0),
              c = t.useProgram("skyboxCapture"),
              h = new Float64Array(16);
          e.identity(h), e.rotateY(h, h, .5 * -Math.PI), ho(n, i, c, h, l, 0), e.identity(h), e.rotateY(h, h, .5 * Math.PI), ho(n, i, c, h, l, 1), e.identity(h), e.rotateX(h, h, .5 * -Math.PI), ho(n, i, c, h, l, 2), e.identity(h), e.rotateX(h, h, .5 * Math.PI), ho(n, i, c, h, l, 3), e.identity(h), ho(n, i, c, h, l, 4), e.identity(h), e.rotateY(h, h, Math.PI), ho(n, i, c, h, l, 5), n.viewport.set([0, 0, t.width, t.height]);
        }(t, o), o.markSkyboxValid(t)) : "sky" === t.renderPass && function (t, i, o, r, n) {
          var a = t.context,
              s = a.gl,
              l = t.transform,
              c = t.useProgram("skybox");
          a.activeTexture.set(s.TEXTURE0), s.bindTexture(s.TEXTURE_CUBE_MAP, i.skyboxTexture);

          var h = function (e, t, i, o, r) {
            return {
              u_matrix: e,
              u_sun_direction: t,
              u_cubemap: 0,
              u_opacity: o,
              u_temporal_offset: r
            };
          }(l.skyboxMatrix, i.getCenter(t, !1), 0, r, n);

          t.prepareDrawProgram(a, c), c.draw(a, s.TRIANGLES, o, e.StencilMode.disabled, t.colorModeForRenderPass(), e.CullFaceMode.backCW, h, "skybox", i.skyboxGeometry.vertexBuffer, i.skyboxGeometry.indexBuffer, i.skyboxGeometry.segment);
        }(t, o, c, a, h) : "gradient" === l && "sky" === t.renderPass && function (t, i, o, r, n) {
          var a = t.context,
              s = a.gl,
              l = t.transform,
              c = t.useProgram("skyboxGradient");
          i.skyboxGeometry || (i.skyboxGeometry = new co(a)), a.activeTexture.set(s.TEXTURE0);
          var h = i.colorRampTexture;
          h || (h = i.colorRampTexture = new e.Texture(a, i.colorRamp, s.RGBA)), h.bind(s.LINEAR, s.CLAMP_TO_EDGE);

          var u = function (t, i, o, r, n) {
            return {
              u_matrix: t,
              u_color_ramp: 0,
              u_center_direction: i,
              u_radius: e.degToRad(o),
              u_opacity: r,
              u_temporal_offset: n
            };
          }(l.skyboxMatrix, i.getCenter(t, !1), i.paint.get("sky-gradient-radius"), r, n);

          t.prepareDrawProgram(a, c), c.draw(a, s.TRIANGLES, o, e.StencilMode.disabled, t.colorModeForRenderPass(), e.CullFaceMode.backCW, u, "skyboxGradient", i.skyboxGeometry.vertexBuffer, i.skyboxGeometry.indexBuffer, i.skyboxGeometry.segment);
        }(t, o, c, a, h);
      },
      debug: function debug(e, t, i) {
        for (var _o135 = 0; _o135 < i.length; _o135++) {
          no(e, t, i[_o135]);
        }
      },
      custom: function custom(t, i, o) {
        var r = t.context,
            n = o.implementation;
        if (t.transform.projection.unsupportedLayers && t.transform.projection.unsupportedLayers.includes("custom")) e.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if ("offscreen" === t.renderPass) {
          var _e401 = n.prerender;
          _e401 && (t.setCustomLayerDefaults(), r.setColorMode(t.colorModeForRenderPass()), _e401.call(n, r.gl, t.transform.customLayerMatrix()), r.setDirty(), t.setBaseState());
        } else if ("translucent" === t.renderPass) {
          t.setCustomLayerDefaults(), r.setColorMode(t.colorModeForRenderPass()), r.setStencilMode(e.StencilMode.disabled);

          var _i249 = "3d" === n.renderingMode ? new e.DepthMode(t.context.gl.LEQUAL, e.DepthMode.ReadWrite, t.depthRangeFor3D) : t.depthModeForSublayer(0, e.DepthMode.ReadOnly);

          r.setDepthMode(_i249), n.render(r.gl, t.transform.customLayerMatrix()), r.setDirty(), t.setBaseState(), r.bindFramebuffer.set(null);
        }
      }
    };

    var _o = /*#__PURE__*/function () {
      function _o(t, i) {
        _classCallCheck(this, _o);

        this.context = new de(t), this.transform = i, this._tileTextures = {}, this.frameCopies = [], this.loadTimeStamps = [], this.setup(), this.numSublayers = e.SourceCache.maxUnderzooming + e.SourceCache.maxOverzooming + 1, this.depthEpsilon = 1 / Math.pow(2, 16), this.crossTileSymbolIndex = new Rt(), this.gpuTimers = {}, this.frameCounter = 0, this._backgroundTiles = {};
      }

      _createClass(_o, [{
        key: "updateTerrain",
        value: function updateTerrain(e, t) {
          var i = !!e && !!e.terrain && this.transform.projection.supportsTerrain;
          if (!(i || this._terrain && this._terrain.enabled)) return;
          this._terrain || (this._terrain = new _i(this, e));
          var o = this._terrain;
          this.transform.elevation = i ? o : null, o.update(e, this.transform, t);
        }
      }, {
        key: "_updateFog",
        value: function _updateFog(e) {
          var t = e.fog;
          if (!t || t.getOpacity(this.transform.pitch) < 1 || t.properties.get("horizon-blend") < .03) return void (this.transform.fogCullDistSq = null);

          var _t$getFovAdjustedRang = t.getFovAdjustedRange(this.transform._fov),
              _t$getFovAdjustedRang2 = _slicedToArray(_t$getFovAdjustedRang, 2),
              i = _t$getFovAdjustedRang2[0],
              o = _t$getFovAdjustedRang2[1];

          if (i > o) return void (this.transform.fogCullDistSq = null);
          var r = i + .78 * (o - i);
          this.transform.fogCullDistSq = r * r;
        }
      }, {
        key: "terrain",
        get: function get() {
          return this.transform._terrainEnabled() && this._terrain && this._terrain.enabled ? this._terrain : null;
        }
      }, {
        key: "resize",
        value: function resize(t, i) {
          if (this.width = t * e.exported.devicePixelRatio, this.height = i * e.exported.devicePixelRatio, this.context.viewport.set([0, 0, this.width, this.height]), this.style) {
            var _iterator237 = _createForOfIteratorHelper(this.style.order),
                _step237;

            try {
              for (_iterator237.s(); !(_step237 = _iterator237.n()).done;) {
                var _e402 = _step237.value;

                this.style._layers[_e402].resize();
              }
            } catch (err) {
              _iterator237.e(err);
            } finally {
              _iterator237.f();
            }
          }
        }
      }, {
        key: "setup",
        value: function setup() {
          var t = this.context,
              i = new e.StructArrayLayout2i4();
          i.emplaceBack(0, 0), i.emplaceBack(e.EXTENT, 0), i.emplaceBack(0, e.EXTENT), i.emplaceBack(e.EXTENT, e.EXTENT), this.tileExtentBuffer = t.createVertexBuffer(i, e.posAttributes.members), this.tileExtentSegments = e.SegmentVector.simpleSegment(0, 0, 4, 2);
          var o = new e.StructArrayLayout2i4();
          o.emplaceBack(0, 0), o.emplaceBack(e.EXTENT, 0), o.emplaceBack(0, e.EXTENT), o.emplaceBack(e.EXTENT, e.EXTENT), this.debugBuffer = t.createVertexBuffer(o, e.posAttributes.members), this.debugSegments = e.SegmentVector.simpleSegment(0, 0, 4, 5);
          var r = new e.StructArrayLayout2i4();
          r.emplaceBack(-1, -1), r.emplaceBack(1, -1), r.emplaceBack(-1, 1), r.emplaceBack(1, 1), this.viewportBuffer = t.createVertexBuffer(r, e.posAttributes.members), this.viewportSegments = e.SegmentVector.simpleSegment(0, 0, 4, 2);
          var n = new e.StructArrayLayout4i8();
          n.emplaceBack(0, 0, 0, 0), n.emplaceBack(e.EXTENT, 0, e.EXTENT, 0), n.emplaceBack(0, e.EXTENT, 0, e.EXTENT), n.emplaceBack(e.EXTENT, e.EXTENT, e.EXTENT, e.EXTENT), this.mercatorBoundsBuffer = t.createVertexBuffer(n, e.boundsAttributes.members), this.mercatorBoundsSegments = e.SegmentVector.simpleSegment(0, 0, 4, 2);
          var a = new e.StructArrayLayout3ui6();
          a.emplaceBack(0, 1, 2), a.emplaceBack(2, 1, 3), this.quadTriangleIndexBuffer = t.createIndexBuffer(a);
          var s = new e.StructArrayLayout1ui2();

          for (var _i250 = 0, _arr3 = [0, 1, 3, 2, 0]; _i250 < _arr3.length; _i250++) {
            var _e403 = _arr3[_i250];
            s.emplaceBack(_e403);
          }

          this.debugIndexBuffer = t.createIndexBuffer(s), this.emptyTexture = new e.Texture(t, {
            width: 1,
            height: 1,
            data: new Uint8Array([0, 0, 0, 0])
          }, t.gl.RGBA), this.identityMat = e.create();
          var l = this.context.gl;
          this.stencilClearMode = new e.StencilMode({
            func: l.ALWAYS,
            mask: 0
          }, 0, 255, l.ZERO, l.ZERO, l.ZERO), this.loadTimeStamps.push(e.window.performance.now());
        }
      }, {
        key: "getMercatorTileBoundsBuffers",
        value: function getMercatorTileBoundsBuffers() {
          return {
            tileBoundsBuffer: this.mercatorBoundsBuffer,
            tileBoundsIndexBuffer: this.quadTriangleIndexBuffer,
            tileBoundsSegments: this.mercatorBoundsSegments
          };
        }
      }, {
        key: "getTileBoundsBuffers",
        value: function getTileBoundsBuffers(e) {
          return e._makeTileBoundsBuffers(this.context, this.transform.projection), e._tileBoundsBuffer ? {
            tileBoundsBuffer: e._tileBoundsBuffer,
            tileBoundsIndexBuffer: e._tileBoundsIndexBuffer,
            tileBoundsSegments: e._tileBoundsSegments
          } : this.getMercatorTileBoundsBuffers();
        }
      }, {
        key: "clearStencil",
        value: function clearStencil() {
          var t = this.context,
              i = t.gl;
          this.nextStencilID = 1, this.currentStencilSource = void 0, this._tileClippingMaskIDs = {}, this.useProgram("clippingMask").draw(t, i.TRIANGLES, e.DepthMode.disabled, this.stencilClearMode, e.ColorMode.disabled, e.CullFaceMode.disabled, si(this.identityMat), "$clipping", this.viewportBuffer, this.quadTriangleIndexBuffer, this.viewportSegments);
        }
      }, {
        key: "resetStencilClippingMasks",
        value: function resetStencilClippingMasks() {
          this.terrain || (this.currentStencilSource = void 0, this._tileClippingMaskIDs = {});
        }
      }, {
        key: "_renderTileClippingMasks",
        value: function _renderTileClippingMasks(t, i, o) {
          if (!i || this.currentStencilSource === i.id || !t.isTileClipped() || !o || 0 === o.length) return;

          if (this._tileClippingMaskIDs && !this.terrain) {
            var _e404 = !1;

            var _iterator238 = _createForOfIteratorHelper(o),
                _step238;

            try {
              for (_iterator238.s(); !(_step238 = _iterator238.n()).done;) {
                var _t372 = _step238.value;

                if (void 0 === this._tileClippingMaskIDs[_t372.key]) {
                  _e404 = !0;
                  break;
                }
              }
            } catch (err) {
              _iterator238.e(err);
            } finally {
              _iterator238.f();
            }

            if (!_e404) return;
          }

          this.currentStencilSource = i.id;
          var r = this.context,
              n = r.gl;
          this.nextStencilID + o.length > 256 && this.clearStencil(), r.setColorMode(e.ColorMode.disabled), r.setDepthMode(e.DepthMode.disabled);
          var a = this.useProgram("clippingMask");
          this._tileClippingMaskIDs = {};

          var _iterator239 = _createForOfIteratorHelper(o),
              _step239;

          try {
            for (_iterator239.s(); !(_step239 = _iterator239.n()).done;) {
              var _t373 = _step239.value;

              var _o136 = i.getTile(_t373),
                  _s134 = this._tileClippingMaskIDs[_t373.key] = this.nextStencilID++,
                  _this$getTileBoundsBu = this.getTileBoundsBuffers(_o136),
                  _l75 = _this$getTileBoundsBu.tileBoundsBuffer,
                  _c50 = _this$getTileBoundsBu.tileBoundsIndexBuffer,
                  _h38 = _this$getTileBoundsBu.tileBoundsSegments;

              a.draw(r, n.TRIANGLES, e.DepthMode.disabled, new e.StencilMode({
                func: n.ALWAYS,
                mask: 0
              }, _s134, 255, n.KEEP, n.KEEP, n.REPLACE), e.ColorMode.disabled, e.CullFaceMode.disabled, si(_t373.projMatrix), "$clipping", _l75, _c50, _h38);
            }
          } catch (err) {
            _iterator239.e(err);
          } finally {
            _iterator239.f();
          }
        }
      }, {
        key: "stencilModeFor3D",
        value: function stencilModeFor3D() {
          this.currentStencilSource = void 0, this.nextStencilID + 1 > 256 && this.clearStencil();
          var t = this.nextStencilID++,
              i = this.context.gl;
          return new e.StencilMode({
            func: i.NOTEQUAL,
            mask: 255
          }, t, 255, i.KEEP, i.KEEP, i.REPLACE);
        }
      }, {
        key: "stencilModeForClipping",
        value: function stencilModeForClipping(t) {
          if (this.terrain) return this.terrain.stencilModeForRTTOverlap(t);
          var i = this.context.gl;
          return new e.StencilMode({
            func: i.EQUAL,
            mask: 255
          }, this._tileClippingMaskIDs[t.key], 0, i.KEEP, i.KEEP, i.REPLACE);
        }
      }, {
        key: "stencilConfigForOverlap",
        value: function stencilConfigForOverlap(t) {
          var i = this.context.gl,
              o = t.sort(function (e, t) {
            return t.overscaledZ - e.overscaledZ;
          }),
              r = o[o.length - 1].overscaledZ,
              n = o[0].overscaledZ - r + 1;

          if (n > 1) {
            this.currentStencilSource = void 0, this.nextStencilID + n > 256 && this.clearStencil();
            var _t374 = {};

            for (var _o137 = 0; _o137 < n; _o137++) {
              _t374[_o137 + r] = new e.StencilMode({
                func: i.GEQUAL,
                mask: 255
              }, _o137 + this.nextStencilID, 255, i.KEEP, i.KEEP, i.REPLACE);
            }

            return this.nextStencilID += n, [_t374, o];
          }

          return [_defineProperty({}, r, e.StencilMode.disabled), o];
        }
      }, {
        key: "colorModeForRenderPass",
        value: function colorModeForRenderPass() {
          var t = this.context.gl;

          if (this._showOverdrawInspector) {
            var _i251 = 1 / 8;

            return new e.ColorMode([t.CONSTANT_COLOR, t.ONE], new e.Color(_i251, _i251, _i251, 0), [!0, !0, !0, !0]);
          }

          return "opaque" === this.renderPass ? e.ColorMode.unblended : e.ColorMode.alphaBlended;
        }
      }, {
        key: "depthModeForSublayer",
        value: function depthModeForSublayer(t, i, o) {
          if (!this.opaquePassEnabledForLayer()) return e.DepthMode.disabled;
          var r = 1 - ((1 + this.currentLayer) * this.numSublayers + t) * this.depthEpsilon;
          return new e.DepthMode(o || this.context.gl.LEQUAL, i, [r, r]);
        }
      }, {
        key: "opaquePassEnabledForLayer",
        value: function opaquePassEnabledForLayer() {
          return this.currentLayer < this.opaquePassCutoff;
        }
      }, {
        key: "render",
        value: function render(t, i) {
          var _this108 = this;

          this.style = t, this.options = i, this.lineAtlas = t.lineAtlas, this.imageManager = t.imageManager, this.glyphManager = t.glyphManager, this.symbolFadeChange = t.placement.symbolFadeChange(e.exported.now()), this.imageManager.beginFrame();
          var o = this.style.order,
              r = this.style._sourceCaches;

          for (var _e405 in r) {
            var _t375 = r[_e405];
            _t375.used && _t375.prepare(this.context);
          }

          var n = {},
              a = {},
              s = {};

          for (var _e406 in r) {
            var _t376 = r[_e406];
            n[_e406] = _t376.getVisibleCoordinates(), a[_e406] = n[_e406].slice().reverse(), s[_e406] = _t376.getVisibleCoordinates(!0).reverse();
          }

          this.opaquePassCutoff = 1 / 0;

          for (var _e407 = 0; _e407 < o.length; _e407++) {
            if (this.style._layers[o[_e407]].is3D()) {
              this.opaquePassCutoff = _e407;
              break;
            }
          }

          if (this.terrain && (this.terrain.updateTileBinding(s), this.opaquePassCutoff = 0), "globe" !== this.transform.projection.name || this.globeSharedBuffers || (this.globeSharedBuffers = new e.GlobeSharedBuffers(this.context)), !e.isMapAuthenticated(this.context.gl)) return;
          this.renderPass = "offscreen";

          var _iterator240 = _createForOfIteratorHelper(o),
              _step240;

          try {
            for (_iterator240.s(); !(_step240 = _iterator240.n()).done;) {
              var _e411 = _step240.value;

              var _i256 = this.style._layers[_e411],
                  _o138 = t._getLayerSourceCache(_i256);

              if (!_i256.hasOffscreenPass() || _i256.isHidden(this.transform.zoom)) continue;

              var _r280 = _o138 ? a[_o138.id] : void 0;

              ("custom" === _i256.type || _i256.isSky() || _r280 && _r280.length) && this.renderLayer(this, _o138, _i256, _r280);
            }
          } catch (err) {
            _iterator240.e(err);
          } finally {
            _iterator240.f();
          }

          this.depthRangeFor3D = [0, 1 - (t.order.length + 2) * this.numSublayers * this.depthEpsilon], this.terrain && (this.style.hasSymbolLayers() || this.style.hasCircleLayers()) && this.terrain.drawDepth(), this.context.bindFramebuffer.set(null), this.context.viewport.set([0, 0, this.width, this.height]);
          var l = e.Color.transparent;
          if (this.style.fog && this.style.fog.getOpacity(this.transform.pitch) && (l = this.style.fog.properties.get("color")), this.context.clear({
            color: i.showOverdrawInspector ? e.Color.black : l,
            depth: 1
          }), this.clearStencil(), this._showOverdrawInspector = i.showOverdrawInspector, this.renderPass = "opaque", !this.terrain) for (this.currentLayer = o.length - 1; this.currentLayer >= 0; this.currentLayer--) {
            var _e408 = this.style._layers[o[this.currentLayer]],
                _i252 = t._getLayerSourceCache(_e408);

            if (_e408.isSky()) continue;

            var _r278 = _i252 ? a[_i252.id] : void 0;

            this._renderTileClippingMasks(_e408, _i252, _r278), this.renderLayer(this, _i252, _e408, _r278);
          }
          if (this.renderPass = "sky", (e.globeToMercatorTransition(this.transform.zoom) > 0 || "globe" !== this.transform.projection.name) && this.transform.isHorizonVisible()) for (this.currentLayer = 0; this.currentLayer < o.length; this.currentLayer++) {
            var _e409 = this.style._layers[o[this.currentLayer]],
                _i253 = t._getLayerSourceCache(_e409);

            _e409.isSky() && this.renderLayer(this, _i253, _e409, _i253 ? a[_i253.id] : void 0);
          }

          for ("globe" === this.transform.projection.name && function (t) {
            var i = t.context,
                o = i.gl,
                r = t.transform,
                n = new e.DepthMode(o.LEQUAL, e.DepthMode.ReadOnly, [0, 1]),
                a = t.useProgram("globeAtmosphere"),
                s = r._camera.getWorldToCamera(r.worldSize, 1),
                l = r._camera.getCameraToClipPerspective(r._fov, r.width / r.height, r._nearZ, r._farZ),
                c = e.mul([], s, e.calculateGlobeMatrix(r, r.worldSize)),
                h = e.mul([], r.labelPlaneMatrix, l),
                u = e.transformMat4([], [0, 0, 0], c),
                _ = e.add([], u, [r.worldSize / Math.PI / 2, 0, 0]),
                d = e.transformMat4([], u, h),
                p = e.transformMat4([], _, h),
                m = e.length(e.sub([], p, d)),
                f = 1 - e.globeToMercatorTransition(r.zoom),
                g = {
              u_center: d,
              u_radius: m,
              u_screen_size: [r.width, r.height],
              u_pixel_ratio: e.exported.devicePixelRatio,
              u_opacity: f,
              u_fadeout_range: 2,
              u_start_color: [1, 1, 1],
              u_end_color: [.0118, .7451, .9882]
            };

            t.prepareDrawProgram(i, a);
            var v = t.globeSharedBuffers;
            v && a.draw(i, o.TRIANGLES, n, e.StencilMode.disabled, e.ColorMode.alphaBlended, e.CullFaceMode.backCW, g, "skybox", v.atmosphereVertexBuffer, v.atmosphereIndexBuffer, v.atmosphereSegments);
          }(this), this.renderPass = "translucent", this.currentLayer = 0; this.currentLayer < o.length;) {
            var _e410 = this.style._layers[o[this.currentLayer]],
                _i254 = t._getLayerSourceCache(_e410);

            if (_e410.isSky()) {
              ++this.currentLayer;
              continue;
            }

            if (this.terrain && this.style.isLayerDraped(_e410)) {
              if (_e410.isHidden(this.transform.zoom)) {
                ++this.currentLayer;
                continue;
              }

              this.currentLayer = this.terrain.renderBatch(this.currentLayer);
              continue;
            }

            var _r279 = _i254 ? ("symbol" === _e410.type ? s : a)[_i254.id] : void 0;

            this._renderTileClippingMasks(_e410, _i254, _i254 ? n[_i254.id] : void 0), this.renderLayer(this, _i254, _e410, _r279), ++this.currentLayer;
          }

          if (this.terrain && this.terrain.postRender(), this.options.showTileBoundaries || this.options.showQueryGeometry) {
            var _i255 = null;
            e.values(this.style._layers).forEach(function (e) {
              var o = t._getLayerSourceCache(e);

              o && !e.isHidden(_this108.transform.zoom) && (!_i255 || _i255.getSource().maxzoom < o.getSource().maxzoom) && (_i255 = o);
            }), _i255 && this.options.showTileBoundaries && uo.debug(this, _i255, _i255.getVisibleCoordinates());
          }

          this.options.showPadding && function (e) {
            var t = e.transform.padding;
            io(e, e.transform.height - (t.top || 0), 3, Yi), io(e, t.bottom || 0, 3, Ji), oo(e, t.left || 0, 3, Qi), oo(e, e.transform.width - (t.right || 0), 3, eo);
            var i = e.transform.centerPoint;
            !function (e, t, i, o) {
              ro(e, t - 1, i - 10, 2, 20, o), ro(e, t - 10, i - 1, 20, 2, o);
            }(e, i.x, e.transform.height - i.y, to);
          }(this), this.context.setDefault(), this.frameCounter = (this.frameCounter + 1) % Number.MAX_SAFE_INTEGER, this.tileLoaded && this.options.speedIndexTiming && (this.loadTimeStamps.push(e.window.performance.now()), this.saveCanvasCopy());
        }
      }, {
        key: "renderLayer",
        value: function renderLayer(e, t, i, o) {
          i.isHidden(this.transform.zoom) || ("background" === i.type || "sky" === i.type || "custom" === i.type || o && o.length) && (this.id = i.id, this.gpuTimingStart(i), e.transform.projection.unsupportedLayers && e.transform.projection.unsupportedLayers.includes(i.type) || uo[i.type](e, t, i, o, this.style.placement.variableOffsets, this.options.isInitialLoad), this.gpuTimingEnd());
        }
      }, {
        key: "gpuTimingStart",
        value: function gpuTimingStart(e) {
          if (!this.options.gpuTiming) return;
          var t = this.context.extTimerQuery;
          var i = this.gpuTimers[e.id];
          i || (i = this.gpuTimers[e.id] = {
            calls: 0,
            cpuTime: 0,
            query: t.createQueryEXT()
          }), i.calls++, t.beginQueryEXT(t.TIME_ELAPSED_EXT, i.query);
        }
      }, {
        key: "gpuTimingEnd",
        value: function gpuTimingEnd() {
          if (!this.options.gpuTiming) return;
          var e = this.context.extTimerQuery;
          e.endQueryEXT(e.TIME_ELAPSED_EXT);
        }
      }, {
        key: "collectGpuTimers",
        value: function collectGpuTimers() {
          var e = this.gpuTimers;
          return this.gpuTimers = {}, e;
        }
      }, {
        key: "queryGpuTimers",
        value: function queryGpuTimers(e) {
          var t = {};

          for (var _i257 in e) {
            var _o139 = e[_i257],
                _r281 = this.context.extTimerQuery,
                _n188 = _r281.getQueryObjectEXT(_o139.query, _r281.QUERY_RESULT_EXT) / 1e6;

            _r281.deleteQueryEXT(_o139.query), t[_i257] = _n188;
          }

          return t;
        }
      }, {
        key: "translatePosMatrix",
        value: function translatePosMatrix(t, i, o, r, n) {
          if (!o[0] && !o[1]) return t;
          var a = n ? "map" === r ? this.transform.angle : 0 : "viewport" === r ? -this.transform.angle : 0;

          if (a) {
            var _e412 = Math.sin(a),
                _t377 = Math.cos(a);

            o = [o[0] * _t377 - o[1] * _e412, o[0] * _e412 + o[1] * _t377];
          }

          var s = [n ? o[0] : M(i, o[0], this.transform.zoom), n ? o[1] : M(i, o[1], this.transform.zoom), 0],
              l = new Float32Array(16);
          return e.translate(l, t, s), l;
        }
      }, {
        key: "saveTileTexture",
        value: function saveTileTexture(e) {
          var t = this._tileTextures[e.size[0]];
          t ? t.push(e) : this._tileTextures[e.size[0]] = [e];
        }
      }, {
        key: "getTileTexture",
        value: function getTileTexture(e) {
          var t = this._tileTextures[e];
          return t && t.length > 0 ? t.pop() : null;
        }
      }, {
        key: "isPatternMissing",
        value: function isPatternMissing(e) {
          if (!e) return !1;
          if (!e.from || !e.to) return !0;
          var t = this.imageManager.getPattern(e.from.toString()),
              i = this.imageManager.getPattern(e.to.toString());
          return !t || !i;
        }
      }, {
        key: "currentGlobalDefines",
        value: function currentGlobalDefines() {
          var e = this.terrain && this.terrain.renderingToTexture,
              t = this.style && this.style.fog,
              i = [];
          return this.terrain && !this.terrain.renderingToTexture && i.push("TERRAIN"), t && !e && 0 !== t.getOpacity(this.transform.pitch) && i.push("FOG"), e && i.push("RENDER_TO_TEXTURE"), this._showOverdrawInspector && i.push("OVERDRAW_INSPECTOR"), i;
        }
      }, {
        key: "useProgram",
        value: function useProgram(e, t, i) {
          this.cache = this.cache || {};
          var o = i || [],
              r = this.currentGlobalDefines().concat(o),
              n = pi.cacheKey(e, r, t);
          return this.cache[n] || (this.cache[n] = new pi(this.context, e, Xt[e], t, Ui[e], r)), this.cache[n];
        }
      }, {
        key: "setCustomLayerDefaults",
        value: function setCustomLayerDefaults() {
          this.context.unbindVAO(), this.context.cullFace.setDefault(), this.context.frontFace.setDefault(), this.context.cullFaceSide.setDefault(), this.context.activeTexture.setDefault(), this.context.pixelStoreUnpack.setDefault(), this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(), this.context.pixelStoreUnpackFlipY.setDefault();
        }
      }, {
        key: "setBaseState",
        value: function setBaseState() {
          var e = this.context.gl;
          this.context.cullFace.set(!1), this.context.viewport.set([0, 0, this.width, this.height]), this.context.blendEquation.set(e.FUNC_ADD);
        }
      }, {
        key: "initDebugOverlayCanvas",
        value: function initDebugOverlayCanvas() {
          null == this.debugOverlayCanvas && (this.debugOverlayCanvas = e.window.document.createElement("canvas"), this.debugOverlayCanvas.width = 512, this.debugOverlayCanvas.height = 512, this.debugOverlayTexture = new e.Texture(this.context, this.debugOverlayCanvas, this.context.gl.RGBA));
        }
      }, {
        key: "destroy",
        value: function destroy() {
          this._terrain && this._terrain.destroy(), this.globeSharedBuffers && this.globeSharedBuffers.destroy(), this.emptyTexture.destroy(), this.debugOverlayTexture && this.debugOverlayTexture.destroy();
        }
      }, {
        key: "prepareDrawTile",
        value: function prepareDrawTile(e) {
          this.terrain && this.terrain.prepareDrawTile(e);
        }
      }, {
        key: "prepareDrawProgram",
        value: function prepareDrawProgram(e, t, i) {
          if (this.terrain && this.terrain.renderingToTexture) return;
          var o = this.style.fog;

          if (o) {
            var _r282 = o.getOpacity(this.transform.pitch);

            0 !== _r282 && t.setFogUniformValues(e, function (e, t, i, o) {
              var r = t.properties.get("color"),
                  n = e.frameCounter / 1e3 % 1,
                  a = [r.r / r.a, r.g / r.a, r.b / r.a, o];
              return {
                u_fog_matrix: i ? e.transform.calculateFogTileMatrix(i) : e.identityMat,
                u_fog_range: t.getFovAdjustedRange(e.transform._fov),
                u_fog_color: a,
                u_fog_horizon_blend: t.properties.get("horizon-blend"),
                u_fog_temporal_offset: n
              };
            }(this, o, i, _r282));
          }
        }
      }, {
        key: "setTileLoadedFlag",
        value: function setTileLoadedFlag(e) {
          this.tileLoaded = e;
        }
      }, {
        key: "saveCanvasCopy",
        value: function saveCanvasCopy() {
          this.frameCopies.push(this.canvasCopy()), this.tileLoaded = !1;
        }
      }, {
        key: "canvasCopy",
        value: function canvasCopy() {
          var e = this.context.gl,
              t = e.createTexture();
          return e.bindTexture(e.TEXTURE_2D, t), e.copyTexImage2D(e.TEXTURE_2D, 0, e.RGBA, 0, 0, e.drawingBufferWidth, e.drawingBufferHeight, 0), t;
        }
      }, {
        key: "getCanvasCopiesAndTimestamps",
        value: function getCanvasCopiesAndTimestamps() {
          return {
            canvasCopies: this.frameCopies,
            timeStamps: this.loadTimeStamps
          };
        }
      }, {
        key: "averageElevationNeedsEasing",
        value: function averageElevationNeedsEasing() {
          if (!this.transform._elevation) return !1;
          var e = this.style && this.style.fog;
          return !!e && 0 !== e.getOpacity(this.transform.pitch);
        }
      }, {
        key: "getBackgroundTiles",
        value: function getBackgroundTiles() {
          var t = this._backgroundTiles,
              i = this._backgroundTiles = {},
              o = this.transform.coveringTiles({
            tileSize: 512
          });

          var _iterator241 = _createForOfIteratorHelper(o),
              _step241;

          try {
            for (_iterator241.s(); !(_step241 = _iterator241.n()).done;) {
              var _r283 = _step241.value;
              i[_r283.key] = t[_r283.key] || new e.Tile(_r283, 512, this.transform.tileZoom, this);
            }
          } catch (err) {
            _iterator241.e(err);
          } finally {
            _iterator241.f();
          }

          return i;
        }
      }, {
        key: "clearBackgroundTiles",
        value: function clearBackgroundTiles() {
          this._backgroundTiles = {};
        }
      }]);

      return _o;
    }();

    var po = /*#__PURE__*/function () {
      function po() {
        var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
        var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
        var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
        var o = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;

        _classCallCheck(this, po);

        if (isNaN(e) || e < 0 || isNaN(t) || t < 0 || isNaN(i) || i < 0 || isNaN(o) || o < 0) throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");
        this.top = e, this.bottom = t, this.left = i, this.right = o;
      }

      _createClass(po, [{
        key: "interpolate",
        value: function interpolate(t, i, o) {
          return null != i.top && null != t.top && (this.top = e.number(t.top, i.top, o)), null != i.bottom && null != t.bottom && (this.bottom = e.number(t.bottom, i.bottom, o)), null != i.left && null != t.left && (this.left = e.number(t.left, i.left, o)), null != i.right && null != t.right && (this.right = e.number(t.right, i.right, o)), this;
        }
      }, {
        key: "getCenter",
        value: function getCenter(t, i) {
          var o = e.clamp((this.left + t - this.right) / 2, 0, t),
              r = e.clamp((this.top + i - this.bottom) / 2, 0, i);
          return new e.pointGeometry(o, r);
        }
      }, {
        key: "equals",
        value: function equals(e) {
          return this.top === e.top && this.bottom === e.bottom && this.left === e.left && this.right === e.right;
        }
      }, {
        key: "clone",
        value: function clone() {
          return new po(this.top, this.bottom, this.left, this.right);
        }
      }, {
        key: "toJSON",
        value: function toJSON() {
          return {
            top: this.top,
            bottom: this.bottom,
            left: this.left,
            right: this.right
          };
        }
      }]);

      return po;
    }();

    function mo(t, i) {
      var o = e.getColumn(t, 3);
      e.fromQuat(t, i), e.setColumn(t, 3, o);
    }

    function fo(t, i) {
      e.setColumn(t, 3, [i[0], i[1], i[2], 1]);
    }

    function go(t, i) {
      var o = e.identity$1([]);
      return e.rotateZ$1(o, o, -i), e.rotateX$1(o, o, -t), o;
    }

    function vo(t, i) {
      var o = [t[0], t[1], 0],
          r = [i[0], i[1], 0];

      if (e.length(o) >= 1e-15) {
        var _t378 = e.normalize([], o);

        e.scale$2(r, _t378, e.dot(r, _t378)), i[0] = r[0], i[1] = r[1];
      }

      var n = e.cross([], i, t);
      if (e.len(n) < 1e-15) return null;
      var a = Math.atan2(-n[1], n[0]);
      return go(Math.atan2(Math.sqrt(t[0] * t[0] + t[1] * t[1]), -t[2]), a);
    }

    var xo = /*#__PURE__*/function () {
      function xo(e, t) {
        _classCallCheck(this, xo);

        this.position = e, this.orientation = t;
      }

      _createClass(xo, [{
        key: "position",
        get: function get() {
          return this._position;
        },
        set: function set(t) {
          this._position = this._renderWorldCopies ? function (t) {
            if (!t) return;
            var i = Array.isArray(t) ? new e.MercatorCoordinate(t[0], t[1], t[2]) : t;
            return i.x = e.wrap(i.x, 0, 1), i;
          }(t) : t;
        }
      }, {
        key: "lookAtPoint",
        value: function lookAtPoint(t, i) {
          if (this.orientation = null, !this.position) return;
          var o = this._elevation ? this._elevation.getAtPointOrZero(e.MercatorCoordinate.fromLngLat(t)) : 0,
              r = this.position,
              n = e.MercatorCoordinate.fromLngLat(t, o),
              a = [n.x - r.x, n.y - r.y, n.z - r.z];
          i || (i = [0, 0, 1]), i[2] = Math.abs(i[2]), this.orientation = vo(a, i);
        }
      }, {
        key: "setPitchBearing",
        value: function setPitchBearing(t, i) {
          this.orientation = go(e.degToRad(t), e.degToRad(-i));
        }
      }]);

      return xo;
    }();

    var yo = /*#__PURE__*/function () {
      function yo(t, i) {
        _classCallCheck(this, yo);

        this._transform = e.identity([]), this._orientation = e.identity$1([]), i && (this._orientation = i, mo(this._transform, this._orientation)), t && fo(this._transform, t);
      }

      _createClass(yo, [{
        key: "mercatorPosition",
        get: function get() {
          var t = this.position;
          return new e.MercatorCoordinate(t[0], t[1], t[2]);
        }
      }, {
        key: "position",
        get: function get() {
          var t = e.getColumn(this._transform, 3);
          return [t[0], t[1], t[2]];
        },
        set: function set(e) {
          fo(this._transform, e);
        }
      }, {
        key: "orientation",
        get: function get() {
          return this._orientation;
        },
        set: function set(e) {
          this._orientation = e, mo(this._transform, this._orientation);
        }
      }, {
        key: "getPitchBearing",
        value: function getPitchBearing() {
          var e = this.forward(),
              t = this.right();
          return {
            bearing: Math.atan2(-t[1], t[0]),
            pitch: Math.atan2(Math.sqrt(e[0] * e[0] + e[1] * e[1]), -e[2])
          };
        }
      }, {
        key: "setPitchBearing",
        value: function setPitchBearing(e, t) {
          this._orientation = go(e, t), mo(this._transform, this._orientation);
        }
      }, {
        key: "forward",
        value: function forward() {
          var t = e.getColumn(this._transform, 2);
          return [-t[0], -t[1], -t[2]];
        }
      }, {
        key: "up",
        value: function up() {
          var t = e.getColumn(this._transform, 1);
          return [-t[0], -t[1], -t[2]];
        }
      }, {
        key: "right",
        value: function right() {
          var t = e.getColumn(this._transform, 0);
          return [t[0], t[1], t[2]];
        }
      }, {
        key: "getCameraToWorld",
        value: function getCameraToWorld(t, i) {
          var o = new Float64Array(16);
          return e.invert(o, this.getWorldToCamera(t, i)), o;
        }
      }, {
        key: "getWorldToCameraPosition",
        value: function getWorldToCameraPosition(t, i, o) {
          var r = this.position;
          e.scale$2(r, r, -t);
          var n = new Float64Array(16);
          return e.fromScaling(n, [o, o, o]), e.translate(n, n, r), n[10] *= i, n;
        }
      }, {
        key: "getWorldToCamera",
        value: function getWorldToCamera(t, i) {
          var o = new Float64Array(16),
              r = new Float64Array(4),
              n = this.position;
          return e.conjugate(r, this._orientation), e.scale$2(n, n, -t), e.fromQuat(o, r), e.translate(o, o, n), o[1] *= -1, o[5] *= -1, o[9] *= -1, o[13] *= -1, o[8] *= i, o[9] *= i, o[10] *= i, o[11] *= i, o;
        }
      }, {
        key: "getCameraToClipPerspective",
        value: function getCameraToClipPerspective(t, i, o, r) {
          var n = new Float64Array(16);
          return e.perspective(n, t, i, o, r), n;
        }
      }, {
        key: "getDistanceToElevation",
        value: function getDistanceToElevation(t) {
          var i = 0 === t ? 0 : e.mercatorZfromAltitude(t, this.position[1]),
              o = this.forward();
          return (i - this.position[2]) / o[2];
        }
      }, {
        key: "clone",
        value: function clone() {
          return new yo(_toConsumableArray(this.position), _toConsumableArray(this.orientation));
        }
      }]);

      return yo;
    }();

    function bo(t, i) {
      var o = To(t),
          r = function (t, i, o, r, n) {
        var a = new e.LngLat(o.lng - 180 * Eo, o.lat),
            s = new e.LngLat(o.lng + 180 * Eo, o.lat),
            l = t.project(a.lng, a.lat),
            c = t.project(s.lng, s.lat),
            h = -Math.atan2(c.y - l.y, c.x - l.x),
            u = e.MercatorCoordinate.fromLngLat(o);
        u.y = e.clamp(u.y, -.999975, .999975);

        var _ = u.toLngLat(),
            d = t.project(_.lng, _.lat),
            p = e.MercatorCoordinate.fromLngLat(_);

        p.x += Eo;
        var m = p.toLngLat(),
            f = t.project(m.lng, m.lat),
            g = Mo(f.x - d.x, f.y - d.y, h),
            v = e.MercatorCoordinate.fromLngLat(_);
        v.y += Eo;
        var x = v.toLngLat(),
            y = t.project(x.lng, x.lat),
            b = Mo(y.x - d.x, y.y - d.y, h),
            w = Math.abs(g.x) / Math.abs(b.y),
            T = e.identity([]);
        e.rotateZ(T, T, -h * (1 - (n ? 0 : r)));
        var E = e.identity([]);
        return e.scale(E, E, [1, 1 - (1 - w) * r, 1]), E[4] = -b.x / b.y * r, e.rotateZ(E, E, h), e.multiply$1(E, T, E), E;
      }(t.projection, 0, t.center, o, i),
          n = wo(t);

      return e.scale(r, r, [n, n, 1]), r;
    }

    function wo(t) {
      var i = t.projection,
          o = To(t),
          r = Co(i, t.center),
          n = Co(i, e.LngLat.convert(i.center));
      return Math.pow(2, r * o + (1 - o) * n);
    }

    function To(t) {
      var i = t.projection.range;
      if (!i) return 0;
      var o = Math.max(t.width, t.height),
          r = Math.log(o / 1024) / Math.LN2;
      return e.smoothstep(i[0] + r, i[1] + r, t.zoom);
    }

    var Eo = 1 / 4e4;

    function Co(t, i) {
      var o = e.clamp(i.lat, -e.MAX_MERCATOR_LATITUDE, e.MAX_MERCATOR_LATITUDE),
          r = new e.LngLat(i.lng - 180 * Eo, o),
          n = new e.LngLat(i.lng + 180 * Eo, o),
          a = t.project(r.lng, o),
          s = t.project(n.lng, o),
          l = e.MercatorCoordinate.fromLngLat(r),
          c = e.MercatorCoordinate.fromLngLat(n),
          h = s.x - a.x,
          u = s.y - a.y,
          _ = c.x - l.x,
          d = c.y - l.y,
          p = Math.sqrt((_ * _ + d * d) / (h * h + u * u));

      return Math.log(p) / Math.LN2;
    }

    function Mo(e, t, i) {
      var o = Math.cos(i),
          r = Math.sin(i);
      return {
        x: e * o - t * r,
        y: e * r + t * o
      };
    }

    var So = /*#__PURE__*/function () {
      function So(t, i, o, r, n) {
        _classCallCheck(this, So);

        this.tileSize = 512, this._renderWorldCopies = void 0 === n || n, this._minZoom = t || 0, this._maxZoom = i || 22, this._minPitch = null == o ? 0 : o, this._maxPitch = null == r ? 60 : r, this.setProjection(), this.setMaxBounds(), this.width = 0, this.height = 0, this._center = new e.LngLat(0, 0), this.zoom = 0, this.angle = 0, this._fov = .6435011087932844, this._pitch = 0, this._nearZ = 0, this._farZ = 0, this._unmodified = !0, this._edgeInsets = new po(), this._projMatrixCache = {}, this._alignedProjMatrixCache = {}, this._fogTileMatrixCache = {}, this._distanceTileDataCache = {}, this._camera = new yo(), this._centerAltitude = 0, this._averageElevation = 0, this.cameraElevationReference = "ground", this._projectionScaler = 1, this._horizonShift = .1;
      }

      _createClass(So, [{
        key: "clone",
        value: function clone() {
          var e = new So(this._minZoom, this._maxZoom, this._minPitch, this.maxPitch, this._renderWorldCopies);
          return e.setProjection(this.getProjection()), e._elevation = this._elevation, e._centerAltitude = this._centerAltitude, e.tileSize = this.tileSize, e.setMaxBounds(this.getMaxBounds()), e.width = this.width, e.height = this.height, e.cameraElevationReference = this.cameraElevationReference, e._center = this._center, e._setZoom(this.zoom), e._cameraZoom = this._cameraZoom, e.angle = this.angle, e._fov = this._fov, e._pitch = this._pitch, e._nearZ = this._nearZ, e._farZ = this._farZ, e._averageElevation = this._averageElevation, e._unmodified = this._unmodified, e._edgeInsets = this._edgeInsets.clone(), e._camera = this._camera.clone(), e._calcMatrices(), e.freezeTileCoverage = this.freezeTileCoverage, e;
        }
      }, {
        key: "elevation",
        get: function get() {
          return this._elevation;
        },
        set: function set(e) {
          this._elevation !== e && (this._elevation = e, e ? this._updateCenterElevation() && this._updateCameraOnTerrain() : (this._cameraZoom = null, this._centerAltitude = 0), this._calcMatrices());
        }
      }, {
        key: "updateElevation",
        value: function updateElevation(e) {
          this._terrainEnabled() && null == this._cameraZoom && this._updateCenterElevation() && this._updateCameraOnTerrain(), e && this._constrainCameraAltitude(), this._calcMatrices();
        }
      }, {
        key: "getProjection",
        value: function getProjection() {
          return e.pick(this.projection, ["name", "center", "parallels"]);
        }
      }, {
        key: "setProjection",
        value: function setProjection(t) {
          null == t && (t = {
            name: "mercator"
          }), this.projectionOptions = t;
          var i = this.projection ? this.getProjection() : void 0;
          return this.projection = e.getProjection(t), !n(i, this.getProjection()) && (this._calcMatrices(), !0);
        }
      }, {
        key: "minZoom",
        get: function get() {
          return this._minZoom;
        },
        set: function set(e) {
          this._minZoom !== e && (this._minZoom = e, this.zoom = Math.max(this.zoom, e));
        }
      }, {
        key: "maxZoom",
        get: function get() {
          return this._maxZoom;
        },
        set: function set(e) {
          this._maxZoom !== e && (this._maxZoom = e, this.zoom = Math.min(this.zoom, e));
        }
      }, {
        key: "minPitch",
        get: function get() {
          return this._minPitch;
        },
        set: function set(e) {
          this._minPitch !== e && (this._minPitch = e, this.pitch = Math.max(this.pitch, e));
        }
      }, {
        key: "maxPitch",
        get: function get() {
          return this._maxPitch;
        },
        set: function set(e) {
          this._maxPitch !== e && (this._maxPitch = e, this.pitch = Math.min(this.pitch, e));
        }
      }, {
        key: "renderWorldCopies",
        get: function get() {
          return this._renderWorldCopies && !0 === this.projection.supportsWorldCopies;
        },
        set: function set(e) {
          void 0 === e ? e = !0 : null === e && (e = !1), this._renderWorldCopies = e;
        }
      }, {
        key: "worldSize",
        get: function get() {
          return this.tileSize * this.scale;
        }
      }, {
        key: "cameraWorldSize",
        get: function get() {
          var e = Math.max(this._camera.getDistanceToElevation(this._averageElevation), Number.EPSILON);
          return this._worldSizeFromZoom(this._zoomFromMercatorZ(e));
        }
      }, {
        key: "pixelsPerMeter",
        get: function get() {
          return this.projection.pixelsPerMeter(this.center.lat, this.worldSize);
        }
      }, {
        key: "cameraPixelsPerMeter",
        get: function get() {
          return this.projection.pixelsPerMeter(this.center.lat, this.cameraWorldSize);
        }
      }, {
        key: "centerOffset",
        get: function get() {
          return this.centerPoint._sub(this.size._div(2));
        }
      }, {
        key: "size",
        get: function get() {
          return new e.pointGeometry(this.width, this.height);
        }
      }, {
        key: "bearing",
        get: function get() {
          return e.wrap(this.rotation, -180, 180);
        },
        set: function set(e) {
          this.rotation = e;
        }
      }, {
        key: "rotation",
        get: function get() {
          return -this.angle / Math.PI * 180;
        },
        set: function set(t) {
          var i = -t * Math.PI / 180;
          var o;
          this.angle !== i && (this._unmodified = !1, this.angle = i, this._calcMatrices(), this.rotationMatrix = (o = new e.ARRAY_TYPE(4), e.ARRAY_TYPE != Float32Array && (o[1] = 0, o[2] = 0), o[0] = 1, o[3] = 1, o), function (e, t, i) {
            var o = t[0],
                r = t[1],
                n = t[2],
                a = t[3],
                s = Math.sin(i),
                l = Math.cos(i);
            e[0] = o * l + n * s, e[1] = r * l + a * s, e[2] = o * -s + n * l, e[3] = r * -s + a * l;
          }(this.rotationMatrix, this.rotationMatrix, this.angle));
        }
      }, {
        key: "pitch",
        get: function get() {
          return this._pitch / Math.PI * 180;
        },
        set: function set(t) {
          var i = e.clamp(t, this.minPitch, this.maxPitch) / 180 * Math.PI;
          this._pitch !== i && (this._unmodified = !1, this._pitch = i, this._calcMatrices());
        }
      }, {
        key: "fov",
        get: function get() {
          return this._fov / Math.PI * 180;
        },
        set: function set(e) {
          e = Math.max(.01, Math.min(60, e)), this._fov !== e && (this._unmodified = !1, this._fov = e / 180 * Math.PI, this._calcMatrices());
        }
      }, {
        key: "averageElevation",
        get: function get() {
          return this._averageElevation;
        },
        set: function set(e) {
          this._averageElevation = e, this._calcFogMatrices();
        }
      }, {
        key: "zoom",
        get: function get() {
          return this._zoom;
        },
        set: function set(e) {
          var t = Math.min(Math.max(e, this.minZoom), this.maxZoom);
          this._zoom !== t && (this._unmodified = !1, this._setZoom(t), this._terrainEnabled() && this._updateCameraOnTerrain(), this._constrain(), this._calcMatrices());
        }
      }, {
        key: "_setZoom",
        value: function _setZoom(e) {
          this._zoom = e, this.scale = this.zoomScale(e), this.tileZoom = Math.floor(e), this.zoomFraction = e - this.tileZoom;
        }
      }, {
        key: "_updateCenterElevation",
        value: function _updateCenterElevation() {
          if (!this._elevation) return !1;

          var e = this._elevation.getAtPointOrZero(this.locationCoordinate(this.center), -1);

          return -1 === e ? (this._cameraZoom = null, !1) : (this._centerAltitude = e, !0);
        }
      }, {
        key: "_updateCameraOnTerrain",
        value: function _updateCameraOnTerrain() {
          this._cameraZoom = this._zoomFromMercatorZ((this.pixelsPerMeter * this._centerAltitude + this.cameraToCenterDistance) / this.worldSize);
        }
      }, {
        key: "sampleAverageElevation",
        value: function sampleAverageElevation() {
          if (!this._elevation) return 0;
          var t = this._elevation,
              i = [[.5, .2], [.3, .5], [.5, .5], [.7, .5], [.5, .8]],
              o = this.horizonLineFromTop();
          var r = 0,
              n = 0;

          for (var _a122 = 0; _a122 < i.length; _a122++) {
            var _s135 = new e.pointGeometry(i[_a122][0] * this.width, o + i[_a122][1] * (this.height - o)),
                _l76 = t.pointCoordinate(_s135);

            if (!_l76) continue;

            var _c51 = 1 / Math.hypot(_l76[0] - this._camera.position[0], _l76[1] - this._camera.position[1]);

            r += _l76[3] * _c51, n += _c51;
          }

          return 0 === n ? NaN : r / n;
        }
      }, {
        key: "center",
        get: function get() {
          return this._center;
        },
        set: function set(e) {
          e.lat === this._center.lat && e.lng === this._center.lng || (this._unmodified = !1, this._center = e, this._terrainEnabled() && ("ground" === this.cameraElevationReference ? this._updateCenterElevation() ? this._updateCameraOnTerrain() : this._cameraZoom = null : this._updateZoomFromElevation()), this._constrain(), this._calcMatrices());
        }
      }, {
        key: "_updateZoomFromElevation",
        value: function _updateZoomFromElevation() {
          if (null == this._cameraZoom || !this._elevation) return;

          var e = this._cameraZoom,
              t = this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),
              i = this.pixelsPerMeter / this.worldSize * t,
              o = this._mercatorZfromZoom(e),
              r = this._mercatorZfromZoom(this._maxZoom),
              n = Math.max(o - i, r);

          this._setZoom(this._zoomFromMercatorZ(n));
        }
      }, {
        key: "padding",
        get: function get() {
          return this._edgeInsets.toJSON();
        },
        set: function set(e) {
          this._edgeInsets.equals(e) || (this._unmodified = !1, this._edgeInsets.interpolate(this._edgeInsets, e, 1), this._calcMatrices());
        }
      }, {
        key: "computeZoomRelativeTo",
        value: function computeZoomRelativeTo(t) {
          var i = this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint, t.toAltitude()));
          var o;
          o = t.z < this._camera.position[2] ? [i.x, i.y, i.z] : [t.x, t.y, t.z];
          var r = e.length(e.sub([], this._camera.position, o));
          return e.clamp(this._zoomFromMercatorZ(r), this._minZoom, this._maxZoom);
        }
      }, {
        key: "setFreeCameraOptions",
        value: function setFreeCameraOptions(t) {
          if (!this.height) return;
          if (!t.position && !t.orientation) return;

          this._updateCameraState();

          var i = !1;

          if (t.orientation && !e.exactEquals(t.orientation, this._camera.orientation) && (i = this._setCameraOrientation(t.orientation)), t.position) {
            var _o140 = [t.position.x, t.position.y, t.position.z];
            e.exactEquals$1(_o140, this._camera.position) || (this._setCameraPosition(_o140), i = !0);
          }

          i && (this._updateStateFromCamera(), this.recenterOnTerrain());
        }
      }, {
        key: "getFreeCameraOptions",
        value: function getFreeCameraOptions() {
          this._updateCameraState();

          var t = this._camera.position,
              i = new xo();
          return i.position = new e.MercatorCoordinate(t[0], t[1], t[2]), i.orientation = this._camera.orientation, i._elevation = this.elevation, i._renderWorldCopies = this.renderWorldCopies, i;
        }
      }, {
        key: "_setCameraOrientation",
        value: function _setCameraOrientation(t) {
          if (!e.length$1(t)) return !1;
          e.normalize$1(t, t);
          var i = e.transformQuat([], [0, 0, -1], t),
              o = e.transformQuat([], [0, -1, 0], t);
          if (o[2] < 0) return !1;
          var r = vo(i, o);
          return !!r && (this._camera.orientation = r, !0);
        }
      }, {
        key: "_setCameraPosition",
        value: function _setCameraPosition(t) {
          var i = this.zoomScale(this.minZoom) * this.tileSize,
              o = this.zoomScale(this.maxZoom) * this.tileSize,
              r = this.cameraToCenterDistance;
          t[2] = e.clamp(t[2], r / o, r / i), this._camera.position = t;
        }
      }, {
        key: "centerPoint",
        get: function get() {
          return this._edgeInsets.getCenter(this.width, this.height);
        }
      }, {
        key: "fovAboveCenter",
        get: function get() {
          return this._fov * (.5 + this.centerOffset.y / this.height);
        }
      }, {
        key: "isPaddingEqual",
        value: function isPaddingEqual(e) {
          return this._edgeInsets.equals(e);
        }
      }, {
        key: "interpolatePadding",
        value: function interpolatePadding(e, t, i) {
          this._unmodified = !1, this._edgeInsets.interpolate(e, t, i), this._constrain(), this._calcMatrices();
        }
      }, {
        key: "coveringZoomLevel",
        value: function coveringZoomLevel(e) {
          var t = (e.roundZoom ? Math.round : Math.floor)(this.zoom + this.scaleZoom(this.tileSize / e.tileSize));
          return Math.max(0, t);
        }
      }, {
        key: "getVisibleUnwrappedCoordinates",
        value: function getVisibleUnwrappedCoordinates(t) {
          var i = [new e.UnwrappedTileID(0, t)];

          if (this.renderWorldCopies) {
            var _o141 = this.pointCoordinate(new e.pointGeometry(0, 0)),
                _r284 = this.pointCoordinate(new e.pointGeometry(this.width, 0)),
                _n189 = this.pointCoordinate(new e.pointGeometry(this.width, this.height)),
                _a123 = this.pointCoordinate(new e.pointGeometry(0, this.height)),
                _s136 = Math.floor(Math.min(_o141.x, _r284.x, _n189.x, _a123.x)),
                _l77 = Math.floor(Math.max(_o141.x, _r284.x, _n189.x, _a123.x)),
                _c52 = 1;

            for (var _o142 = _s136 - _c52; _o142 <= _l77 + _c52; _o142++) {
              0 !== _o142 && i.push(new e.UnwrappedTileID(_o142, t));
            }
          }

          return i;
        }
      }, {
        key: "coveringTiles",
        value: function coveringTiles(t) {
          var _this109 = this;

          var i = this.coveringZoomLevel(t);
          var o = i,
              r = this.elevation && !t.isTerrainDEM,
              n = "mercator" === this.projection.name;
          if (void 0 !== t.minzoom && i < t.minzoom) return [];
          void 0 !== t.maxzoom && i > t.maxzoom && (i = t.maxzoom);

          var a = this.locationCoordinate(this.center),
              s = 1 << i,
              l = [s * a.x, s * a.y, 0],
              c = e.Frustum.fromInvProjectionMatrix(this.invProjMatrix, this.worldSize, i, "globe" !== this.projection.name),
              h = this.pointCoordinate(this.getCameraPoint()),
              u = s * e.mercatorZfromAltitude(1, this.center.lat),
              _ = this._camera.position[2] / e.mercatorZfromAltitude(1, this.center.lat),
              d = [s * h.x, s * h.y, _],
              p = this.cameraToCenterDistance / t.tileSize * (t.roundZoom ? 1 : .502),
              m = this.pitch <= 60 && this._edgeInsets.top <= this._edgeInsets.bottom && !this._elevation && !this.projection.isReprojectedInTileSpace ? i : 0,
              f = t.isTerrainDEM && this._elevation ? 1e4 * this._elevation.exaggeration() : this._centerAltitude,
              g = t.isTerrainDEM ? -f : this._elevation ? this._elevation.getMinElevationBelowMSL() : 0,
              v = this.projection.isReprojectedInTileSpace ? wo(this) : 1,
              x = function x(t) {
            var i = 1 / 4e4,
                o = new e.MercatorCoordinate(t.x + i, t.y, t.z),
                r = new e.MercatorCoordinate(t.x, t.y + i, t.z),
                n = t.toLngLat(),
                a = o.toLngLat(),
                s = r.toLngLat(),
                l = _this109.locationCoordinate(n),
                c = _this109.locationCoordinate(a),
                h = _this109.locationCoordinate(s),
                u = Math.hypot(c.x - l.x, c.y - l.y),
                _ = Math.hypot(h.x - l.x, h.y - l.y);

            return Math.sqrt(u * _) * v / i;
          },
              y = function y(t) {
            var i = f,
                o = g;
            return {
              aabb: e.tileAABB(_this109, s, 0, 0, 0, t, o, i, _this109.projection),
              zoom: 0,
              x: 0,
              y: 0,
              minZ: o,
              maxZ: i,
              wrap: t,
              fullyVisible: !1
            };
          },
              b = [];

          var w = [];

          var T = i,
              E = t.reparseOverscaled ? o : i,
              C = function C(e) {
            return e * e;
          },
              M = C((_ - this._centerAltitude) * u),
              S = function S(e) {
            if (!_this109._elevation || !e.tileID || !n) return;

            var t = _this109._elevation.getMinMaxForTile(e.tileID),
                i = e.aabb;

            t ? (i.min[2] = t.min, i.max[2] = t.max, i.center[2] = (i.min[2] + i.max[2]) / 2) : (e.shouldSplit = I(e), e.shouldSplit || (i.min[2] = i.max[2] = i.center[2] = _this109._centerAltitude));
          },
              I = function I(t) {
            if (t.zoom < m) return !0;
            if (t.zoom === T) return !1;
            if (null != t.shouldSplit) return t.shouldSplit;
            var i = t.aabb.distanceX(d),
                n = t.aabb.distanceY(d);
            var a = M;
            r && (a = C(t.aabb.distanceZ(d) * u));
            var s = 1;

            if (_this109.projection.isReprojectedInTileSpace && o <= 5) {
              var _i258 = Math.pow(2, t.zoom),
                  _o143 = x(new e.MercatorCoordinate((t.x + .5) / _i258, (t.y + .5) / _i258));

              s = _o143 > .85 ? 1 : _o143;
            }

            var l = i * i + n * n + a;
            return l < C((1 << T - t.zoom) * p * s * function (e, t) {
              if (t * C(.707) < e) return 1;
              var i = Math.sqrt(t / e);
              return i / (1.4144271570014144 + (Math.pow(1.1, i - 1.4144271570014144 + 1) - 1) / (1.1 - 1) - 1);
            }(Math.max(a, M), l));
          };

          if (this.renderWorldCopies) for (var _e413 = 1; _e413 <= 3; _e413++) {
            b.push(y(-_e413)), b.push(y(_e413));
          }

          for (b.push(y(0)); b.length > 0;) {
            var _o144 = b.pop(),
                _a124 = _o144.x,
                _h39 = _o144.y;

            var _u62 = _o144.fullyVisible;

            if (!_u62) {
              var _e414 = _o144.aabb.intersects(c);

              if (0 === _e414) continue;
              _u62 = 2 === _e414;
            }

            if (_o144.zoom !== T && I(_o144)) for (var _t379 = 0; _t379 < 4; _t379++) {
              var _i259 = (_a124 << 1) + _t379 % 2,
                  _l78 = (_h39 << 1) + (_t379 >> 1),
                  _c53 = {
                aabb: n ? _o144.aabb.quadrant(_t379) : e.tileAABB(this, s, _o144.zoom + 1, _i259, _l78, _o144.wrap, _o144.minZ, _o144.maxZ, this.projection),
                zoom: _o144.zoom + 1,
                x: _i259,
                y: _l78,
                wrap: _o144.wrap,
                fullyVisible: _u62,
                tileID: void 0,
                shouldSplit: void 0,
                minZ: _o144.minZ,
                maxZ: _o144.maxZ
              };

              r && (_c53.tileID = new e.OverscaledTileID(_o144.zoom + 1 === T ? E : _o144.zoom + 1, _o144.wrap, _o144.zoom + 1, _i259, _l78), S(_c53)), b.push(_c53);
            } else {
              var _r285 = _o144.zoom === T ? E : _o144.zoom;

              if (t.minzoom && t.minzoom > _r285) continue;

              var _n190 = l[0] - (.5 + _a124 + (_o144.wrap << _o144.zoom)) * (1 << i - _o144.zoom),
                  _s137 = l[1] - .5 - _h39,
                  _c54 = _o144.tileID ? _o144.tileID : new e.OverscaledTileID(_r285, _o144.wrap, _o144.zoom, _a124, _h39);

              w.push({
                tileID: _c54,
                distanceSq: _n190 * _n190 + _s137 * _s137
              });
            }
          }

          if (this.fogCullDistSq) {
            var _i260 = this.fogCullDistSq,
                _o145 = this.horizonLineFromTop();

            w = w.filter(function (r) {
              var n = [0, 0, 0, 1],
                  a = [e.EXTENT, e.EXTENT, 0, 1],
                  s = _this109.calculateFogTileMatrix(r.tileID.toUnwrapped());

              e.transformMat4$1(n, n, s), e.transformMat4$1(a, a, s);
              var l = e.getAABBPointSquareDist(n, a);
              if (0 === l) return !0;
              var c = !1;
              var h = _this109._elevation;

              if (h && l > _i260 && 0 !== _o145) {
                var _i261 = _this109.calculateProjMatrix(r.tileID.toUnwrapped());

                var _n191;

                t.isTerrainDEM || (_n191 = h.getMinMaxForTile(r.tileID)), _n191 || (_n191 = {
                  min: g,
                  max: f
                });

                var _a125 = e.furthestTileCorner(_this109.rotation),
                    _s138 = [_a125[0] * e.EXTENT, _a125[1] * e.EXTENT, _n191.max];

                e.transformMat4(_s138, _s138, _i261), c = (1 - _s138[1]) * _this109.height * .5 < _o145;
              }

              return l < _i260 || c;
            });
          }

          return w.sort(function (e, t) {
            return e.distanceSq - t.distanceSq;
          }).map(function (e) {
            return e.tileID;
          });
        }
      }, {
        key: "resize",
        value: function resize(e, t) {
          this.width = e, this.height = t, this.pixelsToGLUnits = [2 / e, -2 / t], this._constrain(), this._calcMatrices();
        }
      }, {
        key: "unmodified",
        get: function get() {
          return this._unmodified;
        }
      }, {
        key: "zoomScale",
        value: function zoomScale(e) {
          return Math.pow(2, e);
        }
      }, {
        key: "scaleZoom",
        value: function scaleZoom(e) {
          return Math.log(e) / Math.LN2;
        }
      }, {
        key: "project",
        value: function project(t) {
          var i = e.clamp(t.lat, -e.MAX_MERCATOR_LATITUDE, e.MAX_MERCATOR_LATITUDE),
              o = this.projection.project(t.lng, i);
          return new e.pointGeometry(o.x * this.worldSize, o.y * this.worldSize);
        }
      }, {
        key: "unproject",
        value: function unproject(e) {
          return this.projection.unproject(e.x / this.worldSize, e.y / this.worldSize);
        }
      }, {
        key: "point",
        get: function get() {
          return this.project(this.center);
        }
      }, {
        key: "setLocationAtPoint",
        value: function setLocationAtPoint(t, i) {
          var o = this.pointCoordinate(i),
              r = this.pointCoordinate(this.centerPoint),
              n = this.locationCoordinate(t);
          this.setLocation(new e.MercatorCoordinate(n.x - (o.x - r.x), n.y - (o.y - r.y)));
        }
      }, {
        key: "setLocation",
        value: function setLocation(e) {
          this.center = this.coordinateLocation(e), this.projection.wrap && (this.center = this.center.wrap());
        }
      }, {
        key: "locationPoint",
        value: function locationPoint(e) {
          return this.projection.locationPoint(this, e);
        }
      }, {
        key: "locationPoint3D",
        value: function locationPoint3D(e) {
          return this._coordinatePoint(this.locationCoordinate(e), !0);
        }
      }, {
        key: "pointLocation",
        value: function pointLocation(e) {
          return this.coordinateLocation(this.pointCoordinate(e));
        }
      }, {
        key: "pointLocation3D",
        value: function pointLocation3D(e) {
          return this.coordinateLocation(this.pointCoordinate3D(e));
        }
      }, {
        key: "locationCoordinate",
        value: function locationCoordinate(t, i) {
          var o = i ? e.mercatorZfromAltitude(i, t.lat) : void 0,
              r = this.projection.project(t.lng, t.lat);
          return new e.MercatorCoordinate(r.x, r.y, o);
        }
      }, {
        key: "coordinateLocation",
        value: function coordinateLocation(e) {
          return this.projection.unproject(e.x, e.y);
        }
      }, {
        key: "pointRayIntersection",
        value: function pointRayIntersection(t, i) {
          var o = null != i ? i : this._centerAltitude,
              r = [t.x, t.y, 0, 1],
              n = [t.x, t.y, 1, 1];
          e.transformMat4$1(r, r, this.pixelMatrixInverse), e.transformMat4$1(n, n, this.pixelMatrixInverse);
          var a = n[3];
          e.scale$1(r, r, 1 / r[3]), e.scale$1(n, n, 1 / a);
          var s = r[2],
              l = n[2];
          return {
            p0: r,
            p1: n,
            t: s === l ? 0 : (o - s) / (l - s)
          };
        }
      }, {
        key: "screenPointToMercatorRay",
        value: function screenPointToMercatorRay(t) {
          var i = [t.x, t.y, 0, 1],
              o = [t.x, t.y, 1, 1];
          return e.transformMat4$1(i, i, this.pixelMatrixInverse), e.transformMat4$1(o, o, this.pixelMatrixInverse), e.scale$1(i, i, 1 / i[3]), e.scale$1(o, o, 1 / o[3]), i[2] = e.mercatorZfromAltitude(i[2], this._center.lat) * this.worldSize, o[2] = e.mercatorZfromAltitude(o[2], this._center.lat) * this.worldSize, e.scale$1(i, i, 1 / this.worldSize), e.scale$1(o, o, 1 / this.worldSize), new e.Ray([i[0], i[1], i[2]], e.normalize([], e.sub([], o, i)));
        }
      }, {
        key: "rayIntersectionCoordinate",
        value: function rayIntersectionCoordinate(t) {
          var i = t.p0,
              o = t.p1,
              r = t.t,
              n = e.mercatorZfromAltitude(i[2], this._center.lat),
              a = e.mercatorZfromAltitude(o[2], this._center.lat);
          return new e.MercatorCoordinate(e.number(i[0], o[0], r) / this.worldSize, e.number(i[1], o[1], r) / this.worldSize, e.number(n, a, r));
        }
      }, {
        key: "pointCoordinate",
        value: function pointCoordinate(e) {
          var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this._centerAltitude;
          return this.projection.createTileTransform(this, this.worldSize).pointCoordinate(e.x, e.y, t);
        }
      }, {
        key: "pointCoordinate3D",
        value: function pointCoordinate3D(t) {
          if (!this.elevation) return this.pointCoordinate(t);
          var i = this.elevation;
          var o = this.elevation.pointCoordinate(t);
          if (o) return new e.MercatorCoordinate(o[0], o[1], o[2]);
          var r = 0,
              n = this.horizonLineFromTop();
          if (t.y > n) return this.pointCoordinate(t);
          var a = .02 * n,
              s = t.clone();

          for (var _t380 = 0; _t380 < 10 && n - r > a; _t380++) {
            s.y = e.number(r, n, .66);

            var _t381 = i.pointCoordinate(s);

            _t381 ? (n = s.y, o = _t381) : r = s.y;
          }

          return o ? new e.MercatorCoordinate(o[0], o[1], o[2]) : this.pointCoordinate(t);
        }
      }, {
        key: "isPointAboveHorizon",
        value: function isPointAboveHorizon(e) {
          if (this.elevation) return !this.elevation.pointCoordinate(e);
          {
            var _t382 = this.horizonLineFromTop();

            return e.y < _t382;
          }
        }
      }, {
        key: "_coordinatePoint",
        value: function _coordinatePoint(t, i) {
          var o = i && this.elevation ? this.elevation.getAtPointOrZero(t, this._centerAltitude) : this._centerAltitude,
              r = [t.x * this.worldSize, t.y * this.worldSize, o + t.toAltitude(), 1];
          return e.transformMat4$1(r, r, this.pixelMatrix), r[3] > 0 ? new e.pointGeometry(r[0] / r[3], r[1] / r[3]) : new e.pointGeometry(Number.MAX_VALUE, Number.MAX_VALUE);
        }
      }, {
        key: "_getBounds",
        value: function _getBounds(t, i) {
          var o = new e.pointGeometry(this._edgeInsets.left, this._edgeInsets.top),
              r = new e.pointGeometry(this.width - this._edgeInsets.right, this._edgeInsets.top),
              n = new e.pointGeometry(this.width - this._edgeInsets.right, this.height - this._edgeInsets.bottom),
              a = new e.pointGeometry(this._edgeInsets.left, this.height - this._edgeInsets.bottom);
          var s = this.pointCoordinate(o, t),
              l = this.pointCoordinate(r, t);

          var c = this.pointCoordinate(n, i),
              h = this.pointCoordinate(a, i),
              u = function u(e, t) {
            return (t.y - e.y) / (t.x - e.x);
          };

          return s.y > 1 && l.y >= 0 ? s = new e.MercatorCoordinate((1 - h.y) / u(h, s) + h.x, 1) : s.y < 0 && l.y <= 1 && (s = new e.MercatorCoordinate(-h.y / u(h, s) + h.x, 0)), l.y > 1 && s.y >= 0 ? l = new e.MercatorCoordinate((1 - c.y) / u(c, l) + c.x, 1) : l.y < 0 && s.y <= 1 && (l = new e.MercatorCoordinate(-c.y / u(c, l) + c.x, 0)), new e.LngLatBounds().extend(this.coordinateLocation(s)).extend(this.coordinateLocation(l)).extend(this.coordinateLocation(h)).extend(this.coordinateLocation(c));
        }
      }, {
        key: "_getBounds3D",
        value: function _getBounds3D() {
          var e = this.elevation;
          if (!e.visibleDemTiles.length) return this._getBounds(0, 0);
          var t = e.visibleDemTiles.reduce(function (e, t) {
            if (t.dem) {
              var _i262 = t.dem.tree;
              e.min = Math.min(e.min, _i262.minimums[0]), e.max = Math.max(e.max, _i262.maximums[0]);
            }

            return e;
          }, {
            min: Number.MAX_VALUE,
            max: 0
          });
          return this._getBounds(t.min * e.exaggeration(), t.max * e.exaggeration());
        }
      }, {
        key: "getBounds",
        value: function getBounds() {
          return this._terrainEnabled() ? this._getBounds3D() : this._getBounds(0, 0);
        }
      }, {
        key: "horizonLineFromTop",
        value: function horizonLineFromTop() {
          var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : !0;
          var t = this.height / 2 / Math.tan(this._fov / 2) / Math.tan(Math.max(this._pitch, .1)) + this.centerOffset.y,
              i = this.height / 2 - t * (1 - this._horizonShift);
          return e ? Math.max(0, i) : i;
        }
      }, {
        key: "getMaxBounds",
        value: function getMaxBounds() {
          return this.maxBounds;
        }
      }, {
        key: "setMaxBounds",
        value: function setMaxBounds(t) {
          this.maxBounds = t, this.minLat = -e.MAX_MERCATOR_LATITUDE, this.maxLat = e.MAX_MERCATOR_LATITUDE, this.minLng = -180, this.maxLng = 180, t && (this.minLat = t.getSouth(), this.maxLat = t.getNorth(), this.minLng = t.getWest(), this.maxLng = t.getEast(), this.maxLng < this.minLng && (this.maxLng += 360)), this.worldMinX = e.mercatorXfromLng(this.minLng) * this.tileSize, this.worldMaxX = e.mercatorXfromLng(this.maxLng) * this.tileSize, this.worldMinY = e.mercatorYfromLat(this.maxLat) * this.tileSize, this.worldMaxY = e.mercatorYfromLat(this.minLat) * this.tileSize, this._constrain();
        }
      }, {
        key: "calculatePosMatrix",
        value: function calculatePosMatrix(e, t) {
          return this.projection.createTileTransform(this, t).createTileMatrix(e);
        }
      }, {
        key: "calculateDistanceTileData",
        value: function calculateDistanceTileData(t) {
          var i = t.key,
              o = this._distanceTileDataCache;
          if (o[i]) return o[i];

          var r = t.canonical,
              n = 1 / this.height,
              a = this.cameraWorldSize / this.zoomScale(r.z),
              s = (r.x + Math.pow(2, r.z) * t.wrap) * a,
              l = r.y * a,
              c = this.point,
              h = this.angle,
              u = Math.sin(-h),
              _ = -Math.cos(-h);

          return o[i] = {
            bearing: [u, _],
            center: [(c.x - s) * n, (c.y - l) * n],
            scale: a / e.EXTENT * n
          }, o[i];
        }
      }, {
        key: "calculateFogTileMatrix",
        value: function calculateFogTileMatrix(t) {
          var i = t.key,
              o = this._fogTileMatrixCache;
          if (o[i]) return o[i];
          var r = this.calculatePosMatrix(t, this.cameraWorldSize);
          return e.multiply$1(r, this.worldToFogMatrix, r), o[i] = new Float32Array(r), o[i];
        }
      }, {
        key: "calculateProjMatrix",
        value: function calculateProjMatrix(t) {
          var i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;
          var o = t.key,
              r = i ? this._alignedProjMatrixCache : this._projMatrixCache;
          if (r[o]) return r[o];
          var n = this.calculatePosMatrix(t, this.worldSize);
          return e.multiply$1(n, this.projection.isReprojectedInTileSpace ? this.mercatorMatrix : i ? this.alignedProjMatrix : this.projMatrix, n), r[o] = new Float32Array(n), r[o];
        }
      }, {
        key: "calculatePixelsToTileUnitsMatrix",
        value: function calculatePixelsToTileUnitsMatrix(t) {
          var i = t.tileID.key,
              o = this._pixelsToTileUnitsCache;
          if (o[i]) return o[i];

          var r = function (t, i) {
            var o = t.tileTransform.scale,
                r = o * e.EXTENT / (t.tileSize * Math.pow(2, i.zoom - t.tileID.overscaledZ + t.tileID.canonical.z));
            return n = new Float32Array(4), l = (a = i.inverseAdjustmentMatrix)[1], c = a[2], h = a[3], _ = (s = [r, r])[1], n[0] = a[0] * (u = s[0]), n[1] = l * u, n[2] = c * _, n[3] = h * _, n;

            var n, a, s, l, c, h, u, _;
          }(t, this);

          return o[i] = r, o[i];
        }
      }, {
        key: "customLayerMatrix",
        value: function customLayerMatrix() {
          return this.mercatorMatrix.slice();
        }
      }, {
        key: "recenterOnTerrain",
        value: function recenterOnTerrain() {
          if (!this._elevation) return;
          var t = this._elevation;

          this._updateCameraState();

          var i = e.mercatorZfromAltitude(1, this._center.lat) * this.worldSize,
              o = this._computeCameraPosition(i),
              r = this._camera.forward(),
              n = e.mercatorZfromAltitude(1, this._center.lat);

          o[2] /= n, r[2] /= n, e.normalize(r, r);
          var a = t.raycast(o, r, t.exaggeration());

          if (a) {
            var _t383 = e.scaleAndAdd([], o, r, a),
                _i263 = new e.MercatorCoordinate(_t383[0], _t383[1], e.mercatorZfromAltitude(_t383[2], e.latFromMercatorY(_t383[1]))),
                _s139 = (_i263.z + e.length([_i263.x - o[0], _i263.y - o[1], _i263.z - o[2] * n])) * this._projectionScaler;

            this._cameraZoom = this._zoomFromMercatorZ(_s139), this._centerAltitude = _i263.toAltitude(), this._center = this.coordinateLocation(_i263), this._updateZoomFromElevation(), this._constrain(), this._calcMatrices();
          }
        }
      }, {
        key: "_constrainCameraAltitude",
        value: function _constrainCameraAltitude() {
          if (!this._elevation) return;
          var t = this._elevation;

          this._updateCameraState();

          var i = e.mercatorZfromAltitude(1, this._center.lat) * this.worldSize,
              o = this._computeCameraPosition(i),
              r = t.getAtPointOrZero(_construct(e.MercatorCoordinate, _toConsumableArray(o))),
              n = this._minimumHeightOverTerrain() * Math.cos(e.degToRad(this._maxPitch)),
              a = this._camera.position[2] - this.pixelsPerMeter / this.worldSize * r;

          if (a < n) {
            var _t384 = this.locationCoordinate(this._center, this._centerAltitude),
                _i264 = [_t384.x - o[0], _t384.y - o[1], _t384.z - o[2]],
                _r286 = e.length(_i264);

            _i264[2] -= (n - a) / this._projectionScaler;

            var _s140 = e.length(_i264);

            if (0 === _s140) return;
            e.scale$2(_i264, _i264, _r286 / _s140 * this._projectionScaler), this._camera.position = [_t384.x - _i264[0], _t384.y - _i264[1], _t384.z * this._projectionScaler - _i264[2]], this._camera.orientation = vo(_i264, this._camera.up()), this._updateStateFromCamera();
          }
        }
      }, {
        key: "_constrain",
        value: function _constrain() {
          if (!this.center || !this.width || !this.height || this._constraining) return;

          if (this._constraining = !0, this.projection.isReprojectedInTileSpace) {
            var _t385 = this.center;
            return _t385.lat = e.clamp(_t385.lat, this.minLat, this.maxLat), !this.maxBounds && this.renderWorldCopies || (_t385.lng = e.clamp(_t385.lng, this.minLng, this.maxLng)), this.center = _t385, void (this._constraining = !1);
          }

          var t = this._unmodified,
              _this$point = this.point,
              i = _this$point.x,
              o = _this$point.y;
          var r = 0,
              n = i,
              a = o;
          var s = this.width / 2,
              l = this.height / 2,
              c = this.worldMinY * this.scale,
              h = this.worldMaxY * this.scale;

          if (o - l < c && (a = c + l), o + l > h && (a = h - l), h - c < this.height && (r = Math.max(r, this.height / (h - c)), a = (h + c) / 2), this.maxBounds || !this._renderWorldCopies || !this.projection.wrap) {
            var _e415 = this.worldMinX * this.scale,
                _t386 = this.worldMaxX * this.scale,
                _o146 = this.worldSize / 2 - (_e415 + _t386) / 2;

            n = (i + _o146 + this.worldSize) % this.worldSize - _o146, n - s < _e415 && (n = _e415 + s), n + s > _t386 && (n = _t386 - s), _t386 - _e415 < this.width && (r = Math.max(r, this.width / (_t386 - _e415)), n = (_t386 + _e415) / 2);
          }

          n === i && a === o || (this.center = this.unproject(new e.pointGeometry(n, a))), r && (this.zoom += this.scaleZoom(r)), this._constrainCameraAltitude(), this._unmodified = t, this._constraining = !1;
        }
      }, {
        key: "_minZoomForBounds",
        value: function _minZoomForBounds() {
          var e = Math.max(0, this.scaleZoom(this.height / (this.worldMaxY - this.worldMinY)));
          return this.maxBounds && (e = Math.max(e, this.scaleZoom(this.width / (this.worldMaxX - this.worldMinX)))), e;
        }
      }, {
        key: "_maxCameraBoundsDistance",
        value: function _maxCameraBoundsDistance() {
          return this._mercatorZfromZoom(this._minZoomForBounds());
        }
      }, {
        key: "_calcMatrices",
        value: function _calcMatrices() {
          if (!this.height) return;
          var t = this._fov / 2,
              i = this.centerOffset,
              o = this.pixelsPerMeter;
          this._projectionScaler = o / (e.mercatorZfromAltitude(1, this.center.lat) * this.worldSize), this.cameraToCenterDistance = .5 / Math.tan(t) * this.height * this._projectionScaler, this._updateCameraState(), this._farZ = this.projection.farthestPixelDistance(this), this._nearZ = this.height / 50;

          var n = this._camera.getWorldToCamera(this.worldSize, "meters" === this.projection.zAxisUnit ? o : 1),
              a = this._camera.getCameraToClipPerspective(this._fov, this.width / this.height, this._nearZ, this._farZ);

          a[8] = 2 * -i.x / this.width, a[9] = 2 * i.y / this.height;
          var s = e.mul([], a, n);

          if (this.projection.isReprojectedInTileSpace) {
            var _t387 = this.locationCoordinate(this.center),
                _i265 = e.identity([]);

            e.translate(_i265, _i265, [_t387.x * this.worldSize, _t387.y * this.worldSize, 0]), e.multiply$1(_i265, _i265, bo(this)), e.translate(_i265, _i265, [-_t387.x * this.worldSize, -_t387.y * this.worldSize, 0]), e.multiply$1(s, s, _i265), this.inverseAdjustmentMatrix = function (e) {
              var t = bo(e, !0);
              return r([], [t[0], t[1], t[4], t[5]]);
            }(this);
          } else this.inverseAdjustmentMatrix = [1, 0, 0, 1];

          this.mercatorMatrix = e.scale([], s, [this.worldSize, this.worldSize, this.worldSize / o, 1]), this.projMatrix = s, this.invProjMatrix = e.invert(new Float64Array(16), this.projMatrix);
          var l = new Float32Array(16);
          e.identity(l), e.scale(l, l, [1, -1, 1]), e.rotateX(l, l, this._pitch), e.rotateZ(l, l, this.angle);
          var c = e.perspective(new Float32Array(16), this._fov, this.width / this.height, this._nearZ, this._farZ),
              h = (Math.PI / 2 - this._pitch) * (this.height / this._fov) * this._horizonShift;
          c[8] = 2 * -i.x / this.width, c[9] = 2 * (i.y + h) / this.height, this.skyboxMatrix = e.multiply$1(l, c, l);
          var u = this.point,
              _ = u.x,
              d = u.y,
              p = this.width % 2 / 2,
              m = this.height % 2 / 2,
              f = Math.cos(this.angle),
              g = Math.sin(this.angle),
              v = _ - Math.round(_) + f * p + g * m,
              x = d - Math.round(d) + f * m + g * p,
              y = new Float64Array(s);
          if (e.translate(y, y, [v > .5 ? v - 1 : v, x > .5 ? x - 1 : x, 0]), this.alignedProjMatrix = y, s = e.create(), e.scale(s, s, [this.width / 2, -this.height / 2, 1]), e.translate(s, s, [1, -1, 0]), this.labelPlaneMatrix = s, s = e.create(), e.scale(s, s, [1, -1, 1]), e.translate(s, s, [-1, -1, 0]), e.scale(s, s, [2 / this.width, 2 / this.height, 1]), this.glCoordMatrix = s, this.pixelMatrix = e.multiply$1(new Float64Array(16), this.labelPlaneMatrix, this.projMatrix), this._calcFogMatrices(), this._distanceTileDataCache = {}, s = e.invert(new Float64Array(16), this.pixelMatrix), !s) throw new Error("failed to invert matrix");
          this.pixelMatrixInverse = s, this._projMatrixCache = {}, this._alignedProjMatrixCache = {}, this._pixelsToTileUnitsCache = {};
        }
      }, {
        key: "_calcFogMatrices",
        value: function _calcFogMatrices() {
          this._fogTileMatrixCache = {};
          var t = this.cameraWorldSize,
              i = this.cameraPixelsPerMeter,
              o = this._camera.position,
              r = 1 / this.height,
              n = [t, t, i];
          e.scale$2(n, n, r), e.scale$2(o, o, -1), e.multiply$2(o, o, n);
          var a = e.create();
          e.translate(a, a, o), e.scale(a, a, n), this.mercatorFogMatrix = a, this.worldToFogMatrix = this._camera.getWorldToCameraPosition(t, i, r);
        }
      }, {
        key: "_computeCameraPosition",
        value: function _computeCameraPosition(e) {
          var t = (e = e || this.pixelsPerMeter) / this.pixelsPerMeter,
              i = this._camera.forward(),
              o = this.point,
              r = this._mercatorZfromZoom(this._cameraZoom ? this._cameraZoom : this._zoom) * t - e / this.worldSize * this._centerAltitude;

          return [o.x / this.worldSize - i[0] * r, o.y / this.worldSize - i[1] * r, e / this.worldSize * this._centerAltitude - i[2] * r];
        }
      }, {
        key: "_updateCameraState",
        value: function _updateCameraState() {
          this.height && (this._camera.setPitchBearing(this._pitch, this.angle), this._camera.position = this._computeCameraPosition());
        }
      }, {
        key: "_translateCameraConstrained",
        value: function _translateCameraConstrained(t) {
          var i = this._maxCameraBoundsDistance() * Math.cos(this._pitch),
              o = t[2];
          var r = 1;
          o > 0 && (r = Math.min((i - this._camera.position[2]) / o, 1)), this._camera.position = e.scaleAndAdd([], this._camera.position, t, r), this._updateStateFromCamera();
        }
      }, {
        key: "_updateStateFromCamera",
        value: function _updateStateFromCamera() {
          var t = this._camera.position,
              i = this._camera.forward(),
              _this$_camera$getPitc = this._camera.getPitchBearing(),
              o = _this$_camera$getPitc.pitch,
              r = _this$_camera$getPitc.bearing,
              n = e.mercatorZfromAltitude(this._centerAltitude, this.center.lat) * this._projectionScaler,
              a = this._mercatorZfromZoom(this._maxZoom) * Math.cos(e.degToRad(this._maxPitch)),
              s = Math.max((t[2] - n) / Math.cos(o), a),
              l = this._zoomFromMercatorZ(s);

          e.scaleAndAdd(t, t, i, s), this._pitch = e.clamp(o, e.degToRad(this.minPitch), e.degToRad(this.maxPitch)), this.angle = e.wrap(r, -Math.PI, Math.PI), this._setZoom(e.clamp(l, this._minZoom, this._maxZoom)), this._terrainEnabled() && this._updateCameraOnTerrain(), this._center = this.coordinateLocation(new e.MercatorCoordinate(t[0], t[1], t[2])), this._unmodified = !1, this._constrain(), this._calcMatrices();
        }
      }, {
        key: "_worldSizeFromZoom",
        value: function _worldSizeFromZoom(e) {
          return Math.pow(2, e) * this.tileSize;
        }
      }, {
        key: "_mercatorZfromZoom",
        value: function _mercatorZfromZoom(e) {
          return this.cameraToCenterDistance / this._worldSizeFromZoom(e);
        }
      }, {
        key: "_minimumHeightOverTerrain",
        value: function _minimumHeightOverTerrain() {
          var e = Math.min((null != this._cameraZoom ? this._cameraZoom : this._zoom) + 2, this._maxZoom);
          return this._mercatorZfromZoom(e);
        }
      }, {
        key: "_zoomFromMercatorZ",
        value: function _zoomFromMercatorZ(e) {
          return this.scaleZoom(this.cameraToCenterDistance / (e * this.tileSize));
        }
      }, {
        key: "_terrainEnabled",
        value: function _terrainEnabled() {
          return !(!this._elevation || !this.projection.supportsTerrain && (e.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."), 1));
        }
      }, {
        key: "anyCornerOffEdge",
        value: function anyCornerOffEdge(t, i) {
          var o = Math.min(t.x, i.x),
              r = Math.max(t.x, i.x),
              n = Math.min(t.y, i.y),
              a = Math.max(t.y, i.y);
          if (n < this.horizonLineFromTop(!1)) return !0;
          if ("mercator" !== this.projection.name) return !1;
          var s = [new e.pointGeometry(o, n), new e.pointGeometry(r, a), new e.pointGeometry(o, a), new e.pointGeometry(r, n)],
              l = this.renderWorldCopies ? -3 : 0,
              c = this.renderWorldCopies ? 4 : 1;

          for (var _i266 = 0, _s141 = s; _i266 < _s141.length; _i266++) {
            var _e416 = _s141[_i266];

            var _t388 = this.pointRayIntersection(_e416);

            if (_t388.t < 0) return !0;

            var _i267 = this.rayIntersectionCoordinate(_t388);

            if (_i267.x < l || _i267.y < 0 || _i267.x > c || _i267.y > 1) return !0;
          }

          return !1;
        }
      }, {
        key: "isHorizonVisible",
        value: function isHorizonVisible() {
          return this.pitch + e.radToDeg(this.fovAboveCenter) > 88 || this.anyCornerOffEdge(new e.pointGeometry(0, 0), new e.pointGeometry(this.width, this.height));
        }
      }, {
        key: "zoomDeltaToMovement",
        value: function zoomDeltaToMovement(t, i) {
          var o = e.length(e.sub([], this._camera.position, t)),
              r = this._zoomFromMercatorZ(o) + i;
          return o - this._mercatorZfromZoom(r);
        }
      }, {
        key: "getCameraPoint",
        value: function getCameraPoint() {
          var t = Math.tan(this._pitch) * (this.cameraToCenterDistance || 1);
          return this.centerPoint.add(new e.pointGeometry(0, t));
        }
      }]);

      return So;
    }();

    function Io(e, t) {
      var i = !1,
          o = null;

      var r = function r() {
        o = null, i && (e(), o = setTimeout(r, t), i = !1);
      };

      return function () {
        return i = !0, o || r(), o;
      };
    }

    var zo = /*#__PURE__*/function () {
      function zo(t) {
        _classCallCheck(this, zo);

        this._hashName = t && encodeURIComponent(t), e.bindAll(["_getCurrentHash", "_onHashChange", "_updateHash"], this), this._updateHash = Io(this._updateHashUnthrottled.bind(this), 300);
      }

      _createClass(zo, [{
        key: "addTo",
        value: function addTo(t) {
          return this._map = t, e.window.addEventListener("hashchange", this._onHashChange, !1), this._map.on("moveend", this._updateHash), this;
        }
      }, {
        key: "remove",
        value: function remove() {
          return e.window.removeEventListener("hashchange", this._onHashChange, !1), this._map.off("moveend", this._updateHash), clearTimeout(this._updateHash()), delete this._map, this;
        }
      }, {
        key: "getHashString",
        value: function getHashString(t) {
          var i = this._map.getCenter(),
              o = Math.round(100 * this._map.getZoom()) / 100,
              r = Math.ceil((o * Math.LN2 + Math.log(512 / 360 / .5)) / Math.LN10),
              n = Math.pow(10, r),
              a = Math.round(i.lng * n) / n,
              s = Math.round(i.lat * n) / n,
              l = this._map.getBearing(),
              c = this._map.getPitch();

          var h = "";

          if (h += t ? "/".concat(a, "/").concat(s, "/").concat(o) : "".concat(o, "/").concat(s, "/").concat(a), (l || c) && (h += "/" + Math.round(10 * l) / 10), c && (h += "/".concat(Math.round(c))), this._hashName) {
            var _t389 = this._hashName;

            var _i268 = !1;

            var _o147 = e.window.location.hash.slice(1).split("&").map(function (e) {
              var o = e.split("=")[0];
              return o === _t389 ? (_i268 = !0, "".concat(o, "=").concat(h)) : e;
            }).filter(function (e) {
              return e;
            });

            return _i268 || _o147.push("".concat(_t389, "=").concat(h)), "#".concat(_o147.join("&"));
          }

          return "#".concat(h);
        }
      }, {
        key: "_getCurrentHash",
        value: function _getCurrentHash() {
          var _this110 = this;

          var t = e.window.location.hash.replace("#", "");

          if (this._hashName) {
            var _e417;

            return t.split("&").map(function (e) {
              return e.split("=");
            }).forEach(function (t) {
              t[0] === _this110._hashName && (_e417 = t);
            }), (_e417 && _e417[1] || "").split("/");
          }

          return t.split("/");
        }
      }, {
        key: "_onHashChange",
        value: function _onHashChange() {
          var e = this._getCurrentHash();

          if (e.length >= 3 && !e.some(function (e) {
            return isNaN(e);
          })) {
            var _t390 = this._map.dragRotate.isEnabled() && this._map.touchZoomRotate.isEnabled() ? +(e[3] || 0) : this._map.getBearing();

            return this._map.jumpTo({
              center: [+e[2], +e[1]],
              zoom: +e[0],
              bearing: _t390,
              pitch: +(e[4] || 0)
            }), !0;
          }

          return !1;
        }
      }, {
        key: "_updateHashUnthrottled",
        value: function _updateHashUnthrottled() {
          var t = e.window.location.href.replace(/(#.+)?$/, this.getHashString());
          e.window.history.replaceState(e.window.history.state, null, t);
        }
      }]);

      return zo;
    }();

    var Do = {
      linearity: .3,
      easing: e.bezier(0, 0, .3, 1)
    },
        Po = e.extend({
      deceleration: 2500,
      maxSpeed: 1400
    }, Do),
        Ao = e.extend({
      deceleration: 20,
      maxSpeed: 1400
    }, Do),
        Lo = e.extend({
      deceleration: 1e3,
      maxSpeed: 360
    }, Do),
        Ro = e.extend({
      deceleration: 1e3,
      maxSpeed: 90
    }, Do);

    var ko = /*#__PURE__*/function () {
      function ko(e) {
        _classCallCheck(this, ko);

        this._map = e, this.clear();
      }

      _createClass(ko, [{
        key: "clear",
        value: function clear() {
          this._inertiaBuffer = [];
        }
      }, {
        key: "record",
        value: function record(t) {
          this._drainInertiaBuffer(), this._inertiaBuffer.push({
            time: e.exported.now(),
            settings: t
          });
        }
      }, {
        key: "_drainInertiaBuffer",
        value: function _drainInertiaBuffer() {
          var t = this._inertiaBuffer,
              i = e.exported.now();

          for (; t.length > 0 && i - t[0].time > 160;) {
            t.shift();
          }
        }
      }, {
        key: "_onMoveEnd",
        value: function _onMoveEnd(t) {
          if (this._drainInertiaBuffer(), this._inertiaBuffer.length < 2) return;
          var i = {
            zoom: 0,
            bearing: 0,
            pitch: 0,
            pan: new e.pointGeometry(0, 0),
            pinchAround: void 0,
            around: void 0
          };

          var _iterator242 = _createForOfIteratorHelper(this._inertiaBuffer),
              _step242;

          try {
            for (_iterator242.s(); !(_step242 = _iterator242.n()).done;) {
              var _ref184 = _step242.value;
              var _e421 = _ref184.settings;
              i.zoom += _e421.zoomDelta || 0, i.bearing += _e421.bearingDelta || 0, i.pitch += _e421.pitchDelta || 0, _e421.panDelta && i.pan._add(_e421.panDelta), _e421.around && (i.around = _e421.around), _e421.pinchAround && (i.pinchAround = _e421.pinchAround);
            }
          } catch (err) {
            _iterator242.e(err);
          } finally {
            _iterator242.f();
          }

          var o = this._inertiaBuffer[this._inertiaBuffer.length - 1].time - this._inertiaBuffer[0].time,
              r = {};

          if (i.pan.mag()) {
            var _n192 = Bo(i.pan.mag(), o, e.extend({}, Po, t || {}));

            r.offset = i.pan.mult(_n192.amount / i.pan.mag()), r.center = this._map.transform.center, Oo(r, _n192);
          }

          if (i.zoom) {
            var _e418 = Bo(i.zoom, o, Ao);

            r.zoom = this._map.transform.zoom + _e418.amount, Oo(r, _e418);
          }

          if (i.bearing) {
            var _t391 = Bo(i.bearing, o, Lo);

            r.bearing = this._map.transform.bearing + e.clamp(_t391.amount, -179, 179), Oo(r, _t391);
          }

          if (i.pitch) {
            var _e419 = Bo(i.pitch, o, Ro);

            r.pitch = this._map.transform.pitch + _e419.amount, Oo(r, _e419);
          }

          if (r.zoom || r.bearing) {
            var _e420 = void 0 === i.pinchAround ? i.around : i.pinchAround;

            r.around = _e420 ? this._map.unproject(_e420) : this._map.getCenter();
          }

          return this.clear(), e.extend(r, {
            noMoveStart: !0
          });
        }
      }]);

      return ko;
    }();

    function Oo(e, t) {
      (!e.duration || e.duration < t.duration) && (e.duration = t.duration, e.easing = t.easing);
    }

    function Bo(t, i, o) {
      var r = o.maxSpeed,
          n = o.linearity,
          a = o.deceleration,
          s = e.clamp(t * n / (i / 1e3), -r, r),
          l = Math.abs(s) / (a * n);
      return {
        easing: o.easing,
        duration: 1e3 * l,
        amount: s * (l / 2)
      };
    }

    var Fo = /*#__PURE__*/function (_e$Event) {
      _inherits(Fo, _e$Event);

      var _super121 = _createSuper(Fo);

      function Fo(t, i, o) {
        var _this111;

        var r = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};

        _classCallCheck(this, Fo);

        var n = a.mousePos(i.getCanvasContainer(), o),
            s = i.unproject(n);
        _this111 = _super121.call(this, t, e.extend({
          point: n,
          lngLat: s,
          originalEvent: o
        }, r)), _this111._defaultPrevented = !1, _this111.target = i;
        return _this111;
      }

      _createClass(Fo, [{
        key: "preventDefault",
        value: function preventDefault() {
          this._defaultPrevented = !0;
        }
      }, {
        key: "defaultPrevented",
        get: function get() {
          return this._defaultPrevented;
        }
      }]);

      return Fo;
    }(e.Event);

    var Uo = /*#__PURE__*/function (_e$Event2) {
      _inherits(Uo, _e$Event2);

      var _super122 = _createSuper(Uo);

      function Uo(t, i, o) {
        var _this112;

        _classCallCheck(this, Uo);

        var r = "touchend" === t ? o.changedTouches : o.touches,
            n = a.touchPos(i.getCanvasContainer(), r),
            s = n.map(function (e) {
          return i.unproject(e);
        }),
            l = n.reduce(function (e, t, i, o) {
          return e.add(t.div(o.length));
        }, new e.pointGeometry(0, 0));
        _this112 = _super122.call(this, t, {
          points: n,
          point: l,
          lngLats: s,
          lngLat: i.unproject(l),
          originalEvent: o
        }), _this112._defaultPrevented = !1;
        return _this112;
      }

      _createClass(Uo, [{
        key: "preventDefault",
        value: function preventDefault() {
          this._defaultPrevented = !0;
        }
      }, {
        key: "defaultPrevented",
        get: function get() {
          return this._defaultPrevented;
        }
      }]);

      return Uo;
    }(e.Event);

    var No = /*#__PURE__*/function (_e$Event3) {
      _inherits(No, _e$Event3);

      var _super123 = _createSuper(No);

      function No(e, t, i) {
        var _this113;

        _classCallCheck(this, No);

        _this113 = _super123.call(this, e, {
          originalEvent: i
        }), _this113._defaultPrevented = !1;
        return _this113;
      }

      _createClass(No, [{
        key: "preventDefault",
        value: function preventDefault() {
          this._defaultPrevented = !0;
        }
      }, {
        key: "defaultPrevented",
        get: function get() {
          return this._defaultPrevented;
        }
      }]);

      return No;
    }(e.Event);

    var Go = /*#__PURE__*/function () {
      function Go(e, t) {
        _classCallCheck(this, Go);

        this._map = e, this._clickTolerance = t.clickTolerance;
      }

      _createClass(Go, [{
        key: "reset",
        value: function reset() {
          delete this._mousedownPos;
        }
      }, {
        key: "wheel",
        value: function wheel(e) {
          return this._firePreventable(new No(e.type, this._map, e));
        }
      }, {
        key: "mousedown",
        value: function mousedown(e, t) {
          return this._mousedownPos = t, this._firePreventable(new Fo(e.type, this._map, e));
        }
      }, {
        key: "mouseup",
        value: function mouseup(e) {
          this._map.fire(new Fo(e.type, this._map, e));
        }
      }, {
        key: "preclick",
        value: function preclick(t) {
          var i = e.extend({}, t);
          i.type = "preclick", this._map.fire(new Fo(i.type, this._map, i));
        }
      }, {
        key: "click",
        value: function click(e, t) {
          this._mousedownPos && this._mousedownPos.dist(t) >= this._clickTolerance || (this.preclick(e), this._map.fire(new Fo(e.type, this._map, e)));
        }
      }, {
        key: "dblclick",
        value: function dblclick(e) {
          return this._firePreventable(new Fo(e.type, this._map, e));
        }
      }, {
        key: "mouseover",
        value: function mouseover(e) {
          this._map.fire(new Fo(e.type, this._map, e));
        }
      }, {
        key: "mouseout",
        value: function mouseout(e) {
          this._map.fire(new Fo(e.type, this._map, e));
        }
      }, {
        key: "touchstart",
        value: function touchstart(e) {
          return this._firePreventable(new Uo(e.type, this._map, e));
        }
      }, {
        key: "touchmove",
        value: function touchmove(e) {
          this._map.fire(new Uo(e.type, this._map, e));
        }
      }, {
        key: "touchend",
        value: function touchend(e) {
          this._map.fire(new Uo(e.type, this._map, e));
        }
      }, {
        key: "touchcancel",
        value: function touchcancel(e) {
          this._map.fire(new Uo(e.type, this._map, e));
        }
      }, {
        key: "_firePreventable",
        value: function _firePreventable(e) {
          if (this._map.fire(e), e.defaultPrevented) return {};
        }
      }, {
        key: "isEnabled",
        value: function isEnabled() {
          return !0;
        }
      }, {
        key: "isActive",
        value: function isActive() {
          return !1;
        }
      }, {
        key: "enable",
        value: function enable() {}
      }, {
        key: "disable",
        value: function disable() {}
      }]);

      return Go;
    }();

    var jo = /*#__PURE__*/function () {
      function jo(e) {
        _classCallCheck(this, jo);

        this._map = e;
      }

      _createClass(jo, [{
        key: "reset",
        value: function reset() {
          this._delayContextMenu = !1, delete this._contextMenuEvent;
        }
      }, {
        key: "mousemove",
        value: function mousemove(e) {
          this._map.fire(new Fo(e.type, this._map, e));
        }
      }, {
        key: "mousedown",
        value: function mousedown() {
          this._delayContextMenu = !0;
        }
      }, {
        key: "mouseup",
        value: function mouseup() {
          this._delayContextMenu = !1, this._contextMenuEvent && (this._map.fire(new Fo("contextmenu", this._map, this._contextMenuEvent)), delete this._contextMenuEvent);
        }
      }, {
        key: "contextmenu",
        value: function contextmenu(e) {
          this._delayContextMenu ? this._contextMenuEvent = e : this._map.fire(new Fo(e.type, this._map, e)), this._map.listens("contextmenu") && e.preventDefault();
        }
      }, {
        key: "isEnabled",
        value: function isEnabled() {
          return !0;
        }
      }, {
        key: "isActive",
        value: function isActive() {
          return !1;
        }
      }, {
        key: "enable",
        value: function enable() {}
      }, {
        key: "disable",
        value: function disable() {}
      }]);

      return jo;
    }();

    var Zo = /*#__PURE__*/function () {
      function Zo(e, t) {
        _classCallCheck(this, Zo);

        this._map = e, this._el = e.getCanvasContainer(), this._container = e.getContainer(), this._clickTolerance = t.clickTolerance || 1;
      }

      _createClass(Zo, [{
        key: "isEnabled",
        value: function isEnabled() {
          return !!this._enabled;
        }
      }, {
        key: "isActive",
        value: function isActive() {
          return !!this._active;
        }
      }, {
        key: "enable",
        value: function enable() {
          this.isEnabled() || (this._enabled = !0);
        }
      }, {
        key: "disable",
        value: function disable() {
          this.isEnabled() && (this._enabled = !1);
        }
      }, {
        key: "mousedown",
        value: function mousedown(e, t) {
          this.isEnabled() && e.shiftKey && 0 === e.button && (a.disableDrag(), this._startPos = this._lastPos = t, this._active = !0);
        }
      }, {
        key: "mousemoveWindow",
        value: function mousemoveWindow(e, t) {
          var _this114 = this;

          if (!this._active) return;
          var i = t;
          if (this._lastPos.equals(i) || !this._box && i.dist(this._startPos) < this._clickTolerance) return;
          var o = this._startPos;
          this._lastPos = i, this._box || (this._box = a.create("div", "mapboxgl-boxzoom", this._container), this._container.classList.add("mapboxgl-crosshair"), this._fireEvent("boxzoomstart", e));
          var r = Math.min(o.x, i.x),
              n = Math.max(o.x, i.x),
              s = Math.min(o.y, i.y),
              l = Math.max(o.y, i.y);

          this._map._requestDomTask(function () {
            _this114._box && (_this114._box.style.transform = "translate(".concat(r, "px,").concat(s, "px)"), _this114._box.style.width = n - r + "px", _this114._box.style.height = l - s + "px");
          });
        }
      }, {
        key: "mouseupWindow",
        value: function mouseupWindow(t, i) {
          var _this115 = this;

          if (!this._active) return;
          if (0 !== t.button) return;
          var o = this._startPos,
              r = i;
          if (this.reset(), a.suppressClick(), o.x !== r.x || o.y !== r.y) return this._map.fire(new e.Event("boxzoomend", {
            originalEvent: t
          })), {
            cameraAnimation: function cameraAnimation(e) {
              return e.fitScreenCoordinates(o, r, _this115._map.getBearing(), {
                linear: !1
              });
            }
          };

          this._fireEvent("boxzoomcancel", t);
        }
      }, {
        key: "keydown",
        value: function keydown(e) {
          this._active && 27 === e.keyCode && (this.reset(), this._fireEvent("boxzoomcancel", e));
        }
      }, {
        key: "blur",
        value: function blur() {
          this.reset();
        }
      }, {
        key: "reset",
        value: function reset() {
          this._active = !1, this._container.classList.remove("mapboxgl-crosshair"), this._box && (this._box.remove(), this._box = null), a.enableDrag(), delete this._startPos, delete this._lastPos;
        }
      }, {
        key: "_fireEvent",
        value: function _fireEvent(t, i) {
          return this._map.fire(new e.Event(t, {
            originalEvent: i
          }));
        }
      }]);

      return Zo;
    }();

    function Vo(e, t) {
      var i = {};

      for (var _o148 = 0; _o148 < e.length; _o148++) {
        i[e[_o148].identifier] = t[_o148];
      }

      return i;
    }

    var Wo = /*#__PURE__*/function () {
      function Wo(e) {
        _classCallCheck(this, Wo);

        this.reset(), this.numTouches = e.numTouches;
      }

      _createClass(Wo, [{
        key: "reset",
        value: function reset() {
          delete this.centroid, delete this.startTime, delete this.touches, this.aborted = !1;
        }
      }, {
        key: "touchstart",
        value: function touchstart(t, i, o) {
          (this.centroid || o.length > this.numTouches) && (this.aborted = !0), this.aborted || (void 0 === this.startTime && (this.startTime = t.timeStamp), o.length === this.numTouches && (this.centroid = function (t) {
            var i = new e.pointGeometry(0, 0);

            var _iterator243 = _createForOfIteratorHelper(t),
                _step243;

            try {
              for (_iterator243.s(); !(_step243 = _iterator243.n()).done;) {
                var _e422 = _step243.value;

                i._add(_e422);
              }
            } catch (err) {
              _iterator243.e(err);
            } finally {
              _iterator243.f();
            }

            return i.div(t.length);
          }(i), this.touches = Vo(o, i)));
        }
      }, {
        key: "touchmove",
        value: function touchmove(e, t, i) {
          if (this.aborted || !this.centroid) return;
          var o = Vo(i, t);

          for (var _e423 in this.touches) {
            var _t392 = this.touches[_e423],
                _i269 = o[_e423];
            (!_i269 || _i269.dist(_t392) > 30) && (this.aborted = !0);
          }
        }
      }, {
        key: "touchend",
        value: function touchend(e, t, i) {
          if ((!this.centroid || e.timeStamp - this.startTime > 500) && (this.aborted = !0), 0 === i.length) {
            var _e424 = !this.aborted && this.centroid;

            if (this.reset(), _e424) return _e424;
          }
        }
      }]);

      return Wo;
    }();

    var qo = /*#__PURE__*/function () {
      function qo(e) {
        _classCallCheck(this, qo);

        this.singleTap = new Wo(e), this.numTaps = e.numTaps, this.reset();
      }

      _createClass(qo, [{
        key: "reset",
        value: function reset() {
          this.lastTime = 1 / 0, delete this.lastTap, this.count = 0, this.singleTap.reset();
        }
      }, {
        key: "touchstart",
        value: function touchstart(e, t, i) {
          this.singleTap.touchstart(e, t, i);
        }
      }, {
        key: "touchmove",
        value: function touchmove(e, t, i) {
          this.singleTap.touchmove(e, t, i);
        }
      }, {
        key: "touchend",
        value: function touchend(e, t, i) {
          var o = this.singleTap.touchend(e, t, i);

          if (o) {
            var _t393 = e.timeStamp - this.lastTime < 500,
                _i270 = !this.lastTap || this.lastTap.dist(o) < 30;

            if (_t393 && _i270 || this.reset(), this.count++, this.lastTime = e.timeStamp, this.lastTap = o, this.count === this.numTaps) return this.reset(), o;
          }
        }
      }]);

      return qo;
    }();

    var Xo = /*#__PURE__*/function () {
      function Xo() {
        _classCallCheck(this, Xo);

        this._zoomIn = new qo({
          numTouches: 1,
          numTaps: 2
        }), this._zoomOut = new qo({
          numTouches: 2,
          numTaps: 1
        }), this.reset();
      }

      _createClass(Xo, [{
        key: "reset",
        value: function reset() {
          this._active = !1, this._zoomIn.reset(), this._zoomOut.reset();
        }
      }, {
        key: "touchstart",
        value: function touchstart(e, t, i) {
          this._zoomIn.touchstart(e, t, i), this._zoomOut.touchstart(e, t, i);
        }
      }, {
        key: "touchmove",
        value: function touchmove(e, t, i) {
          this._zoomIn.touchmove(e, t, i), this._zoomOut.touchmove(e, t, i);
        }
      }, {
        key: "touchend",
        value: function touchend(e, t, i) {
          var _this116 = this;

          var o = this._zoomIn.touchend(e, t, i),
              r = this._zoomOut.touchend(e, t, i);

          return o ? (this._active = !0, e.preventDefault(), setTimeout(function () {
            return _this116.reset();
          }, 0), {
            cameraAnimation: function cameraAnimation(t) {
              return t.easeTo({
                duration: 300,
                zoom: t.getZoom() + 1,
                around: t.unproject(o)
              }, {
                originalEvent: e
              });
            }
          }) : r ? (this._active = !0, e.preventDefault(), setTimeout(function () {
            return _this116.reset();
          }, 0), {
            cameraAnimation: function cameraAnimation(t) {
              return t.easeTo({
                duration: 300,
                zoom: t.getZoom() - 1,
                around: t.unproject(r)
              }, {
                originalEvent: e
              });
            }
          }) : void 0;
        }
      }, {
        key: "touchcancel",
        value: function touchcancel() {
          this.reset();
        }
      }, {
        key: "enable",
        value: function enable() {
          this._enabled = !0;
        }
      }, {
        key: "disable",
        value: function disable() {
          this._enabled = !1, this.reset();
        }
      }, {
        key: "isEnabled",
        value: function isEnabled() {
          return this._enabled;
        }
      }, {
        key: "isActive",
        value: function isActive() {
          return this._active;
        }
      }]);

      return Xo;
    }();

    var $o = {
      0: 1,
      2: 2
    };

    var Ho = /*#__PURE__*/function () {
      function Ho(e) {
        _classCallCheck(this, Ho);

        this.reset(), this._clickTolerance = e.clickTolerance || 1;
      }

      _createClass(Ho, [{
        key: "blur",
        value: function blur() {
          this.reset();
        }
      }, {
        key: "reset",
        value: function reset() {
          this._active = !1, this._moved = !1, delete this._lastPoint, delete this._eventButton;
        }
      }, {
        key: "_correctButton",
        value: function _correctButton(e, t) {
          return !1;
        }
      }, {
        key: "_move",
        value: function _move(e, t) {
          return {};
        }
      }, {
        key: "mousedown",
        value: function mousedown(e, t) {
          if (this._lastPoint) return;
          var i = a.mouseButton(e);
          this._correctButton(e, i) && (this._lastPoint = t, this._eventButton = i);
        }
      }, {
        key: "mousemoveWindow",
        value: function mousemoveWindow(e, t) {
          var i = this._lastPoint;
          if (i) if (e.preventDefault(), function (e, t) {
            var i = $o[t];
            return void 0 === e.buttons || (e.buttons & i) !== i;
          }(e, this._eventButton)) this.reset();else if (this._moved || !(t.dist(i) < this._clickTolerance)) return this._moved = !0, this._lastPoint = t, this._move(i, t);
        }
      }, {
        key: "mouseupWindow",
        value: function mouseupWindow(e) {
          this._lastPoint && a.mouseButton(e) === this._eventButton && (this._moved && a.suppressClick(), this.reset());
        }
      }, {
        key: "enable",
        value: function enable() {
          this._enabled = !0;
        }
      }, {
        key: "disable",
        value: function disable() {
          this._enabled = !1, this.reset();
        }
      }, {
        key: "isEnabled",
        value: function isEnabled() {
          return this._enabled;
        }
      }, {
        key: "isActive",
        value: function isActive() {
          return this._active;
        }
      }]);

      return Ho;
    }();

    var Ko = /*#__PURE__*/function (_Ho) {
      _inherits(Ko, _Ho);

      var _super124 = _createSuper(Ko);

      function Ko() {
        _classCallCheck(this, Ko);

        return _super124.apply(this, arguments);
      }

      _createClass(Ko, [{
        key: "mousedown",
        value: function mousedown(e, t) {
          _get(_getPrototypeOf(Ko.prototype), "mousedown", this).call(this, e, t), this._lastPoint && (this._active = !0);
        }
      }, {
        key: "_correctButton",
        value: function _correctButton(e, t) {
          return 0 === t && !e.ctrlKey;
        }
      }, {
        key: "_move",
        value: function _move(e, t) {
          return {
            around: t,
            panDelta: t.sub(e)
          };
        }
      }]);

      return Ko;
    }(Ho);

    var Yo = /*#__PURE__*/function (_Ho2) {
      _inherits(Yo, _Ho2);

      var _super125 = _createSuper(Yo);

      function Yo() {
        _classCallCheck(this, Yo);

        return _super125.apply(this, arguments);
      }

      _createClass(Yo, [{
        key: "_correctButton",
        value: function _correctButton(e, t) {
          return 0 === t && e.ctrlKey || 2 === t;
        }
      }, {
        key: "_move",
        value: function _move(e, t) {
          var i = .8 * (t.x - e.x);
          if (i) return this._active = !0, {
            bearingDelta: i
          };
        }
      }, {
        key: "contextmenu",
        value: function contextmenu(e) {
          e.preventDefault();
        }
      }]);

      return Yo;
    }(Ho);

    var Jo = /*#__PURE__*/function (_Ho3) {
      _inherits(Jo, _Ho3);

      var _super126 = _createSuper(Jo);

      function Jo() {
        _classCallCheck(this, Jo);

        return _super126.apply(this, arguments);
      }

      _createClass(Jo, [{
        key: "_correctButton",
        value: function _correctButton(e, t) {
          return 0 === t && e.ctrlKey || 2 === t;
        }
      }, {
        key: "_move",
        value: function _move(e, t) {
          var i = -.5 * (t.y - e.y);
          if (i) return this._active = !0, {
            pitchDelta: i
          };
        }
      }, {
        key: "contextmenu",
        value: function contextmenu(e) {
          e.preventDefault();
        }
      }]);

      return Jo;
    }(Ho);

    var Qo = /*#__PURE__*/function () {
      function Qo(t, i) {
        _classCallCheck(this, Qo);

        this._map = t, this._el = t.getCanvasContainer(), this._minTouches = 1, this._clickTolerance = i.clickTolerance || 1, this.reset(), e.bindAll(["_addTouchPanBlocker", "_showTouchPanBlockerAlert"], this);
      }

      _createClass(Qo, [{
        key: "reset",
        value: function reset() {
          this._active = !1, this._touches = {}, this._sum = new e.pointGeometry(0, 0);
        }
      }, {
        key: "touchstart",
        value: function touchstart(e, t, i) {
          return this._calculateTransform(e, t, i);
        }
      }, {
        key: "touchmove",
        value: function touchmove(e, t, i) {
          if (this._active && !(i.length < this._minTouches)) {
            if (this._map._cooperativeGestures && !this._map.isMoving()) {
              if (1 === i.length) return void this._showTouchPanBlockerAlert();
              "hidden" !== this._alertContainer.style.visibility && (this._alertContainer.style.visibility = "hidden", clearTimeout(this._alertTimer));
            }

            return e.preventDefault(), this._calculateTransform(e, t, i);
          }
        }
      }, {
        key: "touchend",
        value: function touchend(e, t, i) {
          this._calculateTransform(e, t, i), this._active && i.length < this._minTouches && this.reset();
        }
      }, {
        key: "touchcancel",
        value: function touchcancel() {
          this.reset();
        }
      }, {
        key: "_calculateTransform",
        value: function _calculateTransform(t, i, o) {
          o.length > 0 && (this._active = !0);
          var r = Vo(o, i),
              n = new e.pointGeometry(0, 0),
              a = new e.pointGeometry(0, 0);
          var s = 0;

          for (var _e425 in r) {
            var _t394 = r[_e425],
                _i271 = this._touches[_e425];
            _i271 && (n._add(_t394), a._add(_t394.sub(_i271)), s++, r[_e425] = _t394);
          }

          if (this._touches = r, s < this._minTouches || !a.mag()) return;
          var l = a.div(s);
          return this._sum._add(l), this._sum.mag() < this._clickTolerance ? void 0 : {
            around: n.div(s),
            panDelta: l
          };
        }
      }, {
        key: "enable",
        value: function enable() {
          this._enabled = !0, this._map._cooperativeGestures && (this._addTouchPanBlocker(), this._el.classList.add("mapboxgl-touch-pan-blocker-override", "mapboxgl-scrollable-page"));
        }
      }, {
        key: "disable",
        value: function disable() {
          this._enabled = !1, this._map._cooperativeGestures && (clearTimeout(this._alertTimer), this._alertContainer.remove(), this._el.classList.remove("mapboxgl-touch-pan-blocker-override", "mapboxgl-scrollable-page")), this.reset();
        }
      }, {
        key: "isEnabled",
        value: function isEnabled() {
          return this._enabled;
        }
      }, {
        key: "isActive",
        value: function isActive() {
          return this._active;
        }
      }, {
        key: "_addTouchPanBlocker",
        value: function _addTouchPanBlocker() {
          this._map && !this._alertContainer && (this._alertContainer = a.create("div", "mapboxgl-touch-pan-blocker", this._map._container), this._alertContainer.textContent = this._map._getUIString("TouchPanBlocker.Message"), this._alertContainer.style.fontSize = "".concat(Math.max(10, Math.min(24, Math.floor(.05 * this._el.clientWidth))), "px"));
        }
      }, {
        key: "_showTouchPanBlockerAlert",
        value: function _showTouchPanBlockerAlert() {
          var _this117 = this;

          "hidden" === this._alertContainer.style.visibility && (this._alertContainer.style.visibility = "visible"), this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"), clearTimeout(this._alertTimer), this._alertTimer = setTimeout(function () {
            _this117._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show");
          }, 500);
        }
      }]);

      return Qo;
    }();

    var er = /*#__PURE__*/function () {
      function er() {
        _classCallCheck(this, er);

        this.reset();
      }

      _createClass(er, [{
        key: "reset",
        value: function reset() {
          this._active = !1, delete this._firstTwoTouches;
        }
      }, {
        key: "_start",
        value: function _start(e) {}
      }, {
        key: "_move",
        value: function _move(e, t, i) {
          return {};
        }
      }, {
        key: "touchstart",
        value: function touchstart(e, t, i) {
          this._firstTwoTouches || i.length < 2 || (this._firstTwoTouches = [i[0].identifier, i[1].identifier], this._start([t[0], t[1]]));
        }
      }, {
        key: "touchmove",
        value: function touchmove(e, t, i) {
          if (!this._firstTwoTouches) return;
          e.preventDefault();

          var _this$_firstTwoTouche = _slicedToArray(this._firstTwoTouches, 2),
              o = _this$_firstTwoTouche[0],
              r = _this$_firstTwoTouche[1],
              n = tr(i, t, o),
              a = tr(i, t, r);

          if (!n || !a) return;
          var s = this._aroundCenter ? null : n.add(a).div(2);
          return this._move([n, a], s, e);
        }
      }, {
        key: "touchend",
        value: function touchend(e, t, i) {
          if (!this._firstTwoTouches) return;

          var _this$_firstTwoTouche2 = _slicedToArray(this._firstTwoTouches, 2),
              o = _this$_firstTwoTouche2[0],
              r = _this$_firstTwoTouche2[1],
              n = tr(i, t, o),
              s = tr(i, t, r);

          n && s || (this._active && a.suppressClick(), this.reset());
        }
      }, {
        key: "touchcancel",
        value: function touchcancel() {
          this.reset();
        }
      }, {
        key: "enable",
        value: function enable(e) {
          this._enabled = !0, this._aroundCenter = !!e && "center" === e.around;
        }
      }, {
        key: "disable",
        value: function disable() {
          this._enabled = !1, this.reset();
        }
      }, {
        key: "isEnabled",
        value: function isEnabled() {
          return this._enabled;
        }
      }, {
        key: "isActive",
        value: function isActive() {
          return this._active;
        }
      }]);

      return er;
    }();

    function tr(e, t, i) {
      for (var _o149 = 0; _o149 < e.length; _o149++) {
        if (e[_o149].identifier === i) return t[_o149];
      }
    }

    function ir(e, t) {
      return Math.log(e / t) / Math.LN2;
    }

    var or = /*#__PURE__*/function (_er) {
      _inherits(or, _er);

      var _super127 = _createSuper(or);

      function or() {
        _classCallCheck(this, or);

        return _super127.apply(this, arguments);
      }

      _createClass(or, [{
        key: "reset",
        value: function reset() {
          _get(_getPrototypeOf(or.prototype), "reset", this).call(this), delete this._distance, delete this._startDistance;
        }
      }, {
        key: "_start",
        value: function _start(e) {
          this._startDistance = this._distance = e[0].dist(e[1]);
        }
      }, {
        key: "_move",
        value: function _move(e, t) {
          var i = this._distance;
          if (this._distance = e[0].dist(e[1]), this._active || !(Math.abs(ir(this._distance, this._startDistance)) < .1)) return this._active = !0, {
            zoomDelta: ir(this._distance, i),
            pinchAround: t
          };
        }
      }]);

      return or;
    }(er);

    function rr(e, t) {
      return 180 * e.angleWith(t) / Math.PI;
    }

    var nr = /*#__PURE__*/function (_er2) {
      _inherits(nr, _er2);

      var _super128 = _createSuper(nr);

      function nr() {
        _classCallCheck(this, nr);

        return _super128.apply(this, arguments);
      }

      _createClass(nr, [{
        key: "reset",
        value: function reset() {
          _get(_getPrototypeOf(nr.prototype), "reset", this).call(this), delete this._minDiameter, delete this._startVector, delete this._vector;
        }
      }, {
        key: "_start",
        value: function _start(e) {
          this._startVector = this._vector = e[0].sub(e[1]), this._minDiameter = e[0].dist(e[1]);
        }
      }, {
        key: "_move",
        value: function _move(e, t) {
          var i = this._vector;
          if (this._vector = e[0].sub(e[1]), this._active || !this._isBelowThreshold(this._vector)) return this._active = !0, {
            bearingDelta: rr(this._vector, i),
            pinchAround: t
          };
        }
      }, {
        key: "_isBelowThreshold",
        value: function _isBelowThreshold(e) {
          this._minDiameter = Math.min(this._minDiameter, e.mag());
          var t = 25 / (Math.PI * this._minDiameter) * 360,
              i = rr(e, this._startVector);
          return Math.abs(i) < t;
        }
      }]);

      return nr;
    }(er);

    function ar(e) {
      return Math.abs(e.y) > Math.abs(e.x);
    }

    var sr = /*#__PURE__*/function (_er3) {
      _inherits(sr, _er3);

      var _super129 = _createSuper(sr);

      function sr(e) {
        var _this118;

        _classCallCheck(this, sr);

        _this118 = _super129.call(this), _this118._map = e;
        return _this118;
      }

      _createClass(sr, [{
        key: "reset",
        value: function reset() {
          _get(_getPrototypeOf(sr.prototype), "reset", this).call(this), this._valid = void 0, delete this._firstMove, delete this._lastPoints;
        }
      }, {
        key: "_start",
        value: function _start(e) {
          this._lastPoints = e, ar(e[0].sub(e[1])) && (this._valid = !1);
        }
      }, {
        key: "_move",
        value: function _move(e, t, i) {
          var o = e[0].sub(this._lastPoints[0]),
              r = e[1].sub(this._lastPoints[1]);
          if (!(this._map._cooperativeGestures && i.touches.length < 3) && (this._valid = this.gestureBeginsVertically(o, r, i.timeStamp), this._valid)) return this._lastPoints = e, this._active = !0, {
            pitchDelta: (o.y + r.y) / 2 * -.5
          };
        }
      }, {
        key: "gestureBeginsVertically",
        value: function gestureBeginsVertically(e, t, i) {
          if (void 0 !== this._valid) return this._valid;
          var o = e.mag() >= 2,
              r = t.mag() >= 2;
          if (!o && !r) return;
          if (!o || !r) return void 0 === this._firstMove && (this._firstMove = i), i - this._firstMove < 100 && void 0;
          var n = e.y > 0 == t.y > 0;
          return ar(e) && ar(t) && n;
        }
      }]);

      return sr;
    }(er);

    var lr = {
      panStep: 100,
      bearingStep: 15,
      pitchStep: 10
    };

    var cr = /*#__PURE__*/function () {
      function cr() {
        _classCallCheck(this, cr);

        var e = lr;
        this._panStep = e.panStep, this._bearingStep = e.bearingStep, this._pitchStep = e.pitchStep, this._rotationDisabled = !1;
      }

      _createClass(cr, [{
        key: "blur",
        value: function blur() {
          this.reset();
        }
      }, {
        key: "reset",
        value: function reset() {
          this._active = !1;
        }
      }, {
        key: "keydown",
        value: function keydown(e) {
          var _this119 = this;

          if (e.altKey || e.ctrlKey || e.metaKey) return;
          var t = 0,
              i = 0,
              o = 0,
              r = 0,
              n = 0;

          switch (e.keyCode) {
            case 61:
            case 107:
            case 171:
            case 187:
              t = 1;
              break;

            case 189:
            case 109:
            case 173:
              t = -1;
              break;

            case 37:
              e.shiftKey ? i = -1 : (e.preventDefault(), r = -1);
              break;

            case 39:
              e.shiftKey ? i = 1 : (e.preventDefault(), r = 1);
              break;

            case 38:
              e.shiftKey ? o = 1 : (e.preventDefault(), n = -1);
              break;

            case 40:
              e.shiftKey ? o = -1 : (e.preventDefault(), n = 1);
              break;

            default:
              return;
          }

          return this._rotationDisabled && (i = 0, o = 0), {
            cameraAnimation: function cameraAnimation(a) {
              var s = a.getZoom();
              a.easeTo({
                duration: 300,
                easeId: "keyboardHandler",
                easing: hr,
                zoom: t ? Math.round(s) + t * (e.shiftKey ? 2 : 1) : s,
                bearing: a.getBearing() + i * _this119._bearingStep,
                pitch: a.getPitch() + o * _this119._pitchStep,
                offset: [-r * _this119._panStep, -n * _this119._panStep],
                center: a.getCenter()
              }, {
                originalEvent: e
              });
            }
          };
        }
      }, {
        key: "enable",
        value: function enable() {
          this._enabled = !0;
        }
      }, {
        key: "disable",
        value: function disable() {
          this._enabled = !1, this.reset();
        }
      }, {
        key: "isEnabled",
        value: function isEnabled() {
          return this._enabled;
        }
      }, {
        key: "isActive",
        value: function isActive() {
          return this._active;
        }
      }, {
        key: "disableRotation",
        value: function disableRotation() {
          this._rotationDisabled = !0;
        }
      }, {
        key: "enableRotation",
        value: function enableRotation() {
          this._rotationDisabled = !1;
        }
      }]);

      return cr;
    }();

    function hr(e) {
      return e * (2 - e);
    }

    var ur = 4.000244140625;

    var _r = /*#__PURE__*/function () {
      function _r(t, i) {
        _classCallCheck(this, _r);

        this._map = t, this._el = t.getCanvasContainer(), this._handler = i, this._delta = 0, this._defaultZoomRate = .01, this._wheelZoomRate = .0022222222222222222, e.bindAll(["_onTimeout", "_addScrollZoomBlocker", "_showBlockerAlert", "_isFullscreen"], this);
      }

      _createClass(_r, [{
        key: "setZoomRate",
        value: function setZoomRate(e) {
          this._defaultZoomRate = e;
        }
      }, {
        key: "setWheelZoomRate",
        value: function setWheelZoomRate(e) {
          this._wheelZoomRate = e;
        }
      }, {
        key: "isEnabled",
        value: function isEnabled() {
          return !!this._enabled;
        }
      }, {
        key: "isActive",
        value: function isActive() {
          return !!this._active || void 0 !== this._finishTimeout;
        }
      }, {
        key: "isZooming",
        value: function isZooming() {
          return !!this._zooming;
        }
      }, {
        key: "enable",
        value: function enable(e) {
          this.isEnabled() || (this._enabled = !0, this._aroundCenter = !!e && "center" === e.around, this._map._cooperativeGestures && this._addScrollZoomBlocker());
        }
      }, {
        key: "disable",
        value: function disable() {
          this.isEnabled() && (this._enabled = !1, this._map._cooperativeGestures && (clearTimeout(this._alertTimer), this._alertContainer.remove()));
        }
      }, {
        key: "wheel",
        value: function wheel(t) {
          if (!this.isEnabled()) return;

          if (this._map._cooperativeGestures) {
            if (!(t.ctrlKey || t.metaKey || this.isZooming() || this._isFullscreen())) return void this._showBlockerAlert();
            "hidden" !== this._alertContainer.style.visibility && (this._alertContainer.style.visibility = "hidden", clearTimeout(this._alertTimer));
          }

          var i = t.deltaMode === e.window.WheelEvent.DOM_DELTA_LINE ? 40 * t.deltaY : t.deltaY;
          var o = e.exported.now(),
              r = o - (this._lastWheelEventTime || 0);
          this._lastWheelEventTime = o, 0 !== i && i % ur == 0 ? this._type = "wheel" : 0 !== i && Math.abs(i) < 4 ? this._type = "trackpad" : r > 400 ? (this._type = null, this._lastValue = i, this._timeout = setTimeout(this._onTimeout, 40, t)) : this._type || (this._type = Math.abs(r * i) < 200 ? "trackpad" : "wheel", this._timeout && (clearTimeout(this._timeout), this._timeout = null, i += this._lastValue)), t.shiftKey && i && (i /= 4), this._type && (this._lastWheelEvent = t, this._delta -= i, this._active || this._start(t)), t.preventDefault();
        }
      }, {
        key: "_onTimeout",
        value: function _onTimeout(e) {
          this._type = "wheel", this._delta -= this._lastValue, this._active || this._start(e);
        }
      }, {
        key: "_start",
        value: function _start(e) {
          if (!this._delta) return;
          this._frameId && (this._frameId = null), this._active = !0, this.isZooming() || (this._zooming = !0), this._finishTimeout && (clearTimeout(this._finishTimeout), delete this._finishTimeout);
          var t = a.mousePos(this._el, e);
          this._aroundPoint = this._aroundCenter ? this._map.transform.centerPoint : t, this._aroundCoord = this._map.transform.pointCoordinate3D(this._aroundPoint), this._targetZoom = void 0, this._frameId || (this._frameId = !0, this._handler._triggerRenderFrame());
        }
      }, {
        key: "renderFrame",
        value: function renderFrame() {
          var _this120 = this;

          if (!this._frameId) return;
          if (this._frameId = null, !this.isActive()) return;

          var t = this._map.transform,
              i = function i() {
            return t._terrainEnabled() && _this120._aroundCoord ? t.computeZoomRelativeTo(_this120._aroundCoord) : t.zoom;
          };

          if (0 !== this._delta) {
            var _e426 = "wheel" === this._type && Math.abs(this._delta) > ur ? this._wheelZoomRate : this._defaultZoomRate;

            var _o150 = 2 / (1 + Math.exp(-Math.abs(this._delta * _e426)));

            this._delta < 0 && 0 !== _o150 && (_o150 = 1 / _o150);

            var _r287 = i(),
                _n193 = Math.pow(2, _r287),
                _a126 = "number" == typeof this._targetZoom ? t.zoomScale(this._targetZoom) : _n193;

            this._targetZoom = Math.min(t.maxZoom, Math.max(t.minZoom, t.scaleZoom(_a126 * _o150))), "wheel" === this._type && (this._startZoom = i(), this._easing = this._smoothOutEasing(200)), this._delta = 0;
          }

          var o = "number" == typeof this._targetZoom ? this._targetZoom : i(),
              r = this._startZoom,
              n = this._easing;
          var a,
              s = !1;

          if ("wheel" === this._type && r && n) {
            var _t395 = Math.min((e.exported.now() - this._lastWheelEventTime) / 200, 1),
                _i272 = n(_t395);

            a = e.number(r, o, _i272), _t395 < 1 ? this._frameId || (this._frameId = !0) : s = !0;
          } else a = o, s = !0;

          return this._active = !0, s && (this._active = !1, this._finishTimeout = setTimeout(function () {
            _this120._zooming = !1, _this120._handler._triggerRenderFrame(), delete _this120._targetZoom, delete _this120._finishTimeout;
          }, 200)), {
            noInertia: !0,
            needsRenderFrame: !s,
            zoomDelta: a - i(),
            around: this._aroundPoint,
            aroundCoord: this._aroundCoord,
            originalEvent: this._lastWheelEvent
          };
        }
      }, {
        key: "_smoothOutEasing",
        value: function _smoothOutEasing(t) {
          var i = e.ease;

          if (this._prevEase) {
            var _t396 = this._prevEase,
                _o151 = (e.exported.now() - _t396.start) / _t396.duration,
                _r288 = _t396.easing(_o151 + .01) - _t396.easing(_o151),
                _n194 = .27 / Math.sqrt(_r288 * _r288 + 1e-4) * .01,
                _a127 = Math.sqrt(.0729 - _n194 * _n194);

            i = e.bezier(_n194, _a127, .25, 1);
          }

          return this._prevEase = {
            start: e.exported.now(),
            duration: t,
            easing: i
          }, i;
        }
      }, {
        key: "blur",
        value: function blur() {
          this.reset();
        }
      }, {
        key: "reset",
        value: function reset() {
          this._active = !1;
        }
      }, {
        key: "_addScrollZoomBlocker",
        value: function _addScrollZoomBlocker() {
          this._map && !this._alertContainer && (this._alertContainer = a.create("div", "mapboxgl-scroll-zoom-blocker", this._map._container), this._alertContainer.textContent = /(Mac|iPad)/i.test(e.window.navigator.userAgent) ? this._map._getUIString("ScrollZoomBlocker.CmdMessage") : this._map._getUIString("ScrollZoomBlocker.CtrlMessage"), this._alertContainer.style.fontSize = "".concat(Math.max(10, Math.min(24, Math.floor(.05 * this._el.clientWidth))), "px"));
        }
      }, {
        key: "_isFullscreen",
        value: function _isFullscreen() {
          return !!e.window.document.fullscreenElement || !!e.window.document.webkitFullscreenElement;
        }
      }, {
        key: "_showBlockerAlert",
        value: function _showBlockerAlert() {
          var _this121 = this;

          "hidden" === this._alertContainer.style.visibility && (this._alertContainer.style.visibility = "visible"), this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"), clearTimeout(this._alertTimer), this._alertTimer = setTimeout(function () {
            _this121._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show");
          }, 200);
        }
      }]);

      return _r;
    }();

    var dr = /*#__PURE__*/function () {
      function dr(e, t) {
        _classCallCheck(this, dr);

        this._clickZoom = e, this._tapZoom = t;
      }

      _createClass(dr, [{
        key: "enable",
        value: function enable() {
          this._clickZoom.enable(), this._tapZoom.enable();
        }
      }, {
        key: "disable",
        value: function disable() {
          this._clickZoom.disable(), this._tapZoom.disable();
        }
      }, {
        key: "isEnabled",
        value: function isEnabled() {
          return this._clickZoom.isEnabled() && this._tapZoom.isEnabled();
        }
      }, {
        key: "isActive",
        value: function isActive() {
          return this._clickZoom.isActive() || this._tapZoom.isActive();
        }
      }]);

      return dr;
    }();

    var pr = /*#__PURE__*/function () {
      function pr() {
        _classCallCheck(this, pr);

        this.reset();
      }

      _createClass(pr, [{
        key: "reset",
        value: function reset() {
          this._active = !1;
        }
      }, {
        key: "blur",
        value: function blur() {
          this.reset();
        }
      }, {
        key: "dblclick",
        value: function dblclick(e, t) {
          return e.preventDefault(), {
            cameraAnimation: function cameraAnimation(i) {
              i.easeTo({
                duration: 300,
                zoom: i.getZoom() + (e.shiftKey ? -1 : 1),
                around: i.unproject(t)
              }, {
                originalEvent: e
              });
            }
          };
        }
      }, {
        key: "enable",
        value: function enable() {
          this._enabled = !0;
        }
      }, {
        key: "disable",
        value: function disable() {
          this._enabled = !1, this.reset();
        }
      }, {
        key: "isEnabled",
        value: function isEnabled() {
          return this._enabled;
        }
      }, {
        key: "isActive",
        value: function isActive() {
          return this._active;
        }
      }]);

      return pr;
    }();

    var mr = /*#__PURE__*/function () {
      function mr() {
        _classCallCheck(this, mr);

        this._tap = new qo({
          numTouches: 1,
          numTaps: 1
        }), this.reset();
      }

      _createClass(mr, [{
        key: "reset",
        value: function reset() {
          this._active = !1, delete this._swipePoint, delete this._swipeTouch, delete this._tapTime, this._tap.reset();
        }
      }, {
        key: "touchstart",
        value: function touchstart(e, t, i) {
          this._swipePoint || (this._tapTime && e.timeStamp - this._tapTime > 500 && this.reset(), this._tapTime ? i.length > 0 && (this._swipePoint = t[0], this._swipeTouch = i[0].identifier) : this._tap.touchstart(e, t, i));
        }
      }, {
        key: "touchmove",
        value: function touchmove(e, t, i) {
          if (this._tapTime) {
            if (this._swipePoint) {
              if (i[0].identifier !== this._swipeTouch) return;

              var _o152 = t[0],
                  _r289 = _o152.y - this._swipePoint.y;

              return this._swipePoint = _o152, e.preventDefault(), this._active = !0, {
                zoomDelta: _r289 / 128
              };
            }
          } else this._tap.touchmove(e, t, i);
        }
      }, {
        key: "touchend",
        value: function touchend(e, t, i) {
          this._tapTime ? this._swipePoint && 0 === i.length && this.reset() : this._tap.touchend(e, t, i) && (this._tapTime = e.timeStamp);
        }
      }, {
        key: "touchcancel",
        value: function touchcancel() {
          this.reset();
        }
      }, {
        key: "enable",
        value: function enable() {
          this._enabled = !0;
        }
      }, {
        key: "disable",
        value: function disable() {
          this._enabled = !1, this.reset();
        }
      }, {
        key: "isEnabled",
        value: function isEnabled() {
          return this._enabled;
        }
      }, {
        key: "isActive",
        value: function isActive() {
          return this._active;
        }
      }]);

      return mr;
    }();

    var fr = /*#__PURE__*/function () {
      function fr(e, t, i) {
        _classCallCheck(this, fr);

        this._el = e, this._mousePan = t, this._touchPan = i;
      }

      _createClass(fr, [{
        key: "enable",
        value: function enable(e) {
          this._inertiaOptions = e || {}, this._mousePan.enable(), this._touchPan.enable(), this._el.classList.add("mapboxgl-touch-drag-pan");
        }
      }, {
        key: "disable",
        value: function disable() {
          this._mousePan.disable(), this._touchPan.disable(), this._el.classList.remove("mapboxgl-touch-drag-pan");
        }
      }, {
        key: "isEnabled",
        value: function isEnabled() {
          return this._mousePan.isEnabled() && this._touchPan.isEnabled();
        }
      }, {
        key: "isActive",
        value: function isActive() {
          return this._mousePan.isActive() || this._touchPan.isActive();
        }
      }]);

      return fr;
    }();

    var gr = /*#__PURE__*/function () {
      function gr(e, t, i) {
        _classCallCheck(this, gr);

        this._pitchWithRotate = e.pitchWithRotate, this._mouseRotate = t, this._mousePitch = i;
      }

      _createClass(gr, [{
        key: "enable",
        value: function enable() {
          this._mouseRotate.enable(), this._pitchWithRotate && this._mousePitch.enable();
        }
      }, {
        key: "disable",
        value: function disable() {
          this._mouseRotate.disable(), this._mousePitch.disable();
        }
      }, {
        key: "isEnabled",
        value: function isEnabled() {
          return this._mouseRotate.isEnabled() && (!this._pitchWithRotate || this._mousePitch.isEnabled());
        }
      }, {
        key: "isActive",
        value: function isActive() {
          return this._mouseRotate.isActive() || this._mousePitch.isActive();
        }
      }]);

      return gr;
    }();

    var vr = /*#__PURE__*/function () {
      function vr(e, t, i, o) {
        _classCallCheck(this, vr);

        this._el = e, this._touchZoom = t, this._touchRotate = i, this._tapDragZoom = o, this._rotationDisabled = !1, this._enabled = !0;
      }

      _createClass(vr, [{
        key: "enable",
        value: function enable(e) {
          this._touchZoom.enable(e), this._rotationDisabled || this._touchRotate.enable(e), this._tapDragZoom.enable(), this._el.classList.add("mapboxgl-touch-zoom-rotate");
        }
      }, {
        key: "disable",
        value: function disable() {
          this._touchZoom.disable(), this._touchRotate.disable(), this._tapDragZoom.disable(), this._el.classList.remove("mapboxgl-touch-zoom-rotate");
        }
      }, {
        key: "isEnabled",
        value: function isEnabled() {
          return this._touchZoom.isEnabled() && (this._rotationDisabled || this._touchRotate.isEnabled()) && this._tapDragZoom.isEnabled();
        }
      }, {
        key: "isActive",
        value: function isActive() {
          return this._touchZoom.isActive() || this._touchRotate.isActive() || this._tapDragZoom.isActive();
        }
      }, {
        key: "disableRotation",
        value: function disableRotation() {
          this._rotationDisabled = !0, this._touchRotate.disable();
        }
      }, {
        key: "enableRotation",
        value: function enableRotation() {
          this._rotationDisabled = !1, this._touchZoom.isEnabled() && this._touchRotate.enable();
        }
      }]);

      return vr;
    }();

    var xr = function xr(e) {
      return e.zoom || e.drag || e.pitch || e.rotate;
    };

    var yr = /*#__PURE__*/function (_e$Event4) {
      _inherits(yr, _e$Event4);

      var _super130 = _createSuper(yr);

      function yr() {
        _classCallCheck(this, yr);

        return _super130.apply(this, arguments);
      }

      return _createClass(yr);
    }(e.Event);

    var br = /*#__PURE__*/function () {
      function br() {
        _classCallCheck(this, br);

        this.constants = [1, 1, .01], this.radius = 0;
      }

      _createClass(br, [{
        key: "setup",
        value: function setup(t, i) {
          var o = e.sub([], i, t);
          this.radius = e.length(o[2] < 0 ? e.div([], o, this.constants) : [o[0], o[1], 0]);
        }
      }, {
        key: "projectRay",
        value: function projectRay(t) {
          e.div(t, t, this.constants), e.normalize(t, t), e.mul$1(t, t, this.constants);
          var i = e.scale$2([], t, this.radius);

          if (i[2] > 0) {
            var _t397 = e.scale$2([], [0, 0, 1], e.dot(i, [0, 0, 1])),
                _o153 = e.scale$2([], e.normalize([], [i[0], i[1], 0]), this.radius),
                _r290 = e.add([], i, e.scale$2([], e.sub([], e.add([], _o153, _t397), i), 2));

            i[0] = _r290[0], i[1] = _r290[1];
          }

          return i;
        }
      }]);

      return br;
    }();

    function wr(e) {
      return e.panDelta && e.panDelta.mag() || e.zoomDelta || e.bearingDelta || e.pitchDelta;
    }

    var Tr = /*#__PURE__*/function () {
      function Tr(t, i) {
        _classCallCheck(this, Tr);

        this._map = t, this._el = this._map.getCanvasContainer(), this._handlers = [], this._handlersById = {}, this._changes = [], this._inertia = new ko(t), this._bearingSnap = i.bearingSnap, this._previousActiveHandlers = {}, this._trackingEllipsoid = new br(), this._dragOrigin = null, this._eventsInProgress = {}, this._addDefaultHandlers(i), e.bindAll(["handleEvent", "handleWindowEvent"], this);
        var o = this._el;
        this._listeners = [[o, "touchstart", {
          passive: !0
        }], [o, "touchmove", {
          passive: !1
        }], [o, "touchend", void 0], [o, "touchcancel", void 0], [o, "mousedown", void 0], [o, "mousemove", void 0], [o, "mouseup", void 0], [e.window.document, "mousemove", {
          capture: !0
        }], [e.window.document, "mouseup", void 0], [o, "mouseover", void 0], [o, "mouseout", void 0], [o, "dblclick", void 0], [o, "click", void 0], [o, "keydown", {
          capture: !1
        }], [o, "keyup", void 0], [o, "wheel", {
          passive: !1
        }], [o, "contextmenu", void 0], [e.window, "blur", void 0]];

        var _iterator244 = _createForOfIteratorHelper(this._listeners),
            _step244;

        try {
          for (_iterator244.s(); !(_step244 = _iterator244.n()).done;) {
            var _ref187 = _step244.value;

            var _ref186 = _slicedToArray(_ref187, 3);

            var _t398 = _ref186[0];
            var _i273 = _ref186[1];
            var _o154 = _ref186[2];

            _t398.addEventListener(_i273, _t398 === e.window.document ? this.handleWindowEvent : this.handleEvent, _o154);
          }
        } catch (err) {
          _iterator244.e(err);
        } finally {
          _iterator244.f();
        }
      }

      _createClass(Tr, [{
        key: "destroy",
        value: function destroy() {
          var _iterator245 = _createForOfIteratorHelper(this._listeners),
              _step245;

          try {
            for (_iterator245.s(); !(_step245 = _iterator245.n()).done;) {
              var _ref190 = _step245.value;

              var _ref189 = _slicedToArray(_ref190, 3);

              var _t399 = _ref189[0];
              var _i274 = _ref189[1];
              var _o155 = _ref189[2];

              _t399.removeEventListener(_i274, _t399 === e.window.document ? this.handleWindowEvent : this.handleEvent, _o155);
            }
          } catch (err) {
            _iterator245.e(err);
          } finally {
            _iterator245.f();
          }
        }
      }, {
        key: "_addDefaultHandlers",
        value: function _addDefaultHandlers(e) {
          var t = this._map,
              i = t.getCanvasContainer();

          this._add("mapEvent", new Go(t, e));

          var o = t.boxZoom = new Zo(t, e);

          this._add("boxZoom", o);

          var r = new Xo(),
              n = new pr();
          t.doubleClickZoom = new dr(n, r), this._add("tapZoom", r), this._add("clickZoom", n);
          var a = new mr();

          this._add("tapDragZoom", a);

          var s = t.touchPitch = new sr(t);

          this._add("touchPitch", s);

          var l = new Yo(e),
              c = new Jo(e);
          t.dragRotate = new gr(e, l, c), this._add("mouseRotate", l, ["mousePitch"]), this._add("mousePitch", c, ["mouseRotate"]);
          var h = new Ko(e),
              u = new Qo(t, e);
          t.dragPan = new fr(i, h, u), this._add("mousePan", h), this._add("touchPan", u, ["touchZoom", "touchRotate"]);

          var _ = new nr(),
              d = new or();

          t.touchZoomRotate = new vr(i, d, _, a), this._add("touchRotate", _, ["touchPan", "touchZoom"]), this._add("touchZoom", d, ["touchPan", "touchRotate"]), this._add("blockableMapEvent", new jo(t));
          var p = t.scrollZoom = new _r(t, this);

          this._add("scrollZoom", p, ["mousePan"]);

          var m = t.keyboard = new cr();

          this._add("keyboard", m);

          for (var _i275 = 0, _arr4 = ["boxZoom", "doubleClickZoom", "tapDragZoom", "touchPitch", "dragRotate", "dragPan", "touchZoomRotate", "scrollZoom", "keyboard"]; _i275 < _arr4.length; _i275++) {
            var _i276 = _arr4[_i275];
            e.interactive && e[_i276] && t[_i276].enable(e[_i276]);
          }
        }
      }, {
        key: "_add",
        value: function _add(e, t, i) {
          this._handlers.push({
            handlerName: e,
            handler: t,
            allowed: i
          }), this._handlersById[e] = t;
        }
      }, {
        key: "stop",
        value: function stop(e) {
          if (!this._updatingCamera) {
            var _iterator246 = _createForOfIteratorHelper(this._handlers),
                _step246;

            try {
              for (_iterator246.s(); !(_step246 = _iterator246.n()).done;) {
                var _ref192 = _step246.value;
                var _e427 = _ref192.handler;

                _e427.reset();
              }
            } catch (err) {
              _iterator246.e(err);
            } finally {
              _iterator246.f();
            }

            this._inertia.clear(), this._fireEvents({}, {}, e), this._changes = [];
          }
        }
      }, {
        key: "isActive",
        value: function isActive() {
          var _iterator247 = _createForOfIteratorHelper(this._handlers),
              _step247;

          try {
            for (_iterator247.s(); !(_step247 = _iterator247.n()).done;) {
              var _ref194 = _step247.value;
              var _e428 = _ref194.handler;
              if (_e428.isActive()) return !0;
            }
          } catch (err) {
            _iterator247.e(err);
          } finally {
            _iterator247.f();
          }

          return !1;
        }
      }, {
        key: "isZooming",
        value: function isZooming() {
          return !!this._eventsInProgress.zoom || this._map.scrollZoom.isZooming();
        }
      }, {
        key: "isRotating",
        value: function isRotating() {
          return !!this._eventsInProgress.rotate;
        }
      }, {
        key: "isMoving",
        value: function isMoving() {
          return Boolean(xr(this._eventsInProgress)) || this.isZooming();
        }
      }, {
        key: "_blockedByActive",
        value: function _blockedByActive(e, t, i) {
          for (var _o156 in e) {
            if (_o156 !== i && (!t || t.indexOf(_o156) < 0)) return !0;
          }

          return !1;
        }
      }, {
        key: "handleWindowEvent",
        value: function handleWindowEvent(e) {
          this.handleEvent(e, "".concat(e.type, "Window"));
        }
      }, {
        key: "_getMapTouches",
        value: function _getMapTouches(e) {
          var t = [];

          var _iterator248 = _createForOfIteratorHelper(e),
              _step248;

          try {
            for (_iterator248.s(); !(_step248 = _iterator248.n()).done;) {
              var _i277 = _step248.value;
              this._el.contains(_i277.target) && t.push(_i277);
            }
          } catch (err) {
            _iterator248.e(err);
          } finally {
            _iterator248.f();
          }

          return t;
        }
      }, {
        key: "handleEvent",
        value: function handleEvent(e, t) {
          this._updatingCamera = !0;
          var i = "renderFrame" === e.type,
              o = i ? void 0 : e,
              r = {
            needsRenderFrame: !1
          },
              n = {},
              s = {},
              l = e.touches ? this._getMapTouches(e.touches) : void 0,
              c = l ? a.touchPos(this._el, l) : i ? void 0 : a.mousePos(this._el, e);

          var _iterator249 = _createForOfIteratorHelper(this._handlers),
              _step249;

          try {
            for (_iterator249.s(); !(_step249 = _iterator249.n()).done;) {
              var _ref196 = _step249.value;
              var _i278 = _ref196.handlerName;
              var _a128 = _ref196.handler;
              var _h40 = _ref196.allowed;
              if (!_a128.isEnabled()) continue;

              var _u63 = void 0;

              this._blockedByActive(s, _h40, _i278) ? _a128.reset() : _a128[t || e.type] && (_u63 = _a128[t || e.type](e, c, l), this.mergeHandlerResult(r, n, _u63, _i278, o), _u63 && _u63.needsRenderFrame && this._triggerRenderFrame()), (_u63 || _a128.isActive()) && (s[_i278] = _a128);
            }
          } catch (err) {
            _iterator249.e(err);
          } finally {
            _iterator249.f();
          }

          var h = {};

          for (var _e429 in this._previousActiveHandlers) {
            s[_e429] || (h[_e429] = o);
          }

          this._previousActiveHandlers = s, (Object.keys(h).length || wr(r)) && (this._changes.push([r, n, h]), this._triggerRenderFrame()), (Object.keys(s).length || wr(r)) && this._map._stop(!0), this._updatingCamera = !1;
          var u = r.cameraAnimation;
          u && (this._inertia.clear(), this._fireEvents({}, {}, !0), this._changes = [], u(this._map));
        }
      }, {
        key: "mergeHandlerResult",
        value: function mergeHandlerResult(t, i, o, r, n) {
          if (!o) return;
          e.extend(t, o);
          var a = {
            handlerName: r,
            originalEvent: o.originalEvent || n
          };
          void 0 !== o.zoomDelta && (i.zoom = a), void 0 !== o.panDelta && (i.drag = a), void 0 !== o.pitchDelta && (i.pitch = a), void 0 !== o.bearingDelta && (i.rotate = a);
        }
      }, {
        key: "_applyChanges",
        value: function _applyChanges() {
          var t = {},
              i = {},
              o = {};

          var _iterator250 = _createForOfIteratorHelper(this._changes),
              _step250;

          try {
            for (_iterator250.s(); !(_step250 = _iterator250.n()).done;) {
              var _ref199 = _step250.value;

              var _ref198 = _slicedToArray(_ref199, 3);

              var _r291 = _ref198[0];
              var _n195 = _ref198[1];
              var _a129 = _ref198[2];
              _r291.panDelta && (t.panDelta = (t.panDelta || new e.pointGeometry(0, 0))._add(_r291.panDelta)), _r291.zoomDelta && (t.zoomDelta = (t.zoomDelta || 0) + _r291.zoomDelta), _r291.bearingDelta && (t.bearingDelta = (t.bearingDelta || 0) + _r291.bearingDelta), _r291.pitchDelta && (t.pitchDelta = (t.pitchDelta || 0) + _r291.pitchDelta), void 0 !== _r291.around && (t.around = _r291.around), void 0 !== _r291.aroundCoord && (t.aroundCoord = _r291.aroundCoord), void 0 !== _r291.pinchAround && (t.pinchAround = _r291.pinchAround), _r291.noInertia && (t.noInertia = _r291.noInertia), e.extend(i, _n195), e.extend(o, _a129);
            }
          } catch (err) {
            _iterator250.e(err);
          } finally {
            _iterator250.f();
          }

          this._updateMapTransform(t, i, o), this._changes = [];
        }
      }, {
        key: "_updateMapTransform",
        value: function _updateMapTransform(t, i, o) {
          var _this122 = this;

          var r = this._map,
              n = r.transform,
              a = function a(e) {
            return [e.x, e.y, e.z];
          };

          if (function (e) {
            var t = _this122._eventsInProgress.drag;
            return t && !_this122._handlersById[t.handlerName].isActive();
          }() && !wr(t)) {
            var _e430 = n.zoom;
            n.cameraElevationReference = "sea", n.recenterOnTerrain(), n.cameraElevationReference = "ground", _e430 !== n.zoom && this._map._update(!0);
          }

          if (!wr(t)) return this._fireEvents(i, o, !0);
          var s = t.panDelta,
              l = t.zoomDelta,
              c = t.bearingDelta,
              h = t.pitchDelta,
              u = t.around,
              _ = t.aroundCoord,
              d = t.pinchAround;
          void 0 !== d && (u = d), function (e) {
            return i.drag && !_this122._eventsInProgress.drag;
          }() && u && (this._dragOrigin = a(n.pointCoordinate3D(u)), this._trackingEllipsoid.setup(n._camera.position, this._dragOrigin)), n.cameraElevationReference = "sea", r._stop(!0), u = u || r.transform.centerPoint, c && (n.bearing += c), h && (n.pitch += h), n._updateCameraState();
          var p = [0, 0, 0];

          if (s) {
            var _e431 = n.pointCoordinate(u),
                _t400 = n.pointCoordinate(u.sub(s));

            _e431 && _t400 && (p[0] = _t400.x - _e431.x, p[1] = _t400.y - _e431.y);
          }

          var m = n.zoom,
              f = [0, 0, 0];

          if (l) {
            var _t401 = a(_ || n.pointCoordinate3D(u)),
                _i279 = {
              dir: e.normalize([], e.sub([], _t401, n._camera.position))
            };

            if (_i279.dir[2] < 0) {
              var _o157 = n.zoomDeltaToMovement(_t401, l);

              e.scale$2(f, _i279.dir, _o157);
            }
          }

          var g = e.add(p, p, f);
          n._translateCameraConstrained(g), l && Math.abs(n.zoom - m) > 1e-4 && n.recenterOnTerrain(), n.cameraElevationReference = "ground", this._map._update(), t.noInertia || this._inertia.record(t), this._fireEvents(i, o, !0);
        }
      }, {
        key: "_fireEvents",
        value: function _fireEvents(t, i, o) {
          var _this123 = this;

          var r = xr(this._eventsInProgress),
              n = xr(t),
              a = {};

          for (var _e432 in t) {
            var _i280 = t[_e432].originalEvent;
            this._eventsInProgress[_e432] || (a["".concat(_e432, "start")] = _i280), this._eventsInProgress[_e432] = t[_e432];
          }

          !r && n && this._fireEvent("movestart", n.originalEvent);

          for (var _e433 in a) {
            this._fireEvent(_e433, a[_e433]);
          }

          n && this._fireEvent("move", n.originalEvent);

          for (var _e434 in t) {
            var _i281 = t[_e434].originalEvent;

            this._fireEvent(_e434, _i281);
          }

          var s = {};
          var l;

          for (var _e435 in this._eventsInProgress) {
            var _this$_eventsInProgre = this._eventsInProgress[_e435],
                _t402 = _this$_eventsInProgre.handlerName,
                _o158 = _this$_eventsInProgre.originalEvent;
            this._handlersById[_t402].isActive() || (delete this._eventsInProgress[_e435], l = i[_t402] || _o158, s["".concat(_e435, "end")] = l);
          }

          for (var _e436 in s) {
            this._fireEvent(_e436, s[_e436]);
          }

          var c = xr(this._eventsInProgress);

          if (o && (r || n) && !c) {
            this._updatingCamera = !0;

            var _t403 = this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),
                _i282 = function _i282(e) {
              return 0 !== e && -_this123._bearingSnap < e && e < _this123._bearingSnap;
            };

            _t403 ? (_i282(_t403.bearing || this._map.getBearing()) && (_t403.bearing = 0), this._map.easeTo(_t403, {
              originalEvent: l
            })) : (this._map.fire(new e.Event("moveend", {
              originalEvent: l
            })), _i282(this._map.getBearing()) && this._map.resetNorth()), this._updatingCamera = !1;
          }
        }
      }, {
        key: "_fireEvent",
        value: function _fireEvent(t, i) {
          this._map.fire(new e.Event(t, i ? {
            originalEvent: i
          } : {}));
        }
      }, {
        key: "_requestFrame",
        value: function _requestFrame() {
          var _this124 = this;

          return this._map.triggerRepaint(), this._map._renderTaskQueue.add(function (e) {
            delete _this124._frameId, _this124.handleEvent(new yr("renderFrame", {
              timeStamp: e
            })), _this124._applyChanges();
          });
        }
      }, {
        key: "_triggerRenderFrame",
        value: function _triggerRenderFrame() {
          void 0 === this._frameId && (this._frameId = this._requestFrame());
        }
      }]);

      return Tr;
    }();

    var Er = "map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";

    var Cr = /*#__PURE__*/function (_e$Evented10) {
      _inherits(Cr, _e$Evented10);

      var _super131 = _createSuper(Cr);

      function Cr(t, i) {
        var _this125;

        _classCallCheck(this, Cr);

        _this125 = _super131.call(this), _this125._moving = !1, _this125._zooming = !1, _this125.transform = t, _this125._bearingSnap = i.bearingSnap, e.bindAll(["_renderFrameCallback"], _assertThisInitialized(_this125));
        return _this125;
      }

      _createClass(Cr, [{
        key: "getCenter",
        value: function getCenter() {
          return new e.LngLat(this.transform.center.lng, this.transform.center.lat);
        }
      }, {
        key: "setCenter",
        value: function setCenter(e, t) {
          return this.jumpTo({
            center: e
          }, t);
        }
      }, {
        key: "panBy",
        value: function panBy(t, i, o) {
          return t = e.pointGeometry.convert(t).mult(-1), this.panTo(this.transform.center, e.extend({
            offset: t
          }, i), o);
        }
      }, {
        key: "panTo",
        value: function panTo(t, i, o) {
          return this.easeTo(e.extend({
            center: t
          }, i), o);
        }
      }, {
        key: "getZoom",
        value: function getZoom() {
          return this.transform.zoom;
        }
      }, {
        key: "setZoom",
        value: function setZoom(e, t) {
          return this.jumpTo({
            zoom: e
          }, t), this;
        }
      }, {
        key: "zoomTo",
        value: function zoomTo(t, i, o) {
          return this.easeTo(e.extend({
            zoom: t
          }, i), o);
        }
      }, {
        key: "zoomIn",
        value: function zoomIn(e, t) {
          return this.zoomTo(this.getZoom() + 1, e, t), this;
        }
      }, {
        key: "zoomOut",
        value: function zoomOut(e, t) {
          return this.zoomTo(this.getZoom() - 1, e, t), this;
        }
      }, {
        key: "getBearing",
        value: function getBearing() {
          return this.transform.bearing;
        }
      }, {
        key: "setBearing",
        value: function setBearing(e, t) {
          return this.jumpTo({
            bearing: e
          }, t), this;
        }
      }, {
        key: "getPadding",
        value: function getPadding() {
          return this.transform.padding;
        }
      }, {
        key: "setPadding",
        value: function setPadding(e, t) {
          return this.jumpTo({
            padding: e
          }, t), this;
        }
      }, {
        key: "rotateTo",
        value: function rotateTo(t, i, o) {
          return this.easeTo(e.extend({
            bearing: t
          }, i), o);
        }
      }, {
        key: "resetNorth",
        value: function resetNorth(t, i) {
          return this.rotateTo(0, e.extend({
            duration: 1e3
          }, t), i), this;
        }
      }, {
        key: "resetNorthPitch",
        value: function resetNorthPitch(t, i) {
          return this.easeTo(e.extend({
            bearing: 0,
            pitch: 0,
            duration: 1e3
          }, t), i), this;
        }
      }, {
        key: "snapToNorth",
        value: function snapToNorth(e, t) {
          return Math.abs(this.getBearing()) < this._bearingSnap ? this.resetNorth(e, t) : this;
        }
      }, {
        key: "getPitch",
        value: function getPitch() {
          return this.transform.pitch;
        }
      }, {
        key: "setPitch",
        value: function setPitch(e, t) {
          return this.jumpTo({
            pitch: e
          }, t), this;
        }
      }, {
        key: "cameraForBounds",
        value: function cameraForBounds(t, i) {
          t = e.LngLatBounds.convert(t);
          var o = i && i.bearing || 0;
          return this._cameraForBoxAndBearing(t.getNorthWest(), t.getSouthEast(), o, i);
        }
      }, {
        key: "_extendCameraOptions",
        value: function _extendCameraOptions(t) {
          var i = {
            top: 0,
            bottom: 0,
            right: 0,
            left: 0
          };

          if ("number" == typeof (t = e.extend({
            padding: i,
            offset: [0, 0],
            maxZoom: this.transform.maxZoom
          }, t)).padding) {
            var _e437 = t.padding;
            t.padding = {
              top: _e437,
              bottom: _e437,
              right: _e437,
              left: _e437
            };
          }

          return t.padding = e.extend(i, t.padding), t;
        }
      }, {
        key: "_cameraForBoxAndBearing",
        value: function _cameraForBoxAndBearing(t, i, o, r) {
          var n = this._extendCameraOptions(r),
              a = this.transform,
              s = a.padding,
              l = a.project(e.LngLat.convert(t)),
              c = a.project(e.LngLat.convert(i)),
              h = l.rotate(-e.degToRad(o)),
              u = c.rotate(-e.degToRad(o)),
              _ = new e.pointGeometry(Math.max(h.x, u.x), Math.max(h.y, u.y)),
              d = new e.pointGeometry(Math.min(h.x, u.x), Math.min(h.y, u.y)),
              p = _.sub(d),
              m = (a.width - (s.left + s.right + n.padding.left + n.padding.right)) / p.x,
              f = (a.height - (s.top + s.bottom + n.padding.top + n.padding.bottom)) / p.y;

          if (f < 0 || m < 0) return void e.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");
          var g = Math.min(a.scaleZoom(a.scale * Math.min(m, f)), n.maxZoom),
              v = "number" == typeof n.offset.x ? new e.pointGeometry(n.offset.x, n.offset.y) : e.pointGeometry.convert(n.offset),
              x = new e.pointGeometry((n.padding.left - n.padding.right) / 2, (n.padding.top - n.padding.bottom) / 2).rotate(o * Math.PI / 180),
              y = v.add(x).mult(a.scale / a.zoomScale(g));
          return {
            center: a.unproject(l.add(c).div(2).sub(y)),
            zoom: g,
            bearing: o
          };
        }
      }, {
        key: "_cameraForBox",
        value: function _cameraForBox(t, i, o, r, n) {
          var a = this._extendCameraOptions(n);

          o = o || 0, r = r || 0, t = e.LngLat.convert(t), i = e.LngLat.convert(i);
          var s = this.transform.clone();
          s.padding = a.padding;
          var l = this.getFreeCameraOptions(),
              c = new e.LngLat(.5 * (t.lng + i.lng), .5 * (t.lat + i.lat)),
              h = .5 * (o + r);
          if (s._camera.position[2] < e.mercatorZfromAltitude(h, c.lat)) return void e.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");
          l.lookAtPoint(c), s.setFreeCameraOptions(l);

          var u = e.MercatorCoordinate.fromLngLat(t),
              _ = e.MercatorCoordinate.fromLngLat(i),
              d = s.pointRayIntersection(s.centerPoint, h),
              p = [(m = s.rayIntersectionCoordinate(d)).x, m.y, m.z];

          var m;
          var f = s.screenPointToMercatorRay(s.centerPoint),
              g = "globe" !== s.projection.name;
          var v,
              x = 0;

          do {
            var _t404 = Math.floor(s.zoom),
                _i283 = 1 << _t404,
                _n196 = Math.min(_i283 * u.x, _i283 * _.x),
                _a130 = Math.min(_i283 * u.y, _i283 * _.y),
                _l79 = Math.max(_i283 * u.x, _i283 * _.x),
                _c55 = Math.max(_i283 * u.y, _i283 * _.y),
                _h41 = new e.Aabb([_n196, _a130, o], [_l79, _c55, r]),
                _d27 = e.Frustum.fromInvProjectionMatrix(s.invProjMatrix, s.worldSize, _t404, g);

            if (2 !== _h41.intersects(_d27)) {
              v && (s._camera.position = e.scaleAndAdd([], s._camera.position, f.dir, -v), s._updateStateFromCamera());
              break;
            }

            var _m18 = e.sub([], s._camera.position, p);

            v = .5 * e.length(_m18), s._camera.position = e.scaleAndAdd([], s._camera.position, f.dir, v);

            try {
              s._updateStateFromCamera();
            } catch (t) {
              return void e.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");
            }
          } while (++x < 10);

          return {
            center: s.center,
            zoom: s.zoom,
            bearing: s.bearing,
            pitch: s.pitch
          };
        }
      }, {
        key: "fitBounds",
        value: function fitBounds(e, t, i) {
          return this._fitInternal(this.cameraForBounds(e, t), t, i);
        }
      }, {
        key: "_raycastElevationBox",
        value: function _raycastElevationBox(t, i) {
          var o = this.transform.elevation;
          if (!o) return;
          var r = new e.pointGeometry(t.x, i.y),
              n = new e.pointGeometry(i.x, t.y),
              a = o.pointCoordinate(t);
          if (!a) return;
          var s = o.pointCoordinate(i);
          if (!s) return;
          var l = o.pointCoordinate(r);
          if (!l) return;
          var c = o.pointCoordinate(n);
          if (!c) return;

          var h = new e.MercatorCoordinate(a[0], a[1]).toLngLat(),
              u = new e.MercatorCoordinate(s[0], s[1]).toLngLat(),
              _ = new e.MercatorCoordinate(l[0], l[1]).toLngLat(),
              d = new e.MercatorCoordinate(c[0], c[1]).toLngLat(),
              p = Math.min(h.lng, Math.min(u.lng, Math.min(_.lng, d.lng))),
              m = Math.min(h.lat, Math.min(u.lat, Math.min(_.lat, d.lat))),
              f = Math.max(h.lng, Math.max(u.lng, Math.max(_.lng, d.lng))),
              g = Math.max(h.lat, Math.max(u.lat, Math.max(_.lat, d.lat))),
              v = Math.min(a[3], Math.min(s[3], Math.min(l[3], c[3]))),
              x = Math.max(a[3], Math.max(s[3], Math.max(l[3], c[3])));

          return {
            minLngLat: new e.LngLat(p, m),
            maxLngLat: new e.LngLat(f, g),
            minAltitude: v,
            maxAltitude: x
          };
        }
      }, {
        key: "fitScreenCoordinates",
        value: function fitScreenCoordinates(t, i, o, r, n) {
          var a, s, l, c;

          var h = e.pointGeometry.convert(t),
              u = e.pointGeometry.convert(i),
              _ = this._raycastElevationBox(h, u);

          if (_) a = _.minLngLat, s = _.maxLngLat, l = _.minAltitude, c = _.maxAltitude;else {
            if (this.transform.anyCornerOffEdge(h, u)) return this;
            a = this.transform.pointLocation(h), s = this.transform.pointLocation(u);
          }
          return this._fitInternal(0 === this.transform.pitch ? this._cameraForBoxAndBearing(this.transform.pointLocation(e.pointGeometry.convert(t)), this.transform.pointLocation(e.pointGeometry.convert(i)), o, r) : this._cameraForBox(a, s, l, c, r), r, n);
        }
      }, {
        key: "_fitInternal",
        value: function _fitInternal(t, i, o) {
          return t ? (delete (i = e.extend(t, i)).padding, i.linear ? this.easeTo(i, o) : this.flyTo(i, o)) : this;
        }
      }, {
        key: "jumpTo",
        value: function jumpTo(t, i) {
          this.stop();
          var o = t.preloadOnly ? this.transform.clone() : this.transform;
          var r = !1,
              n = !1,
              a = !1;
          return "zoom" in t && o.zoom !== +t.zoom && (r = !0, o.zoom = +t.zoom), void 0 !== t.center && (o.center = e.LngLat.convert(t.center)), "bearing" in t && o.bearing !== +t.bearing && (n = !0, o.bearing = +t.bearing), "pitch" in t && o.pitch !== +t.pitch && (a = !0, o.pitch = +t.pitch), null == t.padding || o.isPaddingEqual(t.padding) || (o.padding = t.padding), t.preloadOnly ? (this._preloadTiles(o), this) : (this.fire(new e.Event("movestart", i)).fire(new e.Event("move", i)), r && this.fire(new e.Event("zoomstart", i)).fire(new e.Event("zoom", i)).fire(new e.Event("zoomend", i)), n && this.fire(new e.Event("rotatestart", i)).fire(new e.Event("rotate", i)).fire(new e.Event("rotateend", i)), a && this.fire(new e.Event("pitchstart", i)).fire(new e.Event("pitch", i)).fire(new e.Event("pitchend", i)), this.fire(new e.Event("moveend", i)));
        }
      }, {
        key: "getFreeCameraOptions",
        value: function getFreeCameraOptions() {
          return this.transform.projection.supportsFreeCamera || e.warnOnce(Er), this.transform.getFreeCameraOptions();
        }
      }, {
        key: "setFreeCameraOptions",
        value: function setFreeCameraOptions(t, i) {
          var o = this.transform;
          if (!o.projection.supportsFreeCamera) return void e.warnOnce(Er);
          this.stop();
          var r = o.zoom,
              n = o.pitch,
              a = o.bearing;
          o.setFreeCameraOptions(t);
          var s = r !== o.zoom,
              l = n !== o.pitch,
              c = a !== o.bearing;
          return this.fire(new e.Event("movestart", i)).fire(new e.Event("move", i)), s && this.fire(new e.Event("zoomstart", i)).fire(new e.Event("zoom", i)).fire(new e.Event("zoomend", i)), c && this.fire(new e.Event("rotatestart", i)).fire(new e.Event("rotate", i)).fire(new e.Event("rotateend", i)), l && this.fire(new e.Event("pitchstart", i)).fire(new e.Event("pitch", i)).fire(new e.Event("pitchend", i)), this.fire(new e.Event("moveend", i)), this;
        }
      }, {
        key: "easeTo",
        value: function easeTo(t, i) {
          var _this126 = this;

          this._stop(!1, t.easeId), (!1 === (t = e.extend({
            offset: [0, 0],
            duration: 500,
            easing: e.ease
          }, t)).animate || !t.essential && e.exported.prefersReducedMotion) && (t.duration = 0);

          var o = this.transform,
              r = this.getZoom(),
              n = this.getBearing(),
              a = this.getPitch(),
              s = this.getPadding(),
              l = "zoom" in t ? +t.zoom : r,
              c = "bearing" in t ? this._normalizeBearing(t.bearing, n) : n,
              h = "pitch" in t ? +t.pitch : a,
              u = "padding" in t ? t.padding : o.padding,
              _ = e.pointGeometry.convert(t.offset);

          var d = o.centerPoint.add(_);
          var p = "globe" === o.projection.name ? o.pointCoordinate(d).toLngLat() : o.pointLocation(d),
              m = e.LngLat.convert(t.center || p);

          this._normalizeCenter(m);

          var f = o.project(p),
              g = o.project(m).sub(f),
              v = o.zoomScale(l - r);
          var x, y;
          t.around && (x = e.LngLat.convert(t.around), y = o.locationPoint(x));

          var b = this._zooming || l !== r,
              w = this._rotating || n !== c,
              T = this._pitching || h !== a,
              E = !o.isPaddingEqual(u),
              C = function C(o) {
            return function (p) {
              if (b && (o.zoom = e.number(r, l, p)), w && (o.bearing = e.number(n, c, p)), T && (o.pitch = e.number(a, h, p)), E && (o.interpolatePadding(s, u, p), d = o.centerPoint.add(_)), x) o.setLocationAtPoint(x, y);else {
                var _e438 = o.zoomScale(o.zoom - r),
                    _t405 = l > r ? Math.min(2, v) : Math.max(.5, v),
                    _i284 = Math.pow(_t405, 1 - p),
                    _n197 = o.unproject(f.add(g.mult(p * _i284)).mult(_e438));

                o.setLocationAtPoint(o.renderWorldCopies ? _n197.wrap() : _n197, d);
              }
              return t.preloadOnly || _this126._fireMoveEvents(i), o;
            };
          };

          if (t.preloadOnly) {
            var _e439 = this._emulate(C, t.duration, o);

            return this._preloadTiles(_e439), this;
          }

          var M = {
            moving: this._moving,
            zooming: this._zooming,
            rotating: this._rotating,
            pitching: this._pitching
          };
          return this._zooming = b, this._rotating = w, this._pitching = T, this._padding = E, this._easeId = t.easeId, this._prepareEase(i, t.noMoveStart, M), this._ease(C(o), function (e) {
            o.recenterOnTerrain(), _this126._afterEase(i, e);
          }, t), this;
        }
      }, {
        key: "_prepareEase",
        value: function _prepareEase(t, i) {
          var o = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
          this._moving = !0, this.transform.cameraElevationReference = "sea", i || o.moving || this.fire(new e.Event("movestart", t)), this._zooming && !o.zooming && this.fire(new e.Event("zoomstart", t)), this._rotating && !o.rotating && this.fire(new e.Event("rotatestart", t)), this._pitching && !o.pitching && this.fire(new e.Event("pitchstart", t));
        }
      }, {
        key: "_fireMoveEvents",
        value: function _fireMoveEvents(t) {
          this.fire(new e.Event("move", t)), this._zooming && this.fire(new e.Event("zoom", t)), this._rotating && this.fire(new e.Event("rotate", t)), this._pitching && this.fire(new e.Event("pitch", t));
        }
      }, {
        key: "_afterEase",
        value: function _afterEase(t, i) {
          if (this._easeId && i && this._easeId === i) return;
          delete this._easeId, this.transform.cameraElevationReference = "ground";
          var o = this._zooming,
              r = this._rotating,
              n = this._pitching;
          this._moving = !1, this._zooming = !1, this._rotating = !1, this._pitching = !1, this._padding = !1, o && this.fire(new e.Event("zoomend", t)), r && this.fire(new e.Event("rotateend", t)), n && this.fire(new e.Event("pitchend", t)), this.fire(new e.Event("moveend", t));
        }
      }, {
        key: "flyTo",
        value: function flyTo(t, i) {
          var _this127 = this;

          if (!t.essential && e.exported.prefersReducedMotion) {
            var _o159 = e.pick(t, ["center", "zoom", "bearing", "pitch", "around"]);

            return this.jumpTo(_o159, i);
          }

          this.stop(), t = e.extend({
            offset: [0, 0],
            speed: 1.2,
            curve: 1.42,
            easing: e.ease
          }, t);

          var o = this.transform,
              r = this.getZoom(),
              n = this.getBearing(),
              a = this.getPitch(),
              s = this.getPadding(),
              l = "zoom" in t ? e.clamp(+t.zoom, o.minZoom, o.maxZoom) : r,
              c = "bearing" in t ? this._normalizeBearing(t.bearing, n) : n,
              h = "pitch" in t ? +t.pitch : a,
              u = "padding" in t ? t.padding : o.padding,
              _ = o.zoomScale(l - r),
              d = e.pointGeometry.convert(t.offset);

          var p = o.centerPoint.add(d);
          var m = o.pointLocation(p),
              f = e.LngLat.convert(t.center || m);

          this._normalizeCenter(f);

          var g = o.project(m),
              v = o.project(f).sub(g);
          var x = t.curve;
          var y = Math.max(o.width, o.height),
              b = y / _,
              w = v.mag();

          if ("minZoom" in t) {
            var _i285 = e.clamp(Math.min(t.minZoom, r, l), o.minZoom, o.maxZoom),
                _n198 = y / o.zoomScale(_i285 - r);

            x = Math.sqrt(_n198 / w * 2);
          }

          var T = x * x;

          function E(e) {
            var t = (b * b - y * y + (e ? -1 : 1) * T * T * w * w) / (2 * (e ? b : y) * T * w);
            return Math.log(Math.sqrt(t * t + 1) - t);
          }

          function C(e) {
            return (Math.exp(e) - Math.exp(-e)) / 2;
          }

          function M(e) {
            return (Math.exp(e) + Math.exp(-e)) / 2;
          }

          var S = E(0);

          var I = function I(e) {
            return M(S) / M(S + x * e);
          },
              z = function z(e) {
            return y * ((M(S) * (C(t = S + x * e) / M(t)) - C(S)) / T) / w;
            var t;
          },
              D = (E(1) - S) / x;

          if (Math.abs(w) < 1e-6 || !isFinite(D)) {
            if (Math.abs(y - b) < 1e-6) return this.easeTo(t, i);

            var _e440 = b < y ? -1 : 1;

            D = Math.abs(Math.log(b / y)) / x, z = function z() {
              return 0;
            }, I = function I(t) {
              return Math.exp(_e440 * x * t);
            };
          }

          t.duration = "duration" in t ? +t.duration : 1e3 * D / ("screenSpeed" in t ? +t.screenSpeed / x : +t.speed), t.maxDuration && t.duration > t.maxDuration && (t.duration = 0);

          var P = n !== c,
              A = h !== a,
              L = !o.isPaddingEqual(u),
              R = function R(o) {
            return function (_) {
              var m = _ * D,
                  x = 1 / I(m);
              o.zoom = 1 === _ ? l : r + o.scaleZoom(x), P && (o.bearing = e.number(n, c, _)), A && (o.pitch = e.number(a, h, _)), L && (o.interpolatePadding(s, u, _), p = o.centerPoint.add(d));
              var y = 1 === _ ? f : o.unproject(g.add(v.mult(z(m))).mult(x));
              return o.setLocationAtPoint(o.renderWorldCopies ? y.wrap() : y, p), o._updateCenterElevation(), t.preloadOnly || _this127._fireMoveEvents(i), o;
            };
          };

          if (t.preloadOnly) {
            var _e441 = this._emulate(R, t.duration, o);

            return this._preloadTiles(_e441), this;
          }

          return this._zooming = !0, this._rotating = P, this._pitching = A, this._padding = L, this._prepareEase(i, !1), this._ease(R(o), function () {
            return _this127._afterEase(i);
          }, t), this;
        }
      }, {
        key: "isEasing",
        value: function isEasing() {
          return !!this._easeFrameId;
        }
      }, {
        key: "stop",
        value: function stop() {
          return this._stop();
        }
      }, {
        key: "_stop",
        value: function _stop(e, t) {
          if (this._easeFrameId && (this._cancelRenderFrame(this._easeFrameId), delete this._easeFrameId, delete this._onEaseFrame), this._onEaseEnd) {
            var _e442 = this._onEaseEnd;
            delete this._onEaseEnd, _e442.call(this, t);
          }

          if (!e) {
            var _e443 = this.handlers;
            _e443 && _e443.stop(!1);
          }

          return this;
        }
      }, {
        key: "_ease",
        value: function _ease(t, i, o) {
          !1 === o.animate || 0 === o.duration ? (t(1), i()) : (this._easeStart = e.exported.now(), this._easeOptions = o, this._onEaseFrame = t, this._onEaseEnd = i, this._easeFrameId = this._requestRenderFrame(this._renderFrameCallback));
        }
      }, {
        key: "_renderFrameCallback",
        value: function _renderFrameCallback() {
          var t = Math.min((e.exported.now() - this._easeStart) / this._easeOptions.duration, 1);
          this._onEaseFrame(this._easeOptions.easing(t)), t < 1 ? this._easeFrameId = this._requestRenderFrame(this._renderFrameCallback) : this.stop();
        }
      }, {
        key: "_normalizeBearing",
        value: function _normalizeBearing(t, i) {
          t = e.wrap(t, -180, 180);
          var o = Math.abs(t - i);
          return Math.abs(t - 360 - i) < o && (t -= 360), Math.abs(t + 360 - i) < o && (t += 360), t;
        }
      }, {
        key: "_normalizeCenter",
        value: function _normalizeCenter(e) {
          var t = this.transform;
          if (!t.renderWorldCopies || t.maxBounds) return;
          var i = e.lng - t.center.lng;
          e.lng += i > 180 ? -360 : i < -180 ? 360 : 0;
        }
      }, {
        key: "_emulate",
        value: function _emulate(e, t, i) {
          var o = Math.ceil(15 * t / 1e3),
              r = [],
              n = e(i.clone());

          for (var _e444 = 0; _e444 <= o; _e444++) {
            var _t406 = n(_e444 / o);

            r.push(_t406.clone());
          }

          return r;
        }
      }]);

      return Cr;
    }(e.Evented);

    var Mr = /*#__PURE__*/function () {
      function Mr() {
        var t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

        _classCallCheck(this, Mr);

        this.options = t, e.bindAll(["_toggleAttribution", "_updateEditLink", "_updateData", "_updateCompact"], this);
      }

      _createClass(Mr, [{
        key: "getDefaultPosition",
        value: function getDefaultPosition() {
          return "bottom-right";
        }
      }, {
        key: "onAdd",
        value: function onAdd(e) {
          var t = this.options && this.options.compact;
          return this._map = e, this._container = a.create("div", "mapboxgl-ctrl mapboxgl-ctrl-attrib"), this._compactButton = a.create("button", "mapboxgl-ctrl-attrib-button", this._container), a.create("span", "mapboxgl-ctrl-icon", this._compactButton).setAttribute("aria-hidden", !0), this._compactButton.type = "button", this._compactButton.addEventListener("click", this._toggleAttribution), this._setElementTitle(this._compactButton, "ToggleAttribution"), this._innerContainer = a.create("div", "mapboxgl-ctrl-attrib-inner", this._container), this._innerContainer.setAttribute("role", "list"), t && this._container.classList.add("mapboxgl-compact"), this._updateAttributions(), this._updateEditLink(), this._map.on("styledata", this._updateData), this._map.on("sourcedata", this._updateData), this._map.on("moveend", this._updateEditLink), void 0 === t && (this._map.on("resize", this._updateCompact), this._updateCompact()), this._container;
        }
      }, {
        key: "onRemove",
        value: function onRemove() {
          this._container.remove(), this._map.off("styledata", this._updateData), this._map.off("sourcedata", this._updateData), this._map.off("moveend", this._updateEditLink), this._map.off("resize", this._updateCompact), this._map = void 0, this._attribHTML = void 0;
        }
      }, {
        key: "_setElementTitle",
        value: function _setElementTitle(e, t) {
          var i = this._map._getUIString("AttributionControl.".concat(t));

          e.setAttribute("aria-label", i), e.removeAttribute("title"), e.firstElementChild && e.firstElementChild.setAttribute("title", i);
        }
      }, {
        key: "_toggleAttribution",
        value: function _toggleAttribution() {
          this._container.classList.contains("mapboxgl-compact-show") ? (this._container.classList.remove("mapboxgl-compact-show"), this._compactButton.setAttribute("aria-expanded", "false")) : (this._container.classList.add("mapboxgl-compact-show"), this._compactButton.setAttribute("aria-expanded", "true"));
        }
      }, {
        key: "_updateEditLink",
        value: function _updateEditLink() {
          var t = this._editLink;
          t || (t = this._editLink = this._container.querySelector(".mapbox-improve-map"));
          var i = [{
            key: "owner",
            value: this.styleOwner
          }, {
            key: "id",
            value: this.styleId
          }, {
            key: "access_token",
            value: this._map._requestManager._customAccessToken || e.config.ACCESS_TOKEN
          }];

          if (t) {
            var _o160 = i.reduce(function (e, t, o) {
              return t.value && (e += "".concat(t.key, "=").concat(t.value).concat(o < i.length - 1 ? "&" : "")), e;
            }, "?");

            t.href = "".concat(e.config.FEEDBACK_URL, "/").concat(_o160).concat(this._map._hash ? this._map._hash.getHashString(!0) : ""), t.rel = "noopener nofollow", this._setElementTitle(t, "MapFeedback");
          }
        }
      }, {
        key: "_updateData",
        value: function _updateData(e) {
          !e || "metadata" !== e.sourceDataType && "visibility" !== e.sourceDataType && "style" !== e.dataType || (this._updateAttributions(), this._updateEditLink());
        }
      }, {
        key: "_updateAttributions",
        value: function _updateAttributions() {
          if (!this._map.style) return;
          var e = [];

          if (this._map.style.stylesheet) {
            var _e445 = this._map.style.stylesheet;
            this.styleOwner = _e445.owner, this.styleId = _e445.id;
          }

          var t = this._map.style._sourceCaches;

          for (var _i286 in t) {
            var _o161 = t[_i286];

            if (_o161.used) {
              var _t407 = _o161.getSource();

              _t407.attribution && e.indexOf(_t407.attribution) < 0 && e.push(_t407.attribution);
            }
          }

          e.sort(function (e, t) {
            return e.length - t.length;
          }), e = e.filter(function (t, i) {
            for (var _o162 = i + 1; _o162 < e.length; _o162++) {
              if (e[_o162].indexOf(t) >= 0) return !1;
            }

            return !0;
          }), this.options.customAttribution && (Array.isArray(this.options.customAttribution) ? e = [].concat(_toConsumableArray(this.options.customAttribution), _toConsumableArray(e)) : e.unshift(this.options.customAttribution));
          var i = e.join(" | ");
          i !== this._attribHTML && (this._attribHTML = i, e.length ? (this._innerContainer.innerHTML = i, this._container.classList.remove("mapboxgl-attrib-empty")) : this._container.classList.add("mapboxgl-attrib-empty"), this._editLink = null);
        }
      }, {
        key: "_updateCompact",
        value: function _updateCompact() {
          this._map.getCanvasContainer().offsetWidth <= 640 ? this._container.classList.add("mapboxgl-compact") : this._container.classList.remove("mapboxgl-compact", "mapboxgl-compact-show");
        }
      }]);

      return Mr;
    }();

    var Sr = /*#__PURE__*/function () {
      function Sr() {
        _classCallCheck(this, Sr);

        e.bindAll(["_updateLogo"], this), e.bindAll(["_updateCompact"], this);
      }

      _createClass(Sr, [{
        key: "onAdd",
        value: function onAdd(e) {
          this._map = e, this._container = a.create("div", "mapboxgl-ctrl");
          var t = a.create("a", "mapboxgl-ctrl-logo");
          return t.target = "_blank", t.rel = "noopener nofollow", t.href = "https://www.mapbox.com/", t.setAttribute("aria-label", this._map._getUIString("LogoControl.Title")), t.setAttribute("rel", "noopener nofollow"), this._container.appendChild(t), this._container.style.display = "none", this._map.on("sourcedata", this._updateLogo), this._updateLogo(), this._map.on("resize", this._updateCompact), this._updateCompact(), this._container;
        }
      }, {
        key: "onRemove",
        value: function onRemove() {
          this._container.remove(), this._map.off("sourcedata", this._updateLogo), this._map.off("resize", this._updateCompact);
        }
      }, {
        key: "getDefaultPosition",
        value: function getDefaultPosition() {
          return "bottom-left";
        }
      }, {
        key: "_updateLogo",
        value: function _updateLogo(e) {
          e && "metadata" !== e.sourceDataType || (this._container.style.display = this._logoRequired() ? "block" : "none");
        }
      }, {
        key: "_logoRequired",
        value: function _logoRequired() {
          if (!this._map.style) return !0;
          var e = this._map.style._sourceCaches;
          if (0 === Object.entries(e).length) return !0;

          for (var _t408 in e) {
            var _i287 = e[_t408].getSource();

            if (_i287.hasOwnProperty("mapbox_logo") && !_i287.mapbox_logo) return !1;
          }

          return !0;
        }
      }, {
        key: "_updateCompact",
        value: function _updateCompact() {
          var e = this._container.children;

          if (e.length) {
            var _t409 = e[0];
            this._map.getCanvasContainer().offsetWidth < 250 ? _t409.classList.add("mapboxgl-compact") : _t409.classList.remove("mapboxgl-compact");
          }
        }
      }]);

      return Sr;
    }();

    var Ir = /*#__PURE__*/function () {
      function Ir() {
        _classCallCheck(this, Ir);

        this._queue = [], this._id = 0, this._cleared = !1, this._currentlyRunning = !1;
      }

      _createClass(Ir, [{
        key: "add",
        value: function add(e) {
          var t = ++this._id;
          return this._queue.push({
            callback: e,
            id: t,
            cancelled: !1
          }), t;
        }
      }, {
        key: "remove",
        value: function remove(e) {
          var t = this._currentlyRunning,
              i = t ? this._queue.concat(t) : this._queue;

          var _iterator251 = _createForOfIteratorHelper(i),
              _step251;

          try {
            for (_iterator251.s(); !(_step251 = _iterator251.n()).done;) {
              var _t410 = _step251.value;
              if (_t410.id === e) return void (_t410.cancelled = !0);
            }
          } catch (err) {
            _iterator251.e(err);
          } finally {
            _iterator251.f();
          }
        }
      }, {
        key: "run",
        value: function run() {
          var e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
          var t = this._currentlyRunning = this._queue;
          this._queue = [];

          var _iterator252 = _createForOfIteratorHelper(t),
              _step252;

          try {
            for (_iterator252.s(); !(_step252 = _iterator252.n()).done;) {
              var _i288 = _step252.value;
              if (!_i288.cancelled && (_i288.callback(e), this._cleared)) break;
            }
          } catch (err) {
            _iterator252.e(err);
          } finally {
            _iterator252.f();
          }

          this._cleared = !1, this._currentlyRunning = !1;
        }
      }, {
        key: "clear",
        value: function clear() {
          this._currentlyRunning && (this._cleared = !0), this._queue = [];
        }
      }]);

      return Ir;
    }();

    function zr(t, i, o) {
      if (t = new e.LngLat(t.lng, t.lat), i) {
        var _r292 = new e.LngLat(t.lng - 360, t.lat),
            _n199 = new e.LngLat(t.lng + 360, t.lat),
            _a131 = 360 * Math.ceil(Math.abs(t.lng - o.center.lng) / 360),
            _s142 = o.locationPoint(t).distSqr(i),
            _l80 = i.x < 0 || i.y < 0 || i.x > o.width || i.y > o.height;

        o.locationPoint(_r292).distSqr(i) < _s142 && (_l80 || Math.abs(_r292.lng - o.center.lng) < _a131) ? t = _r292 : o.locationPoint(_n199).distSqr(i) < _s142 && (_l80 || Math.abs(_n199.lng - o.center.lng) < _a131) && (t = _n199);
      }

      for (; Math.abs(t.lng - o.center.lng) > 180;) {
        var _e446 = o.locationPoint(t);

        if (_e446.x >= 0 && _e446.y >= 0 && _e446.x <= o.width && _e446.y <= o.height) break;
        t.lng > o.center.lng ? t.lng -= 360 : t.lng += 360;
      }

      return t;
    }

    var Dr = {
      center: "translate(-50%,-50%)",
      top: "translate(-50%,0)",
      "top-left": "translate(0,0)",
      "top-right": "translate(-100%,0)",
      bottom: "translate(-50%,-100%)",
      "bottom-left": "translate(0,-100%)",
      "bottom-right": "translate(-100%,-100%)",
      left: "translate(0,-50%)",
      right: "translate(-100%,-50%)"
    };

    var Pr = /*#__PURE__*/function (_e$Evented11) {
      _inherits(Pr, _e$Evented11);

      var _super132 = _createSuper(Pr);

      function Pr(t, i) {
        var _this128;

        _classCallCheck(this, Pr);

        if (_this128 = _super132.call(this), (t instanceof e.window.HTMLElement || i) && (t = e.extend({
          element: t
        }, i)), e.bindAll(["_update", "_onMove", "_onUp", "_addDragHandler", "_onMapClick", "_onKeyPress", "_clearFadeTimer"], _assertThisInitialized(_this128)), _this128._anchor = t && t.anchor || "center", _this128._color = t && t.color || "#3FB1CE", _this128._scale = t && t.scale || 1, _this128._draggable = t && t.draggable || !1, _this128._clickTolerance = t && t.clickTolerance || 0, _this128._isDragging = !1, _this128._state = "inactive", _this128._rotation = t && t.rotation || 0, _this128._rotationAlignment = t && t.rotationAlignment || "auto", _this128._pitchAlignment = t && t.pitchAlignment && "auto" !== t.pitchAlignment ? t.pitchAlignment : _this128._rotationAlignment, _this128._updateMoving = function () {
          return _this128._update(!0);
        }, t && t.element) _this128._element = t.element, _this128._offset = e.pointGeometry.convert(t && t.offset || [0, 0]);else {
          _this128._defaultMarker = !0, _this128._element = a.create("div");

          var _i289 = 41,
              _o163 = 27,
              _r293 = a.createSVG("svg", {
            display: "block",
            height: _i289 * _this128._scale + "px",
            width: _o163 * _this128._scale + "px",
            viewBox: "0 0 ".concat(_o163, " ").concat(_i289)
          }, _this128._element),
              _n200 = a.createSVG("radialGradient", {
            id: "shadowGradient"
          }, a.createSVG("defs", {}, _r293));

          a.createSVG("stop", {
            offset: "10%",
            "stop-opacity": .4
          }, _n200), a.createSVG("stop", {
            offset: "100%",
            "stop-opacity": .05
          }, _n200), a.createSVG("ellipse", {
            cx: 13.5,
            cy: 34.8,
            rx: 10.5,
            ry: 5.25,
            fill: "url(#shadowGradient)"
          }, _r293), a.createSVG("path", {
            fill: _this128._color,
            d: "M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"
          }, _r293), a.createSVG("path", {
            opacity: .25,
            d: "M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"
          }, _r293), a.createSVG("circle", {
            fill: "white",
            cx: 13.5,
            cy: 13.5,
            r: 5.5
          }, _r293), _this128._offset = e.pointGeometry.convert(t && t.offset || [0, -14]);
        }
        _this128._element.hasAttribute("aria-label") || _this128._element.setAttribute("aria-label", "Map marker"), _this128._element.classList.add("mapboxgl-marker"), _this128._element.addEventListener("dragstart", function (e) {
          e.preventDefault();
        }), _this128._element.addEventListener("mousedown", function (e) {
          e.preventDefault();
        });
        var o = _this128._element.classList;

        for (var _e447 in Dr) {
          o.remove("mapboxgl-marker-anchor-".concat(_e447));
        }

        o.add("mapboxgl-marker-anchor-".concat(_this128._anchor)), _this128._popup = null;
        return _possibleConstructorReturn(_this128);
      }

      _createClass(Pr, [{
        key: "addTo",
        value: function addTo(e) {
          return e === this._map || (this.remove(), this._map = e, e.getCanvasContainer().appendChild(this._element), e.on("move", this._updateMoving), e.on("moveend", this._update), e.on("remove", this._clearFadeTimer), e._addMarker(this), this.setDraggable(this._draggable), this._update(), this._map.on("click", this._onMapClick)), this;
        }
      }, {
        key: "remove",
        value: function remove() {
          return this._map && (this._map.off("click", this._onMapClick), this._map.off("move", this._updateMoving), this._map.off("moveend", this._update), this._map.off("mousedown", this._addDragHandler), this._map.off("touchstart", this._addDragHandler), this._map.off("mouseup", this._onUp), this._map.off("touchend", this._onUp), this._map.off("mousemove", this._onMove), this._map.off("touchmove", this._onMove), this._map.off("remove", this._clearFadeTimer), this._map._removeMarker(this), delete this._map), this._clearFadeTimer(), this._element.remove(), this._popup && this._popup.remove(), this;
        }
      }, {
        key: "getLngLat",
        value: function getLngLat() {
          return this._lngLat;
        }
      }, {
        key: "setLngLat",
        value: function setLngLat(t) {
          return this._lngLat = e.LngLat.convert(t), this._pos = null, this._popup && this._popup.setLngLat(this._lngLat), this._update(!0), this;
        }
      }, {
        key: "getElement",
        value: function getElement() {
          return this._element;
        }
      }, {
        key: "setPopup",
        value: function setPopup(e) {
          if (this._popup && (this._popup.remove(), this._popup = null, this._element.removeAttribute("role"), this._element.removeEventListener("keypress", this._onKeyPress), this._originalTabIndex || this._element.removeAttribute("tabindex")), e) {
            if (!("offset" in e.options)) {
              var _t411 = 38.1,
                  _i290 = 13.5,
                  _o164 = Math.sqrt(Math.pow(_i290, 2) / 2);

              e.options.offset = this._defaultMarker ? {
                top: [0, 0],
                "top-left": [0, 0],
                "top-right": [0, 0],
                bottom: [0, -_t411],
                "bottom-left": [_o164, -1 * (_t411 - _i290 + _o164)],
                "bottom-right": [-_o164, -1 * (_t411 - _i290 + _o164)],
                left: [_i290, -1 * (_t411 - _i290)],
                right: [-_i290, -1 * (_t411 - _i290)]
              } : this._offset;
            }

            this._popup = e, this._lngLat && this._popup.setLngLat(this._lngLat), this._element.setAttribute("role", "button"), this._originalTabIndex = this._element.getAttribute("tabindex"), this._originalTabIndex || this._element.setAttribute("tabindex", "0"), this._element.addEventListener("keypress", this._onKeyPress), this._element.setAttribute("aria-expanded", "false");
          }

          return this;
        }
      }, {
        key: "_onKeyPress",
        value: function _onKeyPress(e) {
          var t = e.code,
              i = e.charCode || e.keyCode;
          "Space" !== t && "Enter" !== t && 32 !== i && 13 !== i || this.togglePopup();
        }
      }, {
        key: "_onMapClick",
        value: function _onMapClick(e) {
          var t = e.originalEvent.target,
              i = this._element;
          this._popup && (t === i || i.contains(t)) && this.togglePopup();
        }
      }, {
        key: "getPopup",
        value: function getPopup() {
          return this._popup;
        }
      }, {
        key: "togglePopup",
        value: function togglePopup() {
          var e = this._popup;
          return e ? (e.isOpen() ? (e.remove(), this._element.setAttribute("aria-expanded", "false")) : (e.addTo(this._map), this._element.setAttribute("aria-expanded", "true")), this) : this;
        }
      }, {
        key: "_evaluateOpacity",
        value: function _evaluateOpacity() {
          var e = this._pos ? this._pos.sub(this._transformedOffset()) : null;
          if (!this._withinScreenBounds(e)) return void this._clearFadeTimer();

          var t = this._map.unproject(e);

          var i = !1;

          if (this._map.transform._terrainEnabled() && this._map.getTerrain()) {
            var _e448 = this._map.getFreeCameraOptions();

            if (_e448.position) {
              var _o165 = _e448.position.toLngLat();

              i = _o165.distanceTo(t) < .9 * _o165.distanceTo(this._lngLat);
            }
          }

          var o = (1 - this._map._queryFogOpacity(t)) * (i ? .2 : 1);
          this._element.style.opacity = "".concat(o), this._popup && this._popup._setOpacity("".concat(o)), this._fadeTimer = null;
        }
      }, {
        key: "_clearFadeTimer",
        value: function _clearFadeTimer() {
          this._fadeTimer && (clearTimeout(this._fadeTimer), this._fadeTimer = null);
        }
      }, {
        key: "_withinScreenBounds",
        value: function _withinScreenBounds(e) {
          var t = this._map.transform;
          return !!e && e.x >= 0 && e.x < t.width && e.y >= 0 && e.y < t.height;
        }
      }, {
        key: "_updateDOM",
        value: function _updateDOM() {
          var t = this._pos || new e.pointGeometry(0, 0),
              i = this._calculatePitch(),
              o = this._calculateRotation();

          this._element.style.transform = "".concat(Dr[this._anchor], " translate(").concat(t.x, "px, ").concat(t.y, "px) rotateX(").concat(i, "deg) rotateZ(").concat(o, "deg)");
        }
      }, {
        key: "_calculatePitch",
        value: function _calculatePitch() {
          return "viewport" === this._pitchAlignment || "auto" === this._pitchAlignment ? 0 : "map" === this._pitchAlignment ? this._map.getPitch() : 0;
        }
      }, {
        key: "_calculateRotation",
        value: function _calculateRotation() {
          return "viewport" === this._rotationAlignment || "auto" === this._rotationAlignment ? this._rotation : "map" === this._rotationAlignment ? this._rotation - this._map.getBearing() : 0;
        }
      }, {
        key: "_update",
        value: function _update(t) {
          var _this129 = this;

          e.window.cancelAnimationFrame(this._updateFrameId), this._map && (this._map.transform.renderWorldCopies && (this._lngLat = zr(this._lngLat, this._pos, this._map.transform)), this._pos = this._map.project(this._lngLat)._add(this._transformedOffset()), !0 === t ? this._updateFrameId = e.window.requestAnimationFrame(function () {
            _this129._element && _this129._pos && _this129._anchor && (_this129._pos = _this129._pos.round(), _this129._updateDOM());
          }) : this._pos = this._pos.round(), this._map._requestDomTask(function () {
            _this129._map && (_this129._element && _this129._pos && _this129._anchor && _this129._updateDOM(), !_this129._map.getTerrain() && !_this129._map.getFog() || _this129._fadeTimer || (_this129._fadeTimer = setTimeout(_this129._evaluateOpacity.bind(_this129), 60)));
          }));
        }
      }, {
        key: "_transformedOffset",
        value: function _transformedOffset() {
          if (!this._defaultMarker) return this._offset;

          var e = this._map.transform,
              t = this._offset.mult(this._scale);

          return "map" === this._rotationAlignment && t._rotate(e.angle), "map" === this._pitchAlignment && (t.y *= Math.cos(e._pitch)), t;
        }
      }, {
        key: "getOffset",
        value: function getOffset() {
          return this._offset;
        }
      }, {
        key: "setOffset",
        value: function setOffset(t) {
          return this._offset = e.pointGeometry.convert(t), this._update(), this;
        }
      }, {
        key: "_onMove",
        value: function _onMove(t) {
          if (!this._isDragging) {
            var _e449 = this._clickTolerance || this._map._clickTolerance;

            this._isDragging = t.point.dist(this._pointerdownPos) >= _e449;
          }

          this._isDragging && (this._pos = t.point.sub(this._positionDelta), this._lngLat = this._map.unproject(this._pos), this.setLngLat(this._lngLat), this._element.style.pointerEvents = "none", "pending" === this._state && (this._state = "active", this.fire(new e.Event("dragstart"))), this.fire(new e.Event("drag")));
        }
      }, {
        key: "_onUp",
        value: function _onUp() {
          this._element.style.pointerEvents = "auto", this._positionDelta = null, this._pointerdownPos = null, this._isDragging = !1, this._map.off("mousemove", this._onMove), this._map.off("touchmove", this._onMove), "active" === this._state && this.fire(new e.Event("dragend")), this._state = "inactive";
        }
      }, {
        key: "_addDragHandler",
        value: function _addDragHandler(e) {
          this._element.contains(e.originalEvent.target) && (e.preventDefault(), this._positionDelta = e.point.sub(this._pos).add(this._transformedOffset()), this._pointerdownPos = e.point, this._state = "pending", this._map.on("mousemove", this._onMove), this._map.on("touchmove", this._onMove), this._map.once("mouseup", this._onUp), this._map.once("touchend", this._onUp));
        }
      }, {
        key: "setDraggable",
        value: function setDraggable(e) {
          return this._draggable = !!e, this._map && (e ? (this._map.on("mousedown", this._addDragHandler), this._map.on("touchstart", this._addDragHandler)) : (this._map.off("mousedown", this._addDragHandler), this._map.off("touchstart", this._addDragHandler))), this;
        }
      }, {
        key: "isDraggable",
        value: function isDraggable() {
          return this._draggable;
        }
      }, {
        key: "setRotation",
        value: function setRotation(e) {
          return this._rotation = e || 0, this._update(), this;
        }
      }, {
        key: "getRotation",
        value: function getRotation() {
          return this._rotation;
        }
      }, {
        key: "setRotationAlignment",
        value: function setRotationAlignment(e) {
          return this._rotationAlignment = e || "auto", this._update(), this;
        }
      }, {
        key: "getRotationAlignment",
        value: function getRotationAlignment() {
          return this._rotationAlignment;
        }
      }, {
        key: "setPitchAlignment",
        value: function setPitchAlignment(e) {
          return this._pitchAlignment = e && "auto" !== e ? e : this._rotationAlignment, this._update(), this;
        }
      }, {
        key: "getPitchAlignment",
        value: function getPitchAlignment() {
          return this._pitchAlignment;
        }
      }]);

      return Pr;
    }(e.Evented);

    var Ar = /*#__PURE__*/function () {
      function Ar(e) {
        _classCallCheck(this, Ar);

        this.jumpTo(e);
      }

      _createClass(Ar, [{
        key: "getValue",
        value: function getValue(t) {
          if (t <= this._startTime) return this._start;
          if (t >= this._endTime) return this._end;
          var i = e.easeCubicInOut((t - this._startTime) / (this._endTime - this._startTime));
          return this._start * (1 - i) + this._end * i;
        }
      }, {
        key: "isEasing",
        value: function isEasing(e) {
          return e >= this._startTime && e <= this._endTime;
        }
      }, {
        key: "jumpTo",
        value: function jumpTo(e) {
          this._startTime = -1 / 0, this._endTime = -1 / 0, this._start = e, this._end = e;
        }
      }, {
        key: "easeTo",
        value: function easeTo(e, t, i) {
          this._start = this.getValue(t), this._end = e, this._startTime = t, this._endTime = t + i;
        }
      }]);

      return Ar;
    }();

    var Lr = {
      "AttributionControl.ToggleAttribution": "Toggle attribution",
      "AttributionControl.MapFeedback": "Map feedback",
      "FullscreenControl.Enter": "Enter fullscreen",
      "FullscreenControl.Exit": "Exit fullscreen",
      "GeolocateControl.FindMyLocation": "Find my location",
      "GeolocateControl.LocationNotAvailable": "Location not available",
      "LogoControl.Title": "Mapbox logo",
      "NavigationControl.ResetBearing": "Reset bearing to north",
      "NavigationControl.ZoomIn": "Zoom in",
      "NavigationControl.ZoomOut": "Zoom out",
      "ScaleControl.Feet": "ft",
      "ScaleControl.Meters": "m",
      "ScaleControl.Kilometers": "km",
      "ScaleControl.Miles": "mi",
      "ScaleControl.NauticalMiles": "nm",
      "ScrollZoomBlocker.CtrlMessage": "Use ctrl + scroll to zoom the map",
      "ScrollZoomBlocker.CmdMessage": "Use ⌘ + scroll to zoom the map",
      "TouchPanBlocker.Message": "Use two fingers to move the map"
    },
        _e$window = e.window,
        Rr = _e$window.HTMLImageElement,
        kr = _e$window.HTMLElement,
        Or = _e$window.ImageBitmap,
        Br = {
      center: [0, 0],
      zoom: 0,
      bearing: 0,
      pitch: 0,
      minZoom: -2,
      maxZoom: 22,
      minPitch: 0,
      maxPitch: 85,
      interactive: !0,
      scrollZoom: !0,
      boxZoom: !0,
      dragRotate: !0,
      dragPan: !0,
      keyboard: !0,
      doubleClickZoom: !0,
      touchZoomRotate: !0,
      touchPitch: !0,
      cooperativeGestures: !1,
      bearingSnap: 7,
      clickTolerance: 3,
      pitchWithRotate: !0,
      hash: !1,
      attributionControl: !0,
      failIfMajorPerformanceCaveat: !1,
      preserveDrawingBuffer: !1,
      trackResize: !0,
      optimizeForTerrain: !0,
      renderWorldCopies: !0,
      refreshExpiredTiles: !0,
      maxTileCacheSize: null,
      localIdeographFontFamily: "sans-serif",
      localFontFamily: null,
      transformRequest: null,
      accessToken: null,
      fadeDuration: 300,
      crossSourceCollisions: !0
    };

    function Fr(e) {
      e.parentNode && e.parentNode.removeChild(e);
    }

    var Ur = {
      showCompass: !0,
      showZoom: !0,
      visualizePitch: !1
    };

    var Nr = /*#__PURE__*/function () {
      function Nr(t, i) {
        var o = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !1;

        _classCallCheck(this, Nr);

        this._clickTolerance = 10, this.element = i, this.mouseRotate = new Yo({
          clickTolerance: t.dragRotate._mouseRotate._clickTolerance
        }), this.map = t, o && (this.mousePitch = new Jo({
          clickTolerance: t.dragRotate._mousePitch._clickTolerance
        })), e.bindAll(["mousedown", "mousemove", "mouseup", "touchstart", "touchmove", "touchend", "reset"], this), i.addEventListener("mousedown", this.mousedown), i.addEventListener("touchstart", this.touchstart, {
          passive: !1
        }), i.addEventListener("touchmove", this.touchmove), i.addEventListener("touchend", this.touchend), i.addEventListener("touchcancel", this.reset);
      }

      _createClass(Nr, [{
        key: "down",
        value: function down(e, t) {
          this.mouseRotate.mousedown(e, t), this.mousePitch && this.mousePitch.mousedown(e, t), a.disableDrag();
        }
      }, {
        key: "move",
        value: function move(e, t) {
          var i = this.map,
              o = this.mouseRotate.mousemoveWindow(e, t);

          if (o && o.bearingDelta && i.setBearing(i.getBearing() + o.bearingDelta), this.mousePitch) {
            var _o166 = this.mousePitch.mousemoveWindow(e, t);

            _o166 && _o166.pitchDelta && i.setPitch(i.getPitch() + _o166.pitchDelta);
          }
        }
      }, {
        key: "off",
        value: function off() {
          var e = this.element;
          e.removeEventListener("mousedown", this.mousedown), e.removeEventListener("touchstart", this.touchstart, {
            passive: !1
          }), e.removeEventListener("touchmove", this.touchmove), e.removeEventListener("touchend", this.touchend), e.removeEventListener("touchcancel", this.reset), this.offTemp();
        }
      }, {
        key: "offTemp",
        value: function offTemp() {
          a.enableDrag(), e.window.removeEventListener("mousemove", this.mousemove), e.window.removeEventListener("mouseup", this.mouseup);
        }
      }, {
        key: "mousedown",
        value: function mousedown(t) {
          this.down(e.extend({}, t, {
            ctrlKey: !0,
            preventDefault: function preventDefault() {
              return t.preventDefault();
            }
          }), a.mousePos(this.element, t)), e.window.addEventListener("mousemove", this.mousemove), e.window.addEventListener("mouseup", this.mouseup);
        }
      }, {
        key: "mousemove",
        value: function mousemove(e) {
          this.move(e, a.mousePos(this.element, e));
        }
      }, {
        key: "mouseup",
        value: function mouseup(e) {
          this.mouseRotate.mouseupWindow(e), this.mousePitch && this.mousePitch.mouseupWindow(e), this.offTemp();
        }
      }, {
        key: "touchstart",
        value: function touchstart(e) {
          1 !== e.targetTouches.length ? this.reset() : (this._startPos = this._lastPos = a.touchPos(this.element, e.targetTouches)[0], this.down({
            type: "mousedown",
            button: 0,
            ctrlKey: !0,
            preventDefault: function preventDefault() {
              return e.preventDefault();
            }
          }, this._startPos));
        }
      }, {
        key: "touchmove",
        value: function touchmove(e) {
          1 !== e.targetTouches.length ? this.reset() : (this._lastPos = a.touchPos(this.element, e.targetTouches)[0], this.move({
            preventDefault: function preventDefault() {
              return e.preventDefault();
            }
          }, this._lastPos));
        }
      }, {
        key: "touchend",
        value: function touchend(e) {
          0 === e.targetTouches.length && this._startPos && this._lastPos && this._startPos.dist(this._lastPos) < this._clickTolerance && this.element.click(), this.reset();
        }
      }, {
        key: "reset",
        value: function reset() {
          this.mouseRotate.reset(), this.mousePitch && this.mousePitch.reset(), delete this._startPos, delete this._lastPos, this.offTemp();
        }
      }]);

      return Nr;
    }();

    var Gr = {
      positionOptions: {
        enableHighAccuracy: !1,
        maximumAge: 0,
        timeout: 6e3
      },
      fitBoundsOptions: {
        maxZoom: 15
      },
      trackUserLocation: !1,
      showAccuracyCircle: !0,
      showUserLocation: !0,
      showUserHeading: !1
    };
    var jr,
        Zr = 0,
        Vr = !1;
    var Wr = {
      maxWidth: 100,
      unit: "metric"
    };

    function qr(e, t, i) {
      var o = i && i.maxWidth || 100,
          r = e._containerHeight / 2,
          n = e.unproject([0, r]),
          a = e.unproject([o, r]),
          s = n.distanceTo(a);

      if (i && "imperial" === i.unit) {
        var _i291 = 3.2808 * s;

        _i291 > 5280 ? Xr(t, o, _i291 / 5280, e._getUIString("ScaleControl.Miles"), e) : Xr(t, o, _i291, e._getUIString("ScaleControl.Feet"), e);
      } else i && "nautical" === i.unit ? Xr(t, o, s / 1852, e._getUIString("ScaleControl.NauticalMiles"), e) : s >= 1e3 ? Xr(t, o, s / 1e3, e._getUIString("ScaleControl.Kilometers"), e) : Xr(t, o, s, e._getUIString("ScaleControl.Meters"), e);
    }

    function Xr(e, t, i, o, r) {
      var n = function (e) {
        var t = Math.pow(10, "".concat(Math.floor(e)).length - 1);
        var i = e / t;
        return i = i >= 10 ? 10 : i >= 5 ? 5 : i >= 3 ? 3 : i >= 2 ? 2 : i >= 1 ? 1 : function (e) {
          var t = Math.pow(10, Math.ceil(-Math.log(e) / Math.LN10));
          return Math.round(e * t) / t;
        }(i), t * i;
      }(i),
          a = n / i;

      r._requestDomTask(function () {
        e.style.width = t * a + "px", e.innerHTML = "".concat(n, "&nbsp;").concat(o);
      });
    }

    var $r = {
      closeButton: !0,
      closeOnClick: !0,
      focusAfterOpen: !0,
      className: "",
      maxWidth: "240px"
    },
        Hr = ["a[href]", "[tabindex]:not([tabindex='-1'])", "[contenteditable]:not([contenteditable='false'])", "button:not([disabled])", "input:not([disabled])", "select:not([disabled])", "textarea:not([disabled])"].join(", "),
        Kr = {
      version: e.version,
      supported: t,
      setRTLTextPlugin: e.setRTLTextPlugin,
      getRTLTextPluginStatus: e.getRTLTextPluginStatus,
      Map: /*#__PURE__*/function (_Cr) {
        _inherits(Map, _Cr);

        var _super133 = _createSuper(Map);

        function Map(t) {
          var _this130;

          _classCallCheck(this, Map);

          if (null != (t = e.extend({}, Br, t)).minZoom && null != t.maxZoom && t.minZoom > t.maxZoom) throw new Error("maxZoom must be greater than or equal to minZoom");
          if (null != t.minPitch && null != t.maxPitch && t.minPitch > t.maxPitch) throw new Error("maxPitch must be greater than or equal to minPitch");
          if (null != t.minPitch && t.minPitch < 0) throw new Error("minPitch must be greater than or equal to 0");
          if (null != t.maxPitch && t.maxPitch > 85) throw new Error("maxPitch must be less than or equal to 85");

          if (t.antialias && e.isSafariWithAntialiasingBug(e.window) && (t.antialias = !1, e.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")), _this130 = _super133.call(this, new So(t.minZoom, t.maxZoom, t.minPitch, t.maxPitch, t.renderWorldCopies), t), _this130._interactive = t.interactive, _this130._minTileCacheSize = t.minTileCacheSize, _this130._maxTileCacheSize = t.maxTileCacheSize, _this130._failIfMajorPerformanceCaveat = t.failIfMajorPerformanceCaveat, _this130._preserveDrawingBuffer = t.preserveDrawingBuffer, _this130._antialias = t.antialias, _this130._trackResize = t.trackResize, _this130._bearingSnap = t.bearingSnap, _this130._refreshExpiredTiles = t.refreshExpiredTiles, _this130._fadeDuration = t.fadeDuration, _this130._isInitialLoad = !0, _this130._crossSourceCollisions = t.crossSourceCollisions, _this130._crossFadingFactor = 1, _this130._collectResourceTiming = t.collectResourceTiming, _this130._optimizeForTerrain = t.optimizeForTerrain, _this130._renderTaskQueue = new Ir(), _this130._domRenderTaskQueue = new Ir(), _this130._controls = [], _this130._markers = [], _this130._mapId = e.uniqueId(), _this130._locale = e.extend({}, Lr, t.locale), _this130._clickTolerance = t.clickTolerance, _this130._cooperativeGestures = t.cooperativeGestures, _this130._containerWidth = 0, _this130._containerHeight = 0, _this130._averageElevationLastSampledAt = -1 / 0, _this130._averageElevation = new Ar(0), _this130._requestManager = new e.RequestManager(t.transformRequest, t.accessToken, t.testMode), _this130._silenceAuthErrors = !!t.testMode, "string" == typeof t.container) {
            if (_this130._container = e.window.document.getElementById(t.container), !_this130._container) throw new Error("Container '".concat(t.container, "' not found."));
          } else {
            if (!(t.container instanceof kr)) throw new Error("Invalid type: 'container' must be a String or HTMLElement.");
            _this130._container = t.container;
          }

          if (_this130._container.childNodes.length > 0 && e.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."), t.maxBounds && _this130.setMaxBounds(t.maxBounds), e.bindAll(["_onWindowOnline", "_onWindowResize", "_onMapScroll", "_contextLost", "_contextRestored"], _assertThisInitialized(_this130)), _this130._setupContainer(), _this130._setupPainter(), void 0 === _this130.painter) throw new Error("Failed to initialize WebGL.");
          _this130.on("move", function () {
            return _this130._update(!1);
          }), _this130.on("moveend", function () {
            return _this130._update(!1);
          }), _this130.on("zoom", function () {
            return _this130._update(!0);
          }), void 0 !== e.window && (e.window.addEventListener("online", _this130._onWindowOnline, !1), e.window.addEventListener("resize", _this130._onWindowResize, !1), e.window.addEventListener("orientationchange", _this130._onWindowResize, !1), e.window.addEventListener("webkitfullscreenchange", _this130._onWindowResize, !1)), _this130.handlers = new Tr(_assertThisInitialized(_this130), t), _this130._localFontFamily = t.localFontFamily, _this130._localIdeographFontFamily = t.localIdeographFontFamily, t.style && _this130.setStyle(t.style, {
            localFontFamily: _this130._localFontFamily,
            localIdeographFontFamily: _this130._localIdeographFontFamily
          }), t.projection && _this130.setProjection(t.projection), _this130._hash = t.hash && new zo("string" == typeof t.hash && t.hash || void 0).addTo(_assertThisInitialized(_this130)), _this130._hash && _this130._hash._onHashChange() || (_this130.jumpTo({
            center: t.center,
            zoom: t.zoom,
            bearing: t.bearing,
            pitch: t.pitch
          }), t.bounds && (_this130.resize(), _this130.fitBounds(t.bounds, e.extend({}, t.fitBoundsOptions, {
            duration: 0
          })))), _this130.resize(), t.attributionControl && _this130.addControl(new Mr({
            customAttribution: t.customAttribution
          })), _this130._logoControl = new Sr(), _this130.addControl(_this130._logoControl, t.logoPosition), _this130.on("style.load", function () {
            _this130.transform.unmodified && _this130.jumpTo(_this130.style.stylesheet);
          }), _this130.on("data", function (t) {
            _this130._update("style" === t.dataType), _this130.fire(new e.Event("".concat(t.dataType, "data"), t));
          }), _this130.on("dataloading", function (t) {
            _this130.fire(new e.Event("".concat(t.dataType, "dataloading"), t));
          });
          return _possibleConstructorReturn(_this130);
        }

        _createClass(Map, [{
          key: "_getMapId",
          value: function _getMapId() {
            return this._mapId;
          }
        }, {
          key: "addControl",
          value: function addControl(t, i) {
            if (void 0 === i && (i = t.getDefaultPosition ? t.getDefaultPosition() : "top-right"), !t || !t.onAdd) return this.fire(new e.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));
            var o = t.onAdd(this);

            this._controls.push(t);

            var r = this._controlPositions[i];
            return -1 !== i.indexOf("bottom") ? r.insertBefore(o, r.firstChild) : r.appendChild(o), this;
          }
        }, {
          key: "removeControl",
          value: function removeControl(t) {
            if (!t || !t.onRemove) return this.fire(new e.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));

            var i = this._controls.indexOf(t);

            return i > -1 && this._controls.splice(i, 1), t.onRemove(this), this;
          }
        }, {
          key: "hasControl",
          value: function hasControl(e) {
            return this._controls.indexOf(e) > -1;
          }
        }, {
          key: "getContainer",
          value: function getContainer() {
            return this._container;
          }
        }, {
          key: "getCanvasContainer",
          value: function getCanvasContainer() {
            return this._canvasContainer;
          }
        }, {
          key: "getCanvas",
          value: function getCanvas() {
            return this._canvas;
          }
        }, {
          key: "resize",
          value: function resize(t) {
            if (this._updateContainerDimensions(), this._containerWidth === this.transform.width && this._containerHeight === this.transform.height) return this;
            this._resizeCanvas(this._containerWidth, this._containerHeight), this.transform.resize(this._containerWidth, this._containerHeight), this.painter.resize(Math.ceil(this._containerWidth), Math.ceil(this._containerHeight));
            var i = !this._moving;
            return i && this.fire(new e.Event("movestart", t)).fire(new e.Event("move", t)), this.fire(new e.Event("resize", t)), i && this.fire(new e.Event("moveend", t)), this;
          }
        }, {
          key: "getBounds",
          value: function getBounds() {
            return this.transform.getBounds();
          }
        }, {
          key: "getMaxBounds",
          value: function getMaxBounds() {
            return this.transform.getMaxBounds() || null;
          }
        }, {
          key: "setMaxBounds",
          value: function setMaxBounds(t) {
            return this.transform.setMaxBounds(e.LngLatBounds.convert(t)), this._update();
          }
        }, {
          key: "setMinZoom",
          value: function setMinZoom(t) {
            if ((t = null == t ? -2 : t) >= -2 && t <= this.transform.maxZoom) return this.transform.minZoom = t, this._update(), this.getZoom() < t ? this.setZoom(t) : this.fire(new e.Event("zoomstart")).fire(new e.Event("zoom")).fire(new e.Event("zoomend")), this;
            throw new Error("minZoom must be between -2 and the current maxZoom, inclusive");
          }
        }, {
          key: "getMinZoom",
          value: function getMinZoom() {
            return this.transform.minZoom;
          }
        }, {
          key: "setMaxZoom",
          value: function setMaxZoom(t) {
            if ((t = null == t ? 22 : t) >= this.transform.minZoom) return this.transform.maxZoom = t, this._update(), this.getZoom() > t ? this.setZoom(t) : this.fire(new e.Event("zoomstart")).fire(new e.Event("zoom")).fire(new e.Event("zoomend")), this;
            throw new Error("maxZoom must be greater than the current minZoom");
          }
        }, {
          key: "getMaxZoom",
          value: function getMaxZoom() {
            return this.transform.maxZoom;
          }
        }, {
          key: "setMinPitch",
          value: function setMinPitch(t) {
            if ((t = null == t ? 0 : t) < 0) throw new Error("minPitch must be greater than or equal to 0");
            if (t >= 0 && t <= this.transform.maxPitch) return this.transform.minPitch = t, this._update(), this.getPitch() < t ? this.setPitch(t) : this.fire(new e.Event("pitchstart")).fire(new e.Event("pitch")).fire(new e.Event("pitchend")), this;
            throw new Error("minPitch must be between 0 and the current maxPitch, inclusive");
          }
        }, {
          key: "getMinPitch",
          value: function getMinPitch() {
            return this.transform.minPitch;
          }
        }, {
          key: "setMaxPitch",
          value: function setMaxPitch(t) {
            if ((t = null == t ? 85 : t) > 85) throw new Error("maxPitch must be less than or equal to 85");
            if (t >= this.transform.minPitch) return this.transform.maxPitch = t, this._update(), this.getPitch() > t ? this.setPitch(t) : this.fire(new e.Event("pitchstart")).fire(new e.Event("pitch")).fire(new e.Event("pitchend")), this;
            throw new Error("maxPitch must be greater than the current minPitch");
          }
        }, {
          key: "getMaxPitch",
          value: function getMaxPitch() {
            return this.transform.maxPitch;
          }
        }, {
          key: "getRenderWorldCopies",
          value: function getRenderWorldCopies() {
            return this.transform.renderWorldCopies;
          }
        }, {
          key: "setRenderWorldCopies",
          value: function setRenderWorldCopies(e) {
            return this.transform.renderWorldCopies = e, this._update();
          }
        }, {
          key: "getProjection",
          value: function getProjection() {
            return this.transform.getProjection();
          }
        }, {
          key: "setProjection",
          value: function setProjection(e) {
            return this._lazyInitEmptyStyle(), "string" == typeof e && (e = {
              name: e
            }), this._runtimeProjection = e, this.style.updateProjection(), this._transitionFromGlobe = !1, this;
          }
        }, {
          key: "project",
          value: function project(t) {
            return this.transform.locationPoint3D(e.LngLat.convert(t));
          }
        }, {
          key: "unproject",
          value: function unproject(t) {
            return this.transform.pointLocation3D(e.pointGeometry.convert(t));
          }
        }, {
          key: "isMoving",
          value: function isMoving() {
            return this._moving || this.handlers && this.handlers.isMoving();
          }
        }, {
          key: "isZooming",
          value: function isZooming() {
            return this._zooming || this.handlers && this.handlers.isZooming();
          }
        }, {
          key: "isRotating",
          value: function isRotating() {
            return this._rotating || this.handlers && this.handlers.isRotating();
          }
        }, {
          key: "_createDelegatedListener",
          value: function _createDelegatedListener(e, t, i) {
            var _this131 = this;

            if ("mouseenter" === e || "mouseover" === e) {
              var _o167 = !1;

              var _r294 = function _r294(r) {
                var n = t.filter(function (e) {
                  return _this131.getLayer(e);
                }),
                    a = n.length ? _this131.queryRenderedFeatures(r.point, {
                  layers: n
                }) : [];
                a.length ? _o167 || (_o167 = !0, i.call(_this131, new Fo(e, _this131, r.originalEvent, {
                  features: a
                }))) : _o167 = !1;
              },
                  _n201 = function _n201() {
                _o167 = !1;
              };

              return {
                layers: new Set(t),
                listener: i,
                delegates: {
                  mousemove: _r294,
                  mouseout: _n201
                }
              };
            }

            if ("mouseleave" === e || "mouseout" === e) {
              var _o168 = !1;

              var _r295 = function _r295(r) {
                var n = t.filter(function (e) {
                  return _this131.getLayer(e);
                });
                (n.length ? _this131.queryRenderedFeatures(r.point, {
                  layers: n
                }) : []).length ? _o168 = !0 : _o168 && (_o168 = !1, i.call(_this131, new Fo(e, _this131, r.originalEvent)));
              },
                  _n202 = function _n202(t) {
                _o168 && (_o168 = !1, i.call(_this131, new Fo(e, _this131, t.originalEvent)));
              };

              return {
                layers: new Set(t),
                listener: i,
                delegates: {
                  mousemove: _r295,
                  mouseout: _n202
                }
              };
            }

            {
              var _o169 = function _o169(e) {
                var o = t.filter(function (e) {
                  return _this131.getLayer(e);
                }),
                    r = o.length ? _this131.queryRenderedFeatures(e.point, {
                  layers: o
                }) : [];
                r.length && (e.features = r, i.call(_this131, e), delete e.features);
              };

              return {
                layers: new Set(t),
                listener: i,
                delegates: _defineProperty({}, e, _o169)
              };
            }
          }
        }, {
          key: "on",
          value: function on(e, t, i) {
            if (void 0 === i) return _get(_getPrototypeOf(Map.prototype), "on", this).call(this, e, t);
            Array.isArray(t) || (t = [t]);

            var o = this._createDelegatedListener(e, t, i);

            this._delegatedListeners = this._delegatedListeners || {}, this._delegatedListeners[e] = this._delegatedListeners[e] || [], this._delegatedListeners[e].push(o);

            for (var _e450 in o.delegates) {
              this.on(_e450, o.delegates[_e450]);
            }

            return this;
          }
        }, {
          key: "once",
          value: function once(e, t, i) {
            if (void 0 === i) return _get(_getPrototypeOf(Map.prototype), "once", this).call(this, e, t);
            Array.isArray(t) || (t = [t]);

            var o = this._createDelegatedListener(e, t, i);

            for (var _e451 in o.delegates) {
              this.once(_e451, o.delegates[_e451]);
            }

            return this;
          }
        }, {
          key: "off",
          value: function off(e, t, i) {
            var _this132 = this;

            if (void 0 === i) return _get(_getPrototypeOf(Map.prototype), "off", this).call(this, e, t);
            t = new Set(Array.isArray(t) ? t : [t]);

            var o = function o(e, t) {
              if (e.size !== t.size) return !1;

              var _iterator253 = _createForOfIteratorHelper(e),
                  _step253;

              try {
                for (_iterator253.s(); !(_step253 = _iterator253.n()).done;) {
                  var _i292 = _step253.value;
                  if (!t.has(_i292)) return !1;
                }
              } catch (err) {
                _iterator253.e(err);
              } finally {
                _iterator253.f();
              }

              return !0;
            },
                r = this._delegatedListeners ? this._delegatedListeners[e] : void 0;

            return r && function (e) {
              for (var _r296 = 0; _r296 < e.length; _r296++) {
                var _n203 = e[_r296];

                if (_n203.listener === i && o(_n203.layers, t)) {
                  for (var _e452 in _n203.delegates) {
                    _this132.off(_e452, _n203.delegates[_e452]);
                  }

                  return e.splice(_r296, 1), _this132;
                }
              }
            }(r), this;
          }
        }, {
          key: "queryRenderedFeatures",
          value: function queryRenderedFeatures(t, i) {
            return this.style ? (void 0 !== i || void 0 === t || t instanceof e.pointGeometry || Array.isArray(t) || (i = t, t = void 0), this.style.queryRenderedFeatures(t = t || [[0, 0], [this.transform.width, this.transform.height]], i = i || {}, this.transform)) : [];
          }
        }, {
          key: "querySourceFeatures",
          value: function querySourceFeatures(e, t) {
            return this.style.querySourceFeatures(e, t);
          }
        }, {
          key: "queryTerrainElevation",
          value: function queryTerrainElevation(t, i) {
            var o = this.transform.elevation;
            return o ? (i = e.extend({}, {
              exaggerated: !0
            }, i), o.getAtPoint(e.MercatorCoordinate.fromLngLat(t), null, i.exaggerated)) : null;
          }
        }, {
          key: "setStyle",
          value: function setStyle(t, i) {
            return !1 !== (i = e.extend({}, {
              localIdeographFontFamily: this._localIdeographFontFamily,
              localFontFamily: this._localFontFamily
            }, i)).diff && i.localIdeographFontFamily === this._localIdeographFontFamily && i.localFontFamily === this._localFontFamily && this.style && t ? (this._diffStyle(t, i), this) : (this._localIdeographFontFamily = i.localIdeographFontFamily, this._localFontFamily = i.localFontFamily, this._updateStyle(t, i));
          }
        }, {
          key: "_getUIString",
          value: function _getUIString(e) {
            var t = this._locale[e];
            if (null == t) throw new Error("Missing UI string '".concat(e, "'"));
            return t;
          }
        }, {
          key: "_updateStyle",
          value: function _updateStyle(e, t) {
            return this.style && (this.style.setEventedParent(null), this.style._remove(), delete this.style), e && (this.style = new Nt(this, t || {}), this.style.setEventedParent(this, {
              style: this.style
            }), "string" == typeof e ? this.style.loadURL(e) : this.style.loadJSON(e)), this._updateTerrain(), this;
          }
        }, {
          key: "_lazyInitEmptyStyle",
          value: function _lazyInitEmptyStyle() {
            this.style || (this.style = new Nt(this, {}), this.style.setEventedParent(this, {
              style: this.style
            }), this.style.loadEmpty());
          }
        }, {
          key: "_diffStyle",
          value: function _diffStyle(t, i) {
            var _this133 = this;

            if ("string" == typeof t) {
              var _o170 = this._requestManager.normalizeStyleURL(t),
                  _r297 = this._requestManager.transformRequest(_o170, e.ResourceType.Style);

              e.getJSON(_r297, function (t, o) {
                t ? _this133.fire(new e.ErrorEvent(t)) : o && _this133._updateDiff(o, i);
              });
            } else "object" == _typeof(t) && this._updateDiff(t, i);
          }
        }, {
          key: "_updateDiff",
          value: function _updateDiff(t, i) {
            try {
              this.style.setState(t) && this._update(!0);
            } catch (o) {
              e.warnOnce("Unable to perform style diff: ".concat(o.message || o.error || o, ".  Rebuilding the style from scratch.")), this._updateStyle(t, i);
            }
          }
        }, {
          key: "getStyle",
          value: function getStyle() {
            if (this.style) return this.style.serialize();
          }
        }, {
          key: "isStyleLoaded",
          value: function isStyleLoaded() {
            return this.style ? this.style.loaded() : e.warnOnce("There is no style added to the map.");
          }
        }, {
          key: "addSource",
          value: function addSource(e, t) {
            return this._lazyInitEmptyStyle(), this.style.addSource(e, t), this._update(!0);
          }
        }, {
          key: "isSourceLoaded",
          value: function isSourceLoaded(t) {
            var i = this.style && this.style._getSourceCaches(t);

            if (0 !== i.length) return i.every(function (e) {
              return e.loaded();
            });
            this.fire(new e.ErrorEvent(new Error("There is no source with ID '".concat(t, "'"))));
          }
        }, {
          key: "areTilesLoaded",
          value: function areTilesLoaded() {
            var e = this.style && this.style._sourceCaches;

            for (var _t412 in e) {
              var _i293 = e[_t412]._tiles;

              for (var _e453 in _i293) {
                var _t413 = _i293[_e453];
                if ("loaded" !== _t413.state && "errored" !== _t413.state) return !1;
              }
            }

            return !0;
          }
        }, {
          key: "addSourceType",
          value: function addSourceType(e, t, i) {
            return this._lazyInitEmptyStyle(), this.style.addSourceType(e, t, i);
          }
        }, {
          key: "removeSource",
          value: function removeSource(e) {
            return this.style.removeSource(e), this._updateTerrain(), this._update(!0);
          }
        }, {
          key: "getSource",
          value: function getSource(e) {
            return this.style.getSource(e);
          }
        }, {
          key: "addImage",
          value: function addImage(t, i) {
            var _ref200 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},
                _ref200$pixelRatio = _ref200.pixelRatio,
                o = _ref200$pixelRatio === void 0 ? 1 : _ref200$pixelRatio,
                _ref200$sdf = _ref200.sdf,
                r = _ref200$sdf === void 0 ? !1 : _ref200$sdf,
                n = _ref200.stretchX,
                a = _ref200.stretchY,
                s = _ref200.content;

            if (this._lazyInitEmptyStyle(), i instanceof Rr || Or && i instanceof Or) {
              var _e$exported$getImageD = e.exported.getImageData(i),
                  _l81 = _e$exported$getImageD.width,
                  _c56 = _e$exported$getImageD.height,
                  _h42 = _e$exported$getImageD.data;

              this.style.addImage(t, {
                data: new e.RGBAImage({
                  width: _l81,
                  height: _c56
                }, _h42),
                pixelRatio: o,
                stretchX: n,
                stretchY: a,
                content: s,
                sdf: r,
                version: 0
              });
            } else {
              if (void 0 === i.width || void 0 === i.height) return this.fire(new e.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));
              {
                var _l82 = i.width,
                    _c57 = i.height,
                    _h43 = i.data,
                    _u64 = i;
                this.style.addImage(t, {
                  data: new e.RGBAImage({
                    width: _l82,
                    height: _c57
                  }, new Uint8Array(_h43)),
                  pixelRatio: o,
                  stretchX: n,
                  stretchY: a,
                  content: s,
                  sdf: r,
                  version: 0,
                  userImage: _u64
                }), _u64.onAdd && _u64.onAdd(this, t);
              }
            }
          }
        }, {
          key: "updateImage",
          value: function updateImage(t, i) {
            var o = this.style.getImage(t);
            if (!o) return this.fire(new e.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));
            var r = i instanceof Rr || Or && i instanceof Or ? e.exported.getImageData(i) : i,
                n = r.width,
                a = r.height,
                s = r.data;
            return void 0 === n || void 0 === a ? this.fire(new e.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))) : n !== o.data.width || a !== o.data.height ? this.fire(new e.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))) : (o.data.replace(s, !(i instanceof Rr || Or && i instanceof Or)), void this.style.updateImage(t, o));
          }
        }, {
          key: "hasImage",
          value: function hasImage(t) {
            return t ? !!this.style.getImage(t) : (this.fire(new e.ErrorEvent(new Error("Missing required image id"))), !1);
          }
        }, {
          key: "removeImage",
          value: function removeImage(e) {
            this.style.removeImage(e);
          }
        }, {
          key: "loadImage",
          value: function loadImage(t, i) {
            e.getImage(this._requestManager.transformRequest(t, e.ResourceType.Image), function (t, o) {
              i(t, o instanceof Rr ? e.exported.getImageData(o) : o);
            });
          }
        }, {
          key: "listImages",
          value: function listImages() {
            return this.style.listImages();
          }
        }, {
          key: "addLayer",
          value: function addLayer(e, t) {
            return this._lazyInitEmptyStyle(), this.style.addLayer(e, t), this._update(!0);
          }
        }, {
          key: "moveLayer",
          value: function moveLayer(e, t) {
            return this.style.moveLayer(e, t), this._update(!0);
          }
        }, {
          key: "removeLayer",
          value: function removeLayer(e) {
            return this.style.removeLayer(e), this._update(!0);
          }
        }, {
          key: "getLayer",
          value: function getLayer(e) {
            return this.style.getLayer(e);
          }
        }, {
          key: "setLayerZoomRange",
          value: function setLayerZoomRange(e, t, i) {
            return this.style.setLayerZoomRange(e, t, i), this._update(!0);
          }
        }, {
          key: "setFilter",
          value: function setFilter(e, t) {
            var i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
            return this.style.setFilter(e, t, i), this._update(!0);
          }
        }, {
          key: "getFilter",
          value: function getFilter(e) {
            return this.style.getFilter(e);
          }
        }, {
          key: "setPaintProperty",
          value: function setPaintProperty(e, t, i) {
            var o = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};
            return this.style.setPaintProperty(e, t, i, o), this._update(!0);
          }
        }, {
          key: "getPaintProperty",
          value: function getPaintProperty(e, t) {
            return this.style.getPaintProperty(e, t);
          }
        }, {
          key: "setLayoutProperty",
          value: function setLayoutProperty(e, t, i) {
            var o = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};
            return this.style.setLayoutProperty(e, t, i, o), this._update(!0);
          }
        }, {
          key: "getLayoutProperty",
          value: function getLayoutProperty(e, t) {
            return this.style.getLayoutProperty(e, t);
          }
        }, {
          key: "setLight",
          value: function setLight(e) {
            var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
            return this._lazyInitEmptyStyle(), this.style.setLight(e, t), this._update(!0);
          }
        }, {
          key: "getLight",
          value: function getLight() {
            return this.style.getLight();
          }
        }, {
          key: "setTerrain",
          value: function setTerrain(e) {
            return this._lazyInitEmptyStyle(), !e && this.transform.projection.requiresDraping ? this.style.setTerrainForDraping() : this.style.setTerrain(e), this._averageElevationLastSampledAt = -1 / 0, this._update(!0);
          }
        }, {
          key: "_updateProjection",
          value: function _updateProjection() {
            "globe" === this.transform.projection.name && this.transform.zoom >= e.GLOBE_ZOOM_THRESHOLD_MAX && !this._transitionFromGlobe && (this.setProjection({
              name: "mercator"
            }), this._transitionFromGlobe = !0);
          }
        }, {
          key: "getTerrain",
          value: function getTerrain() {
            return this.style ? this.style.getTerrain() : null;
          }
        }, {
          key: "setFog",
          value: function setFog(e) {
            return this._lazyInitEmptyStyle(), this.style.setFog(e), this._update(!0);
          }
        }, {
          key: "getFog",
          value: function getFog() {
            return this.style ? this.style.getFog() : null;
          }
        }, {
          key: "_queryFogOpacity",
          value: function _queryFogOpacity(t) {
            return this.style && this.style.fog ? this.style.fog.getOpacityAtLatLng(e.LngLat.convert(t), this.transform) : 0;
          }
        }, {
          key: "setFeatureState",
          value: function setFeatureState(e, t) {
            return this.style.setFeatureState(e, t), this._update();
          }
        }, {
          key: "removeFeatureState",
          value: function removeFeatureState(e, t) {
            return this.style.removeFeatureState(e, t), this._update();
          }
        }, {
          key: "getFeatureState",
          value: function getFeatureState(e) {
            return this.style.getFeatureState(e);
          }
        }, {
          key: "_updateContainerDimensions",
          value: function _updateContainerDimensions() {
            if (!this._container) return;
            var t = this._container.getBoundingClientRect().width || 400,
                i = this._container.getBoundingClientRect().height || 300;
            var o,
                r = this._container;

            for (; r && !o;) {
              var _t414 = e.window.getComputedStyle(r).transform;
              _t414 && "none" !== _t414 && (o = _t414.match(/matrix.*\((.+)\)/)[1].split(", ")), r = r.parentElement;
            }

            o ? (this._containerWidth = o[0] && "0" !== o[0] ? Math.abs(t / o[0]) : t, this._containerHeight = o[3] && "0" !== o[3] ? Math.abs(i / o[3]) : i) : (this._containerWidth = t, this._containerHeight = i);
          }
        }, {
          key: "_detectMissingCSS",
          value: function _detectMissingCSS() {
            "rgb(250, 128, 114)" !== e.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color") && e.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.");
          }
        }, {
          key: "_setupContainer",
          value: function _setupContainer() {
            var e = this._container;
            e.classList.add("mapboxgl-map"), (this._missingCSSCanary = a.create("div", "mapboxgl-canary", e)).style.visibility = "hidden", this._detectMissingCSS();
            var t = this._canvasContainer = a.create("div", "mapboxgl-canvas-container", e);
            this._interactive && t.classList.add("mapboxgl-interactive"), this._canvas = a.create("canvas", "mapboxgl-canvas", t), this._canvas.addEventListener("webglcontextlost", this._contextLost, !1), this._canvas.addEventListener("webglcontextrestored", this._contextRestored, !1), this._canvas.setAttribute("tabindex", "0"), this._canvas.setAttribute("aria-label", "Map"), this._canvas.setAttribute("role", "region"), this._updateContainerDimensions(), this._resizeCanvas(this._containerWidth, this._containerHeight);
            var i = this._controlContainer = a.create("div", "mapboxgl-control-container", e),
                o = this._controlPositions = {};
            ["top-left", "top-right", "bottom-left", "bottom-right"].forEach(function (e) {
              o[e] = a.create("div", "mapboxgl-ctrl-".concat(e), i);
            }), this._container.addEventListener("scroll", this._onMapScroll, !1);
          }
        }, {
          key: "_resizeCanvas",
          value: function _resizeCanvas(t, i) {
            var o = e.exported.devicePixelRatio || 1;
            this._canvas.width = o * Math.ceil(t), this._canvas.height = o * Math.ceil(i), this._canvas.style.width = "".concat(t, "px"), this._canvas.style.height = "".concat(i, "px");
          }
        }, {
          key: "_addMarker",
          value: function _addMarker(e) {
            this._markers.push(e);
          }
        }, {
          key: "_removeMarker",
          value: function _removeMarker(e) {
            var t = this._markers.indexOf(e);

            -1 !== t && this._markers.splice(t, 1);
          }
        }, {
          key: "_setupPainter",
          value: function _setupPainter() {
            var _this134 = this;

            var i = e.extend({}, t.webGLContextAttributes, {
              failIfMajorPerformanceCaveat: this._failIfMajorPerformanceCaveat,
              preserveDrawingBuffer: this._preserveDrawingBuffer,
              antialias: this._antialias || !1
            }),
                o = this._canvas.getContext("webgl", i) || this._canvas.getContext("experimental-webgl", i);

            o ? (e.storeAuthState(o, !0), this.painter = new _o(o, this.transform), this.on("data", function (e) {
              "source" === e.dataType && _this134.painter.setTileLoadedFlag(!0);
            }), e.exported$1.testSupport(o)) : this.fire(new e.ErrorEvent(new Error("Failed to initialize WebGL")));
          }
        }, {
          key: "_contextLost",
          value: function _contextLost(t) {
            t.preventDefault(), this._frame && (this._frame.cancel(), this._frame = null), this.fire(new e.Event("webglcontextlost", {
              originalEvent: t
            }));
          }
        }, {
          key: "_contextRestored",
          value: function _contextRestored(t) {
            this._setupPainter(), this.resize(), this._update(), this.fire(new e.Event("webglcontextrestored", {
              originalEvent: t
            }));
          }
        }, {
          key: "_onMapScroll",
          value: function _onMapScroll(e) {
            if (e.target === this._container) return this._container.scrollTop = 0, this._container.scrollLeft = 0, !1;
          }
        }, {
          key: "loaded",
          value: function loaded() {
            return !this._styleDirty && !this._sourcesDirty && !!this.style && this.style.loaded();
          }
        }, {
          key: "_update",
          value: function _update(e) {
            return this.style ? (this._styleDirty = this._styleDirty || e, this._sourcesDirty = !0, this.triggerRepaint(), this) : this;
          }
        }, {
          key: "_requestRenderFrame",
          value: function _requestRenderFrame(e) {
            return this._update(), this._renderTaskQueue.add(e);
          }
        }, {
          key: "_cancelRenderFrame",
          value: function _cancelRenderFrame(e) {
            this._renderTaskQueue.remove(e);
          }
        }, {
          key: "_requestDomTask",
          value: function _requestDomTask(e) {
            !this.loaded() || this.loaded() && !this.isMoving() ? e() : this._domRenderTaskQueue.add(e);
          }
        }, {
          key: "_render",
          value: function _render(t) {
            var _this135 = this;

            var i;
            var o = this.painter.context.extTimerQuery,
                r = e.exported.now();
            this.listens("gpu-timing-frame") && (i = o.createQueryEXT(), o.beginQueryEXT(o.TIME_ELAPSED_EXT, i));

            var n = this._updateAverageElevation(r);

            if (this.painter.context.setDirty(), this.painter.setBaseState(), this._renderTaskQueue.run(t), this._domRenderTaskQueue.run(t), this._removed) return;

            this._updateProjection();

            var a = !1;
            var s = this._isInitialLoad ? 0 : this._fadeDuration;

            if (this.style && this._styleDirty) {
              this._styleDirty = !1;

              var _t415 = this.transform.zoom,
                  _i294 = this.transform.pitch,
                  _o171 = e.exported.now();

              this.style.zoomHistory.update(_t415, _o171);

              var _r298 = new e.EvaluationParameters(_t415, {
                now: _o171,
                fadeDuration: s,
                pitch: _i294,
                zoomHistory: this.style.zoomHistory,
                transition: this.style.getTransition()
              }),
                  _n204 = _r298.crossFadingFactor();

              1 === _n204 && _n204 === this._crossFadingFactor || (a = !0, this._crossFadingFactor = _n204), this.style.update(_r298);
            }

            if (this.style && this.style.fog && this.style.fog.hasTransition() && (this.style._markersNeedUpdate = !0, this._sourcesDirty = !0), this.style && this._sourcesDirty && (this._sourcesDirty = !1, this.painter._updateFog(this.style), this._updateTerrain(), this.style._updateSources(this.transform), this._forceMarkerUpdate()), this._placementDirty = this.style && this.style._updatePlacement(this.painter.transform, this.showCollisionBoxes, s, this._crossSourceCollisions), this.style && this.painter.render(this.style, {
              showTileBoundaries: this.showTileBoundaries,
              showTerrainWireframe: this.showTerrainWireframe,
              showOverdrawInspector: this._showOverdrawInspector,
              showQueryGeometry: !!this._showQueryGeometry,
              rotating: this.isRotating(),
              zooming: this.isZooming(),
              moving: this.isMoving(),
              fadeDuration: s,
              isInitialLoad: this._isInitialLoad,
              showPadding: this.showPadding,
              gpuTiming: !!this.listens("gpu-timing-layer"),
              speedIndexTiming: this.speedIndexTiming
            }), this.fire(new e.Event("render")), this.loaded() && !this._loaded && (this._loaded = !0, this.fire(new e.Event("load"))), this.style && (this.style.hasTransitions() || a) && (this._styleDirty = !0), this.style && !this._placementDirty && this.style._releaseSymbolFadeTiles(), this.listens("gpu-timing-frame")) {
              var _t416 = e.exported.now() - r;

              o.endQueryEXT(o.TIME_ELAPSED_EXT, i), setTimeout(function () {
                var r = o.getQueryObjectEXT(i, o.QUERY_RESULT_EXT) / 1e6;
                o.deleteQueryEXT(i), _this135.fire(new e.Event("gpu-timing-frame", {
                  cpuTime: _t416,
                  gpuTime: r
                }));
              }, 50);
            }

            if (this.listens("gpu-timing-layer")) {
              var _t417 = this.painter.collectGpuTimers();

              setTimeout(function () {
                var i = _this135.painter.queryGpuTimers(_t417);

                _this135.fire(new e.Event("gpu-timing-layer", {
                  layerTimes: i
                }));
              }, 50);
            }

            var l = this._sourcesDirty || this._styleDirty || this._placementDirty || n;
            if (l || this._repaint) this.triggerRepaint();else {
              var _t418 = !this.isMoving() && this.loaded();

              if (_t418 && (n = this._updateAverageElevation(r, !0)), n) this.triggerRepaint();else if (this._triggerFrame(!1), _t418 && (this.fire(new e.Event("idle")), this._isInitialLoad = !1, this.speedIndexTiming)) {
                var _t419 = this._calculateSpeedIndex();

                this.fire(new e.Event("speedindexcompleted", {
                  speedIndex: _t419
                })), this.speedIndexTiming = !1;
              }
            }
            return !this._loaded || this._fullyLoaded || l || (this._fullyLoaded = !0, this._authenticate()), this;
          }
        }, {
          key: "_forceMarkerUpdate",
          value: function _forceMarkerUpdate() {
            var _iterator254 = _createForOfIteratorHelper(this._markers),
                _step254;

            try {
              for (_iterator254.s(); !(_step254 = _iterator254.n()).done;) {
                var _e454 = _step254.value;

                _e454._update();
              }
            } catch (err) {
              _iterator254.e(err);
            } finally {
              _iterator254.f();
            }
          }
        }, {
          key: "_updateAverageElevation",
          value: function _updateAverageElevation(e) {
            var _this136 = this;

            var t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;

            var i = function i(e) {
              return _this136.transform.averageElevation = e, _this136._update(!1), !0;
            };

            if (!this.painter.averageElevationNeedsEasing()) return 0 !== this.transform.averageElevation && i(0);

            if ((t || e - this._averageElevationLastSampledAt > 500) && !this._averageElevation.isEasing(e)) {
              var _t420 = this.transform.averageElevation;

              var _o172 = this.transform.sampleAverageElevation();

              isNaN(_o172) ? _o172 = 0 : this._averageElevationLastSampledAt = e;

              var _r299 = Math.abs(_t420 - _o172);

              if (_r299 > 1) {
                if (this._isInitialLoad) return this._averageElevation.jumpTo(_o172), i(_o172);

                this._averageElevation.easeTo(_o172, e, 300);
              } else if (_r299 > 1e-4) return this._averageElevation.jumpTo(_o172), i(_o172);
            }

            return !!this._averageElevation.isEasing(e) && i(this._averageElevation.getValue(e));
          }
        }, {
          key: "_authenticate",
          value: function _authenticate() {
            var _this137 = this;

            e.getMapSessionAPI(this._getMapId(), this._requestManager._skuToken, this._requestManager._customAccessToken, function (t) {
              if (t && (t.message === e.AUTH_ERR_MSG || 401 === t.status)) {
                var _t421 = _this137.painter.context.gl;
                e.storeAuthState(_t421, !1), _this137._logoControl instanceof Sr && _this137._logoControl._updateLogo(), _t421 && _t421.clear(_t421.DEPTH_BUFFER_BIT | _t421.COLOR_BUFFER_BIT | _t421.STENCIL_BUFFER_BIT), _this137._silenceAuthErrors || _this137.fire(new e.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")));
              }
            }), e.postMapLoadEvent(this._getMapId(), this._requestManager._skuToken, this._requestManager._customAccessToken, function () {});
          }
        }, {
          key: "_updateTerrain",
          value: function _updateTerrain() {
            this.painter.updateTerrain(this.style, this.isMoving() || this.isRotating() || this.isZooming());
          }
        }, {
          key: "_calculateSpeedIndex",
          value: function _calculateSpeedIndex() {
            var e = this.painter.canvasCopy(),
                t = this.painter.getCanvasCopiesAndTimestamps();
            t.timeStamps.push(performance.now());
            var i = this.painter.context.gl,
                o = i.createFramebuffer();

            function r(e) {
              i.framebufferTexture2D(i.FRAMEBUFFER, i.COLOR_ATTACHMENT0, i.TEXTURE_2D, e, 0);
              var t = new Uint8Array(i.drawingBufferWidth * i.drawingBufferHeight * 4);
              return i.readPixels(0, 0, i.drawingBufferWidth, i.drawingBufferHeight, i.RGBA, i.UNSIGNED_BYTE, t), t;
            }

            return i.bindFramebuffer(i.FRAMEBUFFER, o), this._canvasPixelComparison(r(e), t.canvasCopies.map(r), t.timeStamps);
          }
        }, {
          key: "_canvasPixelComparison",
          value: function _canvasPixelComparison(e, t, i) {
            var o = i[1] - i[0];
            var r = e.length / 4;

            for (var _n205 = 0; _n205 < t.length; _n205++) {
              var _a132 = t[_n205];
              var _s143 = 0;

              for (var _t422 = 0; _t422 < _a132.length; _t422 += 4) {
                _a132[_t422] === e[_t422] && _a132[_t422 + 1] === e[_t422 + 1] && _a132[_t422 + 2] === e[_t422 + 2] && _a132[_t422 + 3] === e[_t422 + 3] && (_s143 += 1);
              }

              o += (i[_n205 + 2] - i[_n205 + 1]) * (1 - _s143 / r);
            }

            return o;
          }
        }, {
          key: "remove",
          value: function remove() {
            this._hash && this._hash.remove();

            var _iterator255 = _createForOfIteratorHelper(this._controls),
                _step255;

            try {
              for (_iterator255.s(); !(_step255 = _iterator255.n()).done;) {
                var _e455 = _step255.value;

                _e455.onRemove(this);
              }
            } catch (err) {
              _iterator255.e(err);
            } finally {
              _iterator255.f();
            }

            this._controls = [], this._frame && (this._frame.cancel(), this._frame = null), this._renderTaskQueue.clear(), this._domRenderTaskQueue.clear(), this.style && this.style.destroy(), this.painter.destroy(), this.handlers.destroy(), delete this.handlers, this.setStyle(null), void 0 !== e.window && (e.window.removeEventListener("resize", this._onWindowResize, !1), e.window.removeEventListener("orientationchange", this._onWindowResize, !1), e.window.removeEventListener("webkitfullscreenchange", this._onWindowResize, !1), e.window.removeEventListener("online", this._onWindowOnline, !1));
            var t = this.painter.context.gl.getExtension("WEBGL_lose_context");
            t && t.loseContext(), Fr(this._canvasContainer), Fr(this._controlContainer), Fr(this._missingCSSCanary), this._container.classList.remove("mapboxgl-map"), e.removeAuthState(this.painter.context.gl), this._removed = !0, this.fire(new e.Event("remove"));
          }
        }, {
          key: "triggerRepaint",
          value: function triggerRepaint() {
            this._triggerFrame(!0);
          }
        }, {
          key: "_triggerFrame",
          value: function _triggerFrame(t) {
            var _this138 = this;

            this._renderNextFrame = this._renderNextFrame || t, this.style && !this._frame && (this._frame = e.exported.frame(function (e) {
              var t = !!_this138._renderNextFrame;
              _this138._frame = null, _this138._renderNextFrame = null, t && _this138._render(e);
            }));
          }
        }, {
          key: "_preloadTiles",
          value: function _preloadTiles(t) {
            var _this139 = this;

            var i = this.style && Object.values(this.style._sourceCaches) || [];
            return e.asyncAll(i, function (e, i) {
              return e._preloadTiles(t, i);
            }, function () {
              _this139.triggerRepaint();
            }), this;
          }
        }, {
          key: "_onWindowOnline",
          value: function _onWindowOnline() {
            this._update();
          }
        }, {
          key: "_onWindowResize",
          value: function _onWindowResize(e) {
            this._trackResize && this.resize({
              originalEvent: e
            })._update();
          }
        }, {
          key: "showTileBoundaries",
          get: function get() {
            return !!this._showTileBoundaries;
          },
          set: function set(e) {
            this._showTileBoundaries !== e && (this._showTileBoundaries = e, this._update());
          }
        }, {
          key: "showTerrainWireframe",
          get: function get() {
            return !!this._showTerrainWireframe;
          },
          set: function set(e) {
            this._showTerrainWireframe !== e && (this._showTerrainWireframe = e, this._update());
          }
        }, {
          key: "speedIndexTiming",
          get: function get() {
            return !!this._speedIndexTiming;
          },
          set: function set(e) {
            this._speedIndexTiming !== e && (this._speedIndexTiming = e, this._update());
          }
        }, {
          key: "showPadding",
          get: function get() {
            return !!this._showPadding;
          },
          set: function set(e) {
            this._showPadding !== e && (this._showPadding = e, this._update());
          }
        }, {
          key: "showCollisionBoxes",
          get: function get() {
            return !!this._showCollisionBoxes;
          },
          set: function set(e) {
            this._showCollisionBoxes !== e && (this._showCollisionBoxes = e, e ? this.style._generateCollisionBoxes() : this._update());
          }
        }, {
          key: "showOverdrawInspector",
          get: function get() {
            return !!this._showOverdrawInspector;
          },
          set: function set(e) {
            this._showOverdrawInspector !== e && (this._showOverdrawInspector = e, this._update());
          }
        }, {
          key: "repaint",
          get: function get() {
            return !!this._repaint;
          },
          set: function set(e) {
            this._repaint !== e && (this._repaint = e, this.triggerRepaint());
          }
        }, {
          key: "vertices",
          get: function get() {
            return !!this._vertices;
          },
          set: function set(e) {
            this._vertices = e, this._update();
          }
        }, {
          key: "_setCacheLimits",
          value: function _setCacheLimits(t, i) {
            e.setCacheLimits(t, i);
          }
        }, {
          key: "version",
          get: function get() {
            return e.version;
          }
        }]);

        return Map;
      }(Cr),
      NavigationControl: /*#__PURE__*/function () {
        function NavigationControl(t) {
          var _this140 = this;

          _classCallCheck(this, NavigationControl);

          this.options = e.extend({}, Ur, t), this._container = a.create("div", "mapboxgl-ctrl mapboxgl-ctrl-group"), this._container.addEventListener("contextmenu", function (e) {
            return e.preventDefault();
          }), this.options.showZoom && (e.bindAll(["_setButtonTitle", "_updateZoomButtons"], this), this._zoomInButton = this._createButton("mapboxgl-ctrl-zoom-in", function (e) {
            return _this140._map.zoomIn({}, {
              originalEvent: e
            });
          }), a.create("span", "mapboxgl-ctrl-icon", this._zoomInButton).setAttribute("aria-hidden", !0), this._zoomOutButton = this._createButton("mapboxgl-ctrl-zoom-out", function (e) {
            return _this140._map.zoomOut({}, {
              originalEvent: e
            });
          }), a.create("span", "mapboxgl-ctrl-icon", this._zoomOutButton).setAttribute("aria-hidden", !0)), this.options.showCompass && (e.bindAll(["_rotateCompassArrow"], this), this._compass = this._createButton("mapboxgl-ctrl-compass", function (e) {
            _this140.options.visualizePitch ? _this140._map.resetNorthPitch({}, {
              originalEvent: e
            }) : _this140._map.resetNorth({}, {
              originalEvent: e
            });
          }), this._compassIcon = a.create("span", "mapboxgl-ctrl-icon", this._compass), this._compassIcon.setAttribute("aria-hidden", !0));
        }

        _createClass(NavigationControl, [{
          key: "_updateZoomButtons",
          value: function _updateZoomButtons() {
            var e = this._map.getZoom(),
                t = e === this._map.getMaxZoom(),
                i = e === this._map.getMinZoom();

            this._zoomInButton.disabled = t, this._zoomOutButton.disabled = i, this._zoomInButton.setAttribute("aria-disabled", t.toString()), this._zoomOutButton.setAttribute("aria-disabled", i.toString());
          }
        }, {
          key: "_rotateCompassArrow",
          value: function _rotateCompassArrow() {
            var _this141 = this;

            var e = this.options.visualizePitch ? "scale(".concat(1 / Math.pow(Math.cos(this._map.transform.pitch * (Math.PI / 180)), .5), ") rotateX(").concat(this._map.transform.pitch, "deg) rotateZ(").concat(this._map.transform.angle * (180 / Math.PI), "deg)") : "rotate(".concat(this._map.transform.angle * (180 / Math.PI), "deg)");

            this._map._requestDomTask(function () {
              _this141._compassIcon && (_this141._compassIcon.style.transform = e);
            });
          }
        }, {
          key: "onAdd",
          value: function onAdd(e) {
            return this._map = e, this.options.showZoom && (this._setButtonTitle(this._zoomInButton, "ZoomIn"), this._setButtonTitle(this._zoomOutButton, "ZoomOut"), this._map.on("zoom", this._updateZoomButtons), this._updateZoomButtons()), this.options.showCompass && (this._setButtonTitle(this._compass, "ResetBearing"), this.options.visualizePitch && this._map.on("pitch", this._rotateCompassArrow), this._map.on("rotate", this._rotateCompassArrow), this._rotateCompassArrow(), this._handler = new Nr(this._map, this._compass, this.options.visualizePitch)), this._container;
          }
        }, {
          key: "onRemove",
          value: function onRemove() {
            this._container.remove(), this.options.showZoom && this._map.off("zoom", this._updateZoomButtons), this.options.showCompass && (this.options.visualizePitch && this._map.off("pitch", this._rotateCompassArrow), this._map.off("rotate", this._rotateCompassArrow), this._handler.off(), delete this._handler), delete this._map;
          }
        }, {
          key: "_createButton",
          value: function _createButton(e, t) {
            var i = a.create("button", e, this._container);
            return i.type = "button", i.addEventListener("click", t), i;
          }
        }, {
          key: "_setButtonTitle",
          value: function _setButtonTitle(e, t) {
            var i = this._map._getUIString("NavigationControl.".concat(t));

            e.setAttribute("aria-label", i), e.firstElementChild && e.firstElementChild.setAttribute("title", i);
          }
        }]);

        return NavigationControl;
      }(),
      GeolocateControl: /*#__PURE__*/function (_e$Evented12) {
        _inherits(GeolocateControl, _e$Evented12);

        var _super134 = _createSuper(GeolocateControl);

        function GeolocateControl(t) {
          var _this142;

          _classCallCheck(this, GeolocateControl);

          _this142 = _super134.call(this), _this142.options = e.extend({}, Gr, t), e.bindAll(["_onSuccess", "_onError", "_onZoom", "_finish", "_setupUI", "_updateCamera", "_updateMarker", "_updateMarkerRotation"], _assertThisInitialized(_this142)), _this142._onDeviceOrientationListener = _this142._onDeviceOrientation.bind(_assertThisInitialized(_this142)), _this142._updateMarkerRotationThrottled = Io(_this142._updateMarkerRotation, 20);
          return _this142;
        }

        _createClass(GeolocateControl, [{
          key: "onAdd",
          value: function onAdd(t) {
            var i;
            return this._map = t, this._container = a.create("div", "mapboxgl-ctrl mapboxgl-ctrl-group"), i = this._setupUI, void 0 !== jr ? i(jr) : void 0 !== e.window.navigator.permissions ? e.window.navigator.permissions.query({
              name: "geolocation"
            }).then(function (e) {
              jr = "denied" !== e.state, i(jr);
            }) : (jr = !!e.window.navigator.geolocation, i(jr)), this._container;
          }
        }, {
          key: "onRemove",
          value: function onRemove() {
            void 0 !== this._geolocationWatchID && (e.window.navigator.geolocation.clearWatch(this._geolocationWatchID), this._geolocationWatchID = void 0), this.options.showUserLocation && this._userLocationDotMarker && this._userLocationDotMarker.remove(), this.options.showAccuracyCircle && this._accuracyCircleMarker && this._accuracyCircleMarker.remove(), this._container.remove(), this._map.off("zoom", this._onZoom), this._map = void 0, Zr = 0, Vr = !1;
          }
        }, {
          key: "_isOutOfMapMaxBounds",
          value: function _isOutOfMapMaxBounds(e) {
            var t = this._map.getMaxBounds(),
                i = e.coords;

            return t && (i.longitude < t.getWest() || i.longitude > t.getEast() || i.latitude < t.getSouth() || i.latitude > t.getNorth());
          }
        }, {
          key: "_setErrorState",
          value: function _setErrorState() {
            switch (this._watchState) {
              case "WAITING_ACTIVE":
                this._watchState = "ACTIVE_ERROR", this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"), this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");
                break;

              case "ACTIVE_LOCK":
                this._watchState = "ACTIVE_ERROR", this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"), this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"), this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");
                break;

              case "BACKGROUND":
                this._watchState = "BACKGROUND_ERROR", this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"), this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"), this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");
            }
          }
        }, {
          key: "_onSuccess",
          value: function _onSuccess(t) {
            if (this._map) {
              if (this._isOutOfMapMaxBounds(t)) return this._setErrorState(), this.fire(new e.Event("outofmaxbounds", t)), this._updateMarker(), void this._finish();
              if (this.options.trackUserLocation) switch (this._lastKnownPosition = t, this._watchState) {
                case "WAITING_ACTIVE":
                case "ACTIVE_LOCK":
                case "ACTIVE_ERROR":
                  this._watchState = "ACTIVE_LOCK", this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"), this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"), this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");
                  break;

                case "BACKGROUND":
                case "BACKGROUND_ERROR":
                  this._watchState = "BACKGROUND", this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"), this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"), this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");
              }
              this.options.showUserLocation && "OFF" !== this._watchState && this._updateMarker(t), this.options.trackUserLocation && "ACTIVE_LOCK" !== this._watchState || this._updateCamera(t), this.options.showUserLocation && this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"), this.fire(new e.Event("geolocate", t)), this._finish();
            }
          }
        }, {
          key: "_updateCamera",
          value: function _updateCamera(t) {
            var i = new e.LngLat(t.coords.longitude, t.coords.latitude),
                o = t.coords.accuracy,
                r = this._map.getBearing(),
                n = e.extend({
              bearing: r
            }, this.options.fitBoundsOptions);

            this._map.fitBounds(i.toBounds(o), n, {
              geolocateSource: !0
            });
          }
        }, {
          key: "_updateMarker",
          value: function _updateMarker(t) {
            if (t) {
              var _i295 = new e.LngLat(t.coords.longitude, t.coords.latitude);

              this._accuracyCircleMarker.setLngLat(_i295).addTo(this._map), this._userLocationDotMarker.setLngLat(_i295).addTo(this._map), this._accuracy = t.coords.accuracy, this.options.showUserLocation && this.options.showAccuracyCircle && this._updateCircleRadius();
            } else this._userLocationDotMarker.remove(), this._accuracyCircleMarker.remove();
          }
        }, {
          key: "_updateCircleRadius",
          value: function _updateCircleRadius() {
            var e = this._map._containerHeight / 2,
                t = this._map.unproject([0, e]),
                i = this._map.unproject([100, e]),
                o = t.distanceTo(i) / 100,
                r = Math.ceil(2 * this._accuracy / o);

            this._circleElement.style.width = "".concat(r, "px"), this._circleElement.style.height = "".concat(r, "px");
          }
        }, {
          key: "_onZoom",
          value: function _onZoom() {
            this.options.showUserLocation && this.options.showAccuracyCircle && this._updateCircleRadius();
          }
        }, {
          key: "_updateMarkerRotation",
          value: function _updateMarkerRotation() {
            this._userLocationDotMarker && "number" == typeof this._heading ? (this._userLocationDotMarker.setRotation(this._heading), this._dotElement.classList.add("mapboxgl-user-location-show-heading")) : (this._dotElement.classList.remove("mapboxgl-user-location-show-heading"), this._userLocationDotMarker.setRotation(0));
          }
        }, {
          key: "_onError",
          value: function _onError(t) {
            if (this._map) {
              if (this.options.trackUserLocation) if (1 === t.code) {
                this._watchState = "OFF", this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"), this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"), this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"), this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"), this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"), this._geolocateButton.disabled = !0;

                var _e456 = this._map._getUIString("GeolocateControl.LocationNotAvailable");

                this._geolocateButton.setAttribute("aria-label", _e456), this._geolocateButton.firstElementChild && this._geolocateButton.firstElementChild.setAttribute("title", _e456), void 0 !== this._geolocationWatchID && this._clearWatch();
              } else {
                if (3 === t.code && Vr) return;

                this._setErrorState();
              }
              "OFF" !== this._watchState && this.options.showUserLocation && this._dotElement.classList.add("mapboxgl-user-location-dot-stale"), this.fire(new e.Event("error", t)), this._finish();
            }
          }
        }, {
          key: "_finish",
          value: function _finish() {
            this._timeoutId && clearTimeout(this._timeoutId), this._timeoutId = void 0;
          }
        }, {
          key: "_setupUI",
          value: function _setupUI(t) {
            var _this143 = this;

            if (this._container.addEventListener("contextmenu", function (e) {
              return e.preventDefault();
            }), this._geolocateButton = a.create("button", "mapboxgl-ctrl-geolocate", this._container), a.create("span", "mapboxgl-ctrl-icon", this._geolocateButton).setAttribute("aria-hidden", !0), this._geolocateButton.type = "button", !1 === t) {
              e.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");

              var _t423 = this._map._getUIString("GeolocateControl.LocationNotAvailable");

              this._geolocateButton.disabled = !0, this._geolocateButton.setAttribute("aria-label", _t423), this._geolocateButton.firstElementChild && this._geolocateButton.firstElementChild.setAttribute("title", _t423);
            } else {
              var _e457 = this._map._getUIString("GeolocateControl.FindMyLocation");

              this._geolocateButton.setAttribute("aria-label", _e457), this._geolocateButton.firstElementChild && this._geolocateButton.firstElementChild.setAttribute("title", _e457);
            }

            this.options.trackUserLocation && (this._geolocateButton.setAttribute("aria-pressed", "false"), this._watchState = "OFF"), this.options.showUserLocation && (this._dotElement = a.create("div", "mapboxgl-user-location"), this._dotElement.appendChild(a.create("div", "mapboxgl-user-location-dot")), this._dotElement.appendChild(a.create("div", "mapboxgl-user-location-heading")), this._userLocationDotMarker = new Pr({
              element: this._dotElement,
              rotationAlignment: "map",
              pitchAlignment: "map"
            }), this._circleElement = a.create("div", "mapboxgl-user-location-accuracy-circle"), this._accuracyCircleMarker = new Pr({
              element: this._circleElement,
              pitchAlignment: "map"
            }), this.options.trackUserLocation && (this._watchState = "OFF"), this._map.on("zoom", this._onZoom)), this._geolocateButton.addEventListener("click", this.trigger.bind(this)), this._setup = !0, this.options.trackUserLocation && this._map.on("movestart", function (t) {
              t.geolocateSource || "ACTIVE_LOCK" !== _this143._watchState || t.originalEvent && "resize" === t.originalEvent.type || (_this143._watchState = "BACKGROUND", _this143._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"), _this143._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"), _this143.fire(new e.Event("trackuserlocationend")));
            });
          }
        }, {
          key: "_onDeviceOrientation",
          value: function _onDeviceOrientation(e) {
            this._userLocationDotMarker && (e.webkitCompassHeading ? this._heading = e.webkitCompassHeading : !0 === e.absolute && (this._heading = -1 * e.alpha), this._updateMarkerRotationThrottled());
          }
        }, {
          key: "trigger",
          value: function trigger() {
            if (!this._setup) return e.warnOnce("Geolocate control triggered before added to a map"), !1;

            if (this.options.trackUserLocation) {
              switch (this._watchState) {
                case "OFF":
                  this._watchState = "WAITING_ACTIVE", this.fire(new e.Event("trackuserlocationstart"));
                  break;

                case "WAITING_ACTIVE":
                case "ACTIVE_LOCK":
                case "ACTIVE_ERROR":
                case "BACKGROUND_ERROR":
                  Zr--, Vr = !1, this._watchState = "OFF", this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"), this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"), this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"), this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"), this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"), this.fire(new e.Event("trackuserlocationend"));
                  break;

                case "BACKGROUND":
                  this._watchState = "ACTIVE_LOCK", this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"), this._lastKnownPosition && this._updateCamera(this._lastKnownPosition), this.fire(new e.Event("trackuserlocationstart"));
              }

              switch (this._watchState) {
                case "WAITING_ACTIVE":
                  this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"), this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");
                  break;

                case "ACTIVE_LOCK":
                  this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");

                  break;

                case "ACTIVE_ERROR":
                  this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"), this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");
                  break;

                case "BACKGROUND":
                  this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");

                  break;

                case "BACKGROUND_ERROR":
                  this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"), this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error");
              }

              if ("OFF" === this._watchState && void 0 !== this._geolocationWatchID) this._clearWatch();else if (void 0 === this._geolocationWatchID) {
                var _t424;

                this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"), this._geolocateButton.setAttribute("aria-pressed", "true"), Zr++, Zr > 1 ? (_t424 = {
                  maximumAge: 6e5,
                  timeout: 0
                }, Vr = !0) : (_t424 = this.options.positionOptions, Vr = !1), this._geolocationWatchID = e.window.navigator.geolocation.watchPosition(this._onSuccess, this._onError, _t424), this.options.showUserHeading && this._addDeviceOrientationListener();
              }
            } else e.window.navigator.geolocation.getCurrentPosition(this._onSuccess, this._onError, this.options.positionOptions), this._timeoutId = setTimeout(this._finish, 1e4);

            return !0;
          }
        }, {
          key: "_addDeviceOrientationListener",
          value: function _addDeviceOrientationListener() {
            var _this144 = this;

            var t = function t() {
              e.window.addEventListener("ondeviceorientationabsolute" in e.window ? "deviceorientationabsolute" : "deviceorientation", _this144._onDeviceOrientationListener);
            };

            void 0 !== e.window.DeviceMotionEvent && "function" == typeof e.window.DeviceMotionEvent.requestPermission ? DeviceOrientationEvent.requestPermission().then(function (e) {
              "granted" === e && t();
            })["catch"](console.error) : t();
          }
        }, {
          key: "_clearWatch",
          value: function _clearWatch() {
            e.window.navigator.geolocation.clearWatch(this._geolocationWatchID), e.window.removeEventListener("deviceorientation", this._onDeviceOrientationListener), e.window.removeEventListener("deviceorientationabsolute", this._onDeviceOrientationListener), this._geolocationWatchID = void 0, this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"), this._geolocateButton.setAttribute("aria-pressed", "false"), this.options.showUserLocation && this._updateMarker(null);
          }
        }]);

        return GeolocateControl;
      }(e.Evented),
      AttributionControl: Mr,
      ScaleControl: /*#__PURE__*/function () {
        function ScaleControl(t) {
          _classCallCheck(this, ScaleControl);

          this.options = e.extend({}, Wr, t), e.bindAll(["_onMove", "setUnit"], this);
        }

        _createClass(ScaleControl, [{
          key: "getDefaultPosition",
          value: function getDefaultPosition() {
            return "bottom-left";
          }
        }, {
          key: "_onMove",
          value: function _onMove() {
            qr(this._map, this._container, this.options);
          }
        }, {
          key: "onAdd",
          value: function onAdd(e) {
            return this._map = e, this._container = a.create("div", "mapboxgl-ctrl mapboxgl-ctrl-scale", e.getContainer()), this._map.on("move", this._onMove), this._onMove(), this._container;
          }
        }, {
          key: "onRemove",
          value: function onRemove() {
            this._container.remove(), this._map.off("move", this._onMove), this._map = void 0;
          }
        }, {
          key: "setUnit",
          value: function setUnit(e) {
            this.options.unit = e, qr(this._map, this._container, this.options);
          }
        }]);

        return ScaleControl;
      }(),
      FullscreenControl: /*#__PURE__*/function () {
        function FullscreenControl(t) {
          _classCallCheck(this, FullscreenControl);

          this._fullscreen = !1, t && t.container && (t.container instanceof e.window.HTMLElement ? this._container = t.container : e.warnOnce("Full screen control 'container' must be a DOM element.")), e.bindAll(["_onClickFullscreen", "_changeIcon"], this), "onfullscreenchange" in e.window.document ? this._fullscreenchange = "fullscreenchange" : "onwebkitfullscreenchange" in e.window.document && (this._fullscreenchange = "webkitfullscreenchange");
        }

        _createClass(FullscreenControl, [{
          key: "onAdd",
          value: function onAdd(t) {
            return this._map = t, this._container || (this._container = this._map.getContainer()), this._controlContainer = a.create("div", "mapboxgl-ctrl mapboxgl-ctrl-group"), this._checkFullscreenSupport() ? this._setupUI() : (this._controlContainer.style.display = "none", e.warnOnce("This device does not support fullscreen mode.")), this._controlContainer;
          }
        }, {
          key: "onRemove",
          value: function onRemove() {
            this._controlContainer.remove(), this._map = null, e.window.document.removeEventListener(this._fullscreenchange, this._changeIcon);
          }
        }, {
          key: "_checkFullscreenSupport",
          value: function _checkFullscreenSupport() {
            return !(!e.window.document.fullscreenEnabled && !e.window.document.webkitFullscreenEnabled);
          }
        }, {
          key: "_setupUI",
          value: function _setupUI() {
            var t = this._fullscreenButton = a.create("button", "mapboxgl-ctrl-fullscreen", this._controlContainer);
            a.create("span", "mapboxgl-ctrl-icon", t).setAttribute("aria-hidden", !0), t.type = "button", this._updateTitle(), this._fullscreenButton.addEventListener("click", this._onClickFullscreen), e.window.document.addEventListener(this._fullscreenchange, this._changeIcon);
          }
        }, {
          key: "_updateTitle",
          value: function _updateTitle() {
            var e = this._getTitle();

            this._fullscreenButton.setAttribute("aria-label", e), this._fullscreenButton.firstElementChild && this._fullscreenButton.firstElementChild.setAttribute("title", e);
          }
        }, {
          key: "_getTitle",
          value: function _getTitle() {
            return this._map._getUIString(this._isFullscreen() ? "FullscreenControl.Exit" : "FullscreenControl.Enter");
          }
        }, {
          key: "_isFullscreen",
          value: function _isFullscreen() {
            return this._fullscreen;
          }
        }, {
          key: "_changeIcon",
          value: function _changeIcon() {
            (e.window.document.fullscreenElement || e.window.document.webkitFullscreenElement) === this._container !== this._fullscreen && (this._fullscreen = !this._fullscreen, this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"), this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"), this._updateTitle());
          }
        }, {
          key: "_onClickFullscreen",
          value: function _onClickFullscreen() {
            this._isFullscreen() ? e.window.document.exitFullscreen ? e.window.document.exitFullscreen() : e.window.document.webkitCancelFullScreen && e.window.document.webkitCancelFullScreen() : this._container.requestFullscreen ? this._container.requestFullscreen() : this._container.webkitRequestFullscreen && this._container.webkitRequestFullscreen();
          }
        }]);

        return FullscreenControl;
      }(),
      Popup: /*#__PURE__*/function (_e$Evented13) {
        _inherits(Popup, _e$Evented13);

        var _super135 = _createSuper(Popup);

        function Popup(t) {
          var _this145;

          _classCallCheck(this, Popup);

          _this145 = _super135.call(this), _this145.options = e.extend(Object.create($r), t), e.bindAll(["_update", "_onClose", "remove", "_onMouseMove", "_onMouseUp", "_onDrag"], _assertThisInitialized(_this145)), _this145._classList = new Set(t && t.className ? t.className.trim().split(/\s+/) : []);
          return _this145;
        }

        _createClass(Popup, [{
          key: "addTo",
          value: function addTo(t) {
            return this._map && this.remove(), this._map = t, this.options.closeOnClick && this._map.on("preclick", this._onClose), this.options.closeOnMove && this._map.on("move", this._onClose), this._map.on("remove", this.remove), this._update(), this._focusFirstElement(), this._trackPointer ? (this._map.on("mousemove", this._onMouseMove), this._map.on("mouseup", this._onMouseUp), this._map._canvasContainer.classList.add("mapboxgl-track-pointer")) : this._map.on("move", this._update), this.fire(new e.Event("open")), this;
          }
        }, {
          key: "isOpen",
          value: function isOpen() {
            return !!this._map;
          }
        }, {
          key: "remove",
          value: function remove() {
            return this._content && this._content.remove(), this._container && (this._container.remove(), delete this._container), this._map && (this._map.off("move", this._update), this._map.off("move", this._onClose), this._map.off("click", this._onClose), this._map.off("remove", this.remove), this._map.off("mousemove", this._onMouseMove), this._map.off("mouseup", this._onMouseUp), this._map.off("drag", this._onDrag), delete this._map), this.fire(new e.Event("close")), this;
          }
        }, {
          key: "getLngLat",
          value: function getLngLat() {
            return this._lngLat;
          }
        }, {
          key: "setLngLat",
          value: function setLngLat(t) {
            return this._lngLat = e.LngLat.convert(t), this._pos = null, this._trackPointer = !1, this._update(), this._map && (this._map.on("move", this._update), this._map.off("mousemove", this._onMouseMove), this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")), this;
          }
        }, {
          key: "trackPointer",
          value: function trackPointer() {
            return this._trackPointer = !0, this._pos = null, this._update(), this._map && (this._map.off("move", this._update), this._map.on("mousemove", this._onMouseMove), this._map.on("drag", this._onDrag), this._map._canvasContainer.classList.add("mapboxgl-track-pointer")), this;
          }
        }, {
          key: "getElement",
          value: function getElement() {
            return this._container;
          }
        }, {
          key: "setText",
          value: function setText(t) {
            return this.setDOMContent(e.window.document.createTextNode(t));
          }
        }, {
          key: "setHTML",
          value: function setHTML(t) {
            var i = e.window.document.createDocumentFragment(),
                o = e.window.document.createElement("body");
            var r;

            for (o.innerHTML = t; r = o.firstChild, r;) {
              i.appendChild(r);
            }

            return this.setDOMContent(i);
          }
        }, {
          key: "getMaxWidth",
          value: function getMaxWidth() {
            return this._container && this._container.style.maxWidth;
          }
        }, {
          key: "setMaxWidth",
          value: function setMaxWidth(e) {
            return this.options.maxWidth = e, this._update(), this;
          }
        }, {
          key: "setDOMContent",
          value: function setDOMContent(e) {
            if (this._content) for (; this._content.hasChildNodes();) {
              this._content.firstChild && this._content.removeChild(this._content.firstChild);
            } else this._content = a.create("div", "mapboxgl-popup-content", this._container);
            return this._content.appendChild(e), this._createCloseButton(), this._update(), this._focusFirstElement(), this;
          }
        }, {
          key: "addClassName",
          value: function addClassName(e) {
            return this._classList.add(e), this._container && this._updateClassList(), this;
          }
        }, {
          key: "removeClassName",
          value: function removeClassName(e) {
            return this._classList["delete"](e), this._container && this._updateClassList(), this;
          }
        }, {
          key: "setOffset",
          value: function setOffset(e) {
            return this.options.offset = e, this._update(), this;
          }
        }, {
          key: "toggleClassName",
          value: function toggleClassName(e) {
            var t;
            return this._classList["delete"](e) ? t = !1 : (this._classList.add(e), t = !0), this._container && this._updateClassList(), t;
          }
        }, {
          key: "_createCloseButton",
          value: function _createCloseButton() {
            this.options.closeButton && (this._closeButton = a.create("button", "mapboxgl-popup-close-button", this._content), this._closeButton.type = "button", this._closeButton.setAttribute("aria-label", "Close popup"), this._closeButton.setAttribute("aria-hidden", "true"), this._closeButton.innerHTML = "&#215;", this._closeButton.addEventListener("click", this._onClose));
          }
        }, {
          key: "_onMouseUp",
          value: function _onMouseUp(e) {
            this._update(e.point);
          }
        }, {
          key: "_onMouseMove",
          value: function _onMouseMove(e) {
            this._update(e.point);
          }
        }, {
          key: "_onDrag",
          value: function _onDrag(e) {
            this._update(e.point);
          }
        }, {
          key: "_getAnchor",
          value: function _getAnchor(e) {
            if (this.options.anchor) return this.options.anchor;
            var t = this._pos,
                i = this._container.offsetWidth,
                o = this._container.offsetHeight;
            var r;
            return r = t.y + e.bottom.y < o ? ["top"] : t.y > this._map.transform.height - o ? ["bottom"] : [], t.x < i / 2 ? r.push("left") : t.x > this._map.transform.width - i / 2 && r.push("right"), 0 === r.length ? "bottom" : r.join("-");
          }
        }, {
          key: "_updateClassList",
          value: function _updateClassList() {
            var e = _toConsumableArray(this._classList);

            e.push("mapboxgl-popup"), this._anchor && e.push("mapboxgl-popup-anchor-".concat(this._anchor)), this._trackPointer && e.push("mapboxgl-popup-track-pointer"), this._container.className = e.join(" ");
          }
        }, {
          key: "_update",
          value: function _update(t) {
            var _this146 = this;

            if (this._map && (this._lngLat || this._trackPointer) && this._content) {
              if (this._container || (this._container = a.create("div", "mapboxgl-popup", this._map.getContainer()), this._tip = a.create("div", "mapboxgl-popup-tip", this._container), this._container.appendChild(this._content)), this.options.maxWidth && this._container.style.maxWidth !== this.options.maxWidth && (this._container.style.maxWidth = this.options.maxWidth), this._map.transform.renderWorldCopies && !this._trackPointer && (this._lngLat = zr(this._lngLat, this._pos, this._map.transform)), !this._trackPointer || t) {
                var _i296 = this._pos = this._trackPointer && t ? t : this._map.project(this._lngLat),
                    _o173 = function (t) {
                  if (t || (t = new e.pointGeometry(0, 0)), "number" == typeof t) {
                    var _i297 = Math.round(Math.sqrt(.5 * Math.pow(t, 2)));

                    return {
                      center: new e.pointGeometry(0, 0),
                      top: new e.pointGeometry(0, t),
                      "top-left": new e.pointGeometry(_i297, _i297),
                      "top-right": new e.pointGeometry(-_i297, _i297),
                      bottom: new e.pointGeometry(0, -t),
                      "bottom-left": new e.pointGeometry(_i297, -_i297),
                      "bottom-right": new e.pointGeometry(-_i297, -_i297),
                      left: new e.pointGeometry(t, 0),
                      right: new e.pointGeometry(-t, 0)
                    };
                  }

                  if (t instanceof e.pointGeometry || Array.isArray(t)) {
                    var _i298 = e.pointGeometry.convert(t);

                    return {
                      center: _i298,
                      top: _i298,
                      "top-left": _i298,
                      "top-right": _i298,
                      bottom: _i298,
                      "bottom-left": _i298,
                      "bottom-right": _i298,
                      left: _i298,
                      right: _i298
                    };
                  }

                  return {
                    center: e.pointGeometry.convert(t.center || [0, 0]),
                    top: e.pointGeometry.convert(t.top || [0, 0]),
                    "top-left": e.pointGeometry.convert(t["top-left"] || [0, 0]),
                    "top-right": e.pointGeometry.convert(t["top-right"] || [0, 0]),
                    bottom: e.pointGeometry.convert(t.bottom || [0, 0]),
                    "bottom-left": e.pointGeometry.convert(t["bottom-left"] || [0, 0]),
                    "bottom-right": e.pointGeometry.convert(t["bottom-right"] || [0, 0]),
                    left: e.pointGeometry.convert(t.left || [0, 0]),
                    right: e.pointGeometry.convert(t.right || [0, 0])
                  };
                }(this.options.offset),
                    _r300 = this._anchor = this._getAnchor(_o173),
                    _n206 = _i296.add(_o173[_r300]).round();

                this._map._requestDomTask(function () {
                  _this146._container && _r300 && (_this146._container.style.transform = "".concat(Dr[_r300], " translate(").concat(_n206.x, "px,").concat(_n206.y, "px)"));
                });
              }

              this._updateClassList();
            }
          }
        }, {
          key: "_focusFirstElement",
          value: function _focusFirstElement() {
            if (!this.options.focusAfterOpen || !this._container) return;

            var e = this._container.querySelector(Hr);

            e && e.focus();
          }
        }, {
          key: "_onClose",
          value: function _onClose() {
            this.remove();
          }
        }, {
          key: "_setOpacity",
          value: function _setOpacity(e) {
            this._content && (this._content.style.opacity = e), this._tip && (this._tip.style.opacity = e);
          }
        }]);

        return Popup;
      }(e.Evented),
      Marker: Pr,
      Style: Nt,
      LngLat: e.LngLat,
      LngLatBounds: e.LngLatBounds,
      Point: e.pointGeometry,
      MercatorCoordinate: e.MercatorCoordinate,
      FreeCameraOptions: xo,
      Evented: e.Evented,
      config: e.config,
      prewarm: function prewarm() {
        Ae().acquire(ze);
      },
      clearPrewarmedResources: function clearPrewarmedResources() {
        var e = Pe;
        e && (e.isPreloaded() && 1 === e.numActive() ? (e.release(ze), Pe = null) : console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"));
      },

      get accessToken() {
        return e.config.ACCESS_TOKEN;
      },

      set accessToken(t) {
        e.config.ACCESS_TOKEN = t;
      },

      get baseApiUrl() {
        return e.config.API_URL;
      },

      set baseApiUrl(t) {
        e.config.API_URL = t;
      },

      get workerCount() {
        return De.workerCount;
      },

      set workerCount(e) {
        De.workerCount = e;
      },

      get maxParallelImageRequests() {
        return e.config.MAX_PARALLEL_IMAGE_REQUESTS;
      },

      set maxParallelImageRequests(t) {
        e.config.MAX_PARALLEL_IMAGE_REQUESTS = t;
      },

      clearStorage: function clearStorage(t) {
        e.clearTileCache(t);
      },
      workerUrl: "",
      workerClass: null,
      setNow: e.exported.setNow,
      restoreNow: e.exported.restoreNow
    };
    return Kr;
  }); //

  var mapboxgl$1 = mapboxgl;
  return mapboxgl$1;
});
/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../../process/browser.js */ "./node_modules/process/browser.js")))

/***/ }),

/***/ "./node_modules/node-libs-browser/mock/empty.js":
/*!******************************************************!*\
  !*** ./node_modules/node-libs-browser/mock/empty.js ***!
  \******************************************************/
/*! no static exports found */
/***/ (function(module, exports) {



/***/ }),

/***/ "./node_modules/os-browserify/browser.js":
/*!***********************************************!*\
  !*** ./node_modules/os-browserify/browser.js ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports) {

exports.endianness = function () {
  return 'LE';
};

exports.hostname = function () {
  if (typeof location !== 'undefined') {
    return location.hostname;
  } else return '';
};

exports.loadavg = function () {
  return [];
};

exports.uptime = function () {
  return 0;
};

exports.freemem = function () {
  return Number.MAX_VALUE;
};

exports.totalmem = function () {
  return Number.MAX_VALUE;
};

exports.cpus = function () {
  return [];
};

exports.type = function () {
  return 'Browser';
};

exports.release = function () {
  if (typeof navigator !== 'undefined') {
    return navigator.appVersion;
  }

  return '';
};

exports.networkInterfaces = exports.getNetworkInterfaces = function () {
  return {};
};

exports.arch = function () {
  return 'javascript';
};

exports.platform = function () {
  return 'browser';
};

exports.tmpdir = exports.tmpDir = function () {
  return '/tmp';
};

exports.EOL = '\n';

exports.homedir = function () {
  return '/';
};

/***/ }),

/***/ "./node_modules/path-browserify/index.js":
/*!***********************************************!*\
  !*** ./node_modules/path-browserify/index.js ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(process) {// .dirname, .basename, and .extname methods are extracted from Node.js v8.11.1,
// backported and transplited with Babel, with backwards-compat fixes
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.
// resolves . and .. elements in a path array with directory names there
// must be no slashes, empty elements, or device names (c:\) in the array
// (so also no leading and trailing slashes - it does not distinguish
// relative and absolute paths)
function normalizeArray(parts, allowAboveRoot) {
  // if the path tries to go above the root, `up` ends up > 0
  var up = 0;

  for (var i = parts.length - 1; i >= 0; i--) {
    var last = parts[i];

    if (last === '.') {
      parts.splice(i, 1);
    } else if (last === '..') {
      parts.splice(i, 1);
      up++;
    } else if (up) {
      parts.splice(i, 1);
      up--;
    }
  } // if the path is allowed to go above the root, restore leading ..s


  if (allowAboveRoot) {
    for (; up--; up) {
      parts.unshift('..');
    }
  }

  return parts;
} // path.resolve([from ...], to)
// posix version


exports.resolve = function () {
  var resolvedPath = '',
      resolvedAbsolute = false;

  for (var i = arguments.length - 1; i >= -1 && !resolvedAbsolute; i--) {
    var path = i >= 0 ? arguments[i] : process.cwd(); // Skip empty and invalid entries

    if (typeof path !== 'string') {
      throw new TypeError('Arguments to path.resolve must be strings');
    } else if (!path) {
      continue;
    }

    resolvedPath = path + '/' + resolvedPath;
    resolvedAbsolute = path.charAt(0) === '/';
  } // At this point the path should be resolved to a full absolute path, but
  // handle relative paths to be safe (might happen when process.cwd() fails)
  // Normalize the path


  resolvedPath = normalizeArray(filter(resolvedPath.split('/'), function (p) {
    return !!p;
  }), !resolvedAbsolute).join('/');
  return (resolvedAbsolute ? '/' : '') + resolvedPath || '.';
}; // path.normalize(path)
// posix version


exports.normalize = function (path) {
  var isAbsolute = exports.isAbsolute(path),
      trailingSlash = substr(path, -1) === '/'; // Normalize the path

  path = normalizeArray(filter(path.split('/'), function (p) {
    return !!p;
  }), !isAbsolute).join('/');

  if (!path && !isAbsolute) {
    path = '.';
  }

  if (path && trailingSlash) {
    path += '/';
  }

  return (isAbsolute ? '/' : '') + path;
}; // posix version


exports.isAbsolute = function (path) {
  return path.charAt(0) === '/';
}; // posix version


exports.join = function () {
  var paths = Array.prototype.slice.call(arguments, 0);
  return exports.normalize(filter(paths, function (p, index) {
    if (typeof p !== 'string') {
      throw new TypeError('Arguments to path.join must be strings');
    }

    return p;
  }).join('/'));
}; // path.relative(from, to)
// posix version


exports.relative = function (from, to) {
  from = exports.resolve(from).substr(1);
  to = exports.resolve(to).substr(1);

  function trim(arr) {
    var start = 0;

    for (; start < arr.length; start++) {
      if (arr[start] !== '') break;
    }

    var end = arr.length - 1;

    for (; end >= 0; end--) {
      if (arr[end] !== '') break;
    }

    if (start > end) return [];
    return arr.slice(start, end - start + 1);
  }

  var fromParts = trim(from.split('/'));
  var toParts = trim(to.split('/'));
  var length = Math.min(fromParts.length, toParts.length);
  var samePartsLength = length;

  for (var i = 0; i < length; i++) {
    if (fromParts[i] !== toParts[i]) {
      samePartsLength = i;
      break;
    }
  }

  var outputParts = [];

  for (var i = samePartsLength; i < fromParts.length; i++) {
    outputParts.push('..');
  }

  outputParts = outputParts.concat(toParts.slice(samePartsLength));
  return outputParts.join('/');
};

exports.sep = '/';
exports.delimiter = ':';

exports.dirname = function (path) {
  if (typeof path !== 'string') path = path + '';
  if (path.length === 0) return '.';
  var code = path.charCodeAt(0);
  var hasRoot = code === 47
  /*/*/
  ;
  var end = -1;
  var matchedSlash = true;

  for (var i = path.length - 1; i >= 1; --i) {
    code = path.charCodeAt(i);

    if (code === 47
    /*/*/
    ) {
      if (!matchedSlash) {
        end = i;
        break;
      }
    } else {
      // We saw the first non-path separator
      matchedSlash = false;
    }
  }

  if (end === -1) return hasRoot ? '/' : '.';

  if (hasRoot && end === 1) {
    // return '//';
    // Backwards-compat fix:
    return '/';
  }

  return path.slice(0, end);
};

function basename(path) {
  if (typeof path !== 'string') path = path + '';
  var start = 0;
  var end = -1;
  var matchedSlash = true;
  var i;

  for (i = path.length - 1; i >= 0; --i) {
    if (path.charCodeAt(i) === 47
    /*/*/
    ) {
      // If we reached a path separator that was not part of a set of path
      // separators at the end of the string, stop now
      if (!matchedSlash) {
        start = i + 1;
        break;
      }
    } else if (end === -1) {
      // We saw the first non-path separator, mark this as the end of our
      // path component
      matchedSlash = false;
      end = i + 1;
    }
  }

  if (end === -1) return '';
  return path.slice(start, end);
} // Uses a mixed approach for backwards-compatibility, as ext behavior changed
// in new Node.js versions, so only basename() above is backported here


exports.basename = function (path, ext) {
  var f = basename(path);

  if (ext && f.substr(-1 * ext.length) === ext) {
    f = f.substr(0, f.length - ext.length);
  }

  return f;
};

exports.extname = function (path) {
  if (typeof path !== 'string') path = path + '';
  var startDot = -1;
  var startPart = 0;
  var end = -1;
  var matchedSlash = true; // Track the state of characters (if any) we see before our first dot and
  // after any path separator we find

  var preDotState = 0;

  for (var i = path.length - 1; i >= 0; --i) {
    var code = path.charCodeAt(i);

    if (code === 47
    /*/*/
    ) {
      // If we reached a path separator that was not part of a set of path
      // separators at the end of the string, stop now
      if (!matchedSlash) {
        startPart = i + 1;
        break;
      }

      continue;
    }

    if (end === -1) {
      // We saw the first non-path separator, mark this as the end of our
      // extension
      matchedSlash = false;
      end = i + 1;
    }

    if (code === 46
    /*.*/
    ) {
      // If this is our first dot, mark it as the start of our extension
      if (startDot === -1) startDot = i;else if (preDotState !== 1) preDotState = 1;
    } else if (startDot !== -1) {
      // We saw a non-dot and non-path separator before our dot, so we should
      // have a good chance at having a non-empty extension
      preDotState = -1;
    }
  }

  if (startDot === -1 || end === -1 || // We saw a non-dot character immediately before the dot
  preDotState === 0 || // The (right-most) trimmed path component is exactly '..'
  preDotState === 1 && startDot === end - 1 && startDot === startPart + 1) {
    return '';
  }

  return path.slice(startDot, end);
};

function filter(xs, f) {
  if (xs.filter) return xs.filter(f);
  var res = [];

  for (var i = 0; i < xs.length; i++) {
    if (f(xs[i], i, xs)) res.push(xs[i]);
  }

  return res;
} // String.prototype.substr - negative index don't work in IE8


var substr = 'ab'.substr(-1) === 'b' ? function (str, start, len) {
  return str.substr(start, len);
} : function (str, start, len) {
  if (start < 0) start = str.length + start;
  return str.substr(start, len);
};
/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../process/browser.js */ "./node_modules/process/browser.js")))

/***/ }),

/***/ "./node_modules/process/browser.js":
/*!*****************************************!*\
  !*** ./node_modules/process/browser.js ***!
  \*****************************************/
/*! no static exports found */
/***/ (function(module, exports) {

// shim for using process in browser
var process = module.exports = {}; // cached from whatever global is present so that test runners that stub it
// don't break things.  But we need to wrap it in a try catch in case it is
// wrapped in strict mode code which doesn't define any globals.  It's inside a
// function because try/catches deoptimize in certain engines.

var cachedSetTimeout;
var cachedClearTimeout;

function defaultSetTimout() {
  throw new Error('setTimeout has not been defined');
}

function defaultClearTimeout() {
  throw new Error('clearTimeout has not been defined');
}

(function () {
  try {
    if (typeof setTimeout === 'function') {
      cachedSetTimeout = setTimeout;
    } else {
      cachedSetTimeout = defaultSetTimout;
    }
  } catch (e) {
    cachedSetTimeout = defaultSetTimout;
  }

  try {
    if (typeof clearTimeout === 'function') {
      cachedClearTimeout = clearTimeout;
    } else {
      cachedClearTimeout = defaultClearTimeout;
    }
  } catch (e) {
    cachedClearTimeout = defaultClearTimeout;
  }
})();

function runTimeout(fun) {
  if (cachedSetTimeout === setTimeout) {
    //normal enviroments in sane situations
    return setTimeout(fun, 0);
  } // if setTimeout wasn't available but was latter defined


  if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {
    cachedSetTimeout = setTimeout;
    return setTimeout(fun, 0);
  }

  try {
    // when when somebody has screwed with setTimeout but no I.E. maddness
    return cachedSetTimeout(fun, 0);
  } catch (e) {
    try {
      // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally
      return cachedSetTimeout.call(null, fun, 0);
    } catch (e) {
      // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error
      return cachedSetTimeout.call(this, fun, 0);
    }
  }
}

function runClearTimeout(marker) {
  if (cachedClearTimeout === clearTimeout) {
    //normal enviroments in sane situations
    return clearTimeout(marker);
  } // if clearTimeout wasn't available but was latter defined


  if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {
    cachedClearTimeout = clearTimeout;
    return clearTimeout(marker);
  }

  try {
    // when when somebody has screwed with setTimeout but no I.E. maddness
    return cachedClearTimeout(marker);
  } catch (e) {
    try {
      // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally
      return cachedClearTimeout.call(null, marker);
    } catch (e) {
      // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.
      // Some versions of I.E. have different rules for clearTimeout vs setTimeout
      return cachedClearTimeout.call(this, marker);
    }
  }
}

var queue = [];
var draining = false;
var currentQueue;
var queueIndex = -1;

function cleanUpNextTick() {
  if (!draining || !currentQueue) {
    return;
  }

  draining = false;

  if (currentQueue.length) {
    queue = currentQueue.concat(queue);
  } else {
    queueIndex = -1;
  }

  if (queue.length) {
    drainQueue();
  }
}

function drainQueue() {
  if (draining) {
    return;
  }

  var timeout = runTimeout(cleanUpNextTick);
  draining = true;
  var len = queue.length;

  while (len) {
    currentQueue = queue;
    queue = [];

    while (++queueIndex < len) {
      if (currentQueue) {
        currentQueue[queueIndex].run();
      }
    }

    queueIndex = -1;
    len = queue.length;
  }

  currentQueue = null;
  draining = false;
  runClearTimeout(timeout);
}

process.nextTick = function (fun) {
  var args = new Array(arguments.length - 1);

  if (arguments.length > 1) {
    for (var i = 1; i < arguments.length; i++) {
      args[i - 1] = arguments[i];
    }
  }

  queue.push(new Item(fun, args));

  if (queue.length === 1 && !draining) {
    runTimeout(drainQueue);
  }
}; // v8 likes predictible objects


function Item(fun, array) {
  this.fun = fun;
  this.array = array;
}

Item.prototype.run = function () {
  this.fun.apply(null, this.array);
};

process.title = 'browser';
process.browser = true;
process.env = {};
process.argv = [];
process.version = ''; // empty string to avoid regexp issues

process.versions = {};

function noop() {}

process.on = noop;
process.addListener = noop;
process.once = noop;
process.off = noop;
process.removeListener = noop;
process.removeAllListeners = noop;
process.emit = noop;
process.prependListener = noop;
process.prependOnceListener = noop;

process.listeners = function (name) {
  return [];
};

process.binding = function (name) {
  throw new Error('process.binding is not supported');
};

process.cwd = function () {
  return '/';
};

process.chdir = function (dir) {
  throw new Error('process.chdir is not supported');
};

process.umask = function () {
  return 0;
};

/***/ })

/******/ });
//# sourceMappingURL=museums-a0276b715ee8d80ab74d.js.map